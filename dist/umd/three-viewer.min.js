!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(function(){return function(){var e={58:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},739:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},860:function(e,t,n){var r=n(58);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},734:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},142:function(e){function t(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=e.apply(n,r);function s(e){t(o,i,a,s,u,"next",e)}function u(e){t(o,i,a,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},510:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},874:function(e,t,n){var r=n(975),i=n(526);function a(t,n,o){return i()?(e.exports=a=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=a=function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&r(a,n.prototype),a},e.exports.__esModule=!0,e.exports.default=e.exports),a.apply(null,arguments)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},834:function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},554:function(e,t,n){var r=n(818);e.exports=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}},e.exports.__esModule=!0,e.exports.default=e.exports},865:function(e,t,n){var r=n(884),i=n(526),a=n(641);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var o=r(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return a(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},521:function(e){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},621:function(e,t,n){var r=n(831);function i(){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=i=function(e,t,n){var i=r(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},e.exports.__esModule=!0,e.exports.default=e.exports),i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},884:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},564:function(e,t,n){var r=n(975);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},139:function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports},526:function(e){e.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},533:function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},228:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}},e.exports.__esModule=!0,e.exports.default=e.exports},93:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},557:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},641:function(e,t,n){var r=n(888).default,i=n(734);e.exports=function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},271:function(e,t,n){var r=n(888).default;function i(){"use strict";e.exports=i=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,a=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,a=Object.create(i.prototype),o=new E(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return A()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=M(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=f(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d={};function p(){}function v(){}function m(){}var g={};c(g,s,(function(){return this}));var y=Object.getPrototypeOf,x=y&&y(y(k([])));x&&x!==n&&a.call(x,s)&&(g=x);var _=m.prototype=p.prototype=Object.create(g);function b(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(i,o,s,u){var l=f(e[i],e,o);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==r(h)&&a.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(h).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function M(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,M(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=f(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function k(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(a.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:A}}function A(){return{value:void 0,done:!0}}return v.prototype=m,c(_,"constructor",m),c(m,"constructor",v),v.displayName=c(m,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,l,"GeneratorFunction")),e.prototype=Object.create(_),e},t.awrap=function(e){return{__await:e}},b(T.prototype),c(T.prototype,u,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new T(h(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},b(_),c(_,l,"Generator"),c(_,s,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=k,E.prototype={constructor:E,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},975:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},825:function(e,t,n){var r=n(739),i=n(228),a=n(818),o=n(93);e.exports=function(e,t){return r(e)||i(e,t)||a(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},831:function(e,t,n){var r=n(884);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},778:function(e,t,n){var r=n(860),i=n(533),a=n(818),o=n(557);e.exports=function(e){return r(e)||i(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},888:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},818:function(e,t,n){var r=n(58);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},1:function(e,t,n){var r=n(884),i=n(975),a=n(139),o=n(874);function s(t){var n="function"==typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!a(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return o(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},798:function(e,t,n){"use strict";var r=n(888),i=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},a=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.VERSION=void 0,e.VERSION="9.0.1"})),o=i((function(e,t){var n=e&&e.__spreadArray||function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e};function i(e){return e&&0===e.length}function a(e){return null==e?[]:Object.keys(e)}function o(e){for(var t=[],n=Object.keys(e),r=0;r<n.length;r++)t.push(e[n[r]]);return t}function s(e,t){for(var n=[],r=a(e),i=0;i<r.length;i++){var o=r[i];n.push(t.call(null,e[o],o))}return n}function u(e,t){for(var n=[],r=0;r<e.length;r++)n.push(t.call(null,e[r],r));return n}function l(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?t=t.concat(l(r)):t.push(r)}return t}function c(e){return i(e)?void 0:e[0]}function h(e){var t=e&&e.length;return t?e[t-1]:void 0}function f(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t.call(null,e[n],n);else{if(!P(e))throw Error("non exhaustive match");var r=a(e);for(n=0;n<r.length;n++){var i=r[n],o=e[i];t.call(null,o,i)}}}function d(e){return"string"==typeof e}function p(e){return void 0===e}function v(e){return e instanceof Function}function m(e,t){return void 0===t&&(t=1),e.slice(t,e.length)}function g(e,t){return void 0===t&&(t=1),e.slice(0,e.length-t)}function y(e,t){var n=[];if(Array.isArray(e))for(var r=0;r<e.length;r++){var i=e[r];t.call(null,i)&&n.push(i)}return n}function x(e,t){return y(e,(function(e){return!t(e)}))}function _(e,t){for(var n=Object.keys(e),r={},i=0;i<n.length;i++){var a=n[i],o=e[a];t(o)&&(r[a]=o)}return r}function b(e,t){return!!P(e)&&e.hasOwnProperty(t)}function T(e,t){return void 0!==S(e,(function(e){return e===t}))}function M(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}function w(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}function S(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(t.call(null,r))return r}}function E(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];t.call(null,i)&&n.push(i)}return n}function k(e,t,n){for(var r=Array.isArray(e),i=r?e:o(e),s=r?[]:a(e),u=n,l=0;l<i.length;l++)u=t.call(null,u,i[l],r?l:s[l]);return u}function A(e){return x(e,(function(e){return null==e}))}function C(e,t){void 0===t&&(t=function(e){return e});var n=[];return k(e,(function(e,r){var i=t(r);return T(n,i)?e:(n.push(i),e.concat(r))}),[])}function I(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=[null],i=r.concat(t);return Function.bind.apply(e,i)}function R(e){return Array.isArray(e)}function L(e){return e instanceof RegExp}function P(e){return e instanceof Object}function N(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0}function O(e,t){return x(e,(function(e){return T(t,e)}))}function D(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}function F(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}function U(e,t){var n=M(e);return n.sort((function(e,n){return t(e)-t(n)})),n}function G(e,t){if(e.length!==t.length)throw Error("can't zipObject with different number of keys and values!");for(var n={},r=0;r<e.length;r++)n[e[r]]=t[r];return n}function z(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++)for(var i=t[r],o=a(i),s=0;s<o.length;s++){var u=o[s];e[u]=i[u]}return e}function V(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0;r<t.length;r++)for(var i=t[r],o=a(i),s=0;s<o.length;s++){var u=o[s];b(e,u)||(e[u]=i[u])}return e}function B(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return V.apply(void 0,n([{}],e))}function W(e,t){var n={};return f(e,(function(e){var r=t(e),i=n[r];i?i.push(e):n[r]=[e]})),n}function H(e,t){for(var n=w(e),r=a(t),i=0;i<r.length;i++){var o=r[i],s=t[o];n[o]=s}return n}function j(){}function q(e){return e}function X(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];t.push(void 0!==r?r:void 0)}return t}function Y(e){console&&console.error&&console.error("Error: "+e)}function K(e){console&&console.warn&&console.warn("Warning: "+e)}function Z(){return"function"==typeof Map}function J(e){return e[e.length-1]}function Q(e){var t=(new Date).getTime(),n=e();return{time:(new Date).getTime()-t,value:n}}function $(e){function t(){}t.prototype=e;var n=new t;function i(){return r(n.bar)}return i(),i(),e}Object.defineProperty(e,"__esModule",{value:!0}),e.toFastProperties=e.timer=e.peek=e.isES2015MapSupported=e.PRINT_WARNING=e.PRINT_ERROR=e.packArray=e.IDENTITY=e.NOOP=e.merge=e.groupBy=e.defaults=e.assignNoOverwrite=e.assign=e.zipObject=e.sortBy=e.indexOf=e.some=e.difference=e.every=e.isObject=e.isRegExp=e.isArray=e.partial=e.uniq=e.compact=e.reduce=e.findAll=e.find=e.cloneObj=e.cloneArr=e.contains=e.has=e.pick=e.reject=e.filter=e.dropRight=e.drop=e.isFunction=e.isUndefined=e.isString=e.forEach=e.last=e.first=e.flatten=e.map=e.mapValues=e.values=e.keys=e.isEmpty=void 0,e.isEmpty=i,e.keys=a,e.values=o,e.mapValues=s,e.map=u,e.flatten=l,e.first=c,e.last=h,e.forEach=f,e.isString=d,e.isUndefined=p,e.isFunction=v,e.drop=m,e.dropRight=g,e.filter=y,e.reject=x,e.pick=_,e.has=b,e.contains=T,e.cloneArr=M,e.cloneObj=w,e.find=S,e.findAll=E,e.reduce=k,e.compact=A,e.uniq=C,e.partial=I,e.isArray=R,e.isRegExp=L,e.isObject=P,e.every=N,e.difference=O,e.some=D,e.indexOf=F,e.sortBy=U,e.zipObject=G,e.assign=z,e.assignNoOverwrite=V,e.defaults=B,e.groupBy=W,e.merge=H,e.NOOP=j,e.IDENTITY=q,e.packArray=X,e.PRINT_ERROR=Y,e.PRINT_WARNING=K,e.isES2015MapSupported=Z,e.peek=J,e.timer=Q,e.toFastProperties=$})),s=i((function(e,t){var n,i;n="undefined"!=typeof self?self:e,i=function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");var t=this.disjunction();this.consumeChar("/");for(var n={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":o(n,"global");break;case"i":o(n,"ignoreCase");break;case"m":o(n,"multiLine");break;case"u":o(n,"unicode");break;case"y":o(n,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:t,loc:this.loc(0)}},e.prototype.disjunction=function(){var e=[],t=this.idx;for(e.push(this.alternative());"|"===this.peekChar();)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(t)}},e.prototype.alternative=function(){for(var e=[],t=this.idx;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(t)}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){var e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":var t;switch(this.consumeChar("?"),this.popChar()){case"=":t="Lookahead";break;case"!":t="NegativeLookahead"}s(t);var n=this.disjunction();return this.consumeChar(")"),{type:t,value:n,loc:this.loc(e)}}!function(){throw Error("Internal Error - Should never get here!")}()},e.prototype.quantifier=function(e){var t,n=this.idx;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":var r=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:r,atMost:r};break;case",":t=this.isDigit()?{atLeast:r,atMost:this.integerIncludingZero()}:{atLeast:r,atMost:1/0},this.consumeChar("}")}if(!0===e&&void 0===t)return;s(t)}if(!0!==e||void 0!==t)return s(t),"?"===this.peekChar(0)?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t.loc=this.loc(n),t},e.prototype.atom=function(){var e,t=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group()}return void 0===e&&this.isPatternCharacter()&&(e=this.patternCharacter()),s(e),e.loc=this.loc(t),this.isQuantifier()&&(e.quantifier=this.quantifier()),e},e.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[i("\n"),i("\r"),i("\u2028"),i("\u2029")]}},e.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){return{type:"GroupBackReference",value:this.positiveInteger()}},e.prototype.characterClassEscape=function(){var e,t=!1;switch(this.popChar()){case"d":e=l;break;case"D":e=l,t=!0;break;case"s":e=h;break;case"S":e=h,t=!0;break;case"w":e=c;break;case"W":e=c,t=!0}return s(e),{type:"Set",value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case"f":e=i("\f");break;case"n":e=i("\n");break;case"r":e=i("\r");break;case"t":e=i("\t");break;case"v":e=i("\v")}return s(e),{type:"Character",value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var e=this.popChar();if(!1===/[a-zA-Z]/.test(e))throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}},e.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:i("\0")}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){return{type:"Character",value:i(this.popChar())}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case"\n":case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:return{type:"Character",value:i(this.popChar())}}},e.prototype.characterClass=function(){var e=[],t=!1;for(this.consumeChar("["),"^"===this.peekChar(0)&&(this.consumeChar("^"),t=!0);this.isClassAtom();){var n=this.classAtom();if("Character"===n.type&&this.isRangeDash()){this.consumeChar("-");var r=this.classAtom();if("Character"===r.type){if(r.value<n.value)throw Error("Range out of order in character class");e.push({from:n.value,to:r.value})}else a(n.value,e),e.push(i("-")),a(r.value,e)}else a(n.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case"]":case"\n":case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:i("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=!0;"?"===(this.consumeChar("("),this.peekChar(0))?(this.consumeChar("?"),this.consumeChar(":"),e=!1):this.groupIdx++;var t=this.disjunction();this.consumeChar(")");var n={type:"Group",capturing:e,value:t};return e&&(n.idx=this.groupIdx),n},e.prototype.positiveInteger=function(){var e=this.popChar();if(!1===r.test(e))throw Error("Expecting a positive integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(!1===n.test(e))throw Error("Expecting an integer");for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case"\n":case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:i(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},e.prototype.isRangeDash=function(){return"-"===this.peekChar()&&this.isClassAtom(1)},e.prototype.isDigit=function(){return n.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){switch(void 0===e&&(e=0),this.peekChar(e)){case"]":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return"?"===this.peekChar(1)&&("="===this.peekChar(2)||"!"===this.peekChar(2));default:return!1}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return void 0!==this.quantifier(!0)}catch(e){return!1}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case"\n":case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},e.prototype.parseHexDigits=function(e){for(var n="",r=0;r<e;r++){var i=this.popChar();if(!1===t.test(i))throw Error("Expecting a HexDecimal digits");n+=i}return{type:"Character",value:parseInt(n,16)}},e.prototype.peekChar=function(e){return void 0===e&&(e=0),this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);return this.consumeChar(),e},e.prototype.consumeChar=function(e){if(void 0!==e&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++},e.prototype.loc=function(e){return{begin:e,end:this.idx}};var t=/[0-9a-fA-F]/,n=/[0-9]/,r=/[1-9]/;function i(e){return e.charCodeAt(0)}function a(e,t){void 0!==e.length?e.forEach((function(e){t.push(e)})):t.push(e)}function o(e,t){if(!0===e[t])throw"duplicate flag "+t;e[t]=!0}function s(e){if(void 0===e)throw Error("Internal Error - Should never get here!")}var u,l=[];for(u=i("0");u<=i("9");u++)l.push(u);var c=[i("_")].concat(l);for(u=i("a");u<=i("z");u++)c.push(u);for(u=i("A");u<=i("Z");u++)c.push(u);var h=[i(" "),i("\f"),i("\n"),i("\r"),i("\t"),i("\v"),i("\t"),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i(" "),i("\u2028"),i("\u2029"),i(" "),i(" "),i("　"),i("\ufeff")];function f(){}return f.prototype.visitChildren=function(e){for(var t in e){var n=e[t];e.hasOwnProperty(t)&&(void 0!==n.type?this.visit(n):Array.isArray(n)&&n.forEach((function(e){this.visit(e)}),this))}},f.prototype.visit=function(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e)}this.visitChildren(e)},f.prototype.visitPattern=function(e){},f.prototype.visitFlags=function(e){},f.prototype.visitDisjunction=function(e){},f.prototype.visitAlternative=function(e){},f.prototype.visitStartAnchor=function(e){},f.prototype.visitEndAnchor=function(e){},f.prototype.visitWordBoundary=function(e){},f.prototype.visitNonWordBoundary=function(e){},f.prototype.visitLookahead=function(e){},f.prototype.visitNegativeLookahead=function(e){},f.prototype.visitCharacter=function(e){},f.prototype.visitSet=function(e){},f.prototype.visitGroup=function(e){},f.prototype.visitGroupBackReference=function(e){},f.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:f,VERSION:"0.5.0"}},"function"==typeof define&&define.amd?define([],i):"object"==r(t)&&t.exports?t.exports=i():n.regexpToAst=i()})),u=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.clearRegExpParserCache=e.getRegExpAst=void 0;var t=s(),n={},r=new t.RegExpParser;e.getRegExpAst=function(e){var t=e.toString();if(n.hasOwnProperty(t))return n[t];var i=r.pattern(t);return n[t]=i,i},e.clearRegExpParserCache=function(){n={}}})),l=i((function(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.canMatchCharCode=e.firstCharOptimizedIndices=e.getOptimizedStartCodesIndices=e.failedOptimizationPrefixMsg=void 0;var r=s(),i=o(),a=u(),l=c(),h="Complement Sets are not supported for first char optimization";function f(e,t,n){switch(e.type){case"Disjunction":for(var r=0;r<e.value.length;r++)f(e.value[r],t,n);break;case"Alternative":var a=e.value;for(r=0;r<a.length;r++){var o=a[r];switch(o.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var s=o;switch(s.type){case"Character":d(s.value,t,n);break;case"Set":if(!0===s.complement)throw Error(h);i.forEach(s.value,(function(e){if("number"==typeof e)d(e,t,n);else{var r=e;if(!0===n)for(var i=r.from;i<=r.to;i++)d(i,t,n);else{for(i=r.from;i<=r.to&&i<l.minOptimizationVal;i++)d(i,t,n);if(r.to>=l.minOptimizationVal)for(var a=r.from>=l.minOptimizationVal?r.from:l.minOptimizationVal,o=r.to,s=l.charCodeToOptimizedIndex(a),u=l.charCodeToOptimizedIndex(o),c=s;c<=u;c++)t[c]=c}}}));break;case"Group":f(s.value,t,n);break;default:throw Error("Non Exhaustive Match")}var u=void 0!==s.quantifier&&0===s.quantifier.atLeast;if("Group"===s.type&&!1===v(s)||"Group"!==s.type&&!1===u)break}break;default:throw Error("non exhaustive match!")}return i.values(t)}function d(e,t,n){var r=l.charCodeToOptimizedIndex(e);t[r]=r,!0===n&&function(e,t){var n=String.fromCharCode(e),r=n.toUpperCase();if(r!==n){t[i=l.charCodeToOptimizedIndex(r.charCodeAt(0))]=i}else{var i,a=n.toLowerCase();if(a!==n)t[i=l.charCodeToOptimizedIndex(a.charCodeAt(0))]=i}}(e,t)}function p(e,t){return i.find(e.value,(function(e){if("number"==typeof e)return i.contains(t,e);var n=e;return void 0!==i.find(t,(function(e){return n.from<=e&&e<=n.to}))}))}function v(e){return!(!e.quantifier||0!==e.quantifier.atLeast)||!!e.value&&(i.isArray(e.value)?i.every(e.value,v):v(e.value))}e.failedOptimizationPrefixMsg='Unable to use "first char" lexer optimizations:\n',e.getOptimizedStartCodesIndices=function(t,n){void 0===n&&(n=!1);try{var o=a.getRegExpAst(t);return f(o.value,{},o.flags.ignoreCase)}catch(a){if(a.message===h)n&&i.PRINT_WARNING(e.failedOptimizationPrefixMsg+"\tUnable to optimize: < "+t.toString()+" >\n\tComplement Sets cannot be automatically optimized.\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.");else{var s="";n&&(s="\n\tThis will disable the lexer's first char optimizations.\n\tSee: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details."),i.PRINT_ERROR(e.failedOptimizationPrefixMsg+"\n\tFailed parsing: < "+t.toString()+" >\n\tUsing the regexp-to-ast library version: "+r.VERSION+"\n\tPlease open an issue at: https://github.com/bd82/regexp-to-ast/issues"+s)}}return[]},e.firstCharOptimizedIndices=f;var m=function(e){function t(t){var n=e.call(this)||this;return n.targetCharCodes=t,n.found=!1,n}return n(t,e),t.prototype.visitChildren=function(t){if(!0!==this.found){switch(t.type){case"Lookahead":return void this.visitLookahead(t);case"NegativeLookahead":return void this.visitNegativeLookahead(t)}e.prototype.visitChildren.call(this,t)}},t.prototype.visitCharacter=function(e){i.contains(this.targetCharCodes,e.value)&&(this.found=!0)},t.prototype.visitSet=function(e){e.complement?void 0===p(e,this.targetCharCodes)&&(this.found=!0):void 0!==p(e,this.targetCharCodes)&&(this.found=!0)},t}(r.BaseRegExpVisitor);e.canMatchCharCode=function(e,t){if(t instanceof RegExp){var n=a.getRegExpAst(t),r=new m(e);return r.visit(n),r.found}return void 0!==i.find(t,(function(t){return i.contains(e,t.charCodeAt(0))}))}})),c=i((function(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.charCodeToOptimizedIndex=e.minOptimizationVal=e.buildLineBreakIssueMessage=e.LineTerminatorOptimizedTester=e.isShortPattern=e.isCustomPattern=e.cloneEmptyGroups=e.performWarningRuntimeChecks=e.performRuntimeChecks=e.addStickyFlag=e.addStartOfInput=e.findUnreachablePatterns=e.findModesThatDoNotExist=e.findInvalidGroupType=e.findDuplicatePatterns=e.findUnsupportedFlags=e.findStartOfInputAnchor=e.findEmptyMatchRegExps=e.findEndOfInputAnchor=e.findInvalidPatterns=e.findMissingPatterns=e.validatePatterns=e.analyzeTokenTypes=e.enableSticky=e.disableSticky=e.SUPPORT_STICKY=e.MODES=e.DEFAULT_MODE=void 0;var r=s(),i=d(),a=o(),c=l(),h=u(),f="PATTERN";function p(e){var t=a.filter(e,(function(e){return!a.has(e,f)}));return{errors:a.map(t,(function(e){return{message:"Token Type: ->"+e.name+"<- missing static 'PATTERN' property",type:i.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}})),valid:a.difference(e,t)}}function v(e){var t=a.filter(e,(function(e){var t=e[f];return!(a.isRegExp(t)||a.isFunction(t)||a.has(t,"exec")||a.isString(t))}));return{errors:a.map(t,(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:i.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}})),valid:a.difference(e,t)}}e.DEFAULT_MODE="defaultMode",e.MODES="modes",e.SUPPORT_STICKY="boolean"==typeof new RegExp("(?:)").sticky,e.disableSticky=function(){e.SUPPORT_STICKY=!1},e.enableSticky=function(){e.SUPPORT_STICKY=!0},e.analyzeTokenTypes=function(t,n){var r,o=(n=a.defaults(n,{useSticky:e.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r","\n"],tracer:function(e,t){return t()}})).tracer;o("initCharCodeToOptimizedIndexMap",(function(){!function(){if(a.isEmpty(N)){N=new Array(65536);for(var e=0;e<65536;e++)N[e]=e>255?255+~~(e/255):e}}()})),o("Reject Lexer.NA",(function(){r=a.reject(t,(function(e){return e[f]===i.Lexer.NA}))}));var s,u,l,h,d,p,v,m,g,y,x,_=!1;o("Transform Patterns",(function(){_=!1,s=a.map(r,(function(e){var t=e[f];if(a.isRegExp(t)){var r=t.source;return 1!==r.length||"^"===r||"$"===r||"."===r||t.ignoreCase?2!==r.length||"\\"!==r[0]||a.contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],r[1])?n.useSticky?k(t):E(t):r[1]:r}if(a.isFunction(t))return _=!0,{exec:t};if(a.has(t,"exec"))return _=!0,t;if("string"==typeof t){if(1===t.length)return t;var i=t.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),o=new RegExp(i);return n.useSticky?k(o):E(o)}throw Error("non exhaustive match")}))})),o("misc mapping",(function(){u=a.map(r,(function(e){return e.tokenTypeIdx})),l=a.map(r,(function(e){var t=e.GROUP;if(t!==i.Lexer.SKIPPED){if(a.isString(t))return t;if(a.isUndefined(t))return!1;throw Error("non exhaustive match")}})),h=a.map(r,(function(e){var t=e.LONGER_ALT;if(t)return a.indexOf(r,t)})),d=a.map(r,(function(e){return e.PUSH_MODE})),p=a.map(r,(function(e){return a.has(e,"POP_MODE")}))})),o("Line Terminator Handling",(function(){var e=L(n.lineTerminatorCharacters);v=a.map(r,(function(e){return!1})),"onlyOffset"!==n.positionTracking&&(v=a.map(r,(function(t){return a.has(t,"LINE_BREAKS")?t.LINE_BREAKS:!1===I(t,e)?c.canMatchCharCode(e,t.PATTERN):void 0})))})),o("Misc Mapping #2",(function(){m=a.map(r,A),g=a.map(s,C),y=a.reduce(r,(function(e,t){var n=t.GROUP;return a.isString(n)&&n!==i.Lexer.SKIPPED&&(e[n]=[]),e}),{}),x=a.map(s,(function(e,t){return{pattern:s[t],longerAlt:h[t],canLineTerminator:v[t],isCustom:m[t],short:g[t],group:l[t],push:d[t],pop:p[t],tokenTypeIdx:u[t],tokenType:r[t]}}))}));var b=!0,T=[];return n.safeMode||o("First Char Optimization",(function(){T=a.reduce(r,(function(e,t,r){if("string"==typeof t.PATTERN){var i=O(t.PATTERN.charCodeAt(0));P(e,i,x[r])}else if(a.isArray(t.START_CHARS_HINT)){var o;a.forEach(t.START_CHARS_HINT,(function(t){var n=O("string"==typeof t?t.charCodeAt(0):t);o!==n&&(o=n,P(e,n,x[r]))}))}else if(a.isRegExp(t.PATTERN))if(t.PATTERN.unicode)b=!1,n.ensureOptimizations&&a.PRINT_ERROR(c.failedOptimizationPrefixMsg+"\tUnable to analyze < "+t.PATTERN.toString()+" > pattern.\n\tThe regexp unicode flag is not currently supported by the regexp-to-ast library.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE");else{var s=c.getOptimizedStartCodesIndices(t.PATTERN,n.ensureOptimizations);a.isEmpty(s)&&(b=!1),a.forEach(s,(function(t){P(e,t,x[r])}))}else n.ensureOptimizations&&a.PRINT_ERROR(c.failedOptimizationPrefixMsg+"\tTokenType: <"+t.name+"> is using a custom token pattern without providing <start_chars_hint> parameter.\n\tThis will disable the lexer's first char optimizations.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE"),b=!1;return e}),[])})),o("ArrayPacking",(function(){T=a.packArray(T)})),{emptyGroups:y,patternIdxToConfig:x,charCodeToPatternIdxToConfig:T,hasCustom:_,canBeOptimized:b}},e.validatePatterns=function(e,t){var n=[],r=p(e);n=n.concat(r.errors);var i=v(r.valid),o=i.valid;return n=(n=n.concat(i.errors)).concat(function(e){var t=[],n=a.filter(e,(function(e){return a.isRegExp(e[f])}));return(t=(t=(t=(t=t.concat(g(n))).concat(_(n))).concat(b(n))).concat(T(n))).concat(y(n))}(o)),n=(n=(n=n.concat(M(o))).concat(w(o,t))).concat(S(o))},e.findMissingPatterns=p,e.findInvalidPatterns=v;var m=/[^\\][\$]/;function g(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return n(t,e),t.prototype.visitEndAnchor=function(e){this.found=!0},t}(r.BaseRegExpVisitor),o=a.filter(e,(function(e){var n=e[f];try{var r=h.getRegExpAst(n),i=new t;return i.visit(r),i.found}catch(e){return m.test(n.source)}}));return a.map(o,(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+e.name+"<- static 'PATTERN' cannot contain end of input anchor '$'\n\tSee chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:i.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function y(e){var t=a.filter(e,(function(e){return e[f].test("")}));return a.map(t,(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' must not match an empty string",type:i.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}}))}e.findEndOfInputAnchor=g,e.findEmptyMatchRegExps=y;var x=/[^\\[][\^]|^\^/;function _(e){var t=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.found=!1,t}return n(t,e),t.prototype.visitStartAnchor=function(e){this.found=!0},t}(r.BaseRegExpVisitor),o=a.filter(e,(function(e){var n=e[f];try{var r=h.getRegExpAst(n),i=new t;return i.visit(r),i.found}catch(e){return x.test(n.source)}}));return a.map(o,(function(e){return{message:"Unexpected RegExp Anchor Error:\n\tToken Type: ->"+e.name+"<- static 'PATTERN' cannot contain start of input anchor '^'\n\tSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS\tfor details.",type:i.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}}))}function b(e){var t=a.filter(e,(function(e){var t=e[f];return t instanceof RegExp&&(t.multiline||t.global)}));return a.map(t,(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:i.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}}))}function T(e){var t=[],n=a.map(e,(function(n){return a.reduce(e,(function(e,r){return n.PATTERN.source===r.PATTERN.source&&!a.contains(t,r)&&r.PATTERN!==i.Lexer.NA&&(t.push(r),e.push(r)),e}),[])}));n=a.compact(n);var r=a.filter(n,(function(e){return e.length>1}));return a.map(r,(function(e){var t=a.map(e,(function(e){return e.name}));return{message:"The same RegExp pattern ->"+a.first(e).PATTERN+"<-has been used in all of the following Token Types: "+t.join(", ")+" <-",type:i.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}}))}function M(e){var t=a.filter(e,(function(e){if(!a.has(e,"GROUP"))return!1;var t=e.GROUP;return t!==i.Lexer.SKIPPED&&t!==i.Lexer.NA&&!a.isString(t)}));return a.map(t,(function(e){return{message:"Token Type: ->"+e.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:i.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}}))}function w(e,t){var n=a.filter(e,(function(e){return void 0!==e.PUSH_MODE&&!a.contains(t,e.PUSH_MODE)}));return a.map(n,(function(e){return{message:"Token Type: ->"+e.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+e.PUSH_MODE+"<-which does not exist",type:i.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}}))}function S(e){var t=[],n=a.reduce(e,(function(e,t,n){var r=t.PATTERN;return r===i.Lexer.NA||(a.isString(r)?e.push({str:r,idx:n,tokenType:t}):a.isRegExp(r)&&function(e){var t=[".","\\","[","]","|","^","$","(",")","?","*","+","{"];return void 0===a.find(t,(function(t){return-1!==e.source.indexOf(t)}))}(r)&&e.push({str:r.source,idx:n,tokenType:t})),e}),[]);return a.forEach(e,(function(e,r){a.forEach(n,(function(n){var o=n.str,s=n.idx,u=n.tokenType;if(r<s&&function(e,t){if(a.isRegExp(t)){var n=t.exec(e);return null!==n&&0===n.index}if(a.isFunction(t))return t(e,0,[],{});if(a.has(t,"exec"))return t.exec(e,0,[],{});if("string"==typeof t)return t===e;throw Error("non exhaustive match")}(o,e.PATTERN)){var l="Token: ->"+u.name+"<- can never be matched.\nBecause it appears AFTER the Token Type ->"+e.name+"<-in the lexer's definition.\nSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE";t.push({message:l,type:i.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[e,u]})}}))})),t}function E(e){var t=e.ignoreCase?"i":"";return new RegExp("^(?:"+e.source+")",t)}function k(e){var t=e.ignoreCase?"iy":"y";return new RegExp(""+e.source,t)}function A(e){var t=e.PATTERN;if(a.isRegExp(t))return!1;if(a.isFunction(t))return!0;if(a.has(t,"exec"))return!0;if(a.isString(t))return!1;throw Error("non exhaustive match")}function C(e){return!(!a.isString(e)||1!==e.length)&&e.charCodeAt(0)}function I(e,t){if(a.has(e,"LINE_BREAKS"))return!1;if(a.isRegExp(e.PATTERN)){try{c.canMatchCharCode(t,e.PATTERN)}catch(e){return{issue:i.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:e.message}}return!1}if(a.isString(e.PATTERN))return!1;if(A(e))return{issue:i.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function R(e,t){if(t.issue===i.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return"Warning: unable to identify line terminator usage in pattern.\n\tThe problem is in the <"+e.name+"> Token Type\n\t Root cause: "+t.errMsg+".\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(t.issue===i.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return"Warning: A Custom Token Pattern should specify the <line_breaks> option.\n\tThe problem is in the <"+e.name+"> Token Type\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}function L(e){return a.map(e,(function(e){return a.isString(e)&&e.length>0?e.charCodeAt(0):e}))}function P(e,t,n){void 0===e[t]?e[t]=[n]:e[t].push(n)}e.findStartOfInputAnchor=_,e.findUnsupportedFlags=b,e.findDuplicatePatterns=T,e.findInvalidGroupType=M,e.findModesThatDoNotExist=w,e.findUnreachablePatterns=S,e.addStartOfInput=E,e.addStickyFlag=k,e.performRuntimeChecks=function(t,n,r){var o=[];return a.has(t,e.DEFAULT_MODE)||o.push({message:"A MultiMode Lexer cannot be initialized without a <"+e.DEFAULT_MODE+"> property in its definition\n",type:i.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),a.has(t,e.MODES)||o.push({message:"A MultiMode Lexer cannot be initialized without a <"+e.MODES+"> property in its definition\n",type:i.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),a.has(t,e.MODES)&&a.has(t,e.DEFAULT_MODE)&&!a.has(t.modes,t.defaultMode)&&o.push({message:"A MultiMode Lexer cannot be initialized with a "+e.DEFAULT_MODE+": <"+t.defaultMode+">which does not exist\n",type:i.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),a.has(t,e.MODES)&&a.forEach(t.modes,(function(e,t){a.forEach(e,(function(e,n){a.isUndefined(e)&&o.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:<"+t+"> at index: <"+n+">\n",type:i.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})}))})),o},e.performWarningRuntimeChecks=function(e,t,n){var r=[],o=!1,s=a.compact(a.flatten(a.mapValues(e.modes,(function(e){return e})))),u=a.reject(s,(function(e){return e[f]===i.Lexer.NA})),l=L(n);return t&&a.forEach(u,(function(e){var t=I(e,l);if(!1!==t){var n={message:R(e,t),type:t.issue,tokenType:e};r.push(n)}else a.has(e,"LINE_BREAKS")?!0===e.LINE_BREAKS&&(o=!0):c.canMatchCharCode(l,e.PATTERN)&&(o=!0)})),t&&!o&&r.push({message:"Warning: No LINE_BREAKS Found.\n\tThis Lexer has been defined to track line and column information,\n\tBut none of the Token Types can be identified as matching a line terminator.\n\tSee https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS\n\tfor details.",type:i.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),r},e.cloneEmptyGroups=function(e){var t={},n=a.keys(e);return a.forEach(n,(function(n){var r=e[n];if(!a.isArray(r))throw Error("non exhaustive match");t[n]=[]})),t},e.isCustomPattern=A,e.isShortPattern=C,e.LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,n=this.lastIndex;n<t;n++){var r=e.charCodeAt(n);if(10===r)return this.lastIndex=n+1,!0;if(13===r)return 10===e.charCodeAt(n+1)?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0},e.buildLineBreakIssueMessage=R,e.minOptimizationVal=256;var N=[];function O(t){return t<e.minOptimizationVal?t:N[t]}e.charCodeToOptimizedIndex=O})),h=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.isTokenType=e.hasExtendingTokensTypesMapProperty=e.hasExtendingTokensTypesProperty=e.hasCategoriesProperty=e.hasShortKeyProperty=e.singleAssignCategoriesToksMap=e.assignCategoriesMapProp=e.assignCategoriesTokensProp=e.assignTokenDefaultProps=e.expandCategories=e.augmentTokenTypes=e.tokenIdxToClass=e.tokenShortNameIdx=e.tokenStructuredMatcherNoCategories=e.tokenStructuredMatcher=void 0;var t=o();function n(e){for(var n=t.cloneArr(e),r=e,i=!0;i;){r=t.compact(t.flatten(t.map(r,(function(e){return e.CATEGORIES}))));var a=t.difference(r,n);n=n.concat(a),t.isEmpty(a)?i=!1:r=a}return n}function r(n){t.forEach(n,(function(n){u(n)||(e.tokenIdxToClass[e.tokenShortNameIdx]=n,n.tokenTypeIdx=e.tokenShortNameIdx++),l(n)&&!t.isArray(n.CATEGORIES)&&(n.CATEGORIES=[n.CATEGORIES]),l(n)||(n.CATEGORIES=[]),c(n)||(n.categoryMatches=[]),h(n)||(n.categoryMatchesMap={})}))}function i(n){t.forEach(n,(function(n){n.categoryMatches=[],t.forEach(n.categoryMatchesMap,(function(t,r){n.categoryMatches.push(e.tokenIdxToClass[r].tokenTypeIdx)}))}))}function a(e){t.forEach(e,(function(e){s([],e)}))}function s(e,n){t.forEach(e,(function(e){n.categoryMatchesMap[e.tokenTypeIdx]=!0})),t.forEach(n.CATEGORIES,(function(r){var i=e.concat(n);t.contains(i,r)||s(i,r)}))}function u(e){return t.has(e,"tokenTypeIdx")}function l(e){return t.has(e,"CATEGORIES")}function c(e){return t.has(e,"categoryMatches")}function h(e){return t.has(e,"categoryMatchesMap")}e.tokenStructuredMatcher=function(e,t){var n=e.tokenTypeIdx;return n===t.tokenTypeIdx||!0===t.isParent&&!0===t.categoryMatchesMap[n]},e.tokenStructuredMatcherNoCategories=function(e,t){return e.tokenTypeIdx===t.tokenTypeIdx},e.tokenShortNameIdx=1,e.tokenIdxToClass={},e.augmentTokenTypes=function(e){var o=n(e);r(o),a(o),i(o),t.forEach(o,(function(e){e.isParent=e.categoryMatches.length>0}))},e.expandCategories=n,e.assignTokenDefaultProps=r,e.assignCategoriesTokensProp=i,e.assignCategoriesMapProp=a,e.singleAssignCategoriesToksMap=s,e.hasShortKeyProperty=u,e.hasCategoriesProperty=l,e.hasExtendingTokensTypesProperty=c,e.hasExtendingTokensTypesMapProperty=h,e.isTokenType=function(e){return t.has(e,"tokenTypeIdx")}})),f=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.defaultLexerErrorProvider=void 0,e.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return"Unable to pop Lexer Mode after encountering Token ->"+e.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(e,t,n,r,i){return"unexpected character: ->"+e.charAt(t)+"<- at offset: "+t+", skipped "+n+" characters."}}})),d=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Lexer=e.LexerDefinitionErrorType=void 0;var t,n=c(),r=o(),i=h(),a=f(),s=u();(t=e.LexerDefinitionErrorType||(e.LexerDefinitionErrorType={}))[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK";var l={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:["\n","\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:a.defaultLexerErrorProvider,traceInitPerf:!1,skipValidations:!1};Object.freeze(l);var d=function(){function e(e,t){var a=this;if(void 0===t&&(t=l),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},"boolean"==typeof t)throw Error("The second argument to the Lexer constructor is now an ILexerConfig Object.\na boolean 2nd argument is no longer supported");this.config=r.merge(l,t);var o=this.config.traceInitPerf;!0===o?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):"number"==typeof o&&(this.traceInitMaxIdent=o,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",(function(){var o,u=!0;a.TRACE_INIT("Lexer Config handling",(function(){if(a.config.lineTerminatorsPattern===l.lineTerminatorsPattern)a.config.lineTerminatorsPattern=n.LineTerminatorOptimizedTester;else if(a.config.lineTerminatorCharacters===l.lineTerminatorCharacters)throw Error("Error: Missing <lineTerminatorCharacters> property on the Lexer config.\n\tFor details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS");if(t.safeMode&&t.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');a.trackStartLines=/full|onlyStart/i.test(a.config.positionTracking),a.trackEndLines=/full/i.test(a.config.positionTracking),r.isArray(e)?((o={modes:{}}).modes[n.DEFAULT_MODE]=r.cloneArr(e),o[n.DEFAULT_MODE]=n.DEFAULT_MODE):(u=!1,o=r.cloneObj(e))})),!1===a.config.skipValidations&&(a.TRACE_INIT("performRuntimeChecks",(function(){a.lexerDefinitionErrors=a.lexerDefinitionErrors.concat(n.performRuntimeChecks(o,a.trackStartLines,a.config.lineTerminatorCharacters))})),a.TRACE_INIT("performWarningRuntimeChecks",(function(){a.lexerDefinitionWarning=a.lexerDefinitionWarning.concat(n.performWarningRuntimeChecks(o,a.trackStartLines,a.config.lineTerminatorCharacters))}))),o.modes=o.modes?o.modes:{},r.forEach(o.modes,(function(e,t){o.modes[t]=r.reject(e,(function(e){return r.isUndefined(e)}))}));var c=r.keys(o.modes);if(r.forEach(o.modes,(function(e,o){a.TRACE_INIT("Mode: <"+o+"> processing",(function(){var s;(a.modes.push(o),!1===a.config.skipValidations&&a.TRACE_INIT("validatePatterns",(function(){a.lexerDefinitionErrors=a.lexerDefinitionErrors.concat(n.validatePatterns(e,c))})),r.isEmpty(a.lexerDefinitionErrors))&&(i.augmentTokenTypes(e),a.TRACE_INIT("analyzeTokenTypes",(function(){s=n.analyzeTokenTypes(e,{lineTerminatorCharacters:a.config.lineTerminatorCharacters,positionTracking:t.positionTracking,ensureOptimizations:t.ensureOptimizations,safeMode:t.safeMode,tracer:a.TRACE_INIT.bind(a)})})),a.patternIdxToConfig[o]=s.patternIdxToConfig,a.charCodeToPatternIdxToConfig[o]=s.charCodeToPatternIdxToConfig,a.emptyGroups=r.merge(a.emptyGroups,s.emptyGroups),a.hasCustom=s.hasCustom||a.hasCustom,a.canModeBeOptimized[o]=s.canBeOptimized)}))})),a.defaultMode=o.defaultMode,!r.isEmpty(a.lexerDefinitionErrors)&&!a.config.deferDefinitionErrorsHandling){var h=r.map(a.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Errors detected in definition of Lexer:\n"+h)}r.forEach(a.lexerDefinitionWarning,(function(e){r.PRINT_WARNING(e.message)})),a.TRACE_INIT("Choosing sub-methods implementations",(function(){if(n.SUPPORT_STICKY?(a.chopInput=r.IDENTITY,a.match=a.matchWithTest):(a.updateLastIndex=r.NOOP,a.match=a.matchWithExec),u&&(a.handleModes=r.NOOP),!1===a.trackStartLines&&(a.computeNewColumn=r.IDENTITY),!1===a.trackEndLines&&(a.updateTokenEndLineColumnLocation=r.NOOP),/full/i.test(a.config.positionTracking))a.createTokenInstance=a.createFullToken;else if(/onlyStart/i.test(a.config.positionTracking))a.createTokenInstance=a.createStartOnlyToken;else{if(!/onlyOffset/i.test(a.config.positionTracking))throw Error('Invalid <positionTracking> config option: "'+a.config.positionTracking+'"');a.createTokenInstance=a.createOffsetOnlyToken}a.hasCustom?(a.addToken=a.addTokenUsingPush,a.handlePayload=a.handlePayloadWithCustom):(a.addToken=a.addTokenUsingMemberAccess,a.handlePayload=a.handlePayloadNoCustom)})),a.TRACE_INIT("Failed Optimization Warnings",(function(){var e=r.reduce(a.canModeBeOptimized,(function(e,t,n){return!1===t&&e.push(n),e}),[]);if(t.ensureOptimizations&&!r.isEmpty(e))throw Error("Lexer Modes: < "+e.join(", ")+' > cannot be optimized.\n\t Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.\n\t Or inspect the console log for details on how to resolve these issues.')})),a.TRACE_INIT("clearRegExpParserCache",(function(){s.clearRegExpParserCache()})),a.TRACE_INIT("toFastProperties",(function(){r.toFastProperties(a)}))}))}return e.prototype.tokenize=function(e,t){if(void 0===t&&(t=this.defaultMode),!r.isEmpty(this.lexerDefinitionErrors)){var n=r.map(this.lexerDefinitionErrors,(function(e){return e.message})).join("-----------------------\n");throw new Error("Unable to Tokenize because Errors detected in definition of Lexer:\n"+n)}return this.tokenizeInternal(e,t)},e.prototype.tokenizeInternal=function(e,t){var i,a,o,s,u,l,c,h,f,d,p,v,m,g,y=this,x=e,_=x.length,b=0,T=0,M=this.hasCustom?0:Math.floor(e.length/10),w=new Array(M),S=[],E=this.trackStartLines?1:void 0,k=this.trackStartLines?1:void 0,A=n.cloneEmptyGroups(this.emptyGroups),C=this.trackStartLines,I=this.config.lineTerminatorsPattern,R=0,L=[],P=[],N=[],O=[];Object.freeze(O);var D=void 0;function F(){return L}function U(e){var t=n.charCodeToOptimizedIndex(e),r=P[t];return void 0===r?O:r}var G,z=function(e){if(1===N.length&&void 0===e.tokenType.PUSH_MODE){var t=y.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e);S.push({offset:e.startOffset,line:void 0!==e.startLine?e.startLine:void 0,column:void 0!==e.startColumn?e.startColumn:void 0,length:e.image.length,message:t})}else{N.pop();var n=r.last(N);L=y.patternIdxToConfig[n],P=y.charCodeToPatternIdxToConfig[n],R=L.length;var i=y.canModeBeOptimized[n]&&!1===y.config.safeMode;D=P&&i?U:F}};function V(e){N.push(e),P=this.charCodeToPatternIdxToConfig[e],L=this.patternIdxToConfig[e],R=L.length,R=L.length;var t=this.canModeBeOptimized[e]&&!1===this.config.safeMode;D=P&&t?U:F}for(V.call(this,t);b<_;){u=null;var B=x.charCodeAt(b),W=D(B),H=W.length;for(i=0;i<H;i++){var j=(G=W[i]).pattern;if(l=null,!1!==(te=G.short)?B===te&&(u=j):!0===G.isCustom?null!==(g=j.exec(x,b,w,A))?(u=g[0],void 0!==g.payload&&(l=g.payload)):u=null:(this.updateLastIndex(j,b),u=this.match(j,e,b)),null!==u){if(void 0!==(s=G.longerAlt)){var q=L[s],X=q.pattern;c=null,!0===q.isCustom?null!==(g=X.exec(x,b,w,A))?(o=g[0],void 0!==g.payload&&(c=g.payload)):o=null:(this.updateLastIndex(X,b),o=this.match(X,e,b)),o&&o.length>u.length&&(u=o,l=c,G=q)}break}}if(null!==u){if(h=u.length,void 0!==(f=G.group)&&(d=G.tokenTypeIdx,p=this.createTokenInstance(u,b,d,G.tokenType,E,k,h),this.handlePayload(p,l),!1===f?T=this.addToken(w,T,p):A[f].push(p)),e=this.chopInput(e,h),b+=h,k=this.computeNewColumn(k,h),!0===C&&!0===G.canLineTerminator){var Y=0,K=void 0,Z=void 0;I.lastIndex=0;do{!0===(K=I.test(u))&&(Z=I.lastIndex-1,Y++)}while(!0===K);0!==Y&&(E+=Y,k=h-Z,this.updateTokenEndLineColumnLocation(p,f,Z,Y,E,k,h))}this.handleModes(G,z,V,p)}else{for(var J=b,Q=E,$=k,ee=!1;!ee&&b<_;)for(x.charCodeAt(b),e=this.chopInput(e,1),b++,a=0;a<R;a++){var te,ne=L[a];j=ne.pattern;if(!1!==(te=ne.short)?x.charCodeAt(b)===te&&(ee=!0):!0===ne.isCustom?ee=null!==j.exec(x,b,w,A):(this.updateLastIndex(j,b),ee=null!==j.exec(e)),!0===ee)break}v=b-J,m=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(x,J,v,Q,$),S.push({offset:J,line:Q,column:$,length:v,message:m})}}return this.hasCustom||(w.length=T),{tokens:w,groups:A,errors:S}},e.prototype.handleModes=function(e,t,n,r){if(!0===e.pop){var i=e.push;t(r),void 0!==i&&n.call(this,i)}else void 0!==e.push&&n.call(this,e.push)},e.prototype.chopInput=function(e,t){return e.substring(t)},e.prototype.updateLastIndex=function(e,t){e.lastIndex=t},e.prototype.updateTokenEndLineColumnLocation=function(e,t,n,r,i,a,o){var s,u;void 0!==t&&(u=(s=n===o-1)?-1:0,1===r&&!0===s||(e.endLine=i+u,e.endColumn=a-1-u))},e.prototype.computeNewColumn=function(e,t){return e+t},e.prototype.createTokenInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return null},e.prototype.createOffsetOnlyToken=function(e,t,n,r){return{image:e,startOffset:t,tokenTypeIdx:n,tokenType:r}},e.prototype.createStartOnlyToken=function(e,t,n,r,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:n,tokenType:r}},e.prototype.createFullToken=function(e,t,n,r,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:n,tokenType:r}},e.prototype.addToken=function(e,t,n){return 666},e.prototype.addTokenUsingPush=function(e,t,n){return e.push(n),t},e.prototype.addTokenUsingMemberAccess=function(e,t,n){return e[t]=n,++t},e.prototype.handlePayload=function(e,t){},e.prototype.handlePayloadNoCustom=function(e,t){},e.prototype.handlePayloadWithCustom=function(e,t){null!==t&&(e.payload=t)},e.prototype.match=function(e,t,n){return null},e.prototype.matchWithTest=function(e,t,n){return!0===e.test(t)?t.substring(n,e.lastIndex):null},e.prototype.matchWithExec=function(e,t){var n=e.exec(t);return null!==n?n[0]:n},e.prototype.TRACE_INIT=function(e,t){if(!0===this.traceInitPerf){this.traceInitIndent++;var n=new Array(this.traceInitIndent+1).join("\t");this.traceInitIndent<this.traceInitMaxIdent&&console.log(n+"--\x3e <"+e+">");var i=r.timer(t),a=i.time,o=i.value,s=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&s(n+"<-- <"+e+"> time: "+a+"ms"),this.traceInitIndent--,o}return t()},e.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",e.NA=/NOT_APPLICABLE/,e}();e.Lexer=d})),p=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.tokenMatcher=e.createTokenInstance=e.EOF=e.createToken=e.hasTokenLabel=e.tokenName=e.tokenLabel=void 0;var t=o(),n=d(),r=h();function i(e){return t.isString(e.LABEL)&&""!==e.LABEL}e.tokenLabel=function(e){return i(e)?e.LABEL:e.name},e.tokenName=function(e){return e.name},e.hasTokenLabel=i;var a="parent",s="categories",u="label",l="group",c="push_mode",f="pop_mode",p="longer_alt",v="line_breaks",m="start_chars_hint";function g(e){return function(e){var n=e.pattern,i={};if(i.name=e.name,t.isUndefined(n)||(i.PATTERN=n),t.has(e,a))throw"The parent property is no longer supported.\nSee: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.";return t.has(e,s)&&(i.CATEGORIES=e[s]),r.augmentTokenTypes([i]),t.has(e,u)&&(i.LABEL=e[u]),t.has(e,l)&&(i.GROUP=e[l]),t.has(e,f)&&(i.POP_MODE=e[f]),t.has(e,c)&&(i.PUSH_MODE=e[c]),t.has(e,p)&&(i.LONGER_ALT=e[p]),t.has(e,v)&&(i.LINE_BREAKS=e[v]),t.has(e,m)&&(i.START_CHARS_HINT=e[m]),i}(e)}e.createToken=g,e.EOF=g({name:"EOF",pattern:n.Lexer.NA}),r.augmentTokenTypes([e.EOF]),e.createTokenInstance=function(e,t,n,r,i,a,o,s){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:a,startColumn:o,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}},e.tokenMatcher=function(e,t){return r.tokenStructuredMatcher(e,t)}})),v=i((function(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.serializeProduction=e.serializeGrammar=e.Terminal=e.Alternation=e.RepetitionWithSeparator=e.Repetition=e.RepetitionMandatoryWithSeparator=e.RepetitionMandatory=e.Option=e.Alternative=e.Rule=e.NonTerminal=e.AbstractProduction=void 0;var r=o(),i=p(),a=function(){function e(e){this._definition=e}return Object.defineProperty(e.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e},enumerable:!1,configurable:!0}),e.prototype.accept=function(e){e.visit(this),r.forEach(this.definition,(function(t){t.accept(e)}))},e}();e.AbstractProduction=a;var s=function(e){function t(t){var n=e.call(this,[])||this;return n.idx=1,r.assign(n,r.pick(t,(function(e){return void 0!==e}))),n}return n(t,e),Object.defineProperty(t.prototype,"definition",{get:function(){return void 0!==this.referencedRule?this.referencedRule.definition:[]},set:function(e){},enumerable:!1,configurable:!0}),t.prototype.accept=function(e){e.visit(this)},t}(a);e.NonTerminal=s;var u=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.orgText="",r.assign(n,r.pick(t,(function(e){return void 0!==e}))),n}return n(t,e),t}(a);e.Rule=u;var l=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.ignoreAmbiguities=!1,r.assign(n,r.pick(t,(function(e){return void 0!==e}))),n}return n(t,e),t}(a);e.Alternative=l;var c=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,r.assign(n,r.pick(t,(function(e){return void 0!==e}))),n}return n(t,e),t}(a);e.Option=c;var h=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,r.assign(n,r.pick(t,(function(e){return void 0!==e}))),n}return n(t,e),t}(a);e.RepetitionMandatory=h;var f=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,r.assign(n,r.pick(t,(function(e){return void 0!==e}))),n}return n(t,e),t}(a);e.RepetitionMandatoryWithSeparator=f;var d=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,r.assign(n,r.pick(t,(function(e){return void 0!==e}))),n}return n(t,e),t}(a);e.Repetition=d;var v=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,r.assign(n,r.pick(t,(function(e){return void 0!==e}))),n}return n(t,e),t}(a);e.RepetitionWithSeparator=v;var m=function(e){function t(t){var n=e.call(this,t.definition)||this;return n.idx=1,n.ignoreAmbiguities=!1,n.hasPredicates=!1,r.assign(n,r.pick(t,(function(e){return void 0!==e}))),n}return n(t,e),Object.defineProperty(t.prototype,"definition",{get:function(){return this._definition},set:function(e){this._definition=e},enumerable:!1,configurable:!0}),t}(a);e.Alternation=m;var g=function(){function e(e){this.idx=1,r.assign(this,r.pick(e,(function(e){return void 0!==e})))}return e.prototype.accept=function(e){e.visit(this)},e}();function y(e){function t(e){return r.map(e,y)}if(e instanceof s)return{type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};if(e instanceof l)return{type:"Alternative",definition:t(e.definition)};if(e instanceof c)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof h)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof f)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:y(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof v)return{type:"RepetitionWithSeparator",idx:e.idx,separator:y(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof d)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof m)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof g){var n={type:"Terminal",name:e.terminalType.name,label:i.tokenLabel(e.terminalType),idx:e.idx},a=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=r.isRegExp(a)?a.source:a),n}if(e instanceof u)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}e.Terminal=g,e.serializeGrammar=function(e){return r.map(e,y)},e.serializeProduction=y})),m=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RestWalker=void 0;var t=o(),n=v(),r=function(){function e(){}return e.prototype.walk=function(e,r){var i=this;void 0===r&&(r=[]),t.forEach(e.definition,(function(a,o){var s=t.drop(e.definition,o+1);if(a instanceof n.NonTerminal)i.walkProdRef(a,s,r);else if(a instanceof n.Terminal)i.walkTerminal(a,s,r);else if(a instanceof n.Alternative)i.walkFlat(a,s,r);else if(a instanceof n.Option)i.walkOption(a,s,r);else if(a instanceof n.RepetitionMandatory)i.walkAtLeastOne(a,s,r);else if(a instanceof n.RepetitionMandatoryWithSeparator)i.walkAtLeastOneSep(a,s,r);else if(a instanceof n.RepetitionWithSeparator)i.walkManySep(a,s,r);else if(a instanceof n.Repetition)i.walkMany(a,s,r);else{if(!(a instanceof n.Alternation))throw Error("non exhaustive match");i.walkOr(a,s,r)}}))},e.prototype.walkTerminal=function(e,t,n){},e.prototype.walkProdRef=function(e,t,n){},e.prototype.walkFlat=function(e,t,n){var r=t.concat(n);this.walk(e,r)},e.prototype.walkOption=function(e,t,n){var r=t.concat(n);this.walk(e,r)},e.prototype.walkAtLeastOne=function(e,t,r){var i=[new n.Option({definition:e.definition})].concat(t,r);this.walk(e,i)},e.prototype.walkAtLeastOneSep=function(e,t,n){var r=i(e,t,n);this.walk(e,r)},e.prototype.walkMany=function(e,t,r){var i=[new n.Option({definition:e.definition})].concat(t,r);this.walk(e,i)},e.prototype.walkManySep=function(e,t,n){var r=i(e,t,n);this.walk(e,r)},e.prototype.walkOr=function(e,r,i){var a=this,o=r.concat(i);t.forEach(e.definition,(function(e){var t=new n.Alternative({definition:[e]});a.walk(t,o)}))},e}();function i(e,t,r){return[new n.Option({definition:[new n.Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}e.RestWalker=r})),g=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GAstVisitor=void 0;var t=v(),n=function(){function e(){}return e.prototype.visit=function(e){var n=e;switch(n.constructor){case t.NonTerminal:return this.visitNonTerminal(n);case t.Alternative:return this.visitAlternative(n);case t.Option:return this.visitOption(n);case t.RepetitionMandatory:return this.visitRepetitionMandatory(n);case t.RepetitionMandatoryWithSeparator:return this.visitRepetitionMandatoryWithSeparator(n);case t.RepetitionWithSeparator:return this.visitRepetitionWithSeparator(n);case t.Repetition:return this.visitRepetition(n);case t.Alternation:return this.visitAlternation(n);case t.Terminal:return this.visitTerminal(n);case t.Rule:return this.visitRule(n);default:throw Error("non exhaustive match")}},e.prototype.visitNonTerminal=function(e){},e.prototype.visitAlternative=function(e){},e.prototype.visitOption=function(e){},e.prototype.visitRepetition=function(e){},e.prototype.visitRepetitionMandatory=function(e){},e.prototype.visitRepetitionMandatoryWithSeparator=function(e){},e.prototype.visitRepetitionWithSeparator=function(e){},e.prototype.visitAlternation=function(e){},e.prototype.visitTerminal=function(e){},e.prototype.visitRule=function(e){},e}();e.GAstVisitor=n})),y=i((function(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.collectMethods=e.DslMethodsCollectorVisitor=e.getProductionDslName=e.isBranchingProd=e.isOptionalProd=e.isSequenceProd=void 0;var r=o(),i=v(),a=g();e.isSequenceProd=function(e){return e instanceof i.Alternative||e instanceof i.Option||e instanceof i.Repetition||e instanceof i.RepetitionMandatory||e instanceof i.RepetitionMandatoryWithSeparator||e instanceof i.RepetitionWithSeparator||e instanceof i.Terminal||e instanceof i.Rule},e.isOptionalProd=function e(t,n){return void 0===n&&(n=[]),!!(t instanceof i.Option||t instanceof i.Repetition||t instanceof i.RepetitionWithSeparator)||(t instanceof i.Alternation?r.some(t.definition,(function(t){return e(t,n)})):!(t instanceof i.NonTerminal&&r.contains(n,t))&&(t instanceof i.AbstractProduction&&(t instanceof i.NonTerminal&&n.push(t),r.every(t.definition,(function(t){return e(t,n)})))))},e.isBranchingProd=function(e){return e instanceof i.Alternation},e.getProductionDslName=function(e){if(e instanceof i.NonTerminal)return"SUBRULE";if(e instanceof i.Option)return"OPTION";if(e instanceof i.Alternation)return"OR";if(e instanceof i.RepetitionMandatory)return"AT_LEAST_ONE";if(e instanceof i.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(e instanceof i.RepetitionWithSeparator)return"MANY_SEP";if(e instanceof i.Repetition)return"MANY";if(e instanceof i.Terminal)return"CONSUME";throw Error("non exhaustive match")};var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.separator="-",t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return n(t,e),t.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},t.prototype.visitTerminal=function(e){var t=e.terminalType.name+this.separator+"Terminal";r.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitNonTerminal=function(e){var t=e.nonTerminalName+this.separator+"Terminal";r.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},t.prototype.visitOption=function(e){this.dslMethods.option.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},t.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},t.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)},t}(a.GAstVisitor);e.DslMethodsCollectorVisitor=s;var u=new s;e.collectMethods=function(e){u.reset(),e.accept(u);var t=u.dslMethods;return u.reset(),t}})),x=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.firstForTerminal=e.firstForBranching=e.firstForSequence=e.first=void 0;var t=o(),n=v(),r=y();function i(e){if(e instanceof n.NonTerminal)return i(e.referencedRule);if(e instanceof n.Terminal)return u(e);if(r.isSequenceProd(e))return a(e);if(r.isBranchingProd(e))return s(e);throw Error("non exhaustive match")}function a(e){for(var n,a=[],o=e.definition,s=0,u=o.length>s,l=!0;u&&l;)n=o[s],l=r.isOptionalProd(n),a=a.concat(i(n)),s+=1,u=o.length>s;return t.uniq(a)}function s(e){var n=t.map(e.definition,(function(e){return i(e)}));return t.uniq(t.flatten(n))}function u(e){return[e.terminalType]}e.first=i,e.firstForSequence=a,e.firstForBranching=s,e.firstForTerminal=u})),_=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.IN=void 0,e.IN="_~IN~_"})),b=i((function(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.buildInProdFollowPrefix=e.buildBetweenProdsFollowPrefix=e.computeAllProdsFollows=e.ResyncFollowsWalker=void 0;var r=m(),i=x(),a=o(),s=_(),u=v(),l=function(e){function t(t){var n=e.call(this)||this;return n.topProd=t,n.follows={},n}return n(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},t.prototype.walkTerminal=function(e,t,n){},t.prototype.walkProdRef=function(e,t,n){var r=c(e.referencedRule,e.idx)+this.topProd.name,a=t.concat(n),o=new u.Alternative({definition:a}),s=i.first(o);this.follows[r]=s},t}(r.RestWalker);function c(e,t){return e.name+t+s.IN}e.ResyncFollowsWalker=l,e.computeAllProdsFollows=function(e){var t={};return a.forEach(e,(function(e){var n=new l(e).startWalking();a.assign(t,n)})),t},e.buildBetweenProdsFollowPrefix=c,e.buildInProdFollowPrefix=function(e){return e.terminalType.name+e.idx+s.IN}})),T=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.defaultGrammarValidatorErrorProvider=e.defaultGrammarResolverErrorProvider=e.defaultParserErrorProvider=void 0;var t=p(),n=o(),r=o(),i=v(),a=y();e.defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var n=e.expected,r=e.actual;e.previous,e.ruleName;return"Expecting "+(t.hasTokenLabel(n)?"--\x3e "+t.tokenLabel(n)+" <--":"token of type --\x3e "+n.name+" <--")+" but found --\x3e '"+r.image+"' <--"},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;e.ruleName;return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage:function(e){var n=e.expectedPathsPerAlt,i=e.actual,a=(e.previous,e.customUserDescription),o=(e.ruleName,"Expecting: "),s="\nbut found: '"+r.first(i).image+"'";if(a)return o+a+s;var u=r.reduce(n,(function(e,t){return e.concat(t)}),[]),l=r.map(u,(function(e){return"["+r.map(e,(function(e){return t.tokenLabel(e)})).join(", ")+"]"}));return o+("one of these possible Token sequences:\n"+r.map(l,(function(e,t){return"  "+(t+1)+". "+e})).join("\n"))+s},buildEarlyExitMessage:function(e){var n=e.expectedIterationPaths,i=e.actual,a=e.customUserDescription,o=(e.ruleName,"Expecting: "),s="\nbut found: '"+r.first(i).image+"'";return a?o+a+s:o+("expecting at least one iteration which starts with one of these possible Token sequences::\n  <"+r.map(n,(function(e){return"["+r.map(e,(function(e){return t.tokenLabel(e)})).join(",")+"]"})).join(" ,")+">")+s}},Object.freeze(e.defaultParserErrorProvider),e.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+"<-\ninside top level rule: ->"+e.name+"<-"}},e.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,t){var n,o=e.name,s=r.first(t),u=s.idx,l=a.getProductionDslName(s),c=(n=s)instanceof i.Terminal?n.terminalType.name:n instanceof i.NonTerminal?n.nonTerminalName:"",h="->"+l+(u>0?u:"")+"<- "+(c?"with argument: ->"+c+"<-":"")+"\n                  appears more than once ("+t.length+" times) in the top level rule: ->"+o+"<-.\n                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES\n                  ";return h=(h=h.replace(/[ \t]+/g," ")).replace(/\s\s+/g,"\n")},buildNamespaceConflictError:function(e){return"Namespace conflict found in grammar.\nThe grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+e.name+">.\nTo resolve this make sure each Terminal and Non-Terminal names are unique\nThis is easy to accomplish by using the convention that Terminal names start with an uppercase letter\nand Non-Terminal names start with a lower case letter."},buildAlternationPrefixAmbiguityError:function(e){var n=r.map(e.prefixPath,(function(e){return t.tokenLabel(e)})).join(", "),i=0===e.alternation.idx?"":e.alternation.idx;return"Ambiguous alternatives: <"+e.ambiguityIndices.join(" ,")+"> due to common lookahead prefix\nin <OR"+i+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+n+"> may appears as a prefix path in all these alternatives.\nSee: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX\nFor Further details."},buildAlternationAmbiguityError:function(e){var n=r.map(e.prefixPath,(function(e){return t.tokenLabel(e)})).join(", "),i=0===e.alternation.idx?"":e.alternation.idx,a="Ambiguous Alternatives Detected: <"+e.ambiguityIndices.join(" ,")+"> in <OR"+i+"> inside <"+e.topLevelRule.name+"> Rule,\n<"+n+"> may appears as a prefix path in all these alternatives.\n";return a+="See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES\nFor Further details."},buildEmptyRepetitionError:function(e){var t=a.getProductionDslName(e.repetition);return 0!==e.repetition.idx&&(t+=e.repetition.idx),"The repetition <"+t+"> within Rule <"+e.topLevelRule.name+"> can never consume any tokens.\nThis could lead to an infinite loop."},buildTokenNameError:function(e){return"deprecated"},buildEmptyAlternationError:function(e){return"Ambiguous empty alternative: <"+(e.emptyChoiceIdx+1)+"> in <OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\nOnly the last alternative may be an empty alternative."},buildTooManyAlternativesError:function(e){return"An Alternation cannot have more than 256 alternatives:\n<OR"+e.alternation.idx+"> inside <"+e.topLevelRule.name+"> Rule.\n has "+(e.alternation.definition.length+1)+" alternatives."},buildLeftRecursionError:function(e){var t=e.topLevelRule.name;return"Left Recursion found in grammar.\nrule: <"+t+"> can be invoked from itself (directly or indirectly)\nwithout consuming any Tokens. The grammar path that causes this is:\n "+(t+" --\x3e "+n.map(e.leftRecursionPath,(function(e){return e.name})).concat([t]).join(" --\x3e "))+"\n To fix this refactor your grammar to remove the left recursion.\nsee: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring."},buildInvalidRuleNameError:function(e){return"deprecated"},buildDuplicateRuleNameError:function(e){return"Duplicate definition, rule: ->"+(e.topLevelRule instanceof i.Rule?e.topLevelRule.name:e.topLevelRule)+"<- is already defined in the grammar: ->"+e.grammarName+"<-"}}})),M=i((function(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.GastRefResolverVisitor=e.resolveGrammar=void 0;var r=H(),i=o(),a=g();e.resolveGrammar=function(e,t){var n=new s(e,t);return n.resolveRefs(),n.errors};var s=function(e){function t(t,n){var r=e.call(this)||this;return r.nameToTopRule=t,r.errMsgProvider=n,r.errors=[],r}return n(t,e),t.prototype.resolveRefs=function(){var e=this;i.forEach(i.values(this.nameToTopRule),(function(t){e.currTopLevel=t,t.accept(e)}))},t.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule[e.nonTerminalName];if(t)e.referencedRule=t;else{var n=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:n,type:r.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}},t}(a.GAstVisitor);e.GastRefResolverVisitor=s})),w=i((function(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.nextPossibleTokensAfter=e.possiblePathsFrom=e.NextTerminalAfterAtLeastOneSepWalker=e.NextTerminalAfterAtLeastOneWalker=e.NextTerminalAfterManySepWalker=e.NextTerminalAfterManyWalker=e.AbstractNextTerminalAfterProductionWalker=e.NextAfterTokenWalker=e.AbstractNextPossibleTokensWalker=void 0;var r=m(),i=o(),a=x(),s=v(),u=function(e){function t(t,n){var r=e.call(this)||this;return r.topProd=t,r.path=n,r.possibleTokTypes=[],r.nextProductionName="",r.nextProductionOccurrence=0,r.found=!1,r.isAtEndOfPath=!1,r}return n(t,e),t.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=i.cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=i.cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},t.prototype.walk=function(t,n){void 0===n&&(n=[]),this.found||e.prototype.walk.call(this,t,n)},t.prototype.walkProdRef=function(e,t,n){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){var r=t.concat(n);this.updateExpectedNext(),this.walk(e.referencedRule,r)}},t.prototype.updateExpectedNext=function(){i.isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},t}(r.RestWalker);e.AbstractNextPossibleTokensWalker=u;var l=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.path=n,r.nextTerminalName="",r.nextTerminalOccurrence=0,r.nextTerminalName=r.path.lastTok.name,r.nextTerminalOccurrence=r.path.lastTokOccurrence,r}return n(t,e),t.prototype.walkTerminal=function(e,t,n){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){var r=t.concat(n),i=new s.Alternative({definition:r});this.possibleTokTypes=a.first(i),this.found=!0}},t}(u);e.NextAfterTokenWalker=l;var c=function(e){function t(t,n){var r=e.call(this)||this;return r.topRule=t,r.occurrence=n,r.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},r}return n(t,e),t.prototype.startWalking=function(){return this.walk(this.topRule),this.result},t}(r.RestWalker);e.AbstractNextTerminalAfterProductionWalker=c;var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.walkMany=function(t,n,r){if(t.idx===this.occurrence){var a=i.first(n.concat(r));this.result.isEndOfRule=void 0===a,a instanceof s.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkMany.call(this,t,n,r)},t}(c);e.NextTerminalAfterManyWalker=h;var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.walkManySep=function(t,n,r){if(t.idx===this.occurrence){var a=i.first(n.concat(r));this.result.isEndOfRule=void 0===a,a instanceof s.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkManySep.call(this,t,n,r)},t}(c);e.NextTerminalAfterManySepWalker=f;var d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.walkAtLeastOne=function(t,n,r){if(t.idx===this.occurrence){var a=i.first(n.concat(r));this.result.isEndOfRule=void 0===a,a instanceof s.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkAtLeastOne.call(this,t,n,r)},t}(c);e.NextTerminalAfterAtLeastOneWalker=d;var p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.walkAtLeastOneSep=function(t,n,r){if(t.idx===this.occurrence){var a=i.first(n.concat(r));this.result.isEndOfRule=void 0===a,a instanceof s.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkAtLeastOneSep.call(this,t,n,r)},t}(c);function g(e,t,n,r){var a=i.cloneArr(n);a.push(e.name);var o=i.cloneArr(r);return o.push(1),{idx:t,def:e.definition,ruleStack:a,occurrenceStack:o}}e.NextTerminalAfterAtLeastOneSepWalker=p,e.possiblePathsFrom=function e(t,n,r){void 0===r&&(r=[]),r=i.cloneArr(r);var a=[],o=0;function u(s){var u=e(function(e){return e.concat(i.drop(t,o+1))}(s),n,r);return a.concat(u)}for(;r.length<n&&o<t.length;){var l=t[o];if(l instanceof s.Alternative)return u(l.definition);if(l instanceof s.NonTerminal)return u(l.definition);if(l instanceof s.Option)a=u(l.definition);else{if(l instanceof s.RepetitionMandatory)return u(c=l.definition.concat([new s.Repetition({definition:l.definition})]));if(l instanceof s.RepetitionMandatoryWithSeparator)return u(c=[new s.Alternative({definition:l.definition}),new s.Repetition({definition:[new s.Terminal({terminalType:l.separator})].concat(l.definition)})]);if(l instanceof s.RepetitionWithSeparator){var c=l.definition.concat([new s.Repetition({definition:[new s.Terminal({terminalType:l.separator})].concat(l.definition)})]);a=u(c)}else if(l instanceof s.Repetition){c=l.definition.concat([new s.Repetition({definition:l.definition})]);a=u(c)}else{if(l instanceof s.Alternation)return i.forEach(l.definition,(function(e){!1===i.isEmpty(e.definition)&&(a=u(e.definition))})),a;if(!(l instanceof s.Terminal))throw Error("non exhaustive match");r.push(l.terminalType)}}o++}return a.push({partialPath:r,suffixDef:i.drop(t,o)}),a},e.nextPossibleTokensAfter=function(e,t,n,r){var a="EXIT_NONE_TERMINAL",o=[a],u="EXIT_ALTERNATIVE",l=!1,c=t.length,h=c-r-1,f=[],d=[];for(d.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!i.isEmpty(d);){var p=d.pop();if(p!==u){var v=p.def,m=p.idx,y=p.ruleStack,x=p.occurrenceStack;if(!i.isEmpty(v)){var _=v[0];if(_===a){var b={idx:m,def:i.drop(v),ruleStack:i.dropRight(y),occurrenceStack:i.dropRight(x)};d.push(b)}else if(_ instanceof s.Terminal)if(m<c-1){var T=m+1;if(n(t[T],_.terminalType)){b={idx:T,def:i.drop(v),ruleStack:y,occurrenceStack:x};d.push(b)}}else{if(m!==c-1)throw Error("non exhaustive match");f.push({nextTokenType:_.terminalType,nextTokenOccurrence:_.idx,ruleStack:y,occurrenceStack:x}),l=!0}else if(_ instanceof s.NonTerminal){var M=i.cloneArr(y);M.push(_.nonTerminalName);var w=i.cloneArr(x);w.push(_.idx);b={idx:m,def:_.definition.concat(o,i.drop(v)),ruleStack:M,occurrenceStack:w};d.push(b)}else if(_ instanceof s.Option){var S={idx:m,def:i.drop(v),ruleStack:y,occurrenceStack:x};d.push(S),d.push(u);var E={idx:m,def:_.definition.concat(i.drop(v)),ruleStack:y,occurrenceStack:x};d.push(E)}else if(_ instanceof s.RepetitionMandatory){var k=new s.Repetition({definition:_.definition,idx:_.idx});b={idx:m,def:_.definition.concat([k],i.drop(v)),ruleStack:y,occurrenceStack:x};d.push(b)}else if(_ instanceof s.RepetitionMandatoryWithSeparator){var A=new s.Terminal({terminalType:_.separator});k=new s.Repetition({definition:[A].concat(_.definition),idx:_.idx}),b={idx:m,def:_.definition.concat([k],i.drop(v)),ruleStack:y,occurrenceStack:x};d.push(b)}else if(_ instanceof s.RepetitionWithSeparator){S={idx:m,def:i.drop(v),ruleStack:y,occurrenceStack:x};d.push(S),d.push(u);A=new s.Terminal({terminalType:_.separator});var C=new s.Repetition({definition:[A].concat(_.definition),idx:_.idx});E={idx:m,def:_.definition.concat([C],i.drop(v)),ruleStack:y,occurrenceStack:x};d.push(E)}else if(_ instanceof s.Repetition){S={idx:m,def:i.drop(v),ruleStack:y,occurrenceStack:x};d.push(S),d.push(u);C=new s.Repetition({definition:_.definition,idx:_.idx}),E={idx:m,def:_.definition.concat([C],i.drop(v)),ruleStack:y,occurrenceStack:x};d.push(E)}else if(_ instanceof s.Alternation)for(var I=_.definition.length-1;I>=0;I--){var R={idx:m,def:_.definition[I].definition.concat(i.drop(v)),ruleStack:y,occurrenceStack:x};d.push(R),d.push(u)}else if(_ instanceof s.Alternative)d.push({idx:m,def:_.definition.concat(i.drop(v)),ruleStack:y,occurrenceStack:x});else{if(!(_ instanceof s.Rule))throw Error("non exhaustive match");d.push(g(_,m,y,x))}}}else l&&i.last(d).idx<=h&&d.pop()}return f}})),S=i((function(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.areTokenCategoriesNotUsed=e.isStrictPrefixOfPath=e.containsPath=e.getLookaheadPathsForOptionalProd=e.getLookaheadPathsForOr=e.lookAheadSequenceFromAlternatives=e.buildSingleAlternativeLookaheadFunction=e.buildAlternativesLookAheadFunc=e.buildLookaheadFuncForOptionalProd=e.buildLookaheadFuncForOr=e.getProdType=e.PROD_TYPE=void 0;var r,i,a=o(),s=w(),u=m(),l=h(),c=v(),f=g();(i=r=e.PROD_TYPE||(e.PROD_TYPE={}))[i.OPTION=0]="OPTION",i[i.REPETITION=1]="REPETITION",i[i.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",i[i.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",i[i.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",i[i.ALTERNATION=5]="ALTERNATION",e.getProdType=function(e){if(e instanceof c.Option)return r.OPTION;if(e instanceof c.Repetition)return r.REPETITION;if(e instanceof c.RepetitionMandatory)return r.REPETITION_MANDATORY;if(e instanceof c.RepetitionMandatoryWithSeparator)return r.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof c.RepetitionWithSeparator)return r.REPETITION_WITH_SEPARATOR;if(e instanceof c.Alternation)return r.ALTERNATION;throw Error("non exhaustive match")},e.buildLookaheadFuncForOr=function(e,t,n,r,i,a){var o=T(e,t,n);return a(o,r,E(o)?l.tokenStructuredMatcherNoCategories:l.tokenStructuredMatcher,i)},e.buildLookaheadFuncForOptionalProd=function(e,t,n,r,i,a){var o=M(e,t,i,n),s=E(o)?l.tokenStructuredMatcherNoCategories:l.tokenStructuredMatcher;return a(o[0],s,r)},e.buildAlternativesLookAheadFunc=function(e,t,n,r){var i=e.length,o=a.every(e,(function(e){return a.every(e,(function(e){return 1===e.length}))}));if(t)return function(t){for(var r=a.map(t,(function(e){return e.GATE})),o=0;o<i;o++){var s=e[o],u=s.length,l=r[o];if(void 0===l||!1!==l.call(this))e:for(var c=0;c<u;c++){for(var h=s[c],f=h.length,d=0;d<f;d++){var p=this.LA(d+1);if(!1===n(p,h[d]))continue e}return o}}};if(o&&!r){var s=a.map(e,(function(e){return a.flatten(e)})),u=a.reduce(s,(function(e,t,n){return a.forEach(t,(function(t){a.has(e,t.tokenTypeIdx)||(e[t.tokenTypeIdx]=n),a.forEach(t.categoryMatches,(function(t){a.has(e,t)||(e[t]=n)}))})),e}),[]);return function(){var e=this.LA(1);return u[e.tokenTypeIdx]}}return function(){for(var t=0;t<i;t++){var r=e[t],a=r.length;e:for(var o=0;o<a;o++){for(var s=r[o],u=s.length,l=0;l<u;l++){var c=this.LA(l+1);if(!1===n(c,s[l]))continue e}return t}}}},e.buildSingleAlternativeLookaheadFunction=function(e,t,n){var r=a.every(e,(function(e){return 1===e.length})),i=e.length;if(r&&!n){var o=a.flatten(e);if(1===o.length&&a.isEmpty(o[0].categoryMatches)){var s=o[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===s}}var u=a.reduce(o,(function(e,t,n){return e[t.tokenTypeIdx]=!0,a.forEach(t.categoryMatches,(function(t){e[t]=!0})),e}),[]);return function(){var e=this.LA(1);return!0===u[e.tokenTypeIdx]}}return function(){e:for(var n=0;n<i;n++){for(var r=e[n],a=r.length,o=0;o<a;o++){var s=this.LA(o+1);if(!1===t(s,r[o]))continue e}return!0}return!1}};var d=function(e){function t(t,n,r){var i=e.call(this)||this;return i.topProd=t,i.targetOccurrence=n,i.targetProdType=r,i}return n(t,e),t.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},t.prototype.checkIsTarget=function(e,t,n,r){return e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.restDef=n.concat(r),!0)},t.prototype.walkOption=function(t,n,i){this.checkIsTarget(t,r.OPTION,n,i)||e.prototype.walkOption.call(this,t,n,i)},t.prototype.walkAtLeastOne=function(t,n,i){this.checkIsTarget(t,r.REPETITION_MANDATORY,n,i)||e.prototype.walkOption.call(this,t,n,i)},t.prototype.walkAtLeastOneSep=function(t,n,i){this.checkIsTarget(t,r.REPETITION_MANDATORY_WITH_SEPARATOR,n,i)||e.prototype.walkOption.call(this,t,n,i)},t.prototype.walkMany=function(t,n,i){this.checkIsTarget(t,r.REPETITION,n,i)||e.prototype.walkOption.call(this,t,n,i)},t.prototype.walkManySep=function(t,n,i){this.checkIsTarget(t,r.REPETITION_WITH_SEPARATOR,n,i)||e.prototype.walkOption.call(this,t,n,i)},t}(u.RestWalker),p=function(e){function t(t,n,r){var i=e.call(this)||this;return i.targetOccurrence=t,i.targetProdType=n,i.targetRef=r,i.result=[],i}return n(t,e),t.prototype.checkIsTarget=function(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(void 0===this.targetRef||e===this.targetRef)&&(this.result=e.definition)},t.prototype.visitOption=function(e){this.checkIsTarget(e,r.OPTION)},t.prototype.visitRepetition=function(e){this.checkIsTarget(e,r.REPETITION)},t.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,r.REPETITION_MANDATORY)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,r.REPETITION_MANDATORY_WITH_SEPARATOR)},t.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,r.REPETITION_WITH_SEPARATOR)},t.prototype.visitAlternation=function(e){this.checkIsTarget(e,r.ALTERNATION)},t}(f.GAstVisitor);function y(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=[];return t}function x(e){for(var t=[""],n=0;n<e.length;n++){for(var r=e[n],i=[],a=0;a<t.length;a++){var o=t[a];i.push(o+"_"+r.tokenTypeIdx);for(var s=0;s<r.categoryMatches.length;s++){var u="_"+r.categoryMatches[s];i.push(o+u)}}t=i}return t}function _(e,t,n){for(var r=0;r<e.length;r++)if(r!==n)for(var i=e[r],a=0;a<t.length;a++){if(!0===i[t[a]])return!1}return!0}function b(e,t){for(var n=a.map(e,(function(e){return s.possiblePathsFrom([e],1)})),r=y(n.length),i=a.map(n,(function(e){var t={};return a.forEach(e,(function(e){var n=x(e.partialPath);a.forEach(n,(function(e){t[e]=!0}))})),t})),o=n,u=1;u<=t;u++){var l=o;o=y(l.length);for(var c=function(e){for(var n=l[e],c=0;c<n.length;c++){var h=n[c].partialPath,f=n[c].suffixDef,d=x(h);if(_(i,d,e)||a.isEmpty(f)||h.length===t){var p=r[e];if(!1===S(p,h)){p.push(h);for(var v=0;v<d.length;v++){var m=d[v];i[e][m]=!0}}}else{var g=s.possiblePathsFrom(f,u+1,h);o[e]=o[e].concat(g),a.forEach(g,(function(t){var n=x(t.partialPath);a.forEach(n,(function(t){i[e][t]=!0}))}))}}},h=0;h<l.length;h++)c(h)}return r}function T(e,t,n,i){var a=new p(e,r.ALTERNATION,i);return t.accept(a),b(a.result,n)}function M(e,t,n,r){var i=new p(e,n);t.accept(i);var a=i.result,o=new d(t,e,n).startWalking();return b([new c.Alternative({definition:a}),new c.Alternative({definition:o})],r)}function S(e,t){e:for(var n=0;n<e.length;n++){var r=e[n];if(r.length===t.length){for(var i=0;i<r.length;i++){var a=t[i],o=r[i];if(!1===(a===o||void 0!==o.categoryMatchesMap[a.tokenTypeIdx]))continue e}return!0}}return!1}function E(e){return a.every(e,(function(e){return a.every(e,(function(e){return a.every(e,(function(e){return a.isEmpty(e.categoryMatches)}))}))}))}e.lookAheadSequenceFromAlternatives=b,e.getLookaheadPathsForOr=T,e.getLookaheadPathsForOptionalProd=M,e.containsPath=S,e.isStrictPrefixOfPath=function(e,t){return e.length<t.length&&a.every(e,(function(e,n){var r=t[n];return e===r||r.categoryMatchesMap[e.tokenTypeIdx]}))},e.areTokenCategoriesNotUsed=E})),E=i((function(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.checkPrefixAlternativesAmbiguities=e.validateSomeNonEmptyLookaheadPath=e.validateTooManyAlts=e.RepetionCollector=e.validateAmbiguousAlternationAlternatives=e.validateEmptyOrAlternative=e.getFirstNoneTerminal=e.validateNoLeftRecursion=e.validateRuleIsOverridden=e.validateRuleDoesNotAlreadyExist=e.OccurrenceValidationCollector=e.identifyProductionForDuplicates=e.validateGrammar=void 0;var r=o(),i=o(),a=H(),s=y(),u=S(),l=w(),c=v(),h=g();function f(e){return s.getProductionDslName(e)+"_#_"+e.idx+"_#_"+d(e)}function d(e){return e instanceof c.Terminal?e.terminalType.name:e instanceof c.NonTerminal?e.nonTerminalName:""}e.validateGrammar=function(e,t,n,o,u){var l=r.map(e,(function(e){return function(e,t){var n=new p;e.accept(n);var i=n.allProductions,o=r.groupBy(i,f),u=r.pick(o,(function(e){return e.length>1})),l=r.map(r.values(u),(function(n){var i=r.first(n),o=t.buildDuplicateFoundError(e,n),u=s.getProductionDslName(i),l={message:o,type:a.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:u,occurrence:i.idx},c=d(i);return c&&(l.parameter=c),l}));return l}(e,o)})),c=r.map(e,(function(e){return x(e,e,o)})),h=[],v=[],g=[];i.every(c,i.isEmpty)&&(h=i.map(e,(function(e){return T(e,o)})),v=i.map(e,(function(e){return M(e,t,o)})),g=A(e,t,o));var y=function(e,t,n){var r=[],o=i.map(t,(function(e){return e.name}));return i.forEach(e,(function(e){var t=e.name;if(i.contains(o,t)){var s=n.buildNamespaceConflictError(e);r.push({message:s,type:a.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t})}})),r}(e,n,o),_=i.map(e,(function(e){return k(e,o)})),b=i.map(e,(function(t){return m(t,e,u,o)}));return r.flatten(l.concat(g,c,h,v,y,_,b))},e.identifyProductionForDuplicates=f;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return n(t,e),t.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},t.prototype.visitOption=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t.prototype.visitAlternation=function(e){this.allProductions.push(e)},t.prototype.visitTerminal=function(e){this.allProductions.push(e)},t}(h.GAstVisitor);function m(e,t,n,r){var o=[];if(i.reduce(t,(function(t,n){return n.name===e.name?t+1:t}),0)>1){var s=r.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});o.push({message:s,type:a.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e.name})}return o}function x(e,t,n,i){void 0===i&&(i=[]);var o=[],s=_(t.definition);if(r.isEmpty(s))return[];var u=e.name;r.contains(s,e)&&o.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:i}),type:a.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:u});var l=r.difference(s,i.concat([e])),c=r.map(l,(function(t){var a=r.cloneArr(i);return a.push(t),x(e,t,n,a)}));return o.concat(r.flatten(c))}function _(e){var t=[];if(r.isEmpty(e))return t;var n=r.first(e);if(n instanceof c.NonTerminal)t.push(n.referencedRule);else if(n instanceof c.Alternative||n instanceof c.Option||n instanceof c.RepetitionMandatory||n instanceof c.RepetitionMandatoryWithSeparator||n instanceof c.RepetitionWithSeparator||n instanceof c.Repetition)t=t.concat(_(n.definition));else if(n instanceof c.Alternation)t=r.flatten(r.map(n.definition,(function(e){return _(e.definition)})));else if(!(n instanceof c.Terminal))throw Error("non exhaustive match");var i=s.isOptionalProd(n),a=e.length>1;if(i&&a){var o=r.drop(e);return t.concat(_(o))}return t}e.OccurrenceValidationCollector=p,e.validateRuleDoesNotAlreadyExist=m,e.validateRuleIsOverridden=function(e,t,n){var i,o=[];return r.contains(t,e)||(i="Invalid rule override, rule: ->"+e+"<- cannot be overridden in the grammar: ->"+n+"<-as it is not defined in any of the super grammars ",o.push({message:i,type:a.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),o},e.validateNoLeftRecursion=x,e.getFirstNoneTerminal=_;var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.alternations=[],t}return n(t,e),t.prototype.visitAlternation=function(e){this.alternations.push(e)},t}(h.GAstVisitor);function T(e,t){var n=new b;e.accept(n);var i=n.alternations;return r.reduce(i,(function(n,i){var o=r.dropRight(i.definition),s=r.map(o,(function(n,o){var s=l.nextPossibleTokensAfter([n],[],null,1);return r.isEmpty(s)?{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:i,emptyChoiceIdx:o}),type:a.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:i.idx,alternative:o+1}:null}));return n.concat(r.compact(s))}),[])}function M(e,t,n){var o=new b;e.accept(o);var s=o.alternations;s=i.reject(s,(function(e){return!0===e.ignoreAmbiguities}));var l=r.reduce(s,(function(o,s){var l=s.idx,c=s.maxLookahead||t,h=u.getLookaheadPathsForOr(l,e,c,s),f=function(e,t,n,o){var s=[],l=i.reduce(e,(function(n,r,a){return!0===t.definition[a].ignoreAmbiguities||i.forEach(r,(function(r){var o=[a];i.forEach(e,(function(e,n){a!==n&&u.containsPath(e,r)&&!0!==t.definition[n].ignoreAmbiguities&&o.push(n)})),o.length>1&&!u.containsPath(s,r)&&(s.push(r),n.push({alts:o,path:r}))})),n}),[]),c=r.map(l,(function(e){var r=i.map(e.alts,(function(e){return e+1}));return{message:o.buildAlternationAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:r,prefixPath:e.path}),type:a.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:t.idx,alternatives:[e.alts]}}));return c}(h,s,e,n),d=C(h,s,e,n);return o.concat(f,d)}),[]);return l}e.validateEmptyOrAlternative=T,e.validateAmbiguousAlternationAlternatives=M;var E=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.allProductions=[],t}return n(t,e),t.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},t.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},t.prototype.visitRepetition=function(e){this.allProductions.push(e)},t}(h.GAstVisitor);function k(e,t){var n=new b;e.accept(n);var i=n.alternations;return r.reduce(i,(function(n,r){return r.definition.length>255&&n.push({message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:r}),type:a.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:e.name,occurrence:r.idx}),n}),[])}function A(e,t,n){var r=[];return i.forEach(e,(function(e){var o=new E;e.accept(o);var s=o.allProductions;i.forEach(s,(function(o){var s=u.getProdType(o),l=o.maxLookahead||t,c=o.idx,h=u.getLookaheadPathsForOptionalProd(c,e,s,l)[0];if(i.isEmpty(i.flatten(h))){var f=n.buildEmptyRepetitionError({topLevelRule:e,repetition:o});r.push({message:f,type:a.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:e.name})}}))})),r}function C(e,t,n,r){var o=[],s=i.reduce(e,(function(e,t,n){var r=i.map(t,(function(e){return{idx:n,path:e}}));return e.concat(r)}),[]);return i.forEach(s,(function(e){if(!0!==t.definition[e.idx].ignoreAmbiguities){var l=e.idx,c=e.path,h=i.findAll(s,(function(e){return!0!==t.definition[e.idx].ignoreAmbiguities&&e.idx<l&&u.isStrictPrefixOfPath(e.path,c)})),f=i.map(h,(function(e){var i=[e.idx+1,l+1],o=0===t.idx?"":t.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:i,prefixPath:e.path}),type:a.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:o,alternatives:i}}));o=o.concat(f)}})),o}e.RepetionCollector=E,e.validateTooManyAlts=k,e.validateSomeNonEmptyLookaheadPath=A,e.checkPrefixAlternativesAmbiguities=C})),k=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateGrammar=e.resolveGrammar=void 0;var t=o(),n=M(),r=E(),i=T();e.resolveGrammar=function(e){e=t.defaults(e,{errMsgProvider:i.defaultGrammarResolverErrorProvider});var r={};return t.forEach(e.rules,(function(e){r[e.name]=e})),n.resolveGrammar(r,e.errMsgProvider)},e.validateGrammar=function(e){return e=t.defaults(e,{errMsgProvider:i.defaultGrammarValidatorErrorProvider}),r.validateGrammar(e.rules,e.maxLookahead,e.tokenTypes,e.errMsgProvider,e.grammarName)}})),A=i((function(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.EarlyExitException=e.NotAllInputParsedException=e.NoViableAltException=e.MismatchedTokenException=e.isRecognitionException=void 0;var r=o(),i="MismatchedTokenException",a="NoViableAltException",s="EarlyExitException",u="NotAllInputParsedException",l=[i,a,s,u];Object.freeze(l),e.isRecognitionException=function(e){return r.contains(l,e.name)};var c=function(e){function t(t,n){var r=this.constructor,i=e.call(this,t)||this;return i.token=n,i.resyncedTokens=[],Object.setPrototypeOf(i,r.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,i.constructor),i}return n(t,e),t}(Error),h=function(e){function t(t,n,r){var a=e.call(this,t,n)||this;return a.previousToken=r,a.name=i,a}return n(t,e),t}(c);e.MismatchedTokenException=h;var f=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.previousToken=r,i.name=a,i}return n(t,e),t}(c);e.NoViableAltException=f;var d=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.name=u,r}return n(t,e),t}(c);e.NotAllInputParsedException=d;var p=function(e){function t(t,n,r){var i=e.call(this,t,n)||this;return i.previousToken=r,i.name=s,i}return n(t,e),t}(c);e.EarlyExitException=p})),C=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.attemptInRepetitionRecovery=e.Recoverable=e.InRuleRecoveryException=e.IN_RULE_RECOVERY_EXCEPTION=e.EOF_FOLLOW_KEY=void 0;var t=p(),n=o(),r=A(),i=_(),a=H();function s(t){this.name=e.IN_RULE_RECOVERY_EXCEPTION,this.message=t}e.EOF_FOLLOW_KEY={},e.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException",e.InRuleRecoveryException=s,s.prototype=Error.prototype;var u=function(){function o(){}return o.prototype.initRecoverable=function(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=n.has(e,"recoveryEnabled")?e.recoveryEnabled:a.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=l)},o.prototype.getTokenToInsert=function(e){var n=t.createTokenInstance(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n},o.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},o.prototype.tryInRepetitionRecovery=function(e,t,i,a){for(var o=this,s=this.findReSyncTokenType(),u=this.exportLexerState(),l=[],c=!1,h=this.LA(1),f=this.LA(1),d=function(){var e=o.LA(0),t=o.errorMessageProvider.buildMismatchTokenMessage({expected:a,actual:h,previous:e,ruleName:o.getCurrRuleFullName()}),i=new r.MismatchedTokenException(t,h,o.LA(0));i.resyncedTokens=n.dropRight(l),o.SAVE_ERROR(i)};!c;){if(this.tokenMatcher(f,a))return void d();if(i.call(this))return d(),void e.apply(this,t);this.tokenMatcher(f,s)?c=!0:(f=this.SKIP_TOKEN(),this.addToResyncTokens(f,l))}this.importLexerState(u)},o.prototype.shouldInRepetitionRecoveryBeTried=function(e,t,n){return!(!1===n||void 0===e||void 0===t||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))},o.prototype.getFollowsForInRuleRecovery=function(e,t){var n=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(n)},o.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){var n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new s("sad sad panda")},o.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},o.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e)||n.isEmpty(t))return!1;var i=this.LA(1);return void 0!==n.find(t,(function(e){return r.tokenMatcher(i,e)}))},o.prototype.canRecoverWithSingleTokenDeletion=function(e){return this.tokenMatcher(this.LA(2),e)},o.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return n.contains(r,e)},o.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var i=t.tokenType;if(n.contains(e,i))return i;t=this.LA(r),r++}},o.prototype.getCurrFollowKey=function(){if(1===this.RULE_STACK.length)return e.EOF_FOLLOW_KEY;var t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}},o.prototype.buildFullFollowKeyStack=function(){var t=this,r=this.RULE_STACK,i=this.RULE_OCCURRENCE_STACK;return n.map(r,(function(n,a){return 0===a?e.EOF_FOLLOW_KEY:{ruleName:t.shortRuleNameToFullName(n),idxInCallingRule:i[a],inRule:t.shortRuleNameToFullName(r[a-1])}}))},o.prototype.flattenFollowSet=function(){var e=this,t=n.map(this.buildFullFollowKeyStack(),(function(t){return e.getFollowSetFromFollowKey(t)}));return n.flatten(t)},o.prototype.getFollowSetFromFollowKey=function(n){if(n===e.EOF_FOLLOW_KEY)return[t.EOF];var r=n.ruleName+n.idxInCallingRule+i.IN+n.inRule;return this.resyncFollows[r]},o.prototype.addToResyncTokens=function(e,n){return this.tokenMatcher(e,t.EOF)||n.push(e),n},o.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);!1===this.tokenMatcher(r,e);)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return n.dropRight(t)},o.prototype.attemptInRepetitionRecovery=function(e,t,n,r,i,a,o){},o.prototype.getCurrentGrammarPath=function(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:n.cloneArr(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}},o.prototype.getHumanReadableRuleStack=function(){var e=this;return n.map(this.RULE_STACK,(function(t){return e.shortRuleNameToFullName(t)}))},o}();function l(e,n,r,i,a,o,s){var u=this.getKeyForAutomaticLookahead(i,a),l=this.firstAfterRepMap[u];if(void 0===l){var c=this.getCurrRuleFullName();l=new o(this.getGAstProductions()[c],a).startWalking(),this.firstAfterRepMap[u]=l}var h=l.token,f=l.occurrence,d=l.isEndOfRule;1===this.RULE_STACK.length&&d&&void 0===h&&(h=t.EOF,f=1),this.shouldInRepetitionRecoveryBeTried(h,f,s)&&this.tryInRepetitionRecovery(e,n,r,h)}e.Recoverable=u,e.attemptInRepetitionRecovery=l})),I=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getKeyForAutomaticLookahead=e.AT_LEAST_ONE_SEP_IDX=e.MANY_SEP_IDX=e.AT_LEAST_ONE_IDX=e.MANY_IDX=e.OPTION_IDX=e.OR_IDX=e.BITS_FOR_ALT_IDX=e.BITS_FOR_RULE_IDX=e.BITS_FOR_OCCURRENCE_IDX=e.BITS_FOR_METHOD_TYPE=void 0,e.BITS_FOR_METHOD_TYPE=4,e.BITS_FOR_OCCURRENCE_IDX=8,e.BITS_FOR_RULE_IDX=12,e.BITS_FOR_ALT_IDX=8,e.OR_IDX=1<<e.BITS_FOR_OCCURRENCE_IDX,e.OPTION_IDX=2<<e.BITS_FOR_OCCURRENCE_IDX,e.MANY_IDX=3<<e.BITS_FOR_OCCURRENCE_IDX,e.AT_LEAST_ONE_IDX=4<<e.BITS_FOR_OCCURRENCE_IDX,e.MANY_SEP_IDX=5<<e.BITS_FOR_OCCURRENCE_IDX,e.AT_LEAST_ONE_SEP_IDX=6<<e.BITS_FOR_OCCURRENCE_IDX,e.getKeyForAutomaticLookahead=function(e,t,n){return n|t|e};e.BITS_FOR_ALT_IDX})),R=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LooksAhead=void 0;var t=S(),n=o(),r=H(),i=I(),a=y(),s=function(){function e(){}return e.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=n.has(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:r.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=n.has(e,"maxLookahead")?e.maxLookahead:r.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=n.isES2015MapSupported()?new Map:[],n.isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},e.prototype.preComputeLookaheadFunctions=function(e){var r=this;n.forEach(e,(function(e){r.TRACE_INIT(e.name+" Rule Lookahead",(function(){var o=a.collectMethods(e),s=o.alternation,u=o.repetition,l=o.option,c=o.repetitionMandatory,h=o.repetitionMandatoryWithSeparator,f=o.repetitionWithSeparator;n.forEach(s,(function(n){var o=0===n.idx?"":n.idx;r.TRACE_INIT(""+a.getProductionDslName(n)+o,(function(){var a=t.buildLookaheadFuncForOr(n.idx,e,n.maxLookahead||r.maxLookahead,n.hasPredicates,r.dynamicTokensEnabled,r.lookAheadBuilderForAlternatives),o=i.getKeyForAutomaticLookahead(r.fullRuleNameToShort[e.name],i.OR_IDX,n.idx);r.setLaFuncCache(o,a)}))})),n.forEach(u,(function(n){r.computeLookaheadFunc(e,n.idx,i.MANY_IDX,t.PROD_TYPE.REPETITION,n.maxLookahead,a.getProductionDslName(n))})),n.forEach(l,(function(n){r.computeLookaheadFunc(e,n.idx,i.OPTION_IDX,t.PROD_TYPE.OPTION,n.maxLookahead,a.getProductionDslName(n))})),n.forEach(c,(function(n){r.computeLookaheadFunc(e,n.idx,i.AT_LEAST_ONE_IDX,t.PROD_TYPE.REPETITION_MANDATORY,n.maxLookahead,a.getProductionDslName(n))})),n.forEach(h,(function(n){r.computeLookaheadFunc(e,n.idx,i.AT_LEAST_ONE_SEP_IDX,t.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,n.maxLookahead,a.getProductionDslName(n))})),n.forEach(f,(function(n){r.computeLookaheadFunc(e,n.idx,i.MANY_SEP_IDX,t.PROD_TYPE.REPETITION_WITH_SEPARATOR,n.maxLookahead,a.getProductionDslName(n))}))}))}))},e.prototype.computeLookaheadFunc=function(e,n,r,a,o,s){var u=this;this.TRACE_INIT(""+s+(0===n?"":n),(function(){var s=t.buildLookaheadFuncForOptionalProd(n,e,o||u.maxLookahead,u.dynamicTokensEnabled,a,u.lookAheadBuilderForOptional),l=i.getKeyForAutomaticLookahead(u.fullRuleNameToShort[e.name],r,n);u.setLaFuncCache(l,s)}))},e.prototype.lookAheadBuilderForOptional=function(e,n,r){return t.buildSingleAlternativeLookaheadFunction(e,n,r)},e.prototype.lookAheadBuilderForAlternatives=function(e,n,r,i){return t.buildAlternativesLookAheadFunc(e,n,r,i)},e.prototype.getKeyForAutomaticLookahead=function(e,t){var n=this.getLastExplicitRuleShortName();return i.getKeyForAutomaticLookahead(n,e,t)},e.prototype.getLaFuncFromCache=function(e){},e.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},e.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},e.prototype.setLaFuncCache=function(e,t){},e.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},e.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},e}();e.LooksAhead=s})),L=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.addNoneTerminalToCst=e.addTerminalToCst=e.setNodeLocationFull=e.setNodeLocationOnlyOffset=void 0,e.setNodeLocationOnlyOffset=function(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)},e.setNodeLocationFull=function(e,t){!0===isNaN(e.startOffset)?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)},e.addTerminalToCst=function(e,t,n){void 0===e.children[n]?e.children[n]=[t]:e.children[n].push(t)},e.addNoneTerminalToCst=function(e,t,n){void 0===e.children[t]?e.children[t]=[n]:e.children[t].push(n)}})),P=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.defineNameProp=e.functionName=e.classNameFromInstance=void 0;var t=o();e.classNameFromInstance=function(e){return r(e.constructor)};var n="name";function r(e){return e.name||"anonymous"}e.functionName=r,e.defineNameProp=function(e,r){var i=Object.getOwnPropertyDescriptor(e,n);return!(!t.isUndefined(i)&&!i.configurable)&&(Object.defineProperty(e,n,{enumerable:!1,configurable:!0,writable:!1,value:r}),!0)}})),N=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateRedundantMethods=e.validateMissingCstMethods=e.validateVisitor=e.CstVisitorDefinitionError=e.createBaseVisitorConstructorWithDefaults=e.createBaseSemanticVisitorConstructor=e.defaultVisit=void 0;var t,n,r=o(),i=P();function a(e,t){for(var n=r.keys(e),i=n.length,a=0;a<i;a++)for(var o=e[n[a]],s=o.length,u=0;u<s;u++){var l=o[u];void 0===l.tokenTypeIdx&&this[l.name](l.children,t)}}function s(e,t){var n=u(e,t),r=c(e,t);return n.concat(r)}function u(e,n){var a=r.map(n,(function(n){if(!r.isFunction(e[n]))return{msg:"Missing visitor method: <"+n+"> on "+i.functionName(e.constructor)+" CST Visitor.",type:t.MISSING_METHOD,methodName:n}}));return r.compact(a)}e.defaultVisit=a,e.createBaseSemanticVisitorConstructor=function(e,t){var n=function(){};return i.defineNameProp(n,e+"BaseSemantics"),(n.prototype={visit:function(e,t){if(r.isArray(e)&&(e=e[0]),!r.isUndefined(e))return this[e.name](e.children,t)},validateVisitor:function(){var e=s(this,t);if(!r.isEmpty(e)){var n=r.map(e,(function(e){return e.msg}));throw Error("Errors Detected in CST Visitor <"+i.functionName(this.constructor)+">:\n\t"+n.join("\n\n").replace(/\n/g,"\n\t"))}}}).constructor=n,n._RULE_NAMES=t,n},e.createBaseVisitorConstructorWithDefaults=function(e,t,n){var o=function(){};i.defineNameProp(o,e+"BaseSemanticsWithDefaults");var s=Object.create(n.prototype);return r.forEach(t,(function(e){s[e]=a})),(o.prototype=s).constructor=o,o},(n=t=e.CstVisitorDefinitionError||(e.CstVisitorDefinitionError={}))[n.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",n[n.MISSING_METHOD=1]="MISSING_METHOD",e.validateVisitor=s,e.validateMissingCstMethods=u;var l=["constructor","visit","validateVisitor"];function c(e,n){var a=[];for(var o in e)r.isFunction(e[o])&&!r.contains(l,o)&&!r.contains(n,o)&&a.push({msg:"Redundant visitor method: <"+o+"> on "+i.functionName(e.constructor)+" CST Visitor\nThere is no Grammar Rule corresponding to this method's name.\n",type:t.REDUNDANT_METHOD,methodName:o});return a}e.validateRedundantMethods=c})),O=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TreeBuilder=void 0;var t=L(),n=o(),r=N(),i=H(),a=function(){function e(){}return e.prototype.initTreeBuilder=function(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=n.has(e,"nodeLocationTracking")?e.nodeLocationTracking:i.DEFAULT_PARSER_CONFIG.nodeLocationTracking,this.outputCst)if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=t.setNodeLocationFull,this.setNodeLocationFromNode=t.setNodeLocationFull,this.cstPostRule=n.NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=n.NOOP,this.setNodeLocationFromNode=n.NOOP,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=t.setNodeLocationOnlyOffset,this.setNodeLocationFromNode=t.setNodeLocationOnlyOffset,this.cstPostRule=n.NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=n.NOOP,this.setNodeLocationFromNode=n.NOOP,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else{if(!/none/i.test(this.nodeLocationTracking))throw Error('Invalid <nodeLocationTracking> config option: "'+e.nodeLocationTracking+'"');this.setNodeLocationFromToken=n.NOOP,this.setNodeLocationFromNode=n.NOOP,this.cstPostRule=n.NOOP,this.setInitialNodeLocation=n.NOOP}else this.cstInvocationStateUpdate=n.NOOP,this.cstFinallyStateUpdate=n.NOOP,this.cstPostTerminal=n.NOOP,this.cstPostNonTerminal=n.NOOP,this.cstPostRule=n.NOOP},e.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(e){e.location={startOffset:NaN,endOffset:NaN}},e.prototype.setInitialNodeLocationOnlyOffsetRegular=function(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},e.prototype.setInitialNodeLocationFullRecovery=function(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},e.prototype.setInitialNodeLocationFullRegular=function(e){var t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},e.prototype.cstInvocationStateUpdate=function(e,t){var n={name:e,children:{}};this.setInitialNodeLocation(n),this.CST_STACK.push(n)},e.prototype.cstFinallyStateUpdate=function(){this.CST_STACK.pop()},e.prototype.cstPostRuleFull=function(e){var t=this.LA(0),n=e.location;n.startOffset<=t.startOffset?(n.endOffset=t.endOffset,n.endLine=t.endLine,n.endColumn=t.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)},e.prototype.cstPostRuleOnlyOffset=function(e){var t=this.LA(0),n=e.location;n.startOffset<=t.startOffset?n.endOffset=t.endOffset:n.startOffset=NaN},e.prototype.cstPostTerminal=function(e,n){var r=this.CST_STACK[this.CST_STACK.length-1];t.addTerminalToCst(r,n,e),this.setNodeLocationFromToken(r.location,n)},e.prototype.cstPostNonTerminal=function(e,n){var r=this.CST_STACK[this.CST_STACK.length-1];t.addNoneTerminalToCst(r,n,e),this.setNodeLocationFromNode(r.location,e.location)},e.prototype.getBaseCstVisitorConstructor=function(){if(n.isUndefined(this.baseCstVisitorConstructor)){var e=r.createBaseSemanticVisitorConstructor(this.className,n.keys(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},e.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(n.isUndefined(this.baseCstVisitorWithDefaultsConstructor)){var e=r.createBaseVisitorConstructorWithDefaults(this.className,n.keys(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},e.prototype.getLastExplicitRuleShortName=function(){var e=this.RULE_STACK;return e[e.length-1]},e.prototype.getPreviousExplicitRuleShortName=function(){var e=this.RULE_STACK;return e[e.length-2]},e.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},e}();e.TreeBuilder=a})),D=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.LexerAdapter=void 0;var t=H(),n=function(){function e(){}return e.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(e.prototype,"input",{get:function(){return this.tokVector},set:function(e){if(!0!==this.selfAnalysisDone)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!1,configurable:!0}),e.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):t.END_OF_FILE},e.prototype.LA=function(e){var n=this.currIdx+e;return n<0||this.tokVectorLength<=n?t.END_OF_FILE:this.tokVector[n]},e.prototype.consumeToken=function(){this.currIdx++},e.prototype.exportLexerState=function(){return this.currIdx},e.prototype.importLexerState=function(e){this.currIdx=e},e.prototype.resetLexerState=function(){this.currIdx=-1},e.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},e.prototype.getLexerPosition=function(){return this.exportLexerState()},e}();e.LexerAdapter=n})),F=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RecognizerApi=void 0;var t=o(),n=A(),r=H(),i=T(),a=E(),s=v(),u=function(){function e(){}return e.prototype.ACTION=function(e){return e.call(this)},e.prototype.consume=function(e,t,n){return this.consumeInternal(t,e,n)},e.prototype.subrule=function(e,t,n){return this.subruleInternal(t,e,n)},e.prototype.option=function(e,t){return this.optionInternal(t,e)},e.prototype.or=function(e,t){return this.orInternal(t,e)},e.prototype.many=function(e,t){return this.manyInternal(e,t)},e.prototype.atLeastOne=function(e,t){return this.atLeastOneInternal(e,t)},e.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},e.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},e.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},e.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},e.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},e.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},e.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},e.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},e.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},e.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},e.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},e.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},e.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},e.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},e.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},e.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},e.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},e.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},e.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},e.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},e.prototype.OPTION=function(e){return this.optionInternal(e,0)},e.prototype.OPTION1=function(e){return this.optionInternal(e,1)},e.prototype.OPTION2=function(e){return this.optionInternal(e,2)},e.prototype.OPTION3=function(e){return this.optionInternal(e,3)},e.prototype.OPTION4=function(e){return this.optionInternal(e,4)},e.prototype.OPTION5=function(e){return this.optionInternal(e,5)},e.prototype.OPTION6=function(e){return this.optionInternal(e,6)},e.prototype.OPTION7=function(e){return this.optionInternal(e,7)},e.prototype.OPTION8=function(e){return this.optionInternal(e,8)},e.prototype.OPTION9=function(e){return this.optionInternal(e,9)},e.prototype.OR=function(e){return this.orInternal(e,0)},e.prototype.OR1=function(e){return this.orInternal(e,1)},e.prototype.OR2=function(e){return this.orInternal(e,2)},e.prototype.OR3=function(e){return this.orInternal(e,3)},e.prototype.OR4=function(e){return this.orInternal(e,4)},e.prototype.OR5=function(e){return this.orInternal(e,5)},e.prototype.OR6=function(e){return this.orInternal(e,6)},e.prototype.OR7=function(e){return this.orInternal(e,7)},e.prototype.OR8=function(e){return this.orInternal(e,8)},e.prototype.OR9=function(e){return this.orInternal(e,9)},e.prototype.MANY=function(e){this.manyInternal(0,e)},e.prototype.MANY1=function(e){this.manyInternal(1,e)},e.prototype.MANY2=function(e){this.manyInternal(2,e)},e.prototype.MANY3=function(e){this.manyInternal(3,e)},e.prototype.MANY4=function(e){this.manyInternal(4,e)},e.prototype.MANY5=function(e){this.manyInternal(5,e)},e.prototype.MANY6=function(e){this.manyInternal(6,e)},e.prototype.MANY7=function(e){this.manyInternal(7,e)},e.prototype.MANY8=function(e){this.manyInternal(8,e)},e.prototype.MANY9=function(e){this.manyInternal(9,e)},e.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},e.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},e.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},e.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},e.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},e.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},e.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},e.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},e.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},e.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},e.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},e.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},e.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},e.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},e.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},e.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},e.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},e.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},e.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},e.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},e.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},e.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},e.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},e.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},e.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},e.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},e.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},e.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},e.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},e.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},e.prototype.RULE=function(e,n,a){if(void 0===a&&(a=r.DEFAULT_RULE_CONFIG),t.contains(this.definedRulesNames,e)){var o={message:i.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:r.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(o)}this.definedRulesNames.push(e);var s=this.defineRule(e,n,a);return this[e]=s,s},e.prototype.OVERRIDE_RULE=function(e,t,n){void 0===n&&(n=r.DEFAULT_RULE_CONFIG);var i=[];i=i.concat(a.validateRuleIsOverridden(e,this.definedRulesNames,this.className)),this.definitionErrors=this.definitionErrors.concat(i);var o=this.defineRule(e,t,n);return this[e]=o,o},e.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(e){if(n.isRecognitionException(e))return!1;throw e}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},e.prototype.getGAstProductions=function(){return this.gastProductionsCache},e.prototype.getSerializedGastProductions=function(){return s.serializeGrammar(t.values(this.gastProductionsCache))},e}();e.RecognizerApi=u})),U=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.RecognizerEngine=void 0;var t=o(),n=I(),r=A(),i=S(),a=w(),s=H(),u=C(),l=p(),c=h(),f=P(),d=function(){function e(){}return e.prototype.initRecognizerEngine=function(e,n){if(this.className=f.classNameFromInstance(this),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=c.tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},t.has(n,"serializedGrammar"))throw Error("The Parser's configuration can no longer contain a <serializedGrammar> property.\n\tSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0\n\tFor Further details.");if(t.isArray(e)){if(t.isEmpty(e))throw Error("A Token Vocabulary cannot be empty.\n\tNote that the first argument for the parser constructor\n\tis no longer a Token vector (since v4.0).");if("number"==typeof e[0].startOffset)throw Error("The Parser constructor no longer accepts a token vector as the first argument.\n\tSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0\n\tFor Further details.")}if(t.isArray(e))this.tokensMap=t.reduce(e,(function(e,t){return e[t.name]=t,e}),{});else if(t.has(e,"modes")&&t.every(t.flatten(t.values(e.modes)),c.isTokenType)){var r=t.flatten(t.values(e.modes)),i=t.uniq(r);this.tokensMap=t.reduce(i,(function(e,t){return e[t.name]=t,e}),{})}else{if(!t.isObject(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=t.cloneObj(e)}this.tokensMap.EOF=l.EOF;var a=t.every(t.values(e),(function(e){return t.isEmpty(e.categoryMatches)}));this.tokenMatcher=a?c.tokenStructuredMatcherNoCategories:c.tokenStructuredMatcher,c.augmentTokenTypes(t.values(this.tokensMap))},e.prototype.defineRule=function(e,r,i){if(this.selfAnalysisDone)throw Error("Grammar rule <"+e+"> may not be defined after the 'performSelfAnalysis' method has been called'\nMake sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.");var a=t.has(i,"resyncEnabled")?i.resyncEnabled:s.DEFAULT_RULE_CONFIG.resyncEnabled,o=t.has(i,"recoveryValueFunc")?i.recoveryValueFunc:s.DEFAULT_RULE_CONFIG.recoveryValueFunc,u=this.ruleShortNameIdx<<n.BITS_FOR_METHOD_TYPE+n.BITS_FOR_OCCURRENCE_IDX;function l(e){try{if(!0===this.outputCst){r.apply(this,e);var t=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(t),t}return r.apply(this,e)}catch(e){return this.invokeRuleCatch(e,a,o)}finally{this.ruleFinallyStateUpdate()}}this.ruleShortNameIdx++,this.shortRuleNameToFull[u]=e,this.fullRuleNameToShort[e]=u;var c=function(t,n){return void 0===t&&(t=0),this.ruleInvocationStateUpdate(u,e,t),l.call(this,n)};return c.ruleName=e,c.originalGrammarAction=r,c},e.prototype.invokeRuleCatch=function(e,t,n){var i=1===this.RULE_STACK.length,a=t&&!this.isBackTracking()&&this.recoveryEnabled;if(r.isRecognitionException(e)){var o=e;if(a){var s,u=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(u))return o.resyncedTokens=this.reSyncTo(u),this.outputCst?((s=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,s):n();throw this.outputCst&&((s=this.CST_STACK[this.CST_STACK.length-1]).recoveredNode=!0,o.partialCstResult=s),o}if(i)return this.moveToTerminatedState(),n();throw o}throw e},e.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(n.OPTION_IDX,t);return this.optionInternalLogic(e,t,r)},e.prototype.optionInternalLogic=function(e,t,n){var r,i,a=this,o=this.getLaFuncFromCache(n);if(void 0!==e.DEF){if(r=e.DEF,void 0!==(i=e.GATE)){var s=o;o=function(){return i.call(a)&&s.call(a)}}}else r=e;if(!0===o.call(this))return r.call(this)},e.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(n.AT_LEAST_ONE_IDX,e);return this.atLeastOneInternalLogic(e,t,r)},e.prototype.atLeastOneInternalLogic=function(e,t,r){var o,s,u=this,l=this.getLaFuncFromCache(r);if(void 0!==t.DEF){if(o=t.DEF,void 0!==(s=t.GATE)){var c=l;l=function(){return s.call(u)&&c.call(u)}}}else o=t;if(!0!==l.call(this))throw this.raiseEarlyExitException(e,i.PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);for(var h=this.doSingleRepetition(o);!0===l.call(this)&&!0===h;)h=this.doSingleRepetition(o);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],l,n.AT_LEAST_ONE_IDX,e,a.NextTerminalAfterAtLeastOneWalker)},e.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(n.AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},e.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var o=this,s=t.DEF,u=t.SEP;if(!0!==this.getLaFuncFromCache(r).call(this))throw this.raiseEarlyExitException(e,i.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);s.call(this);for(var l=function(){return o.tokenMatcher(o.LA(1),u)};!0===this.tokenMatcher(this.LA(1),u);)this.CONSUME(u),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,u,l,s,a.NextTerminalAfterAtLeastOneSepWalker],l,n.AT_LEAST_ONE_SEP_IDX,e,a.NextTerminalAfterAtLeastOneSepWalker)},e.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(n.MANY_IDX,e);return this.manyInternalLogic(e,t,r)},e.prototype.manyInternalLogic=function(e,t,r){var i,o,s=this,u=this.getLaFuncFromCache(r);if(void 0!==t.DEF){if(i=t.DEF,void 0!==(o=t.GATE)){var l=u;u=function(){return o.call(s)&&l.call(s)}}}else i=t;for(var c=!0;!0===u.call(this)&&!0===c;)c=this.doSingleRepetition(i);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],u,n.MANY_IDX,e,a.NextTerminalAfterManyWalker,c)},e.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(n.MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,r)},e.prototype.manySepFirstInternalLogic=function(e,t,r){var i=this,o=t.DEF,s=t.SEP;if(!0===this.getLaFuncFromCache(r).call(this)){o.call(this);for(var u=function(){return i.tokenMatcher(i.LA(1),s)};!0===this.tokenMatcher(this.LA(1),s);)this.CONSUME(s),o.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,u,o,a.NextTerminalAfterManySepWalker],u,n.MANY_SEP_IDX,e,a.NextTerminalAfterManySepWalker)}},e.prototype.repetitionSepSecondInternal=function(e,t,r,i,a){for(;r();)this.CONSUME(t),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,i,a],r,n.AT_LEAST_ONE_SEP_IDX,e,a)},e.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t},e.prototype.orInternal=function(e,r){var i=this.getKeyForAutomaticLookahead(n.OR_IDX,r),a=t.isArray(e)?e:e.DEF,o=this.getLaFuncFromCache(i).call(this,a);if(void 0!==o)return a[o].ALT.call(this);this.raiseNoAltException(r,e.ERR_MSG)},e.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),0===this.RULE_STACK.length&&!1===this.isAtEndOfInput()){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new r.NotAllInputParsedException(t,e))}},e.prototype.subruleInternal=function(e,t,n){var r;try{var i=void 0!==n?n.ARGS:void 0;return r=e.call(this,t,i),this.cstPostNonTerminal(r,void 0!==n&&void 0!==n.LABEL?n.LABEL:e.ruleName),r}catch(t){this.subruleInternalError(t,n,e.ruleName)}},e.prototype.subruleInternalError=function(e,t,n){throw r.isRecognitionException(e)&&void 0!==e.partialCstResult&&(this.cstPostNonTerminal(e.partialCstResult,void 0!==t&&void 0!==t.LABEL?t.LABEL:n),delete e.partialCstResult),e},e.prototype.consumeInternal=function(e,t,n){var r;try{var i=this.LA(1);!0===this.tokenMatcher(i,e)?(this.consumeToken(),r=i):this.consumeInternalError(e,i,n)}catch(n){r=this.consumeInternalRecovery(e,t,n)}return this.cstPostTerminal(void 0!==n&&void 0!==n.LABEL?n.LABEL:e.name,r),r},e.prototype.consumeInternalError=function(e,t,n){var i,a=this.LA(0);throw i=void 0!==n&&n.ERR_MSG?n.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:a,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new r.MismatchedTokenException(i,t,a))},e.prototype.consumeInternalRecovery=function(e,t,n){if(!this.recoveryEnabled||"MismatchedTokenException"!==n.name||this.isBackTracking())throw n;var r=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,r)}catch(e){throw e.name===u.IN_RULE_RECOVERY_EXCEPTION?n:e}},e.prototype.saveRecogState=function(){var e=this.errors,n=t.cloneArr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}},e.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},e.prototype.ruleInvocationStateUpdate=function(e,t,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},e.prototype.isBackTracking=function(){return 0!==this.isBackTrackingStack.length},e.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]},e.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull[e]},e.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),l.EOF)},e.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},e}();e.RecognizerEngine=d})),G=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ErrorHandler=void 0;var t=A(),n=o(),r=S(),i=H(),a=function(){function e(){}return e.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=n.has(e,"errorMessageProvider")?e.errorMessageProvider:i.DEFAULT_PARSER_CONFIG.errorMessageProvider},e.prototype.SAVE_ERROR=function(e){if(t.isRecognitionException(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:n.cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(e.prototype,"errors",{get:function(){return n.cloneArr(this._errors)},set:function(e){this._errors=e},enumerable:!1,configurable:!0}),e.prototype.raiseEarlyExitException=function(e,n,i){for(var a=this.getCurrRuleFullName(),o=this.getGAstProductions()[a],s=r.getLookaheadPathsForOptionalProd(e,o,n,this.maxLookahead)[0],u=[],l=1;l<=this.maxLookahead;l++)u.push(this.LA(l));var c=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:s,actual:u,previous:this.LA(0),customUserDescription:i,ruleName:a});throw this.SAVE_ERROR(new t.EarlyExitException(c,this.LA(1),this.LA(0)))},e.prototype.raiseNoAltException=function(e,n){for(var i=this.getCurrRuleFullName(),a=this.getGAstProductions()[i],o=r.getLookaheadPathsForOr(e,a,this.maxLookahead),s=[],u=1;u<=this.maxLookahead;u++)s.push(this.LA(u));var l=this.LA(0),c=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:o,actual:s,previous:l,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new t.NoViableAltException(c,this.LA(1),l))},e}();e.ErrorHandler=a})),z=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ContentAssist=void 0;var t=w(),n=o(),r=function(){function e(){}return e.prototype.initContentAssist=function(){},e.prototype.computeContentAssist=function(e,r){var i=this.gastProductionsCache[e];if(n.isUndefined(i))throw Error("Rule ->"+e+"<- does not exist in this grammar.");return t.nextPossibleTokensAfter([i],r,this.tokenMatcher,this.maxLookahead)},e.prototype.getNextPossibleTokenTypes=function(e){var r=n.first(e.ruleStack),i=this.getGAstProductions()[r];return new t.NextAfterTokenWalker(i,e).startWalking()},e}();e.ContentAssist=r})),V=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.GastRecorder=void 0;var t=o(),n=v(),r=d(),i=h(),a=p(),s=H(),u=I(),l={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(l);var c=Math.pow(2,u.BITS_FOR_OCCURRENCE_IDX)-1,f=a.createToken({name:"RECORDING_PHASE_TOKEN",pattern:r.Lexer.NA});i.augmentTokenTypes([f]);var m=a.createTokenInstance(f,"This IToken indicates the Parser is in Recording Phase\n\tSee: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",-1,-1,-1,-1,-1,-1);Object.freeze(m);var g={name:"This CSTNode indicates the Parser is in Recording Phase\n\tSee: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details",children:{}},y=function(){function e(){}return e.prototype.initGastRecorder=function(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1},e.prototype.enableRecording=function(){var e=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",(function(){for(var t=function(t){var n=t>0?t:"";e["CONSUME"+n]=function(e,n){return this.consumeInternalRecord(e,t,n)},e["SUBRULE"+n]=function(e,n){return this.subruleInternalRecord(e,t,n)},e["OPTION"+n]=function(e){return this.optionInternalRecord(e,t)},e["OR"+n]=function(e){return this.orInternalRecord(e,t)},e["MANY"+n]=function(e){this.manyInternalRecord(t,e)},e["MANY_SEP"+n]=function(e){this.manySepFirstInternalRecord(t,e)},e["AT_LEAST_ONE"+n]=function(e){this.atLeastOneInternalRecord(t,e)},e["AT_LEAST_ONE_SEP"+n]=function(e){this.atLeastOneSepFirstInternalRecord(t,e)}},n=0;n<10;n++)t(n);e.consume=function(e,t,n){return this.consumeInternalRecord(t,e,n)},e.subrule=function(e,t,n){return this.subruleInternalRecord(t,e,n)},e.option=function(e,t){return this.optionInternalRecord(t,e)},e.or=function(e,t){return this.orInternalRecord(t,e)},e.many=function(e,t){this.manyInternalRecord(e,t)},e.atLeastOne=function(e,t){this.atLeastOneInternalRecord(e,t)},e.ACTION=e.ACTION_RECORD,e.BACKTRACK=e.BACKTRACK_RECORD,e.LA=e.LA_RECORD}))},e.prototype.disableRecording=function(){var e=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",(function(){for(var t=0;t<10;t++){var n=t>0?t:"";delete e["CONSUME"+n],delete e["SUBRULE"+n],delete e["OPTION"+n],delete e["OR"+n],delete e["MANY"+n],delete e["MANY_SEP"+n],delete e["AT_LEAST_ONE"+n],delete e["AT_LEAST_ONE_SEP"+n]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA}))},e.prototype.ACTION_RECORD=function(e){},e.prototype.BACKTRACK_RECORD=function(e,t){return function(){return!0}},e.prototype.LA_RECORD=function(e){return s.END_OF_FILE},e.prototype.topLevelRuleRecord=function(e,t){try{var r=new n.Rule({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),t.call(this),this.recordingProdStack.pop(),r}catch(e){if(!0!==e.KNOWN_RECORDER_ERROR)try{e.message=e.message+'\n\t This error was thrown during the "grammar recording phase" For more info see:\n\thttps://chevrotain.io/docs/guide/internals.html#grammar-recording'}catch(t){throw e}throw e}},e.prototype.optionInternalRecord=function(e,t){return x.call(this,n.Option,e,t)},e.prototype.atLeastOneInternalRecord=function(e,t){x.call(this,n.RepetitionMandatory,t,e)},e.prototype.atLeastOneSepFirstInternalRecord=function(e,t){x.call(this,n.RepetitionMandatoryWithSeparator,t,e,true)},e.prototype.manyInternalRecord=function(e,t){x.call(this,n.Repetition,t,e)},e.prototype.manySepFirstInternalRecord=function(e,t){x.call(this,n.RepetitionWithSeparator,t,e,true)},e.prototype.orInternalRecord=function(e,t){return _.call(this,e,t)},e.prototype.subruleInternalRecord=function(e,r,i){if(T(r),!e||!1===t.has(e,"ruleName")){var a=new Error("<SUBRULE"+b(r)+"> argument is invalid expecting a Parser method reference but got: <"+JSON.stringify(e)+">\n inside top level rule: <"+this.recordingProdStack[0].name+">");throw a.KNOWN_RECORDER_ERROR=!0,a}var o=t.peek(this.recordingProdStack),s=e.ruleName,u=new n.NonTerminal({idx:r,nonTerminalName:s,referencedRule:void 0});return o.definition.push(u),this.outputCst?g:l},e.prototype.consumeInternalRecord=function(e,r,a){if(T(r),!i.hasShortKeyProperty(e)){var o=new Error("<CONSUME"+b(r)+"> argument is invalid expecting a TokenType reference but got: <"+JSON.stringify(e)+">\n inside top level rule: <"+this.recordingProdStack[0].name+">");throw o.KNOWN_RECORDER_ERROR=!0,o}var s=t.peek(this.recordingProdStack),u=new n.Terminal({idx:r,terminalType:e});return s.definition.push(u),m},e}();function x(e,n,r,i){void 0===i&&(i=!1),T(r);var a=t.peek(this.recordingProdStack),o=t.isFunction(n)?n:n.DEF,s=new e({definition:[],idx:r});return i&&(s.separator=n.SEP),t.has(n,"MAX_LOOKAHEAD")&&(s.maxLookahead=n.MAX_LOOKAHEAD),this.recordingProdStack.push(s),o.call(this),a.definition.push(s),this.recordingProdStack.pop(),l}function _(e,r){var i=this;T(r);var a=t.peek(this.recordingProdStack),o=!1===t.isArray(e),s=!1===o?e:e.DEF,u=new n.Alternation({definition:[],idx:r,ignoreAmbiguities:o&&!0===e.IGNORE_AMBIGUITIES});t.has(e,"MAX_LOOKAHEAD")&&(u.maxLookahead=e.MAX_LOOKAHEAD);var c=t.some(s,(function(e){return t.isFunction(e.GATE)}));return u.hasPredicates=c,a.definition.push(u),t.forEach(s,(function(e){var r=new n.Alternative({definition:[]});u.definition.push(r),t.has(e,"IGNORE_AMBIGUITIES")?r.ignoreAmbiguities=e.IGNORE_AMBIGUITIES:t.has(e,"GATE")&&(r.ignoreAmbiguities=!0),i.recordingProdStack.push(r),e.ALT.call(i),i.recordingProdStack.pop()})),l}function b(e){return 0===e?"":""+e}function T(e){if(e<0||e>c){var t=new Error("Invalid DSL Method idx value: <"+e+">\n\tIdx value must be a none negative value smaller than "+(c+1));throw t.KNOWN_RECORDER_ERROR=!0,t}}e.GastRecorder=y})),B=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.PerformanceTracer=void 0;var t=o(),n=H(),r=function(){function e(){}return e.prototype.initPerformanceTracer=function(e){if(t.has(e,"traceInitPerf")){var r=e.traceInitPerf,i="number"==typeof r;this.traceInitMaxIdent=i?r:1/0,this.traceInitPerf=i?r>0:r}else this.traceInitMaxIdent=0,this.traceInitPerf=n.DEFAULT_PARSER_CONFIG.traceInitPerf;this.traceInitIndent=-1},e.prototype.TRACE_INIT=function(e,n){if(!0===this.traceInitPerf){this.traceInitIndent++;var r=new Array(this.traceInitIndent+1).join("\t");this.traceInitIndent<this.traceInitMaxIdent&&console.log(r+"--\x3e <"+e+">");var i=t.timer(n),a=i.time,o=i.value,s=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&s(r+"<-- <"+e+"> time: "+a+"ms"),this.traceInitIndent--,o}return n()},e}();e.PerformanceTracer=r})),W=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.applyMixins=void 0,e.applyMixins=function(e,t){t.forEach((function(t){var n=t.prototype;Object.getOwnPropertyNames(n).forEach((function(r){if("constructor"!==r){var i=Object.getOwnPropertyDescriptor(n,r);i&&(i.get||i.set)?Object.defineProperty(e.prototype,r,i):e.prototype[r]=t.prototype[r]}}))}))}})),H=i((function(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.EmbeddedActionsParser=e.CstParser=e.Parser=e.EMPTY_ALT=e.ParserDefinitionErrorType=e.DEFAULT_RULE_CONFIG=e.DEFAULT_PARSER_CONFIG=e.END_OF_FILE=void 0;var r,i=o(),a=b(),s=p(),u=T(),l=k(),c=C(),h=R(),f=O(),d=D(),v=F(),m=U(),g=G(),y=z(),x=V(),_=B(),M=W();e.END_OF_FILE=s.createTokenInstance(s.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(e.END_OF_FILE),e.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:u.defaultParserErrorProvider,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),e.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),(r=e.ParserDefinitionErrorType||(e.ParserDefinitionErrorType={}))[r.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",r[r.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",r[r.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",r[r.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",r[r.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",r[r.LEFT_RECURSION=5]="LEFT_RECURSION",r[r.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",r[r.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",r[r.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",r[r.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",r[r.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",r[r.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",r[r.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e.EMPTY_ALT=function(e){return void 0===e&&(e=void 0),function(){return e}};var w=function(){function t(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;var r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),i.has(n,"ignoredIssues"))throw new Error("The <ignoredIssues> IParserConfig property has been deprecated.\n\tPlease use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.\n\tSee: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES\n\tFor further details.");this.skipValidations=i.has(n,"skipValidations")?n.skipValidations:e.DEFAULT_PARSER_CONFIG.skipValidations}return t.performSelfAnalysis=function(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.\t\nUse the **instance** method with the same name instead.")},t.prototype.performSelfAnalysis=function(){var e=this;this.TRACE_INIT("performSelfAnalysis",(function(){var n;e.selfAnalysisDone=!0;var r=e.className;e.TRACE_INIT("toFastProps",(function(){i.toFastProperties(e)})),e.TRACE_INIT("Grammar Recording",(function(){try{e.enableRecording(),i.forEach(e.definedRulesNames,(function(t){var n=e[t].originalGrammarAction,r=void 0;e.TRACE_INIT(t+" Rule",(function(){r=e.topLevelRuleRecord(t,n)})),e.gastProductionsCache[t]=r}))}finally{e.disableRecording()}}));var o=[];if(e.TRACE_INIT("Grammar Resolving",(function(){o=l.resolveGrammar({rules:i.values(e.gastProductionsCache)}),e.definitionErrors=e.definitionErrors.concat(o)})),e.TRACE_INIT("Grammar Validations",(function(){if(i.isEmpty(o)&&!1===e.skipValidations){var t=l.validateGrammar({rules:i.values(e.gastProductionsCache),maxLookahead:e.maxLookahead,tokenTypes:i.values(e.tokensMap),errMsgProvider:u.defaultGrammarValidatorErrorProvider,grammarName:r});e.definitionErrors=e.definitionErrors.concat(t)}})),i.isEmpty(e.definitionErrors)&&(e.recoveryEnabled&&e.TRACE_INIT("computeAllProdsFollows",(function(){var t=a.computeAllProdsFollows(i.values(e.gastProductionsCache));e.resyncFollows=t})),e.TRACE_INIT("ComputeLookaheadFunctions",(function(){e.preComputeLookaheadFunctions(i.values(e.gastProductionsCache))}))),!t.DEFER_DEFINITION_ERRORS_HANDLING&&!i.isEmpty(e.definitionErrors))throw n=i.map(e.definitionErrors,(function(e){return e.message})),new Error("Parser Definition Errors detected:\n "+n.join("\n-------------------------------\n"))}))},t.DEFER_DEFINITION_ERRORS_HANDLING=!1,t}();e.Parser=w,M.applyMixins(w,[c.Recoverable,h.LooksAhead,f.TreeBuilder,d.LexerAdapter,m.RecognizerEngine,v.RecognizerApi,g.ErrorHandler,y.ContentAssist,x.GastRecorder,_.PerformanceTracer]);var S=function(t){function r(n,r){void 0===r&&(r=e.DEFAULT_PARSER_CONFIG);var a=i.cloneObj(r);return a.outputCst=!0,t.call(this,n,a)||this}return n(r,t),r}(w);e.CstParser=S;var E=function(t){function r(n,r){void 0===r&&(r=e.DEFAULT_PARSER_CONFIG);var a=i.cloneObj(r);return a.outputCst=!1,t.call(this,n,a)||this}return n(r,t),r}(w);e.EmbeddedActionsParser=E})),j=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createSyntaxDiagramsCode=void 0;var t=a();e.createSyntaxDiagramsCode=function(e,n){var r=void 0===n?{}:n,i=r.resourceBase,a=void 0===i?"https://unpkg.com/chevrotain@"+t.VERSION+"/diagrams/":i,o=r.css;return'\n\x3c!-- This is a generated file --\x3e\n<!DOCTYPE html>\n<meta charset="utf-8">\n<style>\n  body {\n    background-color: hsl(30, 20%, 95%)\n  }\n</style>\n\n'+("\n<link rel='stylesheet' href='"+(void 0===o?"https://unpkg.com/chevrotain@"+t.VERSION+"/diagrams/diagrams.css":o)+"'>\n")+("\n<script src='"+a+"vendor/railroad-diagrams.js'><\/script>\n<script src='"+a+"src/diagrams_builder.js'><\/script>\n<script src='"+a+"src/diagrams_behavior.js'><\/script>\n<script src='"+a+"src/main.js'><\/script>\n")+'\n<div id="diagrams" align="center"></div>\n'+("\n<script>\n    window.serializedGrammar = "+JSON.stringify(e,null,"  ")+";\n<\/script>\n")+'\n<script>\n    var diagramsDiv = document.getElementById("diagrams");\n    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);\n<\/script>\n'}})),q=i((function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Parser=e.createSyntaxDiagramsCode=e.clearCache=e.GAstVisitor=e.serializeProduction=e.serializeGrammar=e.Terminal=e.Rule=e.RepetitionWithSeparator=e.RepetitionMandatoryWithSeparator=e.RepetitionMandatory=e.Repetition=e.Option=e.NonTerminal=e.Alternative=e.Alternation=e.defaultLexerErrorProvider=e.NoViableAltException=e.NotAllInputParsedException=e.MismatchedTokenException=e.isRecognitionException=e.EarlyExitException=e.defaultParserErrorProvider=e.tokenName=e.tokenMatcher=e.tokenLabel=e.EOF=e.createTokenInstance=e.createToken=e.LexerDefinitionErrorType=e.Lexer=e.EMPTY_ALT=e.ParserDefinitionErrorType=e.EmbeddedActionsParser=e.CstParser=e.VERSION=void 0;var t=a();Object.defineProperty(e,"VERSION",{enumerable:!0,get:function(){return t.VERSION}});var n=H();Object.defineProperty(e,"CstParser",{enumerable:!0,get:function(){return n.CstParser}}),Object.defineProperty(e,"EmbeddedActionsParser",{enumerable:!0,get:function(){return n.EmbeddedActionsParser}}),Object.defineProperty(e,"ParserDefinitionErrorType",{enumerable:!0,get:function(){return n.ParserDefinitionErrorType}}),Object.defineProperty(e,"EMPTY_ALT",{enumerable:!0,get:function(){return n.EMPTY_ALT}});var r=d();Object.defineProperty(e,"Lexer",{enumerable:!0,get:function(){return r.Lexer}}),Object.defineProperty(e,"LexerDefinitionErrorType",{enumerable:!0,get:function(){return r.LexerDefinitionErrorType}});var i=p();Object.defineProperty(e,"createToken",{enumerable:!0,get:function(){return i.createToken}}),Object.defineProperty(e,"createTokenInstance",{enumerable:!0,get:function(){return i.createTokenInstance}}),Object.defineProperty(e,"EOF",{enumerable:!0,get:function(){return i.EOF}}),Object.defineProperty(e,"tokenLabel",{enumerable:!0,get:function(){return i.tokenLabel}}),Object.defineProperty(e,"tokenMatcher",{enumerable:!0,get:function(){return i.tokenMatcher}}),Object.defineProperty(e,"tokenName",{enumerable:!0,get:function(){return i.tokenName}});var o=T();Object.defineProperty(e,"defaultParserErrorProvider",{enumerable:!0,get:function(){return o.defaultParserErrorProvider}});var s=A();Object.defineProperty(e,"EarlyExitException",{enumerable:!0,get:function(){return s.EarlyExitException}}),Object.defineProperty(e,"isRecognitionException",{enumerable:!0,get:function(){return s.isRecognitionException}}),Object.defineProperty(e,"MismatchedTokenException",{enumerable:!0,get:function(){return s.MismatchedTokenException}}),Object.defineProperty(e,"NotAllInputParsedException",{enumerable:!0,get:function(){return s.NotAllInputParsedException}}),Object.defineProperty(e,"NoViableAltException",{enumerable:!0,get:function(){return s.NoViableAltException}});var u=f();Object.defineProperty(e,"defaultLexerErrorProvider",{enumerable:!0,get:function(){return u.defaultLexerErrorProvider}});var l=v();Object.defineProperty(e,"Alternation",{enumerable:!0,get:function(){return l.Alternation}}),Object.defineProperty(e,"Alternative",{enumerable:!0,get:function(){return l.Alternative}}),Object.defineProperty(e,"NonTerminal",{enumerable:!0,get:function(){return l.NonTerminal}}),Object.defineProperty(e,"Option",{enumerable:!0,get:function(){return l.Option}}),Object.defineProperty(e,"Repetition",{enumerable:!0,get:function(){return l.Repetition}}),Object.defineProperty(e,"RepetitionMandatory",{enumerable:!0,get:function(){return l.RepetitionMandatory}}),Object.defineProperty(e,"RepetitionMandatoryWithSeparator",{enumerable:!0,get:function(){return l.RepetitionMandatoryWithSeparator}}),Object.defineProperty(e,"RepetitionWithSeparator",{enumerable:!0,get:function(){return l.RepetitionWithSeparator}}),Object.defineProperty(e,"Rule",{enumerable:!0,get:function(){return l.Rule}}),Object.defineProperty(e,"Terminal",{enumerable:!0,get:function(){return l.Terminal}});var c=v();Object.defineProperty(e,"serializeGrammar",{enumerable:!0,get:function(){return c.serializeGrammar}}),Object.defineProperty(e,"serializeProduction",{enumerable:!0,get:function(){return c.serializeProduction}});var h=g();Object.defineProperty(e,"GAstVisitor",{enumerable:!0,get:function(){return h.GAstVisitor}}),e.clearCache=function(){console.warn("The clearCache function was 'soft' removed from the Chevrotain API.\n\t It performs no action other than printing this message.\n\t Please avoid using it as it will be completely removed in the future")};var m=j();Object.defineProperty(e,"createSyntaxDiagramsCode",{enumerable:!0,get:function(){return m.createSyntaxDiagramsCode}});var y=function(){throw new Error("The Parser class has been deprecated, use CstParser or EmbeddedActionsParser instead.\nSee: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_7-0-0")};e.Parser=y}));t.Z=q()}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return function(){"use strict";n.r(r),n.d(r,{AddCoord2D:function(){return Ie},AddCoord3D:function(){return se},AddDiv:function(){return sh},AddDomElement:function(){return oh},ArrayBufferToAsciiString:function(){return F},ArrayBufferToUtf8String:function(){return D},ArrayToCoord3D:function(){return pe},ArrayToQuaternion:function(){return Xh},ArrayToRGBColor:function(){return Ee},AsciiStringToArrayBuffer:function(){return U},Base64DataURIToArrayBuffer:function(){return z},BezierTweenFunction:function(){return _h},BigEps:function(){return q},BinaryReader:function(){return C},BinaryWriter:function(){return I},BoundingBoxCalculator3D:function(){return uf},Box3D:function(){return sf},CalculateSurfaceArea:function(){return Qy},CalculateTriangleNormal:function(){return rf},CalculateVolume:function(){return Jy},Camera:function(){return Qc},CameraIsEqual3D:function(){return $c},CameraMode:function(){return Lh},CameraValidator:function(){return Dh},CheckModel:function(){return Nf},ClearDomElement:function(){return uh},ClickDetector:function(){return Eh},ColorComponentFromFloat:function(){return ge},ColorComponentToFloat:function(){return ye},ColorToMaterialConverter:function(){return Bf},ConvertColorToThreeColor:function(){return Zc},ConvertMeshToMeshBuffer:function(){return tx},ConvertModelToThreeObject:function(){return Hy},ConvertThreeColorToColor:function(){return Kc},ConvertThreeGeometryToMesh:function(){return Jc},Coord2D:function(){return Ae},Coord3D:function(){return ae},Coord4D:function(){return Zh},CoordDistance2D:function(){return Le},CoordDistance3D:function(){return le},CoordIsEqual2D:function(){return Ce},CoordIsEqual3D:function(){return oe},CopyObjectAttributes:function(){return g},CreateDiv:function(){return xh},CreateDomElement:function(){return ah},CreateModelUrlParameters:function(){return Gy},CreateObjectUrl:function(){return B},CreateObjectUrlWithMimeType:function(){return W},CreateUrlBuilder:function(){return Fy},CreateUrlParser:function(){return Uy},CrossVector3D:function(){return fe},DegRad:function(){return Y},Direction:function(){return ie},DotVector3D:function(){return ce},EmbeddedViewer:function(){return qy},Eps:function(){return j},EscapeHtmlChars:function(){return x},EventNotifier:function(){return p},ExportedFile:function(){return nx},Exporter:function(){return dx},Exporter3dm:function(){return ax},ExporterBase:function(){return rx},ExporterBim:function(){return ix},ExporterGltf:function(){return ox},ExporterModel:function(){return ux},ExporterObj:function(){return lx},ExporterOff:function(){return cx},ExporterPly:function(){return hx},ExporterSettings:function(){return sx},ExporterStl:function(){return fx},FaceMaterial:function(){return je},FileFormat:function(){return b},FileSource:function(){return _},FinalizeModel:function(){return Pf},FlipMeshTrianglesOrientation:function(){return of},GenerateCone:function(){return up},GenerateCuboid:function(){return sp},GenerateCylinder:function(){return lp},GeneratePlatonicSolid:function(){return hp},GenerateSphere:function(){return cp},Generator:function(){return ip},GeneratorHelper:function(){return ap},GeneratorParams:function(){return rp},GetBoundingBox:function(){return Mf},GetDefaultCamera:function(){return Ph},GetDomElementClientCoordinates:function(){return ih},GetDomElementExternalHeight:function(){return nh},GetDomElementExternalWidth:function(){return th},GetDomElementInnerDimensions:function(){return rh},GetDomElementOuterHeight:function(){return mh},GetDomElementOuterWidth:function(){return vh},GetExternalLibPath:function(){return N},GetFileExtension:function(){return M},GetFileExtensionFromMimeType:function(){return V},GetFileName:function(){return T},GetIntegerFromStyle:function(){return eh},GetMeshType:function(){return nf},GetShadingType:function(){return Yc},GetShadingTypeOfObject:function(){return Oh},GetTetrahedronSignedVolume:function(){return Zy},GetTopology:function(){return wf},GetTriangleArea:function(){return Ky},HasDefaultMaterial:function(){return Ef},HasHighpDriverIssue:function(){return qc},HexStringToRGBColor:function(){return Se},ImportError:function(){return Iy},ImportErrorCode:function(){return Cy},ImportResult:function(){return Ry},ImportSettings:function(){return Ay},Importer:function(){return Py},Importer3dm:function(){return Wf},Importer3ds:function(){return Ld},ImporterBase:function(){return Of},ImporterBim:function(){return Ep},ImporterFcstd:function(){return ky},ImporterFile:function(){return Wh},ImporterFileAccessor:function(){return Ly},ImporterFileList:function(){return Hh},ImporterGltf:function(){return tp},ImporterIfc:function(){return np},ImporterO3dv:function(){return fp},ImporterObj:function(){return vp},ImporterOcct:function(){return wp},ImporterOff:function(){return mp},ImporterPly:function(){return Mp},ImporterStl:function(){return Sp},ImporterThree3mf:function(){return Dg},ImporterThreeBase:function(){return Lg},ImporterThreeDae:function(){return Ng},ImporterThreeFbx:function(){return Pg},ImporterThreeSvg:function(){return vx},ImporterThreeWrl:function(){return Og},Init3DViewerElement:function(){return Xy},Init3DViewerElements:function(){return Yy},InputFile:function(){return zh},InputFilesFromFileObjects:function(){return Bh},InputFilesFromUrls:function(){return Vh},InsertDomElementAfter:function(){return ch},InsertDomElementBefore:function(){return lh},IntegerToHexString:function(){return Te},IsDefined:function(){return v},IsDomElementVisible:function(){return fh},IsEqual:function(){return ee},IsEqualEps:function(){return te},IsGreater:function(){return J},IsGreaterOrEqual:function(){return $},IsLower:function(){return Z},IsLowerOrEqual:function(){return Q},IsModelEmpty:function(){return Tf},IsNegative:function(){return re},IsObjectEmpty:function(){return y},IsPositive:function(){return ne},IsPowerOfTwo:function(){return Gf},IsTwoManifold:function(){return Sf},IsUrl:function(){return k},IsZero:function(){return K},LinearToSRGB:function(){return be},LinearTweenFunction:function(){return bh},LoadExternalLibrary:function(){return O},MaterialBase:function(){return He},MaterialType:function(){return We},Matrix:function(){return Jh},MatrixIsEqual:function(){return Qh},Mesh:function(){return Qe},MeshBuffer:function(){return ex},MeshInstance:function(){return ff},MeshInstanceId:function(){return hf},MeshPrimitiveBuffer:function(){return $y},MeshType:function(){return tf},Model:function(){return mf},ModelObject3D:function(){return Je},ModelToThreeConversionOutput:function(){return Vy},ModelToThreeConversionParams:function(){return zy},MouseInteraction:function(){return wh},NameFromLine:function(){return Df},Navigation:function(){return Ah},NavigationType:function(){return kh},NextPowerOfTwo:function(){return zf},Node:function(){return vf},NodeType:function(){return pf},Object3D:function(){return Ze},Octree:function(){return cf},OctreeNode:function(){return lf},ParabolicTweenFunction:function(){return Th},ParameterConverter:function(){return Ny},ParameterListBuilder:function(){return Oy},ParameterListParser:function(){return Dy},ParametersFromLine:function(){return Ff},PhongMaterial:function(){return qe},PhysicalMaterial:function(){return Xe},Property:function(){return Cf},PropertyGroup:function(){return If},PropertyToString:function(){return Rf},PropertyType:function(){return Af},Quaternion:function(){return jh},QuaternionFromAxisAngle:function(){return Yh},QuaternionFromXYZ:function(){return Kh},QuaternionIsEqual:function(){return qh},RGBAColor:function(){return me},RGBAColorToHexString:function(){return we},RGBColor:function(){return ve},RGBColorFromFloatComponents:function(){return xe},RGBColorIsEqual:function(){return ke},RGBColorToHexString:function(){return Me},RadDeg:function(){return X},ReadFile:function(){return S},ReadLines:function(){return Uf},ReplaceDefaultMaterialColor:function(){return kf},RequestUrl:function(){return w},RevokeObjectUrl:function(){return H},RunTaskAsync:function(){return u},RunTasks:function(){return l},RunTasksBatch:function(){return c},SRGBToLinear:function(){return _e},SetDomElementHeight:function(){return ph},SetDomElementOuterHeight:function(){return yh},SetDomElementOuterWidth:function(){return gh},SetDomElementWidth:function(){return dh},SetExternalLibLocation:function(){return P},SetThreeMeshPolygonOffset:function(){return Ch},ShadingModel:function(){return Uh},ShadingType:function(){return Xc},ShowDomElement:function(){return hh},SubCoord2D:function(){return Re},SubCoord3D:function(){return ue},TaskRunner:function(){return s},TextWriter:function(){return A},TextureIsEqual:function(){return Ye},TextureMap:function(){return Ve},TextureMapIsEqual:function(){return Be},ThreeConversionStateHandler:function(){return By},ThreeModelLoader:function(){return jy},ThreeNodeTree:function(){return Wy},Topology:function(){return bf},TopologyEdge:function(){return yf},TopologyTriangle:function(){return _f},TopologyTriangleEdge:function(){return xf},TopologyVertex:function(){return gf},TouchInteraction:function(){return Sh},TransformFileHostUrls:function(){return E},TransformMesh:function(){return af},Transformation:function(){return $h},TransformationIsEqual:function(){return ef},TraverseThreeObject:function(){return Nh},Triangle:function(){return $e},TweenCoord3D:function(){return Mh},UpVector:function(){return Fh},UpdateMaterialTransparency:function(){return Vf},Utf8StringToArrayBuffer:function(){return G},ValueOrDefault:function(){return m},VectorAngle3D:function(){return he},VectorLength3D:function(){return de},Viewer:function(){return Gh},ViewerExtraGeometry:function(){return Rh},ViewerGeometry:function(){return Ih},WaitWhile:function(){return h}});var e={};n.r(e),n.d(e,{AsyncCompress:function(){return rm},AsyncDecompress:function(){return xm},AsyncDeflate:function(){return Kv},AsyncGunzip:function(){return sm},AsyncGzip:function(){return rm},AsyncInflate:function(){return $v},AsyncUnzipInflate:function(){return qm},AsyncUnzlib:function(){return vm},AsyncZipDeflate:function(){return zm},AsyncZlib:function(){return hm},Compress:function(){return nm},DecodeUTF8:function(){return km},Decompress:function(){return ym},Deflate:function(){return Yv},EncodeUTF8:function(){return Am},Gunzip:function(){return om},Gzip:function(){return nm},Inflate:function(){return Qv},Unzip:function(){return Xm},UnzipInflate:function(){return jm},UnzipPassThrough:function(){return Hm},Unzlib:function(){return pm},Zip:function(){return Vm},ZipDeflate:function(){return Gm},ZipPassThrough:function(){return Um},Zlib:function(){return cm},compress:function(){return im},compressSync:function(){return am},decompress:function(){return _m},decompressSync:function(){return bm},deflate:function(){return Zv},deflateSync:function(){return Jv},gunzip:function(){return um},gunzipSync:function(){return lm},gzip:function(){return im},gzipSync:function(){return am},inflate:function(){return em},inflateSync:function(){return tm},strFromU8:function(){return Im},strToU8:function(){return Cm},unzip:function(){return Ym},unzipSync:function(){return Km},unzlib:function(){return mm},unzlibSync:function(){return gm},zip:function(){return Bm},zipSync:function(){return Wm},zlib:function(){return fm},zlibSync:function(){return dm}});var t=n(510),i=n.n(t),a=n(834),o=n.n(a),s=function(){function e(){i()(this,e),this.count=null,this.current=null,this.callbacks=null}return o()(e,[{key:"Run",value:function(e,t){this.count=e,this.current=0,this.callbacks=t,0===e?this.TaskReady():this.RunOnce()}},{key:"RunBatch",value:function(e,t,n){var r=0;e>0&&(r=parseInt((e-1)/t,10)+1),this.Run(r,{runTask:function(r,i){var a=r*t,o=Math.min((r+1)*t,e)-1;n.runTask(a,o,i)},onReady:n.onReady})}},{key:"RunOnce",value:function(){var e=this;setTimeout((function(){e.callbacks.runTask(e.current,e.TaskReady.bind(e))}),0)}},{key:"TaskReady",value:function(){this.current+=1,this.current<this.count?this.RunOnce():this.callbacks.onReady&&this.callbacks.onReady()}}]),e}();function u(e){setTimeout((function(){e()}),10)}function l(e,t){(new s).Run(e,t)}function c(e,t,n){(new s).RunBatch(e,t,n)}function h(e){!function e(t){t()&&setTimeout((function(){e(t)}),10)}(e)}var f=n(554),d=n.n(f),p=function(){function e(){i()(this,e),this.eventListeners=new Map}return o()(e,[{key:"AddEventListener",value:function(e,t){this.eventListeners.has(e)||this.eventListeners.set(e,[]),this.eventListeners.get(e).push(t)}},{key:"HasEventListener",value:function(e){return this.eventListeners.has(e)}},{key:"GetEventNotifier",value:function(e){var t=this;return function(){t.NotifyEventListeners(e)}}},{key:"NotifyEventListeners",value:function(e){if(this.eventListeners.has(e)){for(var t=this.eventListeners.get(e),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a,o=d()(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.apply(void 0,r)}}catch(e){o.e(e)}finally{o.f()}}}}]),e}();function v(e){return null!=e}function m(e,t){return null==e?t:e}function g(e,t){if(v(e))for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];v(e[i])&&(t[i]=e[i])}}function y(e){return 0===Object.keys(e).length}function x(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}var _={Url:1,File:2,Decompressed:3},b={Text:1,Binary:2};function T(e){var t=e.lastIndexOf("/");-1===t&&(t=e.lastIndexOf("\\"));var n=e;-1!==t&&(n=e.substring(t+1));var r=n.indexOf("?");return-1!==r&&(n=n.substring(0,r)),decodeURI(n)}function M(e){var t=T(e),n=t.lastIndexOf(".");return-1===n?"":t.substring(n+1).toLowerCase()}function w(e,t){return new Promise((function(n,r){var i=new XMLHttpRequest;i.open("GET",e,!0),i.onprogress=function(e){t(e.loaded,e.total)},i.onload=function(){200===i.status?n(i.response):r()},i.onerror=function(){r()},i.responseType="arraybuffer",i.send(null)}))}function S(e,t){return new Promise((function(n,r){var i=new FileReader;i.onprogress=function(e){t(e.loaded,e.total)},i.onloadend=function(e){e.target.readyState===FileReader.DONE&&n(e.target.result)},i.onerror=function(){r()},i.readAsArrayBuffer(e)}))}function E(e){for(var t=0;t<e.length;t++){var n=e[t];if(-1!==n.search(/www\.dropbox\.com/)){var r=(n=n.replace("www.dropbox.com","dl.dropbox.com")).indexOf("?");-1!==r&&(n=n.substring(0,r)),e[t]=n}else if(-1!==n.search(/github\.com/)){var i=(n=(n=n.replace("github.com","raw.githubusercontent.com")).replace("/blob","")).indexOf("?");-1!==i&&(n=n.substring(0,i)),e[t]=n}}}function k(e){return null!==e.match(/^https?:\/\/\S+$/g)}var A=function(){function e(){i()(this,e),this.text="",this.indentation=0}return o()(e,[{key:"GetText",value:function(){return this.text}},{key:"Indent",value:function(e){this.indentation+=e}},{key:"WriteArrayLine",value:function(e){this.WriteLine(e.join(" "))}},{key:"WriteLine",value:function(e){this.WriteIndentation(),this.Write(e+"\n")}},{key:"WriteIndentation",value:function(){for(var e=0;e<this.indentation;e++)this.Write("  ")}},{key:"Write",value:function(e){this.text+=e}}]),e}(),C=function(){function e(t,n){i()(this,e),this.arrayBuffer=t,this.dataView=new DataView(t),this.isLittleEndian=n,this.position=0}return o()(e,[{key:"GetPosition",value:function(){return this.position}},{key:"SetPosition",value:function(e){this.position=e}},{key:"GetByteLength",value:function(){return this.arrayBuffer.byteLength}},{key:"Skip",value:function(e){this.position=this.position+e}},{key:"End",value:function(){return this.position>=this.arrayBuffer.byteLength}},{key:"ReadArrayBuffer",value:function(e){var t=new Uint8Array(this.arrayBuffer),n=new ArrayBuffer(e),r=new Uint8Array(n),i=t.subarray(this.position,this.position+e);return r.set(i,0),this.position+=e,n}},{key:"ReadBoolean8",value:function(){var e=this.dataView.getInt8(this.position);return this.position=this.position+1,!!e}},{key:"ReadCharacter8",value:function(){var e=this.dataView.getInt8(this.position);return this.position=this.position+1,e}},{key:"ReadUnsignedCharacter8",value:function(){var e=this.dataView.getUint8(this.position);return this.position=this.position+1,e}},{key:"ReadInteger16",value:function(){var e=this.dataView.getInt16(this.position,this.isLittleEndian);return this.position=this.position+2,e}},{key:"ReadUnsignedInteger16",value:function(){var e=this.dataView.getUint16(this.position,this.isLittleEndian);return this.position=this.position+2,e}},{key:"ReadInteger32",value:function(){var e=this.dataView.getInt32(this.position,this.isLittleEndian);return this.position=this.position+4,e}},{key:"ReadUnsignedInteger32",value:function(){var e=this.dataView.getUint32(this.position,this.isLittleEndian);return this.position=this.position+4,e}},{key:"ReadFloat32",value:function(){var e=this.dataView.getFloat32(this.position,this.isLittleEndian);return this.position=this.position+4,e}},{key:"ReadDouble64",value:function(){var e=this.dataView.getFloat64(this.position,this.isLittleEndian);return this.position=this.position+8,e}}]),e}(),I=function(){function e(t,n){i()(this,e),this.arrayBuffer=new ArrayBuffer(t),this.dataView=new DataView(this.arrayBuffer),this.isLittleEndian=n,this.position=0}return o()(e,[{key:"GetPosition",value:function(){return this.position}},{key:"SetPosition",value:function(e){this.position=e}},{key:"End",value:function(){return this.position>=this.arrayBuffer.byteLength}},{key:"GetBuffer",value:function(){return this.arrayBuffer}},{key:"WriteArrayBuffer",value:function(e){var t=new Uint8Array(e);new Uint8Array(this.arrayBuffer).set(t,this.position),this.position+=e.byteLength}},{key:"WriteBoolean8",value:function(e){this.dataView.setInt8(this.position,e?1:0),this.position=this.position+1}},{key:"WriteCharacter8",value:function(e){this.dataView.setInt8(this.position,e),this.position=this.position+1}},{key:"WriteUnsignedCharacter8",value:function(e){this.dataView.setUint8(this.position,e),this.position=this.position+1}},{key:"WriteInteger16",value:function(e){this.dataView.setInt16(this.position,e,this.isLittleEndian),this.position=this.position+2}},{key:"WriteUnsignedInteger16",value:function(e){this.dataView.setUint16(this.position,e,this.isLittleEndian),this.position=this.position+2}},{key:"WriteInteger32",value:function(e){this.dataView.setInt32(this.position,e,this.isLittleEndian),this.position=this.position+4}},{key:"WriteUnsignedInteger32",value:function(e){this.dataView.setUint32(this.position,e,this.isLittleEndian),this.position=this.position+4}},{key:"WriteFloat32",value:function(e){this.dataView.setFloat32(this.position,e,this.isLittleEndian),this.position=this.position+4}},{key:"WriteDouble64",value:function(e){this.dataView.setFloat64(this.position,e,this.isLittleEndian),this.position=this.position+8}}]),e}(),R=null,L=new Set;function P(e){R=e}function N(e){return null===R?null:R+"/"+e}function O(e){return new Promise((function(t,n){if(null!==R)if(L.has(e))t();else{var r=document.createElement("script");r.type="text/javascript",r.src=N(e),r.onload=function(){L.add(e),t()},r.onerror=function(){n()},document.head.appendChild(r)}else n()}))}function D(e){return new TextDecoder("utf-8").decode(e)}function F(e){for(var t="",n=new Uint8Array(e),r=0;r<n.byteLength;r++)t+=String.fromCharCode(n[r]);return t}function U(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return t}function G(e){return(new TextEncoder).encode(e).buffer}function z(e){var t="data:";if(!e.startsWith(t))return null;var n=e.indexOf(";");if(-1===n)return null;var r=e.indexOf(",");if(-1===r)return null;for(var i=e.substring(t.length,t.length+n-5),a=atob(e.substring(r+1)),o=new ArrayBuffer(a.length),s=new Uint8Array(o),u=0;u<a.length;u++)s[u]=a.charCodeAt(u);return{mimeType:i,buffer:o}}function V(e){if(null==e)return"";var t=e.split("/");return 0===t.length?"":t[t.length-1]}function B(e){var t=new Blob([e]);return URL.createObjectURL(t)}function W(e,t){var n=new Blob([e],{type:t});return URL.createObjectURL(n)}function H(e){URL.revokeObjectURL(e)}var j=1e-8,q=1e-4,X=57.29577951308232,Y=.017453292519943;function K(e){return Math.abs(e)<j}function Z(e,t){return t-e>j}function J(e,t){return e-t>j}function Q(e,t){return t-e>-j}function $(e,t){return e-t>-j}function ee(e,t){return Math.abs(t-e)<j}function te(e,t,n){return Math.abs(t-e)<n}function ne(e){return e>j}function re(e){return e<-j}var ie={X:1,Y:2,Z:3},ae=function(){function e(t,n,r){i()(this,e),this.x=t,this.y=n,this.z=r}return o()(e,[{key:"Length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"MultiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"Normalize",value:function(){var e=this.Length();return e>0&&this.MultiplyScalar(1/e),this}},{key:"Offset",value:function(e,t){var n=e.Clone().Normalize();return this.x+=n.x*t,this.y+=n.y*t,this.z+=n.z*t,this}},{key:"Rotate",value:function(e,t,n){var r=e.Clone().Normalize(),i=r.x,a=r.y,o=r.z,s=this.x-n.x,u=this.y-n.y,l=this.z-n.z,c=Math.sin(t),h=Math.cos(t);return this.x=-i*(-i*s-a*u-o*l)*(1-h)+s*h+(-o*u+a*l)*c,this.y=-a*(-i*s-a*u-o*l)*(1-h)+u*h+(o*s-i*l)*c,this.z=-o*(-i*s-a*u-o*l)*(1-h)+l*h+(-a*s+i*u)*c,this.x+=n.x,this.y+=n.y,this.z+=n.z,this}},{key:"Clone",value:function(){return new e(this.x,this.y,this.z)}}]),e}();function oe(e,t){return ee(e.x,t.x)&&ee(e.y,t.y)&&ee(e.z,t.z)}function se(e,t){return new ae(e.x+t.x,e.y+t.y,e.z+t.z)}function ue(e,t){return new ae(e.x-t.x,e.y-t.y,e.z-t.z)}function le(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+(e.z-t.z)*(e.z-t.z))}function ce(e,t){return e.x*t.x+e.y*t.y+e.z*t.z}function he(e,t){var n=e.Clone().Normalize(),r=t.Clone().Normalize();if(oe(n,r))return 0;var i=ce(n,r);return Math.acos(i)}function fe(e,t){var n=new ae(0,0,0);return n.x=e.y*t.z-e.z*t.y,n.y=e.z*t.x-e.x*t.z,n.z=e.x*t.y-e.y*t.x,n}function de(e,t,n){return Math.sqrt(e*e+t*t+n*n)}function pe(e){return new ae(e[0],e[1],e[2])}var ve=function(){function e(t,n,r){i()(this,e),this.r=t,this.g=n,this.b=r}return o()(e,[{key:"Set",value:function(e,t,n){this.r=e,this.g=t,this.b=n}},{key:"Clone",value:function(){return new e(this.r,this.g,this.b)}}]),e}(),me=function(){function e(t,n,r,a){i()(this,e),this.r=t,this.g=n,this.b=r,this.a=a}return o()(e,[{key:"Set",value:function(e,t,n,r){this.r=e,this.g=t,this.b=n,this.a=r}},{key:"Clone",value:function(){return new e(this.r,this.g,this.b,this.a)}}]),e}();function ge(e){return parseInt(Math.round(255*e),10)}function ye(e){return e/255}function xe(e,t,n){return new ve(ge(e),ge(t),ge(n))}function _e(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function be(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function Te(e){for(var t=parseInt(e,10).toString(16);t.length<2;)t="0"+t;return t}function Me(e){return Te(e.r)+Te(e.g)+Te(e.b)}function we(e){return Te(e.r)+Te(e.g)+Te(e.b)+Te(e.a)}function Se(e){if(6!==e.length)return null;var t=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);return new ve(t,n,r)}function Ee(e){return new ve(e[0],e[1],e[2])}function ke(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b}var Ae=function(){function e(t,n){i()(this,e),this.x=t,this.y=n}return o()(e,[{key:"Clone",value:function(){return new e(this.x,this.y)}}]),e}();function Ce(e,t){return ee(e.x,t.x)&&ee(e.y,t.y)}function Ie(e,t){return new Ae(e.x+t.x,e.y+t.y)}function Re(e,t){return new Ae(e.x-t.x,e.y-t.y)}function Le(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}var Pe=n(621),Ne=n.n(Pe),Oe=n(884),De=n.n(Oe),Fe=n(564),Ue=n.n(Fe),Ge=n(865),ze=n.n(Ge),Ve=function(){function e(){i()(this,e),this.name=null,this.mimeType=null,this.buffer=null,this.offset=new Ae(0,0),this.scale=new Ae(1,1),this.rotation=0}return o()(e,[{key:"IsValid",value:function(){return null!==this.name&&null!==this.buffer}},{key:"HasTransformation",value:function(){return!Ce(this.offset,new Ae(0,0))||(!Ce(this.scale,new Ae(1,1))||!ee(this.rotation,0))}},{key:"IsEqual",value:function(e){return this.name===e.name&&(this.mimeType===e.mimeType&&(!!Ce(this.offset,e.offset)&&(!!Ce(this.scale,e.scale)&&!!ee(this.rotation,e.rotation))))}}]),e}();function Be(e,t){return null===e&&null===t||null!==e&&null!==t&&e.IsEqual(t)}var We={Phong:1,Physical:2},He=function(){function e(t){i()(this,e),this.type=t,this.isDefault=!1,this.name="",this.color=new ve(0,0,0),this.vertexColors=!1}return o()(e,[{key:"IsEqual",value:function(e){return this.type===e.type&&(this.isDefault===e.isDefault&&(this.name===e.name&&(!!ke(this.color,e.color)&&this.vertexColors===e.vertexColors)))}}]),e}(),je=function(e){Ue()(n,e);var t=ze()(n);function n(e){var r;return i()(this,n),(r=t.call(this,e)).emissive=new ve(0,0,0),r.opacity=1,r.transparent=!1,r.diffuseMap=null,r.bumpMap=null,r.normalMap=null,r.emissiveMap=null,r.alphaTest=0,r.multiplyDiffuseMap=!1,r}return o()(n,[{key:"IsEqual",value:function(e){return!!Ne()(De()(n.prototype),"IsEqual",this).call(this,e)&&(!!ke(this.emissive,e.emissive)&&(!!ee(this.opacity,e.opacity)&&(this.transparent===e.transparent&&(!!Be(this.diffuseMap,e.diffuseMap)&&(!!Be(this.bumpMap,e.bumpMap)&&(!!Be(this.normalMap,e.normalMap)&&(!!Be(this.emissiveMap,e.emissiveMap)&&(!!ee(this.alphaTest,e.alphaTest)&&this.multiplyDiffuseMap===e.multiplyDiffuseMap))))))))}}]),n}(He),qe=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this,We.Phong)).ambient=new ve(0,0,0),e.specular=new ve(0,0,0),e.shininess=0,e.specularMap=null,e}return o()(n,[{key:"IsEqual",value:function(e){return!!Ne()(De()(n.prototype),"IsEqual",this).call(this,e)&&(!!ke(this.ambient,e.ambient)&&(!!ke(this.specular,e.specular)&&(!!ee(this.shininess,e.shininess)&&!!Be(this.specularMap,e.specularMap))))}}]),n}(je),Xe=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this,We.Physical)).metalness=0,e.roughness=1,e.metalnessMap=null,e}return o()(n,[{key:"IsEqual",value:function(e){return!!Ne()(De()(n.prototype),"IsEqual",this).call(this,e)&&(!!ee(this.metalness,e.metalness)&&(!!ee(this.roughness,e.roughness)&&!!Be(this.metalnessMap,e.metalnessMap)))}}]),n}(je);function Ye(e,t){return e.name===t.name&&(e.mimeType===t.mimeType&&(!!Ce(e.offset,t.offset)&&(!!Ce(e.scale,t.scale)&&!!ee(e.rotation,t.rotation))))}var Ke,Ze=function(){function e(){i()(this,e)}return o()(e,[{key:"VertexCount",value:function(){return 0}},{key:"VertexColorCount",value:function(){return 0}},{key:"NormalCount",value:function(){return 0}},{key:"TextureUVCount",value:function(){return 0}},{key:"TriangleCount",value:function(){return 0}},{key:"EnumerateVertices",value:function(e){}},{key:"EnumerateTriangleVertexIndices",value:function(e){}},{key:"EnumerateTriangleVertices",value:function(e){}}]),e}(),Je=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this)).name="",e.propertyGroups=[],e}return o()(n,[{key:"GetName",value:function(){return this.name}},{key:"SetName",value:function(e){this.name=e}},{key:"PropertyGroupCount",value:function(){return this.propertyGroups.length}},{key:"AddPropertyGroup",value:function(e){return this.propertyGroups.push(e),this.propertyGroups.length-1}},{key:"GetPropertyGroup",value:function(e){return this.propertyGroups[e]}},{key:"CloneProperties",value:function(e){var t,n=d()(this.propertyGroups);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.AddPropertyGroup(r.Clone())}}catch(e){n.e(e)}finally{n.f()}}}]),n}(Ze),Qe=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this)).vertices=[],e.vertexColors=[],e.normals=[],e.uvs=[],e.triangles=[],e}return o()(n,[{key:"VertexCount",value:function(){return this.vertices.length}},{key:"VertexColorCount",value:function(){return this.vertexColors.length}},{key:"NormalCount",value:function(){return this.normals.length}},{key:"TextureUVCount",value:function(){return this.uvs.length}},{key:"TriangleCount",value:function(){return this.triangles.length}},{key:"AddVertex",value:function(e){return this.vertices.push(e),this.vertices.length-1}},{key:"SetVertex",value:function(e,t){this.vertices[e]=t}},{key:"GetVertex",value:function(e){return this.vertices[e]}},{key:"AddVertexColor",value:function(e){return this.vertexColors.push(e),this.vertexColors.length-1}},{key:"SetVertexColor",value:function(e,t){this.vertexColors[e]=t}},{key:"GetVertexColor",value:function(e){return this.vertexColors[e]}},{key:"AddNormal",value:function(e){return this.normals.push(e),this.normals.length-1}},{key:"SetNormal",value:function(e,t){this.normals[e]=t}},{key:"GetNormal",value:function(e){return this.normals[e]}},{key:"AddTextureUV",value:function(e){return this.uvs.push(e),this.uvs.length-1}},{key:"SetTextureUV",value:function(e,t){this.uvs[e]=t}},{key:"GetTextureUV",value:function(e){return this.uvs[e]}},{key:"AddTriangle",value:function(e){return this.triangles.push(e),this.triangles.length-1}},{key:"GetTriangle",value:function(e){return this.triangles[e]}},{key:"EnumerateVertices",value:function(e){var t,n=d()(this.vertices);try{for(n.s();!(t=n.n()).done;){e(t.value)}}catch(e){n.e(e)}finally{n.f()}}},{key:"EnumerateTriangleVertexIndices",value:function(e){var t,n=d()(this.triangles);try{for(n.s();!(t=n.n()).done;){var r=t.value;e(r.v0,r.v1,r.v2)}}catch(e){n.e(e)}finally{n.f()}}},{key:"EnumerateTriangleVertices",value:function(e){var t,n=d()(this.triangles);try{for(n.s();!(t=n.n()).done;){var r=t.value;e(this.vertices[r.v0],this.vertices[r.v1],this.vertices[r.v2])}}catch(e){n.e(e)}finally{n.f()}}},{key:"Clone",value:function(){var e=new n;e.SetName(this.GetName()),this.CloneProperties(e);for(var t=0;t<this.VertexCount();t++){var r=this.GetVertex(t);e.AddVertex(r.Clone())}for(var i=0;i<this.VertexColorCount();i++){var a=this.GetVertexColor(i);e.AddVertexColor(a.Clone())}for(var o=0;o<this.NormalCount();o++){var s=this.GetNormal(o);e.AddNormal(s.Clone())}for(var u=0;u<this.TextureUVCount();u++){var l=this.GetTextureUV(u);e.AddTextureUV(l.Clone())}for(var c=0;c<this.TriangleCount();c++){var h=this.GetTriangle(c);e.AddTriangle(h.Clone())}return e}}]),n}(Je),$e=function(){function e(t,n,r){i()(this,e),this.v0=t,this.v1=n,this.v2=r,this.c0=null,this.c1=null,this.c2=null,this.n0=null,this.n1=null,this.n2=null,this.u0=null,this.u1=null,this.u2=null,this.mat=null,this.curve=null}return o()(e,[{key:"HasVertices",value:function(){return null!==this.v0&&null!==this.v1&&null!==this.v2}},{key:"HasVertexColors",value:function(){return null!==this.c0&&null!==this.c1&&null!==this.c2}},{key:"HasNormals",value:function(){return null!==this.n0&&null!==this.n1&&null!==this.n2}},{key:"HasTextureUVs",value:function(){return null!==this.u0&&null!==this.u1&&null!==this.u2}},{key:"SetVertices",value:function(e,t,n){return this.v0=e,this.v1=t,this.v2=n,this}},{key:"SetVertexColors",value:function(e,t,n){return this.c0=e,this.c1=t,this.c2=n,this}},{key:"SetNormals",value:function(e,t,n){return this.n0=e,this.n1=t,this.n2=n,this}},{key:"SetTextureUVs",value:function(e,t,n){return this.u0=e,this.u1=t,this.u2=n,this}},{key:"SetMaterial",value:function(e){return this.mat=e,this}},{key:"SetCurve",value:function(e){return this.curve=e,this}},{key:"Clone",value:function(){var t=new e(this.v0,this.v1,this.v2);return t.SetVertexColors(this.c0,this.c1,this.c2),t.SetNormals(this.n0,this.n1,this.n2),t.SetTextureUVs(this.u0,this.u1,this.u2),t.SetMaterial(this.mat),t.SetCurve(this.curve),t}}]),e}(),et=n(1),tt=(n(778),n(142)),nt=n(825),rt=n.n(nt),it=n(734),at=n(521),ot=n(271),st="145",ut=100,lt=301,ct=302,ht=303,ft=304,dt=306,pt=1e3,vt=1001,mt=1002,gt=1003,yt=1004,xt=1005,_t=1006,bt=1008,Tt=1009,Mt=1012,wt=1014,St=1015,Et=1016,kt=1020,At=1023,Ct=1026,It=1027,Rt=33776,Lt=33777,Pt=33778,Nt=33779,Ot=35840,Dt=35841,Ft=35842,Ut=35843,Gt=37492,zt=37496,Vt=37808,Bt=37809,Wt=37810,Ht=37811,jt=37812,qt=37813,Xt=37814,Yt=37815,Kt=37816,Zt=37817,Jt=37818,Qt=37819,$t=37820,en=37821,tn=36492,nn=2300,rn=2301,an=2302,on=2400,sn=2401,un=2402,ln=2500,cn=3e3,hn=3001,fn="srgb",dn="srgb-linear",pn=7680,vn=35044,mn="300 es",gn=1035,yn=function(){function e(){t(this,e)}return a(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e);e.target=null}}}}]),e}(),xn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],_n=1234567,bn=Math.PI/180,Tn=180/Math.PI;function Mn(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(xn[255&e]+xn[e>>8&255]+xn[e>>16&255]+xn[e>>24&255]+"-"+xn[255&t]+xn[t>>8&255]+"-"+xn[t>>16&15|64]+xn[t>>24&255]+"-"+xn[63&n|128]+xn[n>>8&255]+"-"+xn[n>>16&255]+xn[n>>24&255]+xn[255&r]+xn[r>>8&255]+xn[r>>16&255]+xn[r>>24&255]).toLowerCase()}function wn(e,t,n){return Math.max(t,Math.min(n,e))}function Sn(e,t){return(e%t+t)%t}function En(e,t,n){return(1-n)*e+n*t}function kn(e){return 0==(e&e-1)&&0!==e}function An(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Cn(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function In(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}function Rn(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}}var Ln=Object.freeze({__proto__:null,DEG2RAD:bn,RAD2DEG:Tn,generateUUID:Mn,clamp:wn,euclideanModulo:Sn,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:En,damp:function(e,t,n,r){return En(e,t,1-Math.exp(-n*r))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(Sn(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(_n=e);var t=_n+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*bn},radToDeg:function(e){return e*Tn},isPowerOfTwo:kn,ceilPowerOfTwo:An,floorPowerOfTwo:Cn,setQuaternionFromProperEuler:function(e,t,n,r,i){var a=Math.cos,o=Math.sin,s=a(n/2),u=o(n/2),l=a((t+r)/2),c=o((t+r)/2),h=a((t-r)/2),f=o((t-r)/2),d=a((r-t)/2),p=o((r-t)/2);switch(i){case"XYX":e.set(s*c,u*h,u*f,s*l);break;case"YZY":e.set(u*f,s*c,u*h,s*l);break;case"ZXZ":e.set(u*h,u*f,s*c,s*l);break;case"XZX":e.set(s*c,u*p,u*d,s*l);break;case"YXY":e.set(u*d,s*c,u*p,s*l);break;case"ZYZ":e.set(u*p,u*d,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:Rn,denormalize:In}),Pn=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,n),n.prototype.isVector2=!0,this.x=e,this.y=r}return a(n,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:e,value:ot().mark((function e(){return ot().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),n}(Symbol.iterator),Nn=function(){function e(){t(this,e),e.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}return a(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,u){var l=this.elements;return l[0]=e,l[1]=r,l[2]=o,l[3]=t,l[4]=i,l[5]=s,l[6]=n,l[7]=a,l[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],u=n[1],l=n[4],c=n[7],h=n[2],f=n[5],d=n[8],p=r[0],v=r[3],m=r[6],g=r[1],y=r[4],x=r[7],_=r[2],b=r[5],T=r[8];return i[0]=a*p+o*g+s*_,i[3]=a*v+o*y+s*b,i[6]=a*m+o*x+s*T,i[1]=u*p+l*g+c*_,i[4]=u*v+l*y+c*b,i[7]=u*m+l*x+c*T,i[2]=h*p+f*g+d*_,i[5]=h*v+f*y+d*b,i[8]=h*m+f*x+d*T,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*a*l-t*o*u-n*i*l+n*o*s+r*i*u-r*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=l*a-o*u,h=o*s-l*i,f=u*i-a*s,d=t*c+n*h+r*f;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);var p=1/d;return e[0]=c*p,e[1]=(r*u-l*n)*p,e[2]=(o*n-r*a)*p,e[3]=h*p,e[4]=(l*t-r*s)*p,e[5]=(r*i-o*t)*p,e[6]=f*p,e[7]=(n*s-u*t)*p,e[8]=(a*t-n*i)*p,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,i,a,o){var s=Math.cos(i),u=Math.sin(i);return this.set(n*s,n*u,-n*(s*a+u*o)+a+e,-r*u,r*s,-r*(-u*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],u=r[4],l=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*u,r[6]=t*o+n*l,r[1]=-n*i+t*s,r[4]=-n*a+t*u,r[7]=-n*o+t*l,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}();function On(e){for(var t=e.length-1;t>=0;--t)if(e[t]>=65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function Dn(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Fn(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Un(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var Gn=(at(Ke={},fn,at({},dn,Fn)),at(Ke,dn,at({},fn,Un)),Ke),zn={legacyMode:!0,get workingColorSpace(){return dn},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if(Gn[t]&&void 0!==Gn[t][n]){var r=Gn[t][n];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Vn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bn={r:0,g:0,b:0},Wn={h:0,s:0,l:0},Hn={h:0,s:0,l:0};function jn(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function qn(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Xn,Yn=function(e){function n(e,r,i){return t(this,n),this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===r&&void 0===i?this.set(e):this.setRGB(e,r,i)}return a(n,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fn;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,zn.toWorkingColorSpace(this,t),this}},{key:"setRGB",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dn;return this.r=e,this.g=t,this.b=n,zn.toWorkingColorSpace(this,r),this}},{key:"setHSL",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:dn;if(e=Sn(e,1),t=wn(t,0,1),n=wn(n,0,1),0===t)this.r=this.g=this.b=n;else{var i=n<=.5?n*(1+t):n+t-n*t,a=2*n-i;this.r=jn(a,i,e+1/3),this.g=jn(a,i,e),this.b=jn(a,i,e-1/3)}return zn.toWorkingColorSpace(this,r),this}},{key:"setStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fn;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var i,a=t[1],o=t[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,zn.toWorkingColorSpace(this,n),r(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,zn.toWorkingColorSpace(this,n),r(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){var s=parseFloat(i[1])/360,u=parseFloat(i[2])/100,l=parseFloat(i[3])/100;return r(i[4]),this.setHSL(s,u,l,n)}}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){var c=t[1],h=c.length;if(3===h)return this.r=parseInt(c.charAt(0)+c.charAt(0),16)/255,this.g=parseInt(c.charAt(1)+c.charAt(1),16)/255,this.b=parseInt(c.charAt(2)+c.charAt(2),16)/255,zn.toWorkingColorSpace(this,n),this;if(6===h)return this.r=parseInt(c.charAt(0)+c.charAt(1),16)/255,this.g=parseInt(c.charAt(2)+c.charAt(3),16)/255,this.b=parseInt(c.charAt(4)+c.charAt(5),16)/255,zn.toWorkingColorSpace(this,n),this}return e&&e.length>0?this.setColorName(e,n):this}},{key:"setColorName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fn,n=Vn[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copySRGBToLinear",value:function(e){return this.r=Fn(e.r),this.g=Fn(e.g),this.b=Fn(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=Un(e.r),this.g=Un(e.g),this.b=Un(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fn;return zn.fromWorkingColorSpace(qn(this,Bn),e),wn(255*Bn.r,0,255)<<16^wn(255*Bn.g,0,255)<<8^wn(255*Bn.b,0,255)<<0}},{key:"getHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fn;return("000000"+this.getHex(e).toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dn;zn.fromWorkingColorSpace(qn(this,Bn),t);var n,r,i=Bn.r,a=Bn.g,o=Bn.b,s=Math.max(i,a,o),u=Math.min(i,a,o),l=(u+s)/2;if(u===s)n=0,r=0;else{var c=s-u;switch(r=l<=.5?c/(s+u):c/(2-s-u),s){case i:n=(a-o)/c+(a<o?6:0);break;case a:n=(o-i)/c+2;break;case o:n=(i-a)/c+4}n/=6}return e.h=n,e.s=r,e.l=l,e}},{key:"getRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dn;return zn.fromWorkingColorSpace(qn(this,Bn),t),e.r=Bn.r,e.g=Bn.g,e.b=Bn.b,e}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fn;return zn.fromWorkingColorSpace(qn(this,Bn),e),e!==fn?"color(".concat(e," ").concat(Bn.r," ").concat(Bn.g," ").concat(Bn.b,")"):"rgb(".concat(255*Bn.r|0,",").concat(255*Bn.g|0,",").concat(255*Bn.b|0,")")}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(Wn),Wn.h+=e,Wn.s+=t,Wn.l+=n,this.setHSL(Wn.h,Wn.s,Wn.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(Wn),e.getHSL(Hn);var n=En(Wn.h,Hn.h,t),r=En(Wn.s,Hn.s,t),i=En(Wn.l,Hn.l,t);return this.setHSL(n,r,i),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:e,value:ot().mark((function e(){return ot().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.r;case 2:return e.next=4,this.g;case 4:return e.next=6,this.b;case 6:case"end":return e.stop()}}),e,this)}))}]),n}(Symbol.iterator);Yn.NAMES=Vn;var Kn=function(){function e(){t(this,e)}return a(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Xn&&(Xn=Dn("canvas")),Xn.width=e.width,Xn.height=e.height;var n=Xn.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Xn}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var t=Dn("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),i=r.data,a=0;a<i.length;a++)i[a]=255*Fn(i[a]/255);return n.putImageData(r,0,0),t}if(e.data){for(var o=e.data.slice(0),s=0;s<o.length;s++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[s]=Math.floor(255*Fn(o[s]/255)):o[s]=Fn(o[s]);return{data:o,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}]),e}(),Zn=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t(this,e),this.isSource=!0,this.uuid=Mn(),this.data=n,this.version=0}return a(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var n={uuid:this.uuid,url:""},r=this.data;if(null!==r){var i;if(Array.isArray(r)){i=[];for(var a=0,o=r.length;a<o;a++)r[a].isDataTexture?i.push(Jn(r[a].image)):i.push(Jn(r[a]))}else i=Jn(r);n.url=i}return t||(e.images[this.uuid]=n),n}}]),e}();function Jn(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Kn.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Qn=0,$n=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.DEFAULT_IMAGE,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.DEFAULT_MAPPING,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:vt,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vt,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:_t,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:bt,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:At,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Tt,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:cn;return t(this,r),(e=n.call(this)).isTexture=!0,Object.defineProperty(it(e),"id",{value:Qn++}),e.uuid=Mn(),e.name="",e.source=new Zn(i),e.mipmaps=[],e.mapping=a,e.wrapS=o,e.wrapT=s,e.magFilter=u,e.minFilter=l,e.anisotropy=f,e.format=c,e.internalFormat=null,e.type=h,e.offset=new Pn(0,0),e.repeat=new Pn(1,1),e.center=new Pn(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new Nn,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,e.encoding=d,e.userData={},e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e.needsPMREMUpdate=!1,e}return a(r,[{key:"image",get:function(){return this.source.data},set:function(e){this.source.data=e}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case pt:e.x=e.x-Math.floor(e.x);break;case vt:e.x=e.x<0?0:1;break;case mt:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case pt:e.y=e.y-Math.floor(e.y);break;case vt:e.y=e.y<0?0:1;break;case mt:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}]),r}(yn);$n.DEFAULT_IMAGE=null,$n.DEFAULT_MAPPING=300;var er=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t(this,n),n.prototype.isVector4=!0,this.x=e,this.y=r,this.z=i,this.w=a}return a(n,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,r,i,a=.01,o=.1,s=e.elements,u=s[0],l=s[4],c=s[8],h=s[1],f=s[5],d=s[9],p=s[2],v=s[6],m=s[10];if(Math.abs(l-h)<a&&Math.abs(c-p)<a&&Math.abs(d-v)<a){if(Math.abs(l+h)<o&&Math.abs(c+p)<o&&Math.abs(d+v)<o&&Math.abs(u+f+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(u+1)/2,y=(f+1)/2,x=(m+1)/2,_=(l+h)/4,b=(c+p)/4,T=(d+v)/4;return g>y&&g>x?g<a?(n=0,r=.707106781,i=.707106781):(r=_/(n=Math.sqrt(g)),i=b/n):y>x?y<a?(n=.707106781,r=0,i=.707106781):(n=_/(r=Math.sqrt(y)),i=T/r):x<a?(n=.707106781,r=.707106781,i=0):(n=b/(i=Math.sqrt(x)),r=T/i),this.set(n,r,i,t),this}var M=Math.sqrt((v-d)*(v-d)+(c-p)*(c-p)+(h-l)*(h-l));return Math.abs(M)<.001&&(M=1),this.x=(v-d)/M,this.y=(c-p)/M,this.z=(h-l)/M,this.w=Math.acos((u+f+m-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:e,value:ot().mark((function e(){return ot().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}}),e,this)}))}]),n}(Symbol.iterator),tr=function(e){Fe(r,e);var n=Ge(r);function r(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t(this,r),(a=n.call(this)).isWebGLRenderTarget=!0,a.width=e,a.height=i,a.depth=1,a.scissor=new er(0,0,e,i),a.scissorTest=!1,a.viewport=new er(0,0,e,i);var s={width:e,height:i,depth:1};return a.texture=new $n(s,o.mapping,o.wrapS,o.wrapT,o.magFilter,o.minFilter,o.format,o.type,o.anisotropy,o.encoding),a.texture.isRenderTargetTexture=!0,a.texture.flipY=!1,a.texture.generateMipmaps=void 0!==o.generateMipmaps&&o.generateMipmaps,a.texture.internalFormat=void 0!==o.internalFormat?o.internalFormat:null,a.texture.minFilter=void 0!==o.minFilter?o.minFilter:_t,a.depthBuffer=void 0===o.depthBuffer||o.depthBuffer,a.stencilBuffer=void 0!==o.stencilBuffer&&o.stencilBuffer,a.depthTexture=void 0!==o.depthTexture?o.depthTexture:null,a.samples=void 0!==o.samples?o.samples:0,a}return a(r,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;var t=Object.assign({},e.texture.image);return this.texture.source=new Zn(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),r}(yn),nr=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t(this,r),(e=n.call(this,null)).isDataArrayTexture=!0,e.image={data:i,width:a,height:o,depth:s},e.magFilter=gt,e.minFilter=gt,e.wrapR=vt,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return a(r)}($n),rr=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t(this,r),(e=n.call(this,null)).isData3DTexture=!0,e.image={data:i,width:a,height:o,depth:s},e.magFilter=gt,e.minFilter=gt,e.wrapR=vt,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return a(r)}($n),ir=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t(this,n),this.isQuaternion=!0,this._x=e,this._y=r,this._z=i,this._w=a}return a(n,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){var n=e._x,r=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,u=o(n/2),l=o(r/2),c=o(i/2),h=s(n/2),f=s(r/2),d=s(i/2);switch(a){case"XYZ":this._x=h*l*c+u*f*d,this._y=u*f*c-h*l*d,this._z=u*l*d+h*f*c,this._w=u*l*c-h*f*d;break;case"YXZ":this._x=h*l*c+u*f*d,this._y=u*f*c-h*l*d,this._z=u*l*d-h*f*c,this._w=u*l*c+h*f*d;break;case"ZXY":this._x=h*l*c-u*f*d,this._y=u*f*c+h*l*d,this._z=u*l*d+h*f*c,this._w=u*l*c-h*f*d;break;case"ZYX":this._x=h*l*c-u*f*d,this._y=u*f*c+h*l*d,this._z=u*l*d-h*f*c,this._w=u*l*c+h*f*d;break;case"YZX":this._x=h*l*c+u*f*d,this._y=u*f*c+h*l*d,this._z=u*l*d-h*f*c,this._w=u*l*c-h*f*d;break;case"XZY":this._x=h*l*c-u*f*d,this._y=u*f*c-h*l*d,this._z=u*l*d+h*f*c,this._w=u*l*c+h*f*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],u=t[2],l=t[6],c=t[10],h=n+o+c;if(h>0){var f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(l-s)*f,this._y=(i-u)*f,this._z=(a-r)*f}else if(n>o&&n>c){var d=2*Math.sqrt(1+n-o-c);this._w=(l-s)/d,this._x=.25*d,this._y=(r+a)/d,this._z=(i+u)/d}else if(o>c){var p=2*Math.sqrt(1+o-n-c);this._w=(i-u)/p,this._x=(r+a)/p,this._y=.25*p,this._z=(s+l)/p}else{var v=2*Math.sqrt(1+c-n-o);this._w=(a-r)/v,this._x=(i+u)/v,this._y=(s+l)/v,this._z=.25*v}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(wn(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e){return this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,u=t._z,l=t._w;return this._x=n*l+a*o+r*u-i*s,this._y=r*l+a*s+i*o-n*u,this._z=i*l+a*u+n*s-r*o,this._w=a*l-n*o-r*s-i*u,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-t;return this._w=u*a+t*this._w,this._x=u*n+t*this._x,this._y=u*r+t*this._y,this._z=u*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var l=Math.sqrt(s),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,f=Math.sin(t*c)/l;return this._w=a*h+this._w*f,this._x=n*h+this._x*f,this._y=r*h+this._y*f,this._z=i*h+this._z*f,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){return this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(i),n*Math.cos(i),t*Math.sin(r))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:e,value:ot().mark((function e(){return ot().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._w;case 8:case"end":return e.stop()}}),e,this)}))}],[{key:"slerpFlat",value:function(e,t,n,r,i,a,o){var s=n[r+0],u=n[r+1],l=n[r+2],c=n[r+3],h=i[a+0],f=i[a+1],d=i[a+2],p=i[a+3];if(0===o)return e[t+0]=s,e[t+1]=u,e[t+2]=l,void(e[t+3]=c);if(1===o)return e[t+0]=h,e[t+1]=f,e[t+2]=d,void(e[t+3]=p);if(c!==p||s!==h||u!==f||l!==d){var v=1-o,m=s*h+u*f+l*d+c*p,g=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){var x=Math.sqrt(y),_=Math.atan2(x,m*g);v=Math.sin(v*_)/x,o=Math.sin(o*_)/x}var b=o*g;if(s=s*v+h*b,u=u*v+f*b,l=l*v+d*b,c=c*v+p*b,v===1-o){var T=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=T,u*=T,l*=T,c*=T}}e[t]=s,e[t+1]=u,e[t+2]=l,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,r,i,a){var o=n[r],s=n[r+1],u=n[r+2],l=n[r+3],c=i[a],h=i[a+1],f=i[a+2],d=i[a+3];return e[t]=o*d+l*c+s*f-u*h,e[t+1]=s*d+l*h+u*c-o*f,e[t+2]=u*d+l*f+o*h-s*c,e[t+3]=l*d-o*c-s*h-u*f,e}}]),n}(Symbol.iterator),ar=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t(this,n),n.prototype.isVector3=!0,this.x=e,this.y=r,this.z=i}return a(n,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return this.applyQuaternion(sr.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(sr.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,u=s*t+a*r-o*n,l=s*n+o*t-i*r,c=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this.x=u*s+h*-i+l*-o-c*-a,this.y=l*s+h*-a+c*-i-u*-o,this.z=c*s+h*-o+u*-a-l*-i,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e){return this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return or.copy(this).projectOnVector(e),this.sub(or)}},{key:"reflect",value:function(e){return this.sub(or.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(wn(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"setFromEuler",value:function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:e,value:ot().mark((function e(){return ot().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),n}(Symbol.iterator),or=new ar,sr=new ir,ur=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ar(1/0,1/0,1/0),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar(-1/0,-1/0,-1/0);t(this,e),this.isBox3=!0,this.min=n,this.max=r}return a(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=e.length;s<u;s+=3){var l=e[s],c=e[s+1],h=e[s+2];l<t&&(t=l),c<n&&(n=c),h<r&&(r=h),l>i&&(i=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,u=e.count;s<u;s++){var l=e.getX(s),c=e.getY(s),h=e.getZ(s);l<t&&(t=l),c<n&&(n=c),h<r&&(r=h),l>i&&(i=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=cr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);var n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position)for(var r=n.attributes.position,i=0,a=r.count;i<a;i++)cr.fromBufferAttribute(r,i).applyMatrix4(e.matrixWorld),this.expandByPoint(cr);else null===n.boundingBox&&n.computeBoundingBox(),hr.copy(n.boundingBox),hr.applyMatrix4(e.matrixWorld),this.union(hr);for(var o=e.children,s=0,u=o.length;s<u;s++)this.expandByObject(o[s],t);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,cr),cr.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(yr),xr.subVectors(this.max,yr),fr.subVectors(e.a,yr),dr.subVectors(e.b,yr),pr.subVectors(e.c,yr),vr.subVectors(dr,fr),mr.subVectors(pr,dr),gr.subVectors(fr,pr);var t=[0,-vr.z,vr.y,0,-mr.z,mr.y,0,-gr.z,gr.y,vr.z,0,-vr.x,mr.z,0,-mr.x,gr.z,0,-gr.x,-vr.y,vr.x,0,-mr.y,mr.x,0,-gr.y,gr.x,0];return!!Tr(t,fr,dr,pr,xr)&&(!!Tr(t=[1,0,0,0,1,0,0,0,1],fr,dr,pr,xr)&&(_r.crossVectors(vr,mr),Tr(t=[_r.x,_r.y,_r.z],fr,dr,pr,xr)))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return cr.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return this.getCenter(e.center),e.radius=.5*this.getSize(cr).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(lr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),lr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),lr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),lr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),lr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),lr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),lr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),lr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(lr)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),lr=[new ar,new ar,new ar,new ar,new ar,new ar,new ar,new ar],cr=new ar,hr=new ur,fr=new ar,dr=new ar,pr=new ar,vr=new ar,mr=new ar,gr=new ar,yr=new ar,xr=new ar,_r=new ar,br=new ar;function Tr(e,t,n,r,i){for(var a=0,o=e.length-3;a<=o;a+=3){br.fromArray(e,a);var s=i.x*Math.abs(br.x)+i.y*Math.abs(br.y)+i.z*Math.abs(br.z),u=t.dot(br),l=n.dot(br),c=r.dot(br);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}var Mr=new ur,wr=new ar,Sr=new ar,Er=new ar,kr=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ar,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;t(this,e),this.center=n,this.radius=r}return a(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):Mr.setFromPoints(e).getCenter(n);for(var r=0,i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Er.subVectors(e,this.center);var t=Er.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),r=.5*(n-this.radius);this.center.add(Er.multiplyScalar(r/n)),this.radius+=r}return this}},{key:"union",value:function(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?Sr.set(0,0,1).multiplyScalar(e.radius):Sr.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(wr.copy(e.center).add(Sr)),this.expandByPoint(wr.copy(e.center).sub(Sr)),this)}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Ar=new ar,Cr=new ar,Ir=new ar,Rr=new ar,Lr=new ar,Pr=new ar,Nr=new ar,Or=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ar,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar(0,0,-1);t(this,e),this.origin=n,this.direction=r}return a(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,Ar)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=Ar.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ar.copy(this.direction).multiplyScalar(t).add(this.origin),Ar.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,r){Cr.copy(e).add(t).multiplyScalar(.5),Ir.copy(t).sub(e).normalize(),Rr.copy(this.origin).sub(Cr);var i,a,o,s,u=.5*e.distanceTo(t),l=-this.direction.dot(Ir),c=Rr.dot(this.direction),h=-Rr.dot(Ir),f=Rr.lengthSq(),d=Math.abs(1-l*l);if(d>0)if(a=l*c-h,s=u*d,(i=l*h-c)>=0)if(a>=-s)if(a<=s){var p=1/d;o=(i*=p)*(i+l*(a*=p)+2*c)+a*(l*i+a+2*h)+f}else a=u,o=-(i=Math.max(0,-(l*a+c)))*i+a*(a+2*h)+f;else a=-u,o=-(i=Math.max(0,-(l*a+c)))*i+a*(a+2*h)+f;else a<=-s?o=-(i=Math.max(0,-(-l*u+c)))*i+(a=i>0?-u:Math.min(Math.max(-u,-h),u))*(a+2*h)+f:a<=s?(i=0,o=(a=Math.min(Math.max(-u,-h),u))*(a+2*h)+f):o=-(i=Math.max(0,-(l*u+c)))*i+(a=i>0?u:Math.min(Math.max(-u,-h),u))*(a+2*h)+f;else a=l>0?-u:u,o=-(i=Math.max(0,-(l*a+c)))*i+a*(a+2*h)+f;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Ir).multiplyScalar(a).add(Cr),o}},{key:"intersectSphere",value:function(e,t){Ar.subVectors(e.center,this.origin);var n=Ar.dot(this.direction),r=Ar.dot(Ar)-n*n,i=e.radius*e.radius;if(r>i)return null;var a=Math.sqrt(i-r),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,r,i,a,o,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,r=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,r=(e.min.x-h.x)*u),l>=0?(i=(e.min.y-h.y)*l,a=(e.max.y-h.y)*l):(i=(e.max.y-h.y)*l,a=(e.min.y-h.y)*l),n>a||i>r?null:((i>n||n!=n)&&(n=i),(a<r||r!=r)&&(r=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>r?null:((o>n||n!=n)&&(n=o),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,Ar)}},{key:"intersectTriangle",value:function(e,t,n,r,i){Lr.subVectors(t,e),Pr.subVectors(n,e),Nr.crossVectors(Lr,Pr);var a,o=this.direction.dot(Nr);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Rr.subVectors(this.origin,e);var s=a*this.direction.dot(Pr.crossVectors(Rr,Pr));if(s<0)return null;var u=a*this.direction.dot(Lr.cross(Rr));if(u<0)return null;if(s+u>o)return null;var l=-a*Rr.dot(Nr);return l<0?null:this.at(l/o,i)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Dr=function(){function e(){t(this,e),e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return a(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,u,l,c,h,f,d,p,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=a,m[9]=o,m[13]=s,m[2]=u,m[6]=l,m[10]=c,m[14]=h,m[3]=f,m[7]=d,m[11]=p,m[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,r=1/Fr.setFromMatrixColumn(e,0).length(),i=1/Fr.setFromMatrixColumn(e,1).length(),a=1/Fr.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),u=Math.sin(r),l=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var h=a*l,f=a*c,d=o*l,p=o*c;t[0]=s*l,t[4]=-s*c,t[8]=u,t[1]=f+d*u,t[5]=h-p*u,t[9]=-o*s,t[2]=p-h*u,t[6]=d+f*u,t[10]=a*s}else if("YXZ"===e.order){var v=s*l,m=s*c,g=u*l,y=u*c;t[0]=v+y*o,t[4]=g*o-m,t[8]=a*u,t[1]=a*c,t[5]=a*l,t[9]=-o,t[2]=m*o-g,t[6]=y+v*o,t[10]=a*s}else if("ZXY"===e.order){var x=s*l,_=s*c,b=u*l,T=u*c;t[0]=x-T*o,t[4]=-a*c,t[8]=b+_*o,t[1]=_+b*o,t[5]=a*l,t[9]=T-x*o,t[2]=-a*u,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var M=a*l,w=a*c,S=o*l,E=o*c;t[0]=s*l,t[4]=S*u-w,t[8]=M*u+E,t[1]=s*c,t[5]=E*u+M,t[9]=w*u-S,t[2]=-u,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var k=a*s,A=a*u,C=o*s,I=o*u;t[0]=s*l,t[4]=I-k*c,t[8]=C*c+A,t[1]=c,t[5]=a*l,t[9]=-o*l,t[2]=-u*l,t[6]=A*c+C,t[10]=k-I*c}else if("XZY"===e.order){var R=a*s,L=a*u,P=o*s,N=o*u;t[0]=s*l,t[4]=-c,t[8]=u*l,t[1]=R*c+N,t[5]=a*l,t[9]=L*c-P,t[2]=P*c-L,t[6]=o*l,t[10]=N*c+R}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(Gr,e,zr)}},{key:"lookAt",value:function(e,t,n){var r=this.elements;return Wr.subVectors(e,t),0===Wr.lengthSq()&&(Wr.z=1),Wr.normalize(),Vr.crossVectors(n,Wr),0===Vr.lengthSq()&&(1===Math.abs(n.z)?Wr.x+=1e-4:Wr.z+=1e-4,Wr.normalize(),Vr.crossVectors(n,Wr)),Vr.normalize(),Br.crossVectors(Wr,Vr),r[0]=Vr.x,r[4]=Br.x,r[8]=Wr.x,r[1]=Vr.y,r[5]=Br.y,r[9]=Wr.y,r[2]=Vr.z,r[6]=Br.z,r[10]=Wr.z,this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],u=n[12],l=n[1],c=n[5],h=n[9],f=n[13],d=n[2],p=n[6],v=n[10],m=n[14],g=n[3],y=n[7],x=n[11],_=n[15],b=r[0],T=r[4],M=r[8],w=r[12],S=r[1],E=r[5],k=r[9],A=r[13],C=r[2],I=r[6],R=r[10],L=r[14],P=r[3],N=r[7],O=r[11],D=r[15];return i[0]=a*b+o*S+s*C+u*P,i[4]=a*T+o*E+s*I+u*N,i[8]=a*M+o*k+s*R+u*O,i[12]=a*w+o*A+s*L+u*D,i[1]=l*b+c*S+h*C+f*P,i[5]=l*T+c*E+h*I+f*N,i[9]=l*M+c*k+h*R+f*O,i[13]=l*w+c*A+h*L+f*D,i[2]=d*b+p*S+v*C+m*P,i[6]=d*T+p*E+v*I+m*N,i[10]=d*M+p*k+v*R+m*O,i[14]=d*w+p*A+v*L+m*D,i[3]=g*b+y*S+x*C+_*P,i[7]=g*T+y*E+x*I+_*N,i[11]=g*M+y*k+x*R+_*O,i[15]=g*w+y*A+x*L+_*D,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],u=e[13],l=e[2],c=e[6],h=e[10],f=e[14];return e[3]*(+i*s*c-r*u*c-i*o*h+n*u*h+r*o*f-n*s*f)+e[7]*(+t*s*f-t*u*h+i*a*h-r*a*f+r*u*l-i*s*l)+e[11]*(+t*u*c-t*o*f-i*a*c+n*a*f+i*o*l-n*u*l)+e[15]*(-r*o*l-t*s*c+t*o*h+r*a*c-n*a*h+n*s*l)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11],d=e[12],p=e[13],v=e[14],m=e[15],g=c*v*u-p*h*u+p*s*f-o*v*f-c*s*m+o*h*m,y=d*h*u-l*v*u-d*s*f+a*v*f+l*s*m-a*h*m,x=l*p*u-d*c*u+d*o*f-a*p*f-l*o*m+a*c*m,_=d*c*s-l*p*s-d*o*h+a*p*h+l*o*v-a*c*v,b=t*g+n*y+r*x+i*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var T=1/b;return e[0]=g*T,e[1]=(p*h*i-c*v*i-p*r*f+n*v*f+c*r*m-n*h*m)*T,e[2]=(o*v*i-p*s*i+p*r*u-n*v*u-o*r*m+n*s*m)*T,e[3]=(c*s*i-o*h*i-c*r*u+n*h*u+o*r*f-n*s*f)*T,e[4]=y*T,e[5]=(l*v*i-d*h*i+d*r*f-t*v*f-l*r*m+t*h*m)*T,e[6]=(d*s*i-a*v*i-d*r*u+t*v*u+a*r*m-t*s*m)*T,e[7]=(a*h*i-l*s*i+l*r*u-t*h*u-a*r*f+t*s*f)*T,e[8]=x*T,e[9]=(d*c*i-l*p*i-d*n*f+t*p*f+l*n*m-t*c*m)*T,e[10]=(a*p*i-d*o*i+d*n*u-t*p*u-a*n*m+t*o*m)*T,e[11]=(l*o*i-a*c*i-l*n*u+t*c*u+a*n*f-t*o*f)*T,e[12]=_*T,e[13]=(l*p*r-d*c*r+d*n*h-t*p*h-l*n*v+t*c*v)*T,e[14]=(d*o*r-a*p*r-d*n*s+t*p*s+a*n*v-t*o*v)*T,e[15]=(a*c*r-l*o*r+l*n*s-t*c*s-a*n*h+t*o*h)*T,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,u=i*a,l=i*o;return this.set(u*a+n,u*o-r*s,u*s+r*o,0,u*o+r*s,l*o+n,l*s-r*a,0,u*s-r*o,l*s+r*a,i*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,r,i,a){return this.set(1,n,i,0,e,1,a,0,t,r,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,u=i+i,l=a+a,c=o+o,h=i*u,f=i*l,d=i*c,p=a*l,v=a*c,m=o*c,g=s*u,y=s*l,x=s*c,_=n.x,b=n.y,T=n.z;return r[0]=(1-(p+m))*_,r[1]=(f+x)*_,r[2]=(d-y)*_,r[3]=0,r[4]=(f-x)*b,r[5]=(1-(h+m))*b,r[6]=(v+g)*b,r[7]=0,r[8]=(d+y)*T,r[9]=(v-g)*T,r[10]=(1-(h+p))*T,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(e,t,n){var r=this.elements,i=Fr.set(r[0],r[1],r[2]).length(),a=Fr.set(r[4],r[5],r[6]).length(),o=Fr.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Ur.copy(this);var s=1/i,u=1/a,l=1/o;return Ur.elements[0]*=s,Ur.elements[1]*=s,Ur.elements[2]*=s,Ur.elements[4]*=u,Ur.elements[5]*=u,Ur.elements[6]*=u,Ur.elements[8]*=l,Ur.elements[9]*=l,Ur.elements[10]*=l,t.setFromRotationMatrix(Ur),n.x=i,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,r,i,a){var o=this.elements,s=2*i/(t-e),u=2*i/(n-r),l=(t+e)/(t-e),c=(n+r)/(n-r),h=-(a+i)/(a-i),f=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=u,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,r,i,a){var o=this.elements,s=1/(t-e),u=1/(n-r),l=1/(a-i),c=(t+e)*s,h=(n+r)*u,f=(a+i)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}(),Fr=new ar,Ur=new Dr,Gr=new ar(0,0,0),zr=new ar(1,1,1),Vr=new ar,Br=new ar,Wr=new ar,Hr=new Dr,jr=new ir,qr=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.DefaultOrder;t(this,n),this.isEuler=!0,this._x=e,this._y=r,this._z=i,this._order=a}return a(n,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.elements,i=r[0],a=r[4],o=r[8],s=r[1],u=r[5],l=r[9],c=r[2],h=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(wn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,f),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-wn(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-c,i),this._z=0);break;case"ZXY":this._x=Math.asin(wn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-c,f),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(s,i));break;case"ZYX":this._y=Math.asin(-wn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(s,i)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(wn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-c,i)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-wn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-l,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return Hr.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Hr,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return jr.setFromEuler(this),this.setFromQuaternion(jr,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:e,value:ot().mark((function e(){return ot().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._order;case 8:case"end":return e.stop()}}),e,this)}))},{key:"toVector3",value:function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}]),n}(Symbol.iterator);qr.DefaultOrder="XYZ",qr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Xr=function(){function e(){t(this,e),this.mask=1}return a(e,[{key:"set",value:function(e){this.mask=(1<<e|0)>>>0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!=(this.mask&e.mask)}},{key:"isEnabled",value:function(e){return 0!=(this.mask&(1<<e|0))}}]),e}(),Yr=0,Kr=new ar,Zr=new ir,Jr=new Dr,Qr=new ar,$r=new ar,ei=new ar,ti=new ir,ni=new ar(1,0,0),ri=new ar(0,1,0),ii=new ar(0,0,1),ai={type:"added"},oi={type:"removed"},si=function(e){Fe(r,e);var n=Ge(r);function r(){var e;t(this,r),(e=n.call(this)).isObject3D=!0,Object.defineProperty(it(e),"id",{value:Yr++}),e.uuid=Mn(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=r.DefaultUp.clone();var i=new ar,a=new qr,o=new ir,s=new ar(1,1,1);return a._onChange((function(){o.setFromEuler(a,!1)})),o._onChange((function(){a.setFromQuaternion(o,void 0,!1)})),Object.defineProperties(it(e),{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:a},quaternion:{configurable:!0,enumerable:!0,value:o},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Dr},normalMatrix:{value:new Nn}}),e.matrix=new Dr,e.matrixWorld=new Dr,e.matrixAutoUpdate=r.DefaultMatrixAutoUpdate,e.matrixWorldNeedsUpdate=!1,e.matrixWorldAutoUpdate=r.DefaultMatrixWorldAutoUpdate,e.layers=new Xr,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return a(r,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return Zr.setFromAxisAngle(e,t),this.quaternion.multiply(Zr),this}},{key:"rotateOnWorldAxis",value:function(e,t){return Zr.setFromAxisAngle(e,t),this.quaternion.premultiply(Zr),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(ni,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(ri,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(ii,e)}},{key:"translateOnAxis",value:function(e,t){return Kr.copy(e).applyQuaternion(this.quaternion),this.position.add(Kr.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(ni,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(ri,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(ii,e)}},{key:"localToWorld",value:function(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return e.applyMatrix4(Jr.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?Qr.copy(e):Qr.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),$r.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Jr.lookAt($r,Qr,this.up):Jr.lookAt(Qr,$r,this.up),this.quaternion.setFromRotationMatrix(Jr),r&&(Jr.extractRotation(r.matrixWorld),Zr.setFromRotationMatrix(Jr),this.quaternion.premultiply(Zr.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(ai)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(oi)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(oi)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),Jr.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Jr.multiply(e.parent.matrixWorld)),e.applyMatrix4(Jr),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($r,e,ei),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose($r,ti,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++){var i=t[n];!0!==i.matrixWorldAutoUpdate&&!0!==e||i.updateMatrixWorld(e)}}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&!0===n.matrixWorldAutoUpdate&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,a=r.length;i<a;i++){var o=r[i];!0===o.matrixWorldAutoUpdate&&o.updateWorldMatrix(!1,!0)}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,u=o.length;s<u;s++){var l=o[s];i(e.shapes,l)}else i(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,f=this.material.length;h<f;h++)c.push(i(e.materials,this.material[h]));r.material=c}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(var d=0;d<this.children.length;d++)r.children.push(this.children[d].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(var p=0;p<this.animations.length;p++){var v=this.animations[p];r.animations.push(i(e.animations,v))}}if(t){var m=w(e.geometries),g=w(e.materials),y=w(e.textures),x=w(e.images),_=w(e.shapes),b=w(e.skeletons),T=w(e.animations),M=w(e.nodes);m.length>0&&(n.geometries=m),g.length>0&&(n.materials=g),y.length>0&&(n.textures=y),x.length>0&&(n.images=x),_.length>0&&(n.shapes=_),b.length>0&&(n.skeletons=b),T.length>0&&(n.animations=T),M.length>0&&(n.nodes=M)}return n.object=r,n;function w(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}]),r}(yn);si.DefaultUp=new ar(0,1,0),si.DefaultMatrixAutoUpdate=!0,si.DefaultMatrixWorldAutoUpdate=!0;var ui=new ar,li=new ar,ci=new ar,hi=new ar,fi=new ar,di=new ar,pi=new ar,vi=new ar,mi=new ar,gi=new ar,yi=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ar,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ar;t(this,e),this.a=n,this.b=r,this.c=i}return a(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return ui.subVectors(this.c,this.b),li.subVectors(this.a,this.b),.5*ui.cross(li).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,r,i,a){return e.getUV(t,this.a,this.b,this.c,n,r,i,a)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,r,i=this.a,a=this.b,o=this.c;fi.subVectors(a,i),di.subVectors(o,i),vi.subVectors(e,i);var s=fi.dot(vi),u=di.dot(vi);if(s<=0&&u<=0)return t.copy(i);mi.subVectors(e,a);var l=fi.dot(mi),c=di.dot(mi);if(l>=0&&c<=l)return t.copy(a);var h=s*c-l*u;if(h<=0&&s>=0&&l<=0)return n=s/(s-l),t.copy(i).addScaledVector(fi,n);gi.subVectors(e,o);var f=fi.dot(gi),d=di.dot(gi);if(d>=0&&f<=d)return t.copy(o);var p=f*u-s*d;if(p<=0&&u>=0&&d<=0)return r=u/(u-d),t.copy(i).addScaledVector(di,r);var v=l*d-f*c;if(v<=0&&c-l>=0&&f-d>=0)return pi.subVectors(o,a),r=(c-l)/(c-l+(f-d)),t.copy(a).addScaledVector(pi,r);var m=1/(v+p+h);return n=p*m,r=h*m,t.copy(i).addScaledVector(fi,n).addScaledVector(di,r)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,r){r.subVectors(n,t),ui.subVectors(e,t),r.cross(ui);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,r,i){ui.subVectors(r,t),li.subVectors(n,t),ci.subVectors(e,t);var a=ui.dot(ui),o=ui.dot(li),s=ui.dot(ci),u=li.dot(li),l=li.dot(ci),c=a*u-o*o;if(0===c)return i.set(-2,-1,-1);var h=1/c,f=(u*s-o*l)*h,d=(a*l-o*s)*h;return i.set(1-f-d,d,f)}},{key:"containsPoint",value:function(e,t,n,r){return this.getBarycoord(e,t,n,r,hi),hi.x>=0&&hi.y>=0&&hi.x+hi.y<=1}},{key:"getUV",value:function(e,t,n,r,i,a,o,s){return this.getBarycoord(e,t,n,r,hi),s.set(0,0),s.addScaledVector(i,hi.x),s.addScaledVector(a,hi.y),s.addScaledVector(o,hi.z),s}},{key:"isFrontFacing",value:function(e,t,n,r){return ui.subVectors(n,t),li.subVectors(e,t),ui.cross(li).dot(r)<0}}]),e}(),xi=0,_i=function(e){Fe(r,e);var n=Ge(r);function r(){var e;return t(this,r),(e=n.call(this)).isMaterial=!0,Object.defineProperty(it(e),"id",{value:xi++}),e.uuid=Mn(),e.name="",e.type="Material",e.blending=1,e.side=0,e.vertexColors=!1,e.opacity=1,e.transparent=!1,e.blendSrc=204,e.blendDst=205,e.blendEquation=ut,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=3,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=519,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=pn,e.stencilZFail=pn,e.stencilZPass=pn,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return a(r,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),a=r(e.images);i.length>0&&(n.textures=i),a.length>0&&(n.images=a)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),r}(yn),bi=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this)).isMeshBasicMaterial=!0,i.type="MeshBasicMaterial",i.color=new Yn(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.fog=!0,i.setValues(e),i}return a(r,[{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),r}(_i),Ti=new ar,Mi=new Pn,wi=function(){function e(n,r,i){if(t(this,e),Array.isArray(n))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=n,this.itemSize=r,this.count=void 0!==n?n.length/r:0,this.normalized=!0===i,this.usage=vn,this.updateRange={offset:0,count:-1},this.version=0}return a(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)Mi.fromBufferAttribute(this,t),Mi.applyMatrix3(e),this.setXY(t,Mi.x,Mi.y);else if(3===this.itemSize)for(var r=0,i=this.count;r<i;r++)Ti.fromBufferAttribute(this,r),Ti.applyMatrix3(e),this.setXYZ(r,Ti.x,Ti.y,Ti.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)Ti.fromBufferAttribute(this,t),Ti.applyMatrix4(e),this.setXYZ(t,Ti.x,Ti.y,Ti.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)Ti.fromBufferAttribute(this,t),Ti.applyNormalMatrix(e),this.setXYZ(t,Ti.x,Ti.y,Ti.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)Ti.fromBufferAttribute(this,t),Ti.transformDirection(e),this.setXYZ(t,Ti.x,Ti.y,Ti.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){var t=this.array[e*this.itemSize];return this.normalized&&(t=In(t,this.array)),t}},{key:"setX",value:function(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){var t=this.array[e*this.itemSize+1];return this.normalized&&(t=In(t,this.array)),t}},{key:"setY",value:function(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){var t=this.array[e*this.itemSize+2];return this.normalized&&(t=In(t,this.array)),t}},{key:"setZ",value:function(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){var t=this.array[e*this.itemSize+3];return this.normalized&&(t=In(t,this.array)),t}},{key:"setW",value:function(e,t){return this.normalized&&(t=Rn(t,this.array)),this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.normalized&&(t=Rn(t,this.array),n=Rn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e*=this.itemSize,this.normalized&&(t=Rn(t,this.array),n=Rn(n,this.array),r=Rn(r,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,i){return e*=this.itemSize,this.normalized&&(t=Rn(t,this.array),n=Rn(n,this.array),r=Rn(r,this.array),i=Rn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==vn&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}},{key:"copyColorsArray",value:function(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}},{key:"copyVector2sArray",value:function(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}},{key:"copyVector3sArray",value:function(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}},{key:"copyVector4sArray",value:function(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}]),e}(),Si=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a){return t(this,r),n.call(this,new Uint16Array(e),i,a)}return a(r)}(wi),Ei=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a){return t(this,r),n.call(this,new Uint32Array(e),i,a)}return a(r)}(wi),ki=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a){return t(this,r),n.call(this,new Float32Array(e),i,a)}return a(r)}(wi),Ai=0,Ci=new Dr,Ii=new si,Ri=new ar,Li=new ur,Pi=new ur,Ni=new ar,Oi=function(e){Fe(r,e);var n=Ge(r);function r(){var e;return t(this,r),(e=n.call(this)).isBufferGeometry=!0,Object.defineProperty(it(e),"id",{value:Ai++}),e.uuid=Mn(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return a(r,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(On(e)?Ei:Si)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new Nn).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return Ci.makeRotationFromQuaternion(e),this.applyMatrix4(Ci),this}},{key:"rotateX",value:function(e){return Ci.makeRotationX(e),this.applyMatrix4(Ci),this}},{key:"rotateY",value:function(e){return Ci.makeRotationY(e),this.applyMatrix4(Ci),this}},{key:"rotateZ",value:function(e){return Ci.makeRotationZ(e),this.applyMatrix4(Ci),this}},{key:"translate",value:function(e,t,n){return Ci.makeTranslation(e,t,n),this.applyMatrix4(Ci),this}},{key:"scale",value:function(e,t,n){return Ci.makeScale(e,t,n),this.applyMatrix4(Ci),this}},{key:"lookAt",value:function(e){return Ii.lookAt(e),Ii.updateMatrix(),this.applyMatrix4(Ii.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ri).negate(),this.translate(Ri.x,Ri.y,Ri.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new ki(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new ur);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ar(-1/0,-1/0,-1/0),new ar(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];Li.setFromBufferAttribute(i),this.morphTargetsRelative?(Ni.addVectors(this.boundingBox.min,Li.min),this.boundingBox.expandByPoint(Ni),Ni.addVectors(this.boundingBox.max,Li.max),this.boundingBox.expandByPoint(Ni)):(this.boundingBox.expandByPoint(Li.min),this.boundingBox.expandByPoint(Li.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new kr);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ar,1/0);if(e){var n=this.boundingSphere.center;if(Li.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var a=t[r];Pi.setFromBufferAttribute(a),this.morphTargetsRelative?(Ni.addVectors(Li.min,Pi.min),Li.expandByPoint(Ni),Ni.addVectors(Li.max,Pi.max),Li.expandByPoint(Ni)):(Li.expandByPoint(Pi.min),Li.expandByPoint(Pi.max))}Li.getCenter(n);for(var o=0,s=0,u=e.count;s<u;s++)Ni.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(Ni));if(t)for(var l=0,c=t.length;l<c;l++)for(var h=t[l],f=this.morphTargetsRelative,d=0,p=h.count;d<p;d++)Ni.fromBufferAttribute(h,d),f&&(Ri.fromBufferAttribute(e,d),Ni.add(Ri)),o=Math.max(o,n.distanceToSquared(Ni));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,r=t.position.array,i=t.normal.array,a=t.uv.array,o=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new wi(new Float32Array(4*o),4));for(var s=this.getAttribute("tangent").array,u=[],l=[],c=0;c<o;c++)u[c]=new ar,l[c]=new ar;var h=new ar,f=new ar,d=new ar,p=new Pn,v=new Pn,m=new Pn,g=new ar,y=new ar,x=this.groups;0===x.length&&(x=[{start:0,count:n.length}]);for(var _=0,b=x.length;_<b;++_)for(var T=x[_],M=T.start,w=M,S=M+T.count;w<S;w+=3)D(n[w+0],n[w+1],n[w+2]);for(var E=new ar,k=new ar,A=new ar,C=new ar,I=0,R=x.length;I<R;++I)for(var L=x[I],P=L.start,N=P,O=P+L.count;N<O;N+=3)F(n[N+0]),F(n[N+1]),F(n[N+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function D(e,t,n){h.fromArray(r,3*e),f.fromArray(r,3*t),d.fromArray(r,3*n),p.fromArray(a,2*e),v.fromArray(a,2*t),m.fromArray(a,2*n),f.sub(h),d.sub(h),v.sub(p),m.sub(p);var i=1/(v.x*m.y-m.x*v.y);isFinite(i)&&(g.copy(f).multiplyScalar(m.y).addScaledVector(d,-v.y).multiplyScalar(i),y.copy(d).multiplyScalar(v.x).addScaledVector(f,-m.x).multiplyScalar(i),u[e].add(g),u[t].add(g),u[n].add(g),l[e].add(y),l[t].add(y),l[n].add(y))}function F(e){A.fromArray(i,3*e),C.copy(A);var t=u[e];E.copy(t),E.sub(A.multiplyScalar(A.dot(t))).normalize(),k.crossVectors(C,t);var n=k.dot(l[e])<0?-1:1;s[4*e]=E.x,s[4*e+1]=E.y,s[4*e+2]=E.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new wi(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var r=0,i=n.count;r<i;r++)n.setXYZ(r,0,0,0);var a=new ar,o=new ar,s=new ar,u=new ar,l=new ar,c=new ar,h=new ar,f=new ar;if(e)for(var d=0,p=e.count;d<p;d+=3){var v=e.getX(d+0),m=e.getX(d+1),g=e.getX(d+2);a.fromBufferAttribute(t,v),o.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),h.subVectors(s,o),f.subVectors(a,o),h.cross(f),u.fromBufferAttribute(n,v),l.fromBufferAttribute(n,m),c.fromBufferAttribute(n,g),u.add(h),l.add(h),c.add(h),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(g,c.x,c.y,c.z)}else for(var y=0,x=t.count;y<x;y+=3)a.fromBufferAttribute(t,y+0),o.fromBufferAttribute(t,y+1),s.fromBufferAttribute(t,y+2),h.subVectors(s,o),f.subVectors(a,o),h.cross(f),n.setXYZ(y+0,h.x,h.y,h.z),n.setXYZ(y+1,h.x,h.y,h.z),n.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)Ni.fromBufferAttribute(e,t),Ni.normalize(),e.setXYZ(t,Ni.x,Ni.y,Ni.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r),o=0,s=0,u=0,l=t.length;u<l;u++){o=e.isInterleavedBufferAttribute?t[u]*e.data.stride+e.offset:t[u]*r;for(var c=0;c<r;c++)a[s++]=n[o++]}return new wi(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new r,n=this.index.array,i=this.attributes;for(var a in i){var o=e(i[a],n);t.setAttribute(a,o)}var s=this.morphAttributes;for(var u in s){for(var l=[],c=s[u],h=0,f=c.length;h<f;h++){var d=e(c[h],n);l.push(d)}t.morphAttributes[u]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,v=0,m=p.length;v<m;v++){var g=p[v];t.addGroup(g.start,g.count,g.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var a in i){var o=i[a];e.data.attributes[a]=o.toJSON(e.data)}var s={},u=!1;for(var l in this.morphAttributes){for(var c=this.morphAttributes[l],h=[],f=0,d=c.length;f<d;f++){var p=c[f];h.push(p.toJSON(e.data))}h.length>0&&(s[l]=h,u=!0)}u&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;v.length>0&&(e.data.groups=JSON.parse(JSON.stringify(v)));var m=this.boundingSphere;return null!==m&&(e.data.boundingSphere={center:m.center.toArray(),radius:m.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var r=e.attributes;for(var i in r){var a=r[i];this.setAttribute(i,a.clone(t))}var o=e.morphAttributes;for(var s in o){for(var u=[],l=o[s],c=0,h=l.length;c<h;c++)u.push(l[c].clone(t));this.morphAttributes[s]=u}this.morphTargetsRelative=e.morphTargetsRelative;for(var f=e.groups,d=0,p=f.length;d<p;d++){var v=f[d];this.addGroup(v.start,v.count,v.materialIndex)}var m=e.boundingBox;null!==m&&(this.boundingBox=m.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),r}(yn),Di=new Dr,Fi=new Or,Ui=new kr,Gi=new ar,zi=new ar,Vi=new ar,Bi=new ar,Wi=new ar,Hi=new ar,ji=new ar,qi=new ar,Xi=new ar,Yi=new Pn,Ki=new Pn,Zi=new Pn,Ji=new ar,Qi=new ar,$i=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Oi,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new bi;return t(this,r),(e=n.call(this)).isMesh=!0,e.type="Mesh",e.geometry=i,e.material=a,e.updateMorphTargets(),e}return a(r,[{key:"copy",value:function(e,t){return Pe(Oe(r.prototype),"copy",this).call(this,e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++){var a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),Ui.copy(n.boundingSphere),Ui.applyMatrix4(i),!1!==e.ray.intersectsSphere(Ui)&&(Di.copy(i).invert(),Fi.copy(e.ray).applyMatrix4(Di),null===n.boundingBox||!1!==Fi.intersectsBox(n.boundingBox)))){var a,o=n.index,s=n.attributes.position,u=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,h=n.attributes.uv2,f=n.groups,d=n.drawRange;if(null!==o)if(Array.isArray(r))for(var p=0,v=f.length;p<v;p++)for(var m=f[p],g=r[m.materialIndex],y=Math.max(m.start,d.start),x=Math.min(o.count,Math.min(m.start+m.count,d.start+d.count));y<x;y+=3){var _=o.getX(y),b=o.getX(y+1),T=o.getX(y+2);(a=ea(this,g,e,Fi,s,u,l,c,h,_,b,T))&&(a.faceIndex=Math.floor(y/3),a.face.materialIndex=m.materialIndex,t.push(a))}else for(var M=Math.max(0,d.start),w=Math.min(o.count,d.start+d.count);M<w;M+=3){var S=o.getX(M),E=o.getX(M+1),k=o.getX(M+2);(a=ea(this,r,e,Fi,s,u,l,c,h,S,E,k))&&(a.faceIndex=Math.floor(M/3),t.push(a))}else if(void 0!==s)if(Array.isArray(r))for(var A=0,C=f.length;A<C;A++)for(var I=f[A],R=r[I.materialIndex],L=Math.max(I.start,d.start),P=Math.min(s.count,Math.min(I.start+I.count,d.start+d.count));L<P;L+=3){(a=ea(this,R,e,Fi,s,u,l,c,h,L,L+1,L+2))&&(a.faceIndex=Math.floor(L/3),a.face.materialIndex=I.materialIndex,t.push(a))}else for(var N=Math.max(0,d.start),O=Math.min(s.count,d.start+d.count);N<O;N+=3){(a=ea(this,r,e,Fi,s,u,l,c,h,N,N+1,N+2))&&(a.faceIndex=Math.floor(N/3),t.push(a))}}}}]),r}(si);function ea(e,t,n,r,i,a,o,s,u,l,c,h){Gi.fromBufferAttribute(i,l),zi.fromBufferAttribute(i,c),Vi.fromBufferAttribute(i,h);var f=e.morphTargetInfluences;if(a&&f){ji.set(0,0,0),qi.set(0,0,0),Xi.set(0,0,0);for(var d=0,p=a.length;d<p;d++){var v=f[d],m=a[d];0!==v&&(Bi.fromBufferAttribute(m,l),Wi.fromBufferAttribute(m,c),Hi.fromBufferAttribute(m,h),o?(ji.addScaledVector(Bi,v),qi.addScaledVector(Wi,v),Xi.addScaledVector(Hi,v)):(ji.addScaledVector(Bi.sub(Gi),v),qi.addScaledVector(Wi.sub(zi),v),Xi.addScaledVector(Hi.sub(Vi),v)))}Gi.add(ji),zi.add(qi),Vi.add(Xi)}e.isSkinnedMesh&&(e.boneTransform(l,Gi),e.boneTransform(c,zi),e.boneTransform(h,Vi));var g=function(e,t,n,r,i,a,o,s){if(null===(1===t.side?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,2!==t.side,s)))return null;Qi.copy(s),Qi.applyMatrix4(e.matrixWorld);var u=n.ray.origin.distanceTo(Qi);return u<n.near||u>n.far?null:{distance:u,point:Qi.clone(),object:e}}(e,t,n,r,Gi,zi,Vi,Ji);if(g){s&&(Yi.fromBufferAttribute(s,l),Ki.fromBufferAttribute(s,c),Zi.fromBufferAttribute(s,h),g.uv=yi.getUV(Ji,Gi,zi,Vi,Yi,Ki,Zi,new Pn)),u&&(Yi.fromBufferAttribute(u,l),Ki.fromBufferAttribute(u,c),Zi.fromBufferAttribute(u,h),g.uv2=yi.getUV(Ji,Gi,zi,Vi,Yi,Ki,Zi,new Pn));var y={a:l,b:c,c:h,normal:new ar,materialIndex:0};yi.getNormal(Gi,zi,Vi,y.normal),g.face=y}return g}var ta=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;t(this,r),(e=n.call(this)).type="BoxGeometry",e.parameters={width:i,height:a,depth:o,widthSegments:s,heightSegments:u,depthSegments:l};var c=it(e);s=Math.floor(s),u=Math.floor(u),l=Math.floor(l);var h=[],f=[],d=[],p=[],v=0,m=0;function g(e,t,n,r,i,a,o,s,u,l,g){for(var y=a/u,x=o/l,_=a/2,b=o/2,T=s/2,M=u+1,w=l+1,S=0,E=0,k=new ar,A=0;A<w;A++)for(var C=A*x-b,I=0;I<M;I++){var R=I*y-_;k[e]=R*r,k[t]=C*i,k[n]=T,f.push(k.x,k.y,k.z),k[e]=0,k[t]=0,k[n]=s>0?1:-1,d.push(k.x,k.y,k.z),p.push(I/u),p.push(1-A/l),S+=1}for(var L=0;L<l;L++)for(var P=0;P<u;P++){var N=v+P+M*L,O=v+P+M*(L+1),D=v+(P+1)+M*(L+1),F=v+(P+1)+M*L;h.push(N,O,F),h.push(O,D,F),E+=6}c.addGroup(m,E,g),m+=E,v+=S}return g("z","y","x",-1,-1,o,a,i,l,u,0),g("z","y","x",1,-1,o,a,-i,l,u,1),g("x","z","y",1,1,i,o,a,s,l,2),g("x","z","y",1,-1,i,o,-a,s,l,3),g("x","y","z",1,-1,i,a,o,s,u,4),g("x","y","z",-1,-1,i,a,-o,s,u,5),e.setIndex(h),e.setAttribute("position",new ki(f,3)),e.setAttribute("normal",new ki(d,3)),e.setAttribute("uv",new ki(p,2)),e}return a(r,null,[{key:"fromJSON",value:function(e){return new r(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),r}(Oi);function na(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}function ra(e){for(var t={},n=0;n<e.length;n++){var r=na(e[n]);for(var i in r)t[i]=r[i]}return t}var ia={clone:na,merge:ra},aa=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this)).isShaderMaterial=!0,i.type="ShaderMaterial",i.defines={},i.uniforms={},i.uniformsGroups=[],i.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",i.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",i.linewidth=1,i.wireframe=!1,i.wireframeLinewidth=1,i.fog=!1,i.lights=!1,i.clipping=!1,i.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},i.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},i.index0AttributeName=void 0,i.uniformsNeedUpdate=!1,i.glslVersion=null,void 0!==e&&i.setValues(e),i}return a(r,[{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=na(e.uniforms),this.uniformsGroups=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].clone());return t}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=Pe(Oe(r.prototype),"toJSON",this).call(this,e);for(var n in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var a={};for(var o in this.extensions)!0===this.extensions[o]&&(a[o]=!0);return Object.keys(a).length>0&&(t.extensions=a),t}}]),r}(_i),oa=function(e){Fe(r,e);var n=Ge(r);function r(){var e;return t(this,r),(e=n.call(this)).isCamera=!0,e.type="Camera",e.matrixWorldInverse=new Dr,e.projectionMatrix=new Dr,e.projectionMatrixInverse=new Dr,e}return a(r,[{key:"copy",value:function(e,t){return Pe(Oe(r.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){Pe(Oe(r.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){Pe(Oe(r.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),r}(si),sa=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return t(this,r),(e=n.call(this)).isPerspectiveCamera=!0,e.type="PerspectiveCamera",e.fov=i,e.zoom=1,e.near=o,e.far=s,e.focus=10,e.aspect=a,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return a(r,[{key:"copy",value:function(e,t){return Pe(Oe(r.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Tn*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*bn*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*Tn*Math.atan(Math.tan(.5*bn*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*bn*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*r/o,t-=a.offsetY*n/s,r*=a.width/o,n*=a.height/s}var u=this.filmOffset;0!==u&&(i+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Pe(Oe(r.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),r}(oa),ua=90,la=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a){var o;t(this,r),(o=n.call(this)).type="CubeCamera",o.renderTarget=a;var s=new sa(ua,1,e,i);s.layers=o.layers,s.up.set(0,-1,0),s.lookAt(new ar(1,0,0)),o.add(s);var u=new sa(ua,1,e,i);u.layers=o.layers,u.up.set(0,-1,0),u.lookAt(new ar(-1,0,0)),o.add(u);var l=new sa(ua,1,e,i);l.layers=o.layers,l.up.set(0,0,1),l.lookAt(new ar(0,1,0)),o.add(l);var c=new sa(ua,1,e,i);c.layers=o.layers,c.up.set(0,0,-1),c.lookAt(new ar(0,-1,0)),o.add(c);var h=new sa(ua,1,e,i);h.layers=o.layers,h.up.set(0,-1,0),h.lookAt(new ar(0,0,1)),o.add(h);var f=new sa(ua,1,e,i);return f.layers=o.layers,f.up.set(0,-1,0),f.lookAt(new ar(0,0,-1)),o.add(f),o}return a(r,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,r=nt(this.children,6),i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],l=r[5],c=e.getRenderTarget(),h=e.toneMapping,f=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;var d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,a),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,u),n.texture.generateMipmaps=d,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.toneMapping=h,e.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}]),r}(si),ca=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a,o,s,u,l,c,h,f){var d;return t(this,r),e=void 0!==e?e:[],i=void 0!==i?i:lt,(d=n.call(this,e,i,a,o,s,u,l,c,h,f)).isCubeTexture=!0,d.flipY=!1,d}return a(r,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),r}($n),ha=function(e){Fe(r,e);var n=Ge(r);function r(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,r),(i=n.call(this,e,e,a)).isWebGLCubeRenderTarget=!0;var o={width:e,height:e,depth:1},s=[o,o,o,o,o,o];return i.texture=new ca(s,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),i.texture.isRenderTargetTexture=!0,i.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,i.texture.minFilter=void 0!==a.minFilter?a.minFilter:_t,i}return a(r,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new ta(5,5,5),o=new aa({name:"CubemapFromEquirect",uniforms:na(n),vertexShader:r,fragmentShader:i,side:1,blending:0});o.uniforms.tEquirect.value=t;var s=new $i(a,o),u=t.minFilter;return t.minFilter===bt&&(t.minFilter=_t),new la(1,10,this).update(e,s),t.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,r){for(var i=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(i)}}]),r}(tr),fa=new ar,da=new ar,pa=new Nn,va=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ar(1,0,0),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t(this,e),this.isPlane=!0,this.normal=n,this.constant=r}return a(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var r=fa.subVectors(n,t).cross(da.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){var n=e.delta(fa),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(n).multiplyScalar(i).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||pa.getNormalMatrix(e),r=this.coplanarPoint(fa).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),ma=new kr,ga=new ar,ya=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new va,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new va,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new va,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new va,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new va,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new va;t(this,e),this.planes=[n,r,i,a,o,s]}return a(e,[{key:"set",value:function(e,t,n,r,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],f=n[9],d=n[10],p=n[11],v=n[12],m=n[13],g=n[14],y=n[15];return t[0].setComponents(o-r,c-s,p-h,y-v).normalize(),t[1].setComponents(o+r,c+s,p+h,y+v).normalize(),t[2].setComponents(o+i,c+u,p+f,y+m).normalize(),t[3].setComponents(o-i,c-u,p-f,y-m).normalize(),t[4].setComponents(o-a,c-l,p-d,y-g).normalize(),t[5].setComponents(o+a,c+l,p+d,y+g).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),ma.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ma)}},{key:"intersectsSprite",value:function(e){return ma.center.set(0,0,0),ma.radius=.7071067811865476,ma.applyMatrix4(e.matrixWorld),this.intersectsSphere(ma)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(ga.x=r.normal.x>0?e.max.x:e.min.x,ga.y=r.normal.y>0?e.max.y:e.min.y,ga.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(ga)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function xa(){var e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function _a(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){var a=r.get(t);(!a||a.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=r.get(t);void 0===o?r.set(t,function(t,r){var i,a=t.array,o=t.usage,s=e.createBuffer();if(e.bindBuffer(r,s),e.bufferData(r,a,o),t.onUploadCallback(),a instanceof Float32Array)i=5126;else if(a instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");i=5131}else i=5123;else if(a instanceof Int16Array)i=5122;else if(a instanceof Uint32Array)i=5125;else if(a instanceof Int32Array)i=5124;else if(a instanceof Int8Array)i=5120;else if(a instanceof Uint8Array)i=5121;else{if(!(a instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+a);i=5121}return{buffer:s,type:i,bytesPerElement:a.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(!function(t,r,i){var a=r.array,o=r.updateRange;e.bindBuffer(i,t),-1===o.count?e.bufferSubData(i,0,a):(n?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,t,i),o.version=t.version)}}}}var ba=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t(this,r),(e=n.call(this)).type="PlaneGeometry",e.parameters={width:i,height:a,widthSegments:o,heightSegments:s};for(var u=i/2,l=a/2,c=Math.floor(o),h=Math.floor(s),f=c+1,d=h+1,p=i/c,v=a/h,m=[],g=[],y=[],x=[],_=0;_<d;_++)for(var b=_*v-l,T=0;T<f;T++){var M=T*p-u;g.push(M,-b,0),y.push(0,0,1),x.push(T/c),x.push(1-_/h)}for(var w=0;w<h;w++)for(var S=0;S<c;S++){var E=S+f*w,k=S+f*(w+1),A=S+1+f*(w+1),C=S+1+f*w;m.push(E,k,C),m.push(k,A,C)}return e.setIndex(m),e.setAttribute("position",new ki(g,3)),e.setAttribute("normal",new ki(y,3)),e.setAttribute("uv",new ki(x,2)),e}return a(r,null,[{key:"fromJSON",value:function(e){return new r(e.width,e.height,e.widthSegments,e.heightSegments)}}]),r}(Oi),Ta={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n#define Material_LightProbeLOD( material )\t(0)",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Ma={common:{diffuse:{value:new Yn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Nn},uv2Transform:{value:new Nn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Pn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Yn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Yn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Nn}},sprite:{diffuse:{value:new Yn(16777215)},opacity:{value:1},center:{value:new Pn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Nn}}},wa={basic:{uniforms:ra([Ma.common,Ma.specularmap,Ma.envmap,Ma.aomap,Ma.lightmap,Ma.fog]),vertexShader:Ta.meshbasic_vert,fragmentShader:Ta.meshbasic_frag},lambert:{uniforms:ra([Ma.common,Ma.specularmap,Ma.envmap,Ma.aomap,Ma.lightmap,Ma.emissivemap,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,Ma.fog,Ma.lights,{emissive:{value:new Yn(0)}}]),vertexShader:Ta.meshlambert_vert,fragmentShader:Ta.meshlambert_frag},phong:{uniforms:ra([Ma.common,Ma.specularmap,Ma.envmap,Ma.aomap,Ma.lightmap,Ma.emissivemap,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,Ma.fog,Ma.lights,{emissive:{value:new Yn(0)},specular:{value:new Yn(1118481)},shininess:{value:30}}]),vertexShader:Ta.meshphong_vert,fragmentShader:Ta.meshphong_frag},standard:{uniforms:ra([Ma.common,Ma.envmap,Ma.aomap,Ma.lightmap,Ma.emissivemap,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,Ma.roughnessmap,Ma.metalnessmap,Ma.fog,Ma.lights,{emissive:{value:new Yn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ta.meshphysical_vert,fragmentShader:Ta.meshphysical_frag},toon:{uniforms:ra([Ma.common,Ma.aomap,Ma.lightmap,Ma.emissivemap,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,Ma.gradientmap,Ma.fog,Ma.lights,{emissive:{value:new Yn(0)}}]),vertexShader:Ta.meshtoon_vert,fragmentShader:Ta.meshtoon_frag},matcap:{uniforms:ra([Ma.common,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,Ma.fog,{matcap:{value:null}}]),vertexShader:Ta.meshmatcap_vert,fragmentShader:Ta.meshmatcap_frag},points:{uniforms:ra([Ma.points,Ma.fog]),vertexShader:Ta.points_vert,fragmentShader:Ta.points_frag},dashed:{uniforms:ra([Ma.common,Ma.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ta.linedashed_vert,fragmentShader:Ta.linedashed_frag},depth:{uniforms:ra([Ma.common,Ma.displacementmap]),vertexShader:Ta.depth_vert,fragmentShader:Ta.depth_frag},normal:{uniforms:ra([Ma.common,Ma.bumpmap,Ma.normalmap,Ma.displacementmap,{opacity:{value:1}}]),vertexShader:Ta.meshnormal_vert,fragmentShader:Ta.meshnormal_frag},sprite:{uniforms:ra([Ma.sprite,Ma.fog]),vertexShader:Ta.sprite_vert,fragmentShader:Ta.sprite_frag},background:{uniforms:{uvTransform:{value:new Nn},t2D:{value:null}},vertexShader:Ta.background_vert,fragmentShader:Ta.background_frag},cube:{uniforms:ra([Ma.envmap,{opacity:{value:1}}]),vertexShader:Ta.cube_vert,fragmentShader:Ta.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ta.equirect_vert,fragmentShader:Ta.equirect_frag},distanceRGBA:{uniforms:ra([Ma.common,Ma.displacementmap,{referencePosition:{value:new ar},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ta.distanceRGBA_vert,fragmentShader:Ta.distanceRGBA_frag},shadow:{uniforms:ra([Ma.lights,Ma.fog,{color:{value:new Yn(0)},opacity:{value:1}}]),vertexShader:Ta.shadow_vert,fragmentShader:Ta.shadow_frag}};function Sa(e,t,n,r,i,a){var o,s,u=new Yn(0),l=!0===i?0:1,c=null,h=0,f=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,a)}return{getClearColor:function(){return u},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;u.set(e),d(u,l=t)},getClearAlpha:function(){return l},setClearAlpha:function(e){d(u,l=e)},render:function(n,i){var a=!1,p=!0===i.isScene?i.background:null;p&&p.isTexture&&(p=t.get(p));var v=e.xr,m=v.getSession&&v.getSession();m&&"additive"===m.environmentBlendMode&&(p=null),null===p?d(u,l):p&&p.isColor&&(d(p,1),a=!0),(e.autoClear||a)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),p&&(p.isCubeTexture||p.mapping===dt)?(void 0===s&&((s=new $i(new ta(1,1,1),new aa({name:"BackgroundCubeMaterial",uniforms:na(wa.cube.uniforms),vertexShader:wa.cube.vertexShader,fragmentShader:wa.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(s)),s.material.uniforms.envMap.value=p,s.material.uniforms.flipEnvMap.value=p.isCubeTexture&&!1===p.isRenderTargetTexture?-1:1,c===p&&h===p.version&&f===e.toneMapping||(s.material.needsUpdate=!0,c=p,h=p.version,f=e.toneMapping),s.layers.enableAll(),n.unshift(s,s.geometry,s.material,0,0,null)):p&&p.isTexture&&(void 0===o&&((o=new $i(new ba(2,2),new aa({name:"BackgroundMaterial",uniforms:na(wa.background.uniforms),vertexShader:wa.background.vertexShader,fragmentShader:wa.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),o.material.uniforms.uvTransform.value.copy(p.matrix),c===p&&h===p.version&&f===e.toneMapping||(o.material.needsUpdate=!0,c=p,h=p.version,f=e.toneMapping),o.layers.enableAll(),n.unshift(o,o.geometry,o.material,0,0,null))}}}function Ea(e,t,n,r){var i=e.getParameter(34921),a=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==a,s={},u=d(null),l=u,c=!1;function h(t){return r.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function f(t){return r.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function d(e){for(var t=[],n=[],r=[],a=0;a<i;a++)t[a]=0,n[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function p(){for(var e=l.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function v(e){m(e,0)}function m(n,i){var a=l.newAttributes,o=l.enabledAttributes,s=l.attributeDivisors;(a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==i)&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i)}function g(){for(var t=l.newAttributes,n=l.enabledAttributes,r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function y(t,n,i,a,o,s){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,a,o,s):e.vertexAttribIPointer(t,n,i,o,s)}function x(){_(),c=!0,l!==u&&h((l=u).object)}function _(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:function(i,u,f,x,_){var b=!1;if(o){var T=function(t,n,i){var o=!0===i.wireframe,u=s[t.id];void 0===u&&(u={},s[t.id]=u);var l=u[n.id];void 0===l&&(l={},u[n.id]=l);var c=l[o];void 0===c&&(c=d(r.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),l[o]=c);return c}(x,f,u);l!==T&&h((l=T).object),b=function(e,t,n,r){var i=l.attributes,a=t.attributes,o=0,s=n.getAttributes();for(var u in s){if(s[u].location>=0){var c=i[u],h=a[u];if(void 0===h&&("instanceMatrix"===u&&e.instanceMatrix&&(h=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(h=e.instanceColor)),void 0===c)return!0;if(c.attribute!==h)return!0;if(h&&c.data!==h.data)return!0;o++}}return l.attributesNum!==o||l.index!==r}(i,x,f,_),b&&function(e,t,n,r){var i={},a=t.attributes,o=0,s=n.getAttributes();for(var u in s){if(s[u].location>=0){var c=a[u];void 0===c&&("instanceMatrix"===u&&e.instanceMatrix&&(c=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(c=e.instanceColor));var h={};h.attribute=c,c&&c.data&&(h.data=c.data),i[u]=h,o++}}l.attributes=i,l.attributesNum=o,l.index=r}(i,x,f,_)}else{var M=!0===u.wireframe;l.geometry===x.id&&l.program===f.id&&l.wireframe===M||(l.geometry=x.id,l.program=f.id,l.wireframe=M,b=!0)}null!==_&&n.update(_,34963),(b||c)&&(c=!1,function(i,a,o,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();var u=s.attributes,l=o.getAttributes(),c=a.defaultAttributeValues;for(var h in l){var f=l[h];if(f.location>=0){var d=u[h];if(void 0===d&&("instanceMatrix"===h&&i.instanceMatrix&&(d=i.instanceMatrix),"instanceColor"===h&&i.instanceColor&&(d=i.instanceColor)),void 0!==d){var x=d.normalized,_=d.itemSize,b=n.get(d);if(void 0===b)continue;var T=b.buffer,M=b.type,w=b.bytesPerElement;if(d.isInterleavedBufferAttribute){var S=d.data,E=S.stride,k=d.offset;if(S.isInstancedInterleavedBuffer){for(var A=0;A<f.locationSize;A++)m(f.location+A,S.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=S.meshPerAttribute*S.count)}else for(var C=0;C<f.locationSize;C++)v(f.location+C);e.bindBuffer(34962,T);for(var I=0;I<f.locationSize;I++)y(f.location+I,_/f.locationSize,M,x,E*w,(k+_/f.locationSize*I)*w)}else{if(d.isInstancedBufferAttribute){for(var R=0;R<f.locationSize;R++)m(f.location+R,d.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=d.meshPerAttribute*d.count)}else for(var L=0;L<f.locationSize;L++)v(f.location+L);e.bindBuffer(34962,T);for(var P=0;P<f.locationSize;P++)y(f.location+P,_/f.locationSize,M,x,_*w,_/f.locationSize*P*w)}}else if(void 0!==c){var N=c[h];if(void 0!==N)switch(N.length){case 2:e.vertexAttrib2fv(f.location,N);break;case 3:e.vertexAttrib3fv(f.location,N);break;case 4:e.vertexAttrib4fv(f.location,N);break;default:e.vertexAttrib1fv(f.location,N)}}}}g()}(i,u,f,x),null!==_&&e.bindBuffer(34963,n.get(_).buffer))},reset:x,resetDefaultState:_,dispose:function(){for(var e in x(),s){var t=s[e];for(var n in t){var r=t[n];for(var i in r)f(r[i].object),delete r[i];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var r=t[n];for(var i in r)f(r[i].object),delete r[i];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var r=n[e.id];for(var i in r)f(r[i].object),delete r[i];delete n[e.id]}}},initAttributes:p,enableAttribute:v,disableUnusedAttributes:g}}function ka(e,t,n,r){var i,a=r.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=function(r,o,s){if(0!==s){var u,l;if(a)u=e,l="drawArraysInstanced";else if(l="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[l](i,r,o,s),n.update(o,i,s)}}}function Aa(e,t,n){var r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var u=a||t.has("WEBGL_draw_buffers"),l=!0===n.logarithmicDepthBuffer,c=e.getParameter(34930),h=e.getParameter(35660),f=e.getParameter(3379),d=e.getParameter(34076),p=e.getParameter(34921),v=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),y=h>0,x=a||t.has("OES_texture_float");return{isWebGL2:a,drawBuffers:u,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:v,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:a?e.getParameter(36183):0}}function Ca(e){var t=this,n=null,r=0,i=!1,a=!1,o=new va,s=new Nn,u={value:null,needsUpdate:!1};function l(){u.value!==n&&(u.value=n,u.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(e,n,r,i){var a=null!==e?e.length:0,l=null;if(0!==a){if(l=u.value,!0!==i||null===l){var c=r+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===l||l.length<c)&&(l=new Float32Array(c));for(var f=0,d=r;f!==a;++f,d+=4)o.copy(e[f]).applyMatrix4(h,s),o.normal.toArray(l,d),l[d+3]=o.constant}u.value=l,u.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,l}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){var o=0!==e.length||t||0!==r||i;return i=t,n=c(e,a,0),r=e.length,o},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1,l()},this.setState=function(t,o,s){var h=t.clippingPlanes,f=t.clipIntersection,d=t.clipShadows,p=e.get(t);if(!i||null===h||0===h.length||a&&!d)a?c(null):l();else{var v=a?0:r,m=4*v,g=p.clippingState||null;u.value=g,g=c(h,o,m,s);for(var y=0;y!==m;++y)g[y]=n[y];p.clippingState=g,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=v}}}function Ia(e){var t=new WeakMap;function n(e,t){return t===ht?e.mapping=lt:t===ft&&(e.mapping=ct),e}function r(e){var n=e.target;n.removeEventListener("dispose",r);var i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){var a=i.mapping;if(a===ht||a===ft){if(t.has(i))return n(t.get(i).texture,i.mapping);var o=i.image;if(o&&o.height>0){var s=new ha(o.height/2);return s.fromEquirectangularTexture(e,i),t.set(i,s),i.addEventListener("dispose",r),n(s.texture,i.mapping)}return null}}return i},dispose:function(){t=new WeakMap}}}wa.physical={uniforms:ra([wa.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Pn(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Yn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Pn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Yn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Yn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ta.meshphysical_vert,fragmentShader:Ta.meshphysical_frag};var Ra=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return t(this,r),(e=n.call(this)).isOrthographicCamera=!0,e.type="OrthographicCamera",e.zoom=1,e.view=null,e.left=i,e.right=a,e.top=o,e.bottom=s,e.near=u,e.far=l,e.updateProjectionMatrix(),e}return a(r,[{key:"copy",value:function(e,t){return Pe(Oe(r.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var u=(this.right-this.left)/this.view.fullWidth/this.zoom,l=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(i+=u*this.view.offsetX)+u*this.view.width,s=(o-=l*this.view.offsetY)-l*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=Pe(Oe(r.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),r}(oa),La=[.125,.215,.35,.446,.526,.582],Pa=20,Na=new Ra,Oa=new Yn,Da=null,Fa=(1+Math.sqrt(5))/2,Ua=1/Fa,Ga=[new ar(1,1,1),new ar(-1,1,1),new ar(1,1,-1),new ar(-1,1,-1),new ar(0,Fa,Ua),new ar(0,Fa,-Ua),new ar(Ua,0,Fa),new ar(-Ua,0,Fa),new ar(Fa,Ua,0),new ar(-Fa,Ua,0)],za=function(){function e(n){t(this,e),this._renderer=n,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}return a(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;Da=this._renderer.getRenderTarget(),this._setSize(256);var i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}},{key:"fromEquirectangular",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"fromCubemap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"compileCubemapShader",value:function(){null===this._cubemapMaterial&&(this._cubemapMaterial=Ha(),this._compileMaterial(this._cubemapMaterial))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectMaterial&&(this._equirectMaterial=Wa(),this._compileMaterial(this._equirectMaterial))}},{key:"dispose",value:function(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}},{key:"_setSize",value:function(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}},{key:"_dispose",value:function(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}},{key:"_cleanup",value:function(e){this._renderer.setRenderTarget(Da),e.scissorTest=!1,Ba(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e,t){e.mapping===lt||e.mapping===ct?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Da=this._renderer.getRenderTarget();var n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:_t,minFilter:_t,generateMipmaps:!1,type:Et,format:At,encoding:cn,depthBuffer:!1},r=Va(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Va(e,t,n);var i=this._lodMax,a=function(e){for(var t=[],n=[],r=[],i=e,a=e-4+1+La.length,o=0;o<a;o++){var s=Math.pow(2,i);n.push(s);var u=1/s;o>e-4?u=La[o-e+4-1]:0===o&&(u=0),r.push(u);for(var l=1/(s-2),c=-l,h=1+l,f=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,v=3,m=2,g=1,y=new Float32Array(v*p*d),x=new Float32Array(m*p*d),_=new Float32Array(g*p*d),b=0;b<d;b++){var T=b%3*2/3-1,M=b>2?0:-1,w=[T,M,0,T+2/3,M,0,T+2/3,M+1,0,T,M,0,T+2/3,M+1,0,T,M+1,0];y.set(w,v*p*b),x.set(f,m*p*b);var S=[b,b,b,b,b,b];_.set(S,g*p*b)}var E=new Oi;E.setAttribute("position",new wi(y,v)),E.setAttribute("uv",new wi(x,m)),E.setAttribute("faceIndex",new wi(_,g)),t.push(E),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(i);this._sizeLods=a.sizeLods,this._lodPlanes=a.lodPlanes,this._sigmas=a.sigmas,this._blurMaterial=function(e,t,n){var r=new Float32Array(Pa),i=new ar(0,1,0);return new aa({name:"SphericalGaussianBlur",defines:{n:Pa,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(i,e,t)}return r}},{key:"_compileMaterial",value:function(e){var t=new $i(this._lodPlanes[0],e);this._renderer.compile(t,Na)}},{key:"_sceneToCubeUV",value:function(e,t,n,r){var i=new sa(90,1,t,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,l=s.toneMapping;s.getClearColor(Oa),s.toneMapping=0,s.autoClear=!1;var c=new bi({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),h=new $i(new ta,c),f=!1,d=e.background;d?d.isColor&&(c.color.copy(d),e.background=null,f=!0):(c.color.copy(Oa),f=!0);for(var p=0;p<6;p++){var v=p%3;0===v?(i.up.set(0,a[p],0),i.lookAt(o[p],0,0)):1===v?(i.up.set(0,0,a[p]),i.lookAt(0,o[p],0)):(i.up.set(0,a[p],0),i.lookAt(0,0,o[p]));var m=this._cubeSize;Ba(r,v*m,p>2?m:0,m,m),s.setRenderTarget(r),f&&s.render(h,i),s.render(e,i)}h.geometry.dispose(),h.material.dispose(),s.toneMapping=l,s.autoClear=u,e.background=d}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,r=e.mapping===lt||e.mapping===ct;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=Ha()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Wa());var i=r?this._cubemapMaterial:this._equirectMaterial,a=new $i(this._lodPlanes[0],i);i.uniforms.envMap.value=e;var o=this._cubeSize;Ba(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(a,Na)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var r=1;r<this._lodPlanes.length;r++){var i=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),a=Ga[(r-1)%Ga.length];this._blur(e,r-1,r,i,a)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,r,i){var a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,r,"latitudinal",i),this._halfBlur(a,e,n,n,r,"longitudinal",i)}},{key:"_halfBlur",value:function(e,t,n,r,i,a,o){var s=this._renderer,u=this._blurMaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var l=new $i(this._lodPlanes[r],u),c=u.uniforms,h=this._sizeLods[n]-1,f=isFinite(i)?Math.PI/(2*h):2*Math.PI/39,d=i/f,p=isFinite(i)?1+Math.floor(3*d):Pa;p>Pa&&console.warn("sigmaRadians, ".concat(i,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(Pa));for(var v=[],m=0,g=0;g<Pa;++g){var y=g/d,x=Math.exp(-y*y/2);v.push(x),0===g?m+=x:g<p&&(m+=2*x)}for(var _=0;_<v.length;_++)v[_]=v[_]/m;c.envMap.value=e.texture,c.samples.value=p,c.weights.value=v,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o);var b=this._lodMax;c.dTheta.value=f,c.mipInt.value=b-n;var T=this._sizeLods[r];Ba(t,3*T*(r>b-4?r-b+4:0),4*(this._cubeSize-T),3*T,2*T),s.setRenderTarget(t),s.render(l,Na)}}]),e}();function Va(e,t,n){var r=new tr(e,t,n);return r.texture.mapping=dt,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Ba(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Wa(){return new aa({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Ha(){return new aa({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function ja(e){var t=new WeakMap,n=null;function r(e){var n=e.target;n.removeEventListener("dispose",r);var i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){var a=i.mapping,o=a===ht||a===ft,s=a===lt||a===ct;if(o||s){if(i.isRenderTargetTexture&&!0===i.needsPMREMUpdate){i.needsPMREMUpdate=!1;var u=t.get(i);return null===n&&(n=new za(e)),u=o?n.fromEquirectangular(i,u):n.fromCubemap(i,u),t.set(i,u),u.texture}if(t.has(i))return t.get(i).texture;var l=i.image;if(o&&l&&l.height>0||s&&l&&function(e){for(var t=0,n=6,r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(l)){null===n&&(n=new za(e));var c=o?n.fromEquirectangular(i):n.fromCubemap(i);return t.set(i,c),i.addEventListener("dispose",r),c.texture}return null}}return i},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function qa(e){var t={};function n(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Xa(e,t,n,r){var i={},a=new WeakMap;function o(e){var s=e.target;for(var u in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[u]);s.removeEventListener("dispose",o),delete i[s.id];var l=a.get(s);l&&(t.remove(l),a.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],r=e.index,i=e.attributes.position,o=0;if(null!==r){var s=r.array;o=r.version;for(var u=0,l=s.length;u<l;u+=3){var c=s[u+0],h=s[u+1],f=s[u+2];n.push(c,h,h,f,f,c)}}else{var d=i.array;o=i.version;for(var p=0,v=d.length/3-1;p<v;p+=3){var m=p+0,g=p+1,y=p+2;n.push(m,g,g,y,y,m)}}var x=new(On(n)?Ei:Si)(n,1);x.version=o;var _=a.get(e);_&&t.remove(_),a.set(e,x)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,n.memory.geometries++),t},update:function(e){var n=e.attributes;for(var r in n)t.update(n[r],34962);var i=e.morphAttributes;for(var a in i)for(var o=i[a],s=0,u=o.length;s<u;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function Ya(e,t,n,r){var i,a,o,s=r.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(i,r,a,t*o),n.update(r,i,1)},this.renderInstances=function(r,u,l){if(0!==l){var c,h;if(s)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](i,u,a,r*o,l),n.update(u,i,l)}}}function Ka(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Za(e,t){return e[0]-t[0]}function Ja(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Qa(e,t,n){for(var r={},i=new Float32Array(8),a=new WeakMap,o=new er,s=[],u=0;u<8;u++)s[u]=[u,0];return{update:function(u,l,c,h){var f=u.morphTargetInfluences;if(!0===t.isWebGL2){var d=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,p=void 0!==d?d.length:0,v=a.get(l);if(void 0===v||v.count!==p){void 0!==v&&v.texture.dispose();var m=void 0!==l.morphAttributes.position,g=void 0!==l.morphAttributes.normal,y=void 0!==l.morphAttributes.color,x=l.morphAttributes.position||[],_=l.morphAttributes.normal||[],b=l.morphAttributes.color||[],T=0;!0===m&&(T=1),!0===g&&(T=2),!0===y&&(T=3);var M=l.attributes.position.count*T,w=1;M>t.maxTextureSize&&(w=Math.ceil(M/t.maxTextureSize),M=t.maxTextureSize);var S=new Float32Array(M*w*4*p),E=new nr(S,M,w,p);E.type=St,E.needsUpdate=!0;for(var k=4*T,A=0;A<p;A++)for(var C=x[A],I=_[A],R=b[A],L=M*w*4*A,P=0;P<C.count;P++){var N=P*k;!0===m&&(o.fromBufferAttribute(C,P),S[L+N+0]=o.x,S[L+N+1]=o.y,S[L+N+2]=o.z,S[L+N+3]=0),!0===g&&(o.fromBufferAttribute(I,P),S[L+N+4]=o.x,S[L+N+5]=o.y,S[L+N+6]=o.z,S[L+N+7]=0),!0===y&&(o.fromBufferAttribute(R,P),S[L+N+8]=o.x,S[L+N+9]=o.y,S[L+N+10]=o.z,S[L+N+11]=4===R.itemSize?o.w:1)}v={count:p,texture:E,size:new Pn(M,w)},a.set(l,v),l.addEventListener("dispose",(function e(){E.dispose(),a.delete(l),l.removeEventListener("dispose",e)}))}for(var O=0,D=0;D<f.length;D++)O+=f[D];var F=l.morphTargetsRelative?1:1-O;h.getUniforms().setValue(e,"morphTargetBaseInfluence",F),h.getUniforms().setValue(e,"morphTargetInfluences",f),h.getUniforms().setValue(e,"morphTargetsTexture",v.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",v.size)}else{var U=void 0===f?0:f.length,G=r[l.id];if(void 0===G||G.length!==U){G=[];for(var z=0;z<U;z++)G[z]=[z,0];r[l.id]=G}for(var V=0;V<U;V++){var B=G[V];B[0]=V,B[1]=f[V]}G.sort(Ja);for(var W=0;W<8;W++)W<U&&G[W][1]?(s[W][0]=G[W][0],s[W][1]=G[W][1]):(s[W][0]=Number.MAX_SAFE_INTEGER,s[W][1]=0);s.sort(Za);for(var H=l.morphAttributes.position,j=l.morphAttributes.normal,q=0,X=0;X<8;X++){var Y=s[X],K=Y[0],Z=Y[1];K!==Number.MAX_SAFE_INTEGER&&Z?(H&&l.getAttribute("morphTarget"+X)!==H[K]&&l.setAttribute("morphTarget"+X,H[K]),j&&l.getAttribute("morphNormal"+X)!==j[K]&&l.setAttribute("morphNormal"+X,j[K]),i[X]=Z,q+=Z):(H&&!0===l.hasAttribute("morphTarget"+X)&&l.deleteAttribute("morphTarget"+X),j&&!0===l.hasAttribute("morphNormal"+X)&&l.deleteAttribute("morphNormal"+X),i[X]=0)}var J=l.morphTargetsRelative?1:1-q;h.getUniforms().setValue(e,"morphTargetBaseInfluence",J),h.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function $a(e,t,n,r){var i=new WeakMap;function a(e){var t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var o=r.render.frame,s=e.geometry,u=t.get(e,s);return i.get(u)!==o&&(t.update(u),i.set(u,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),u},dispose:function(){i=new WeakMap}}}var eo=new $n,to=new nr,no=new rr,ro=new ca,io=[],ao=[],oo=new Float32Array(16),so=new Float32Array(9),uo=new Float32Array(4);function lo(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,a=io[i];if(void 0===a&&(a=new Float32Array(i),io[i]=a),0!==t){r.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function co(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function ho(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function fo(e,t){var n=ao[t];void 0===n&&(n=new Int32Array(t),ao[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function po(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function vo(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(co(n,t))return;e.uniform2fv(this.addr,t),ho(n,t)}}function mo(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(co(n,t))return;e.uniform3fv(this.addr,t),ho(n,t)}}function go(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(co(n,t))return;e.uniform4fv(this.addr,t),ho(n,t)}}function yo(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(co(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),ho(n,t)}else{if(co(n,r))return;uo.set(r),e.uniformMatrix2fv(this.addr,!1,uo),ho(n,r)}}function xo(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(co(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),ho(n,t)}else{if(co(n,r))return;so.set(r),e.uniformMatrix3fv(this.addr,!1,so),ho(n,r)}}function _o(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(co(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),ho(n,t)}else{if(co(n,r))return;oo.set(r),e.uniformMatrix4fv(this.addr,!1,oo),ho(n,r)}}function bo(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function To(e,t){var n=this.cache;co(n,t)||(e.uniform2iv(this.addr,t),ho(n,t))}function Mo(e,t){var n=this.cache;co(n,t)||(e.uniform3iv(this.addr,t),ho(n,t))}function wo(e,t){var n=this.cache;co(n,t)||(e.uniform4iv(this.addr,t),ho(n,t))}function So(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function Eo(e,t){var n=this.cache;co(n,t)||(e.uniform2uiv(this.addr,t),ho(n,t))}function ko(e,t){var n=this.cache;co(n,t)||(e.uniform3uiv(this.addr,t),ho(n,t))}function Ao(e,t){var n=this.cache;co(n,t)||(e.uniform4uiv(this.addr,t),ho(n,t))}function Co(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(t||eo,i)}function Io(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||no,i)}function Ro(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||ro,i)}function Lo(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||to,i)}function Po(e,t){e.uniform1fv(this.addr,t)}function No(e,t){var n=lo(t,this.size,2);e.uniform2fv(this.addr,n)}function Oo(e,t){var n=lo(t,this.size,3);e.uniform3fv(this.addr,n)}function Do(e,t){var n=lo(t,this.size,4);e.uniform4fv(this.addr,n)}function Fo(e,t){var n=lo(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Uo(e,t){var n=lo(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Go(e,t){var n=lo(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function zo(e,t){e.uniform1iv(this.addr,t)}function Vo(e,t){e.uniform2iv(this.addr,t)}function Bo(e,t){e.uniform3iv(this.addr,t)}function Wo(e,t){e.uniform4iv(this.addr,t)}function Ho(e,t){e.uniform1uiv(this.addr,t)}function jo(e,t){e.uniform2uiv(this.addr,t)}function qo(e,t){e.uniform3uiv(this.addr,t)}function Xo(e,t){e.uniform4uiv(this.addr,t)}function Yo(e,t,n){var r=this.cache,i=t.length,a=fo(n,i);co(r,a)||(e.uniform1iv(this.addr,a),ho(r,a));for(var o=0;o!==i;++o)n.setTexture2D(t[o]||eo,a[o])}function Ko(e,t,n){var r=this.cache,i=t.length,a=fo(n,i);co(r,a)||(e.uniform1iv(this.addr,a),ho(r,a));for(var o=0;o!==i;++o)n.setTexture3D(t[o]||no,a[o])}function Zo(e,t,n){var r=this.cache,i=t.length,a=fo(n,i);co(r,a)||(e.uniform1iv(this.addr,a),ho(r,a));for(var o=0;o!==i;++o)n.setTextureCube(t[o]||ro,a[o])}function Jo(e,t,n){var r=this.cache,i=t.length,a=fo(n,i);co(r,a)||(e.uniform1iv(this.addr,a),ho(r,a));for(var o=0;o!==i;++o)n.setTexture2DArray(t[o]||to,a[o])}var Qo=a((function e(n,r,i){t(this,e),this.id=n,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return po;case 35664:return vo;case 35665:return mo;case 35666:return go;case 35674:return yo;case 35675:return xo;case 35676:return _o;case 5124:case 35670:return bo;case 35667:case 35671:return To;case 35668:case 35672:return Mo;case 35669:case 35673:return wo;case 5125:return So;case 36294:return Eo;case 36295:return ko;case 36296:return Ao;case 35678:case 36198:case 36298:case 36306:case 35682:return Co;case 35679:case 36299:case 36307:return Io;case 35680:case 36300:case 36308:case 36293:return Ro;case 36289:case 36303:case 36311:case 36292:return Lo}}(r.type)})),$o=a((function e(n,r,i){t(this,e),this.id=n,this.addr=i,this.cache=[],this.size=r.size,this.setValue=function(e){switch(e){case 5126:return Po;case 35664:return No;case 35665:return Oo;case 35666:return Do;case 35674:return Fo;case 35675:return Uo;case 35676:return Go;case 5124:case 35670:return zo;case 35667:case 35671:return Vo;case 35668:case 35672:return Bo;case 35669:case 35673:return Wo;case 5125:return Ho;case 36294:return jo;case 36295:return qo;case 36296:return Xo;case 35678:case 36198:case 36298:case 36306:case 35682:return Yo;case 35679:case 36299:case 36307:return Ko;case 35680:case 36300:case 36308:case 36293:return Zo;case 36289:case 36303:case 36311:case 36292:return Jo}}(r.type)})),es=function(){function e(n){t(this,e),this.id=n,this.seq=[],this.map={}}return a(e,[{key:"setValue",value:function(e,t,n){for(var r=this.seq,i=0,a=r.length;i!==a;++i){var o=r[i];o.setValue(e,t[o.id],n)}}}]),e}(),ts=/(\w+)(\])?(\[|\.)?/g;function ns(e,t){e.seq.push(t),e.map[t.id]=t}function rs(e,t,n){var r=e.name,i=r.length;for(ts.lastIndex=0;;){var a=ts.exec(r),o=ts.lastIndex,s=a[1],u="]"===a[2],l=a[3];if(u&&(s|=0),void 0===l||"["===l&&o+2===i){ns(n,void 0===l?new Qo(s,e,t):new $o(s,e,t));break}var c=n.map[s];void 0===c&&ns(n,c=new es(s)),n=c}}var is=function(){function e(n,r){t(this,e),this.seq=[],this.map={};for(var i=n.getProgramParameter(r,35718),a=0;a<i;++a){var o=n.getActiveUniform(r,a);rs(o,n.getUniformLocation(r,o.name),this)}}return a(e,[{key:"setValue",value:function(e,t,n,r){var i=this.map[t];void 0!==i&&i.setValue(e,n,r)}},{key:"setOptional",value:function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)}}],[{key:"upload",value:function(e,t,n,r){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}}},{key:"seqWithValue",value:function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var a=e[r];a.id in t&&n.push(a)}return n}}]),e}();function as(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}var os=0;function ss(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();if(r&&""===i)return"";var a=/ERROR: 0:(\d+)/.exec(i);if(a){var o=parseInt(a[1]);return n.toUpperCase()+"\n\n"+i+"\n\n"+function(e,t){for(var n=e.split("\n"),r=[],i=Math.max(t-6,0),a=Math.min(t+6,n.length),o=i;o<a;o++){var s=o+1;r.push("".concat(s===t?">":" "," ").concat(s,": ").concat(n[o]))}return r.join("\n")}(e.getShaderSource(t),o)}return i}function us(e,t){var n=function(e){switch(e){case cn:return["Linear","( value )"];case hn:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function ls(e,t){var n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function cs(e){return""!==e}function hs(e,t){var n=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function fs(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var ds=/^[ \t]*#include +<([\w\d./]+)>/gm;function ps(e){return e.replace(ds,vs)}function vs(e,t){var n=Ta[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return ps(n)}var ms=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function gs(e){return e.replace(ms,ys)}function ys(e,t,n,r){for(var i="",a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function xs(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function _s(e,t,n,r){var i,a,o=e.getContext(),s=n.defines,u=n.vertexShader,l=n.fragmentShader,c=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case lt:case ct:t="ENVMAP_TYPE_CUBE";break;case dt:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),f=function(e){var t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===ct&&(t="ENVMAP_MODE_REFRACTION");return t}(n),d=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),p=function(e){var t=e.envMapCubeUVHeight;if(null===t)return null;var n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),v=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(cs).join("\n")}(n),m=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),g=o.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((i=[m].filter(cs).join("\n")).length>0&&(i+="\n"),(a=[v,m].filter(cs).join("\n")).length>0&&(a+="\n")):(i=[xs(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(cs).join("\n"),a=[v,xs(n),"#define SHADER_NAME "+n.shaderName,m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+f:"",n.envMap?"#define "+d:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Ta.tonemapping_pars_fragment:"",0!==n.toneMapping?ls("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Ta.encodings_pars_fragment,us("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(cs).join("\n")),u=fs(u=hs(u=ps(u),n),n),l=fs(l=hs(l=ps(l),n),n),u=gs(u),l=gs(l),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",i=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,a=["#define varying in",n.glslVersion===mn?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===mn?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var x,_,b=y+a+l,T=as(o,35633,y+i+u),M=as(o,35632,b);if(o.attachShader(g,T),o.attachShader(g,M),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),e.debug.checkShaderErrors){var w=o.getProgramInfoLog(g).trim(),S=o.getShaderInfoLog(T).trim(),E=o.getShaderInfoLog(M).trim(),k=!0,A=!0;if(!1===o.getProgramParameter(g,35714)){k=!1;var C=ss(o,T,"vertex"),I=ss(o,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(g,35715)+"\n\nProgram Info Log: "+w+"\n"+C+"\n"+I)}else""!==w?console.warn("THREE.WebGLProgram: Program Info Log:",w):""!==S&&""!==E||(A=!1);A&&(this.diagnostics={runnable:k,programLog:w,vertexShader:{log:S,prefix:i},fragmentShader:{log:E,prefix:a}})}return o.deleteShader(T),o.deleteShader(M),this.getUniforms=function(){return void 0===x&&(x=new is(o,g)),x},this.getAttributes=function(){return void 0===_&&(_=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var a=e.getActiveAttrib(t,i),o=a.name,s=1;35674===a.type&&(s=2),35675===a.type&&(s=3),35676===a.type&&(s=4),n[o]={type:a.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,g)),_},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=os++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=T,this.fragmentShader=M,this}var bs=0,Ts=function(){function e(){t(this,e),this.shaderCache=new Map,this.materialCache=new Map}return a(e,[{key:"update",value:function(e){var t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return!1===a.has(r)&&(a.add(r),r.usedTimes++),!1===a.has(i)&&(a.add(i),i.usedTimes++),this}},{key:"remove",value:function(e){var t,n=this.materialCache.get(e),r=f(n);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code)}}catch(e){r.e(e)}finally{r.f()}return this.materialCache.delete(e),this}},{key:"getVertexShaderID",value:function(e){return this._getShaderStage(e.vertexShader).id}},{key:"getFragmentShaderID",value:function(e){return this._getShaderStage(e.fragmentShader).id}},{key:"dispose",value:function(){this.shaderCache.clear(),this.materialCache.clear()}},{key:"_getShaderCacheForMaterial",value:function(e){var t=this.materialCache,n=t.get(e);return void 0===n&&(n=new Set,t.set(e,n)),n}},{key:"_getShaderStage",value:function(e){var t=this.shaderCache,n=t.get(e);return void 0===n&&(n=new Ms(e),t.set(e,n)),n}}]),e}(),Ms=a((function e(n){t(this,e),this.id=bs++,this.code=n,this.usedTimes=0}));function ws(e,t,n,r,i,a,o){var s=new Xr,u=new Ts,l=[],c=i.isWebGL2,h=i.logarithmicDepthBuffer,f=i.vertexTextures,d=i.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(a,s,l,v,m){var g=v.fog,y=m.geometry,x=a.isMeshStandardMaterial?v.environment:null,_=(a.isMeshStandardMaterial?n:t).get(a.envMap||x),b=_&&_.mapping===dt?_.image.height:null,T=p[a.type];null!==a.precision&&(d=i.getMaxPrecision(a.precision))!==a.precision&&console.warn("THREE.WebGLProgram.getParameters:",a.precision,"not supported, using",d,"instead.");var M,w,S,E,k=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,A=void 0!==k?k.length:0,C=0;if(void 0!==y.morphAttributes.position&&(C=1),void 0!==y.morphAttributes.normal&&(C=2),void 0!==y.morphAttributes.color&&(C=3),T){var I=wa[T];M=I.vertexShader,w=I.fragmentShader}else M=a.vertexShader,w=a.fragmentShader,u.update(a),S=u.getVertexShaderID(a),E=u.getFragmentShaderID(a);var R=e.getRenderTarget(),L=a.alphaTest>0,P=a.clearcoat>0,N=a.iridescence>0;return{isWebGL2:c,shaderID:T,shaderName:a.type,vertexShader:M,fragmentShader:w,defines:a.defines,customVertexShaderID:S,customFragmentShaderID:E,isRawShaderMaterial:!0===a.isRawShaderMaterial,glslVersion:a.glslVersion,precision:d,instancing:!0===m.isInstancedMesh,instancingColor:!0===m.isInstancedMesh&&null!==m.instanceColor,supportsVertexTextures:f,outputEncoding:null===R?e.outputEncoding:!0===R.isXRRenderTarget?R.texture.encoding:cn,map:!!a.map,matcap:!!a.matcap,envMap:!!_,envMapMode:_&&_.mapping,envMapCubeUVHeight:b,lightMap:!!a.lightMap,aoMap:!!a.aoMap,emissiveMap:!!a.emissiveMap,bumpMap:!!a.bumpMap,normalMap:!!a.normalMap,objectSpaceNormalMap:1===a.normalMapType,tangentSpaceNormalMap:0===a.normalMapType,decodeVideoTexture:!!a.map&&!0===a.map.isVideoTexture&&a.map.encoding===hn,clearcoat:P,clearcoatMap:P&&!!a.clearcoatMap,clearcoatRoughnessMap:P&&!!a.clearcoatRoughnessMap,clearcoatNormalMap:P&&!!a.clearcoatNormalMap,iridescence:N,iridescenceMap:N&&!!a.iridescenceMap,iridescenceThicknessMap:N&&!!a.iridescenceThicknessMap,displacementMap:!!a.displacementMap,roughnessMap:!!a.roughnessMap,metalnessMap:!!a.metalnessMap,specularMap:!!a.specularMap,specularIntensityMap:!!a.specularIntensityMap,specularColorMap:!!a.specularColorMap,opaque:!1===a.transparent&&1===a.blending,alphaMap:!!a.alphaMap,alphaTest:L,gradientMap:!!a.gradientMap,sheen:a.sheen>0,sheenColorMap:!!a.sheenColorMap,sheenRoughnessMap:!!a.sheenRoughnessMap,transmission:a.transmission>0,transmissionMap:!!a.transmissionMap,thicknessMap:!!a.thicknessMap,combine:a.combine,vertexTangents:!!a.normalMap&&!!y.attributes.tangent,vertexColors:a.vertexColors,vertexAlphas:!0===a.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUvs:!!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatMap||a.clearcoatRoughnessMap||a.clearcoatNormalMap||a.iridescenceMap||a.iridescenceThicknessMap||a.displacementMap||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||a.sheenColorMap||a.sheenRoughnessMap),uvsVertexOnly:!(a.map||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a.emissiveMap||a.roughnessMap||a.metalnessMap||a.clearcoatNormalMap||a.iridescenceMap||a.iridescenceThicknessMap||a.transmission>0||a.transmissionMap||a.thicknessMap||a.specularIntensityMap||a.specularColorMap||a.sheen>0||a.sheenColorMap||a.sheenRoughnessMap||!a.displacementMap),fog:!!g,useFog:!0===a.fog,fogExp2:g&&g.isFogExp2,flatShading:!!a.flatShading,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===m.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:A,morphTextureStride:C,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numSpotLightMaps:s.spotLightMap.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numSpotLightShadowsWithMaps:s.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:a.dithering,shadowMapEnabled:e.shadowMap.enabled&&l.length>0,shadowMapType:e.shadowMap.type,toneMapping:a.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:a.premultipliedAlpha,doubleSided:2===a.side,flipSided:1===a.side,useDepthPacking:!!a.depthPacking,depthPacking:a.depthPacking||0,index0AttributeName:a.index0AttributeName,extensionDerivatives:a.extensions&&a.extensions.derivatives,extensionFragDepth:a.extensions&&a.extensions.fragDepth,extensionDrawBuffers:a.extensions&&a.extensions.drawBuffers,extensionShaderTextureLOD:a.extensions&&a.extensions.shaderTextureLOD,rendererExtensionFragDepth:c||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||r.has("EXT_shader_texture_lod"),customProgramCacheKey:a.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numSpotLightMaps),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.numSpotLightShadowsWithMaps),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.map&&s.enable(4);t.matcap&&s.enable(5);t.envMap&&s.enable(6);t.lightMap&&s.enable(7);t.aoMap&&s.enable(8);t.emissiveMap&&s.enable(9);t.bumpMap&&s.enable(10);t.normalMap&&s.enable(11);t.objectSpaceNormalMap&&s.enable(12);t.tangentSpaceNormalMap&&s.enable(13);t.clearcoat&&s.enable(14);t.clearcoatMap&&s.enable(15);t.clearcoatRoughnessMap&&s.enable(16);t.clearcoatNormalMap&&s.enable(17);t.iridescence&&s.enable(18);t.iridescenceMap&&s.enable(19);t.iridescenceThicknessMap&&s.enable(20);t.displacementMap&&s.enable(21);t.specularMap&&s.enable(22);t.roughnessMap&&s.enable(23);t.metalnessMap&&s.enable(24);t.gradientMap&&s.enable(25);t.alphaMap&&s.enable(26);t.alphaTest&&s.enable(27);t.vertexColors&&s.enable(28);t.vertexAlphas&&s.enable(29);t.vertexUvs&&s.enable(30);t.vertexTangents&&s.enable(31);t.uvsVertexOnly&&s.enable(32);e.push(s.mask),s.disableAll(),t.fog&&s.enable(0);t.useFog&&s.enable(1);t.flatShading&&s.enable(2);t.logarithmicDepthBuffer&&s.enable(3);t.skinning&&s.enable(4);t.morphTargets&&s.enable(5);t.morphNormals&&s.enable(6);t.morphColors&&s.enable(7);t.premultipliedAlpha&&s.enable(8);t.shadowMapEnabled&&s.enable(9);t.physicallyCorrectLights&&s.enable(10);t.doubleSided&&s.enable(11);t.flipSided&&s.enable(12);t.useDepthPacking&&s.enable(13);t.dithering&&s.enable(14);t.specularIntensityMap&&s.enable(15);t.specularColorMap&&s.enable(16);t.transmission&&s.enable(17);t.transmissionMap&&s.enable(18);t.thicknessMap&&s.enable(19);t.sheen&&s.enable(20);t.sheenColorMap&&s.enable(21);t.sheenRoughnessMap&&s.enable(22);t.decodeVideoTexture&&s.enable(23);t.opaque&&s.enable(24);e.push(s.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=p[e.type];if(n){var r=wa[n];t=ia.clone(r.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var r,i=0,o=l.length;i<o;i++){var s=l[i];if(s.cacheKey===n){++(r=s).usedTimes;break}}return void 0===r&&(r=new _s(e,n,t,a),l.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){var t=l.indexOf(e);l[t]=l[l.length-1],l.pop(),e.destroy()}},releaseShaderCache:function(e){u.remove(e)},programs:l,dispose:function(){u.dispose()}}}function Ss(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Es(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ks(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function As(){var e=[],t=0,n=[],r=[],i=[];function a(n,r,i,a,o,s){var u=e[t];return void 0===u?(u={id:n.id,object:n,geometry:r,material:i,groupOrder:a,renderOrder:n.renderOrder,z:o,group:s},e[t]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=i,u.groupOrder=a,u.renderOrder=n.renderOrder,u.z=o,u.group=s),t++,u}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,o,s,u,l){var c=a(e,t,o,s,u,l);o.transmission>0?r.push(c):!0===o.transparent?i.push(c):n.push(c)},unshift:function(e,t,o,s,u,l){var c=a(e,t,o,s,u,l);o.transmission>0?r.unshift(c):!0===o.transparent?i.unshift(c):n.unshift(c)},finish:function(){for(var n=t,r=e.length;n<r;n++){var i=e[n];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Es),r.length>1&&r.sort(t||ks),i.length>1&&i.sort(t||ks)}}}function Cs(){var e=new WeakMap;return{get:function(t,n){var r,i=e.get(t);return void 0===i?(r=new As,e.set(t,[r])):n>=i.length?(r=new As,i.push(r)):r=i[n],r},dispose:function(){e=new WeakMap}}}function Is(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new ar,color:new Yn};break;case"SpotLight":n={position:new ar,direction:new ar,color:new Yn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new ar,color:new Yn,distance:0,decay:0};break;case"HemisphereLight":n={direction:new ar,skyColor:new Yn,groundColor:new Yn};break;case"RectAreaLight":n={color:new Yn,position:new ar,halfWidth:new ar,halfHeight:new ar}}return e[t.id]=n,n}}}var Rs=0;function Ls(e,t){return(t.castShadow?2:0)-(e.castShadow?2:0)+(t.map?1:0)-(e.map?1:0)}function Ps(e,t){for(var n,r=new Is,i=(n={},{get:function(e){if(void 0!==n[e.id])return n[e.id];var t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pn};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pn,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0},o=0;o<9;o++)a.probe.push(new ar);var s=new ar,u=new Dr,l=new Dr;return{setup:function(n,o){for(var s=0,u=0,l=0,c=0;c<9;c++)a.probe[c].set(0,0,0);var h=0,f=0,d=0,p=0,v=0,m=0,g=0,y=0,x=0,_=0;n.sort(Ls);for(var b=!0!==o?Math.PI:1,T=0,M=n.length;T<M;T++){var w=n[T],S=w.color,E=w.intensity,k=w.distance,A=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)s+=S.r*E*b,u+=S.g*E*b,l+=S.b*E*b;else if(w.isLightProbe)for(var C=0;C<9;C++)a.probe[C].addScaledVector(w.sh.coefficients[C],E);else if(w.isDirectionalLight){var I=r.get(w);if(I.color.copy(w.color).multiplyScalar(w.intensity*b),w.castShadow){var R=w.shadow,L=i.get(w);L.shadowBias=R.bias,L.shadowNormalBias=R.normalBias,L.shadowRadius=R.radius,L.shadowMapSize=R.mapSize,a.directionalShadow[h]=L,a.directionalShadowMap[h]=A,a.directionalShadowMatrix[h]=w.shadow.matrix,m++}a.directional[h]=I,h++}else if(w.isSpotLight){var P=r.get(w);P.position.setFromMatrixPosition(w.matrixWorld),P.color.copy(S).multiplyScalar(E*b),P.distance=k,P.coneCos=Math.cos(w.angle),P.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),P.decay=w.decay,a.spot[d]=P;var N=w.shadow;if(w.map&&(a.spotLightMap[x]=w.map,x++,N.updateMatrices(w),w.castShadow&&_++),a.spotLightMatrix[d]=N.matrix,w.castShadow){var O=i.get(w);O.shadowBias=N.bias,O.shadowNormalBias=N.normalBias,O.shadowRadius=N.radius,O.shadowMapSize=N.mapSize,a.spotShadow[d]=O,a.spotShadowMap[d]=A,y++}d++}else if(w.isRectAreaLight){var D=r.get(w);D.color.copy(S).multiplyScalar(E),D.halfWidth.set(.5*w.width,0,0),D.halfHeight.set(0,.5*w.height,0),a.rectArea[p]=D,p++}else if(w.isPointLight){var F=r.get(w);if(F.color.copy(w.color).multiplyScalar(w.intensity*b),F.distance=w.distance,F.decay=w.decay,w.castShadow){var U=w.shadow,G=i.get(w);G.shadowBias=U.bias,G.shadowNormalBias=U.normalBias,G.shadowRadius=U.radius,G.shadowMapSize=U.mapSize,G.shadowCameraNear=U.camera.near,G.shadowCameraFar=U.camera.far,a.pointShadow[f]=G,a.pointShadowMap[f]=A,a.pointShadowMatrix[f]=w.shadow.matrix,g++}a.point[f]=F,f++}else if(w.isHemisphereLight){var z=r.get(w);z.skyColor.copy(w.color).multiplyScalar(E*b),z.groundColor.copy(w.groundColor).multiplyScalar(E*b),a.hemi[v]=z,v++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(a.rectAreaLTC1=Ma.LTC_FLOAT_1,a.rectAreaLTC2=Ma.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(a.rectAreaLTC1=Ma.LTC_HALF_1,a.rectAreaLTC2=Ma.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=s,a.ambient[1]=u,a.ambient[2]=l;var V=a.hash;V.directionalLength===h&&V.pointLength===f&&V.spotLength===d&&V.rectAreaLength===p&&V.hemiLength===v&&V.numDirectionalShadows===m&&V.numPointShadows===g&&V.numSpotShadows===y&&V.numSpotMaps===x||(a.directional.length=h,a.spot.length=d,a.rectArea.length=p,a.point.length=f,a.hemi.length=v,a.directionalShadow.length=m,a.directionalShadowMap.length=m,a.pointShadow.length=g,a.pointShadowMap.length=g,a.spotShadow.length=y,a.spotShadowMap.length=y,a.directionalShadowMatrix.length=m,a.pointShadowMatrix.length=g,a.spotLightMatrix.length=y+x-_,a.spotLightMap.length=x,a.numSpotLightShadowsWithMaps=_,V.directionalLength=h,V.pointLength=f,V.spotLength=d,V.rectAreaLength=p,V.hemiLength=v,V.numDirectionalShadows=m,V.numPointShadows=g,V.numSpotShadows=y,V.numSpotMaps=x,a.version=Rs++)},setupView:function(e,t){for(var n=0,r=0,i=0,o=0,c=0,h=t.matrixWorldInverse,f=0,d=e.length;f<d;f++){var p=e[f];if(p.isDirectionalLight){var v=a.directional[n];v.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),v.direction.sub(s),v.direction.transformDirection(h),n++}else if(p.isSpotLight){var m=a.spot[i];m.position.setFromMatrixPosition(p.matrixWorld),m.position.applyMatrix4(h),m.direction.setFromMatrixPosition(p.matrixWorld),s.setFromMatrixPosition(p.target.matrixWorld),m.direction.sub(s),m.direction.transformDirection(h),i++}else if(p.isRectAreaLight){var g=a.rectArea[o];g.position.setFromMatrixPosition(p.matrixWorld),g.position.applyMatrix4(h),l.identity(),u.copy(p.matrixWorld),u.premultiply(h),l.extractRotation(u),g.halfWidth.set(.5*p.width,0,0),g.halfHeight.set(0,.5*p.height,0),g.halfWidth.applyMatrix4(l),g.halfHeight.applyMatrix4(l),o++}else if(p.isPointLight){var y=a.point[r];y.position.setFromMatrixPosition(p.matrixWorld),y.position.applyMatrix4(h),r++}else if(p.isHemisphereLight){var x=a.hemi[c];x.direction.setFromMatrixPosition(p.matrixWorld),x.direction.transformDirection(h),c++}}},state:a}}function Ns(e,t){var n=new Ps(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Os(e,t){var n=new WeakMap;return{get:function(r){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=n.get(r);return void 0===o?(i=new Ns(e,t),n.set(r,[i])):a>=o.length?(i=new Ns(e,t),o.push(i)):i=o[a],i},dispose:function(){n=new WeakMap}}}var Ds=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this)).isMeshDepthMaterial=!0,i.type="MeshDepthMaterial",i.depthPacking=3200,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.wireframe=!1,i.wireframeLinewidth=1,i.setValues(e),i}return a(r,[{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),r}(_i),Fs=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this)).isMeshDistanceMaterial=!0,i.type="MeshDistanceMaterial",i.referencePosition=new ar,i.nearDistance=1,i.farDistance=1e3,i.map=null,i.alphaMap=null,i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.setValues(e),i}return a(r,[{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),r}(_i);function Us(e,t,n){var r=new ya,i=new Pn,a=new Pn,o=new er,s=new Ds({depthPacking:3201}),u=new Fs,l={},c=n.maxTextureSize,h={0:1,1:0,2:2},f=new aa({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Pn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=f.clone();d.defines.HORIZONTAL_PASS=1;var p=new Oi;p.setAttribute("position",new wi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new $i(p,f),m=this;function g(n,r){var a=t.update(v);f.defines.VSM_SAMPLES!==n.blurSamples&&(f.defines.VSM_SAMPLES=n.blurSamples,d.defines.VSM_SAMPLES=n.blurSamples,f.needsUpdate=!0,d.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new tr(i.x,i.y)),f.uniforms.shadow_pass.value=n.map.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,a,f,v,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,a,d,v,null)}function y(t,n,r,i,a,o){var c=null,f=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(c=void 0!==f?f:!0===r.isPointLight?u:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){var d=c.uuid,p=n.uuid,v=l[d];void 0===v&&(v={},l[d]=v);var m=v[p];void 0===m&&(m=c.clone(),v[p]=m),c=m}return c.visible=n.visible,c.wireframe=n.wireframe,c.side=3===o?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],c.alphaMap=n.alphaMap,c.alphaTest=n.alphaTest,c.clipShadows=n.clipShadows,c.clippingPlanes=n.clippingPlanes,c.clipIntersection=n.clipIntersection,c.displacementMap=n.displacementMap,c.displacementScale=n.displacementScale,c.displacementBias=n.displacementBias,c.wireframeLinewidth=n.wireframeLinewidth,c.linewidth=n.linewidth,!0===r.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(r.matrixWorld),c.nearDistance=i,c.farDistance=a),c}function x(n,i,a,o,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var u=t.update(n),l=n.material;if(Array.isArray(l))for(var c=u.groups,h=0,f=c.length;h<f;h++){var d=c[h],p=l[d.materialIndex];if(p&&p.visible){var v=y(n,p,o,a.near,a.far,s);e.renderBufferDirect(a,null,u,v,n,d)}}else if(l.visible){var m=y(n,l,o,a.near,a.far,s);e.renderBufferDirect(a,null,u,m,n,null)}}for(var g=n.children,_=0,b=g.length;_<b;_++)x(g[_],i,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,s){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),l=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),f=e.state;f.setBlending(0),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var d=0,p=t.length;d<p;d++){var v=t[d],y=v.shadow;if(void 0!==y){if(!1!==y.autoUpdate||!1!==y.needsUpdate){i.copy(y.mapSize);var _=y.getFrameExtents();if(i.multiply(_),a.copy(y.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(a.x=Math.floor(c/_.x),i.x=a.x*_.x,y.mapSize.x=a.x),i.y>c&&(a.y=Math.floor(c/_.y),i.y=a.y*_.y,y.mapSize.y=a.y)),null===y.map){var b=3!==this.type?{minFilter:gt,magFilter:gt}:{};y.map=new tr(i.x,i.y,b),y.map.texture.name=v.name+".shadowMap",y.camera.updateProjectionMatrix()}e.setRenderTarget(y.map),e.clear();for(var T=y.getViewportCount(),M=0;M<T;M++){var w=y.getViewport(M);o.set(a.x*w.x,a.y*w.y,a.x*w.z,a.y*w.w),f.viewport(o),y.updateMatrices(v,M),r=y.getFrustum(),x(n,s,y.camera,v,this.type)}!0!==y.isPointLightShadow&&3===this.type&&g(y,s),y.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}m.needsUpdate=!1,e.setRenderTarget(u,l,h)}}}function Gs(e,t,n){var r,i,a=n.isWebGL2;var o=new function(){var t=!1,n=new er,r=null,i=new er(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){e?B(2929):W(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},u=new function(){var t=!1,n=null,r=null,i=null,a=null,o=null,s=null,u=null,l=null;return{setTest:function(e){t||(e?B(2960):W(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&u===r||(e.stencilOp(t,n,r),o=t,s=n,u=r)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,u=null,l=null}}},l=new WeakMap,c=new WeakMap,h={},f={},d=new WeakMap,p=[],v=null,m=!1,g=null,y=null,x=null,_=null,b=null,T=null,M=null,w=!1,S=null,E=null,k=null,A=null,C=null,I=e.getParameter(35661),R=!1,L=0,P=e.getParameter(7938);-1!==P.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(P)[1]),R=L>=1):-1!==P.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),R=L>=2);var N=null,O={},D=e.getParameter(3088),F=e.getParameter(2978),U=(new er).fromArray(D),G=(new er).fromArray(F);function z(t,n,r){var i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<r;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,i);return a}var V={};function B(t){!0!==h[t]&&(e.enable(t),h[t]=!0)}function W(t){!1!==h[t]&&(e.disable(t),h[t]=!1)}V[3553]=z(3553,3553,1),V[34067]=z(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),u.setClear(0),B(2929),s.setFunc(3),Y(!1),K(1),B(2884),X(0);var H=(at(r={},ut,32774),at(r,101,32778),at(r,102,32779),r);if(a)H[103]=32775,H[104]=32776;else{var j=t.get("EXT_blend_minmax");null!==j&&(H[103]=j.MIN_EXT,H[104]=j.MAX_EXT)}var q=(at(i={},200,0),at(i,201,1),at(i,202,768),at(i,204,770),at(i,210,776),at(i,208,774),at(i,206,772),at(i,203,769),at(i,205,771),at(i,209,775),at(i,207,773),i);function X(t,n,r,i,a,o,s,u){if(0!==t){if(!1===m&&(B(3042),m=!0),5===t)a=a||n,o=o||r,s=s||i,n===y&&a===b||(e.blendEquationSeparate(H[n],H[a]),y=n,b=a),r===x&&i===_&&o===T&&s===M||(e.blendFuncSeparate(q[r],q[i],q[o],q[s]),x=r,_=i,T=o,M=s),g=t,w=null;else if(t!==g||u!==w){if(y===ut&&b===ut||(e.blendEquation(32774),y=ut,b=ut),u)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}x=null,_=null,T=null,M=null,g=t,w=u}}else!0===m&&(W(3042),m=!1)}function Y(t){S!==t&&(t?e.frontFace(2304):e.frontFace(2305),S=t)}function K(t){0!==t?(B(2884),t!==E&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):W(2884),E=t}function Z(t,n,r){t?(B(32823),A===n&&C===r||(e.polygonOffset(n,r),A=n,C=r)):W(32823)}return{buffers:{color:o,depth:s,stencil:u},enable:B,disable:W,bindFramebuffer:function(t,n){return f[t]!==n&&(e.bindFramebuffer(t,n),f[t]=n,a&&(36009===t&&(f[36160]=n),36160===t&&(f[36009]=n)),!0)},drawBuffers:function(r,i){var a=p,o=!1;if(r)if(void 0===(a=d.get(i))&&(a=[],d.set(i,a)),r.isWebGLMultipleRenderTargets){var s=r.texture;if(a.length!==s.length||36064!==a[0]){for(var u=0,l=s.length;u<l;u++)a[u]=36064+u;a.length=s.length,o=!0}}else 36064!==a[0]&&(a[0]=36064,o=!0);else 1029!==a[0]&&(a[0]=1029,o=!0);o&&(n.isWebGL2?e.drawBuffers(a):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(a))},useProgram:function(t){return v!==t&&(e.useProgram(t),v=t,!0)},setBlending:X,setMaterial:function(e,t){2===e.side?W(2884):B(2884);var n=1===e.side;t&&(n=!n),Y(n),1===e.blending&&!1===e.transparent?X(0):X(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),o.setMask(e.colorWrite);var r=e.stencilWrite;u.setTest(r),r&&(u.setMask(e.stencilWriteMask),u.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),u.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Z(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?B(32926):W(32926)},setFlipSided:Y,setCullFace:K,setLineWidth:function(t){t!==k&&(R&&e.lineWidth(t),k=t)},setPolygonOffset:Z,setScissorTest:function(e){e?B(3089):W(3089)},activeTexture:function(t){void 0===t&&(t=33984+I-1),N!==t&&(e.activeTexture(t),N=t)},bindTexture:function(t,n,r){void 0===r&&(r=null===N?33984+I-1:N);var i=O[r];void 0===i&&(i={type:void 0,texture:void 0},O[r]=i),i.type===t&&i.texture===n||(N!==r&&(e.activeTexture(r),N=r),e.bindTexture(t,n||V[t]),i.type=t,i.texture=n)},unbindTexture:function(){var t=O[N];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},updateUBOMapping:function(t,n){var r=c.get(n);void 0===r&&(r=new WeakMap,c.set(n,r));var i=r.get(t);void 0===i&&(i=e.getUniformBlockIndex(n,t.name),r.set(t,i))},uniformBlockBinding:function(t,n){var r=c.get(n).get(t);l.get(t)!==r&&(e.uniformBlockBinding(n,r,t.__bindingPointIndex),l.set(t,r))},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===U.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),U.copy(t))},viewport:function(t){!1===G.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),G.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===a&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),h={},N=null,O={},f={},d=new WeakMap,p=[],v=null,m=!1,g=null,y=null,x=null,_=null,b=null,T=null,M=null,w=!1,S=null,E=null,k=null,A=null,C=null,U.set(0,0,e.canvas.width,e.canvas.height),G.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),u.reset()}}}function zs(e,t,n,r,i,a,o){var s,u,l,c=i.isWebGL2,h=i.maxTextures,f=i.maxCubemapSize,d=i.maxTextureSize,p=i.maxSamples,v=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,m=/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap,y=new WeakMap,x=!1;try{x="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function _(e,t){return x?new OffscreenCanvas(e,t):Dn("canvas")}function b(e,t,n,r){var i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?Cn:Math.floor,o=a(i*e.width),s=a(i*e.height);void 0===l&&(l=_(o,s));var u=n?_(o,s):l;return u.width=o,u.height=s,u.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),u}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function T(e){return kn(e.width)&&kn(e.height)}function M(e,t){return e.generateMipmaps&&t&&e.minFilter!==gt&&e.minFilter!==_t}function w(t){e.generateMipmap(t)}function S(n,r,i,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===c)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var s=r;return 6403===r&&(5126===i&&(s=33326),5131===i&&(s=33325),5121===i&&(s=33321)),33319===r&&(5126===i&&(s=33328),5131===i&&(s=33327),5121===i&&(s=33323)),6408===r&&(5126===i&&(s=34836),5131===i&&(s=34842),5121===i&&(s=a===hn&&!1===o?35907:32856),32819===i&&(s=32854),32820===i&&(s=32855)),33325!==s&&33326!==s&&33327!==s&&33328!==s&&34842!==s&&34836!==s||t.get("EXT_color_buffer_float"),s}function E(e,t,n){return!0===M(e,n)||e.isFramebufferTexture&&e.minFilter!==gt&&e.minFilter!==_t?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function k(e){return e===gt||e===yt||e===xt?9728:9729}function A(e){var t=e.target;t.removeEventListener("dispose",A),function(e){var t=r.get(e);if(void 0===t.__webglInit)return;var n=e.source,i=y.get(n);if(i){var a=i[t.__cacheKey];a.usedTimes--,0===a.usedTimes&&I(e),0===Object.keys(i).length&&y.delete(n)}r.remove(e)}(t),t.isVideoTexture&&g.delete(t)}function C(t){var n=t.target;n.removeEventListener("dispose",C),function(t){var n=t.texture,i=r.get(t),a=r.get(n);void 0!==a.__webglTexture&&(e.deleteTexture(a.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(i.__webglFramebuffer[s]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[s]);else{if(e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(var u=0;u<i.__webglColorRenderbuffer.length;u++)i.__webglColorRenderbuffer[u]&&e.deleteRenderbuffer(i.__webglColorRenderbuffer[u]);i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(var l=0,c=n.length;l<c;l++){var h=r.get(n[l]);h.__webglTexture&&(e.deleteTexture(h.__webglTexture),o.memory.textures--),r.remove(n[l])}r.remove(n),r.remove(t)}(n)}function I(t){var n=r.get(t);e.deleteTexture(n.__webglTexture);var i=t.source;delete y.get(i)[n.__cacheKey],o.memory.textures--}var R=0;function L(e,t){var i=r.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;g.get(e)!==t&&(g.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&i.__version!==e.version){var a=e.image;if(null===a)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==a.complete)return void F(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.bindTexture(3553,i.__webglTexture,33984+t)}var P=(at(s={},pt,10497),at(s,vt,33071),at(s,mt,33648),s),N=(at(u={},gt,9728),at(u,yt,9984),at(u,xt,9986),at(u,_t,9729),at(u,1007,9985),at(u,bt,9987),u);function O(n,a,o){if(o?(e.texParameteri(n,10242,P[a.wrapS]),e.texParameteri(n,10243,P[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,P[a.wrapR]),e.texParameteri(n,10240,N[a.magFilter]),e.texParameteri(n,10241,N[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS===vt&&a.wrapT===vt||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,k(a.magFilter)),e.texParameteri(n,10241,k(a.minFilter)),a.minFilter!==gt&&a.minFilter!==_t&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(a.type===St&&!1===t.has("OES_texture_float_linear"))return;if(!1===c&&a.type===Et&&!1===t.has("OES_texture_half_float_linear"))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function D(t,n){var r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",A));var i=n.source,a=y.get(i);void 0===a&&(a={},y.set(i,a));var s=function(e){var t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(s!==t.__cacheKey){void 0===a[s]&&(a[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),a[s].usedTimes++;var u=a[t.__cacheKey];void 0!==u&&(a[t.__cacheKey].usedTimes--,0===u.usedTimes&&I(n)),t.__cacheKey=s,t.__webglTexture=a[s].texture}return r}function F(t,i,o){var s=3553;i.isDataArrayTexture&&(s=35866),i.isData3DTexture&&(s=32879);var u=D(t,i),l=i.source;n.bindTexture(s,t.__webglTexture,33984+o);var h=r.get(l);if(l.version!==h.__version||!0===u){n.activeTexture(33984+o),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);var f,p=function(e){return!c&&(e.wrapS!==vt||e.wrapT!==vt||e.minFilter!==gt&&e.minFilter!==_t)}(i)&&!1===T(i.image),v=b(i.image,p,!1,d),m=T(v=W(i,v))||c,g=a.convert(i.format,i.encoding),y=a.convert(i.type),x=S(i.internalFormat,g,y,i.encoding,i.isVideoTexture);O(s,i,m);var _=i.mipmaps,k=c&&!0!==i.isVideoTexture,A=void 0===h.__version||!0===u,C=E(i,v,m);if(i.isDepthTexture)x=6402,c?x=i.type===St?36012:i.type===wt?33190:i.type===kt?35056:33189:i.type===St&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===Ct&&6402===x&&i.type!==Mt&&i.type!==wt&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=wt,y=a.convert(i.type)),i.format===It&&6402===x&&(x=34041,i.type!==kt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=kt,y=a.convert(i.type))),A&&(k?n.texStorage2D(3553,1,x,v.width,v.height):n.texImage2D(3553,0,x,v.width,v.height,0,g,y,null));else if(i.isDataTexture)if(_.length>0&&m){k&&A&&n.texStorage2D(3553,C,x,_[0].width,_[0].height);for(var I=0,R=_.length;I<R;I++)f=_[I],k?n.texSubImage2D(3553,I,0,0,f.width,f.height,g,y,f.data):n.texImage2D(3553,I,x,f.width,f.height,0,g,y,f.data);i.generateMipmaps=!1}else k?(A&&n.texStorage2D(3553,C,x,v.width,v.height),n.texSubImage2D(3553,0,0,0,v.width,v.height,g,y,v.data)):n.texImage2D(3553,0,x,v.width,v.height,0,g,y,v.data);else if(i.isCompressedTexture){k&&A&&n.texStorage2D(3553,C,x,_[0].width,_[0].height);for(var L=0,P=_.length;L<P;L++)f=_[L],i.format!==At?null!==g?k?n.compressedTexSubImage2D(3553,L,0,0,f.width,f.height,g,f.data):n.compressedTexImage2D(3553,L,x,f.width,f.height,0,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):k?n.texSubImage2D(3553,L,0,0,f.width,f.height,g,y,f.data):n.texImage2D(3553,L,x,f.width,f.height,0,g,y,f.data)}else if(i.isDataArrayTexture)k?(A&&n.texStorage3D(35866,C,x,v.width,v.height,v.depth),n.texSubImage3D(35866,0,0,0,0,v.width,v.height,v.depth,g,y,v.data)):n.texImage3D(35866,0,x,v.width,v.height,v.depth,0,g,y,v.data);else if(i.isData3DTexture)k?(A&&n.texStorage3D(32879,C,x,v.width,v.height,v.depth),n.texSubImage3D(32879,0,0,0,0,v.width,v.height,v.depth,g,y,v.data)):n.texImage3D(32879,0,x,v.width,v.height,v.depth,0,g,y,v.data);else if(i.isFramebufferTexture){if(A)if(k)n.texStorage2D(3553,C,x,v.width,v.height);else for(var N=v.width,F=v.height,U=0;U<C;U++)n.texImage2D(3553,U,x,N,F,0,g,y,null),N>>=1,F>>=1}else if(_.length>0&&m){k&&A&&n.texStorage2D(3553,C,x,_[0].width,_[0].height);for(var G=0,z=_.length;G<z;G++)f=_[G],k?n.texSubImage2D(3553,G,0,0,g,y,f):n.texImage2D(3553,G,x,g,y,f);i.generateMipmaps=!1}else k?(A&&n.texStorage2D(3553,C,x,v.width,v.height),n.texSubImage2D(3553,0,0,0,g,y,v)):n.texImage2D(3553,0,x,g,y,v);M(i,m)&&w(s),h.__version=l.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}function U(t,i,o,s,u){var l=a.convert(o.format,o.encoding),c=a.convert(o.type),h=S(o.internalFormat,l,c,o.encoding);r.get(i).__hasExternalTextures||(32879===u||35866===u?n.texImage3D(u,0,h,i.width,i.height,i.depth,0,l,c,null):n.texImage2D(u,0,h,i.width,i.height,0,l,c,null)),n.bindFramebuffer(36160,t),B(i)?v.framebufferTexture2DMultisampleEXT(36160,s,u,r.get(o).__webglTexture,0,V(i)):e.framebufferTexture2D(36160,s,u,r.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function G(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var i=33189;if(r||B(n)){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===St?i=36012:o.type===wt&&(i=33190));var s=V(n);B(n)?v.renderbufferStorageMultisampleEXT(36161,s,i,n.width,n.height):e.renderbufferStorageMultisample(36161,s,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){var u=V(n);r&&!1===B(n)?e.renderbufferStorageMultisample(36161,u,35056,n.width,n.height):B(n)?v.renderbufferStorageMultisampleEXT(36161,u,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else for(var l=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture],c=0;c<l.length;c++){var h=l[c],f=a.convert(h.format,h.encoding),d=a.convert(h.type),p=S(h.internalFormat,f,d,h.encoding),m=V(n);r&&!1===B(n)?e.renderbufferStorageMultisample(36161,m,p,n.width,n.height):B(n)?v.renderbufferStorageMultisampleEXT(36161,m,p,n.width,n.height):e.renderbufferStorage(36161,p,n.width,n.height)}e.bindRenderbuffer(36161,null)}function z(t){var i=r.get(t),a=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(a)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),L(i.depthTexture,0);var a=r.get(i.depthTexture).__webglTexture,o=V(i);if(i.depthTexture.format===Ct)B(i)?v.framebufferTexture2DMultisampleEXT(36160,36096,3553,a,0,o):e.framebufferTexture2D(36160,36096,3553,a,0);else{if(i.depthTexture.format!==It)throw new Error("Unknown depthTexture format");B(i)?v.framebufferTexture2DMultisampleEXT(36160,33306,3553,a,0,o):e.framebufferTexture2D(36160,33306,3553,a,0)}}(i.__webglFramebuffer,t)}else if(a){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(36160,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),G(i.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),G(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function V(e){return Math.min(p,e.samples)}function B(e){var n=r.get(e);return c&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function W(e,n){var r=e.encoding,i=e.format,a=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===gn||r!==cn&&(r===hn?!1===c?!0===t.has("EXT_sRGB")&&i===At?(e.format=gn,e.minFilter=_t,e.generateMipmaps=!1):n=Kn.sRGBToLinear(n):i===At&&a===Tt||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)),n}this.allocateTextureUnit=function(){var e=R;return e>=h&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+h),R+=1,e},this.resetTextureUnits=function(){R=0},this.setTexture2D=L,this.setTexture2DArray=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?F(i,e,t):n.bindTexture(35866,i.__webglTexture,33984+t)},this.setTexture3D=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?F(i,e,t):n.bindTexture(32879,i.__webglTexture,33984+t)},this.setTextureCube=function(t,i){var o=r.get(t);t.version>0&&o.__version!==t.version?function(t,i,o){if(6!==i.image.length)return;var s=D(t,i),u=i.source;n.bindTexture(34067,t.__webglTexture,33984+o);var l=r.get(u);if(u.version!==l.__version||!0===s){n.activeTexture(33984+o),e.pixelStorei(37440,i.flipY),e.pixelStorei(37441,i.premultiplyAlpha),e.pixelStorei(3317,i.unpackAlignment),e.pixelStorei(37443,0);for(var h=i.isCompressedTexture||i.image[0].isCompressedTexture,d=i.image[0]&&i.image[0].isDataTexture,p=[],v=0;v<6;v++)p[v]=h||d?d?i.image[v].image:i.image[v]:b(i.image[v],!1,!0,f),p[v]=W(i,p[v]);var m,g=p[0],y=T(g)||c,x=a.convert(i.format,i.encoding),_=a.convert(i.type),k=S(i.internalFormat,x,_,i.encoding),A=c&&!0!==i.isVideoTexture,C=void 0===l.__version||!0===s,I=E(i,g,y);if(O(34067,i,y),h){A&&C&&n.texStorage2D(34067,I,k,g.width,g.height);for(var R=0;R<6;R++){m=p[R].mipmaps;for(var L=0;L<m.length;L++){var P=m[L];i.format!==At?null!==x?A?n.compressedTexSubImage2D(34069+R,L,0,0,P.width,P.height,x,P.data):n.compressedTexImage2D(34069+R,L,k,P.width,P.height,0,P.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):A?n.texSubImage2D(34069+R,L,0,0,P.width,P.height,x,_,P.data):n.texImage2D(34069+R,L,k,P.width,P.height,0,x,_,P.data)}}}else{m=i.mipmaps,A&&C&&(m.length>0&&I++,n.texStorage2D(34067,I,k,p[0].width,p[0].height));for(var N=0;N<6;N++)if(d){A?n.texSubImage2D(34069+N,0,0,0,p[N].width,p[N].height,x,_,p[N].data):n.texImage2D(34069+N,0,k,p[N].width,p[N].height,0,x,_,p[N].data);for(var F=0;F<m.length;F++){var U=m[F].image[N].image;A?n.texSubImage2D(34069+N,F+1,0,0,U.width,U.height,x,_,U.data):n.texImage2D(34069+N,F+1,k,U.width,U.height,0,x,_,U.data)}}else{A?n.texSubImage2D(34069+N,0,0,0,x,_,p[N]):n.texImage2D(34069+N,0,k,x,_,p[N]);for(var G=0;G<m.length;G++){var z=m[G];A?n.texSubImage2D(34069+N,G+1,0,0,x,_,z.image[N]):n.texImage2D(34069+N,G+1,k,x,_,z.image[N])}}}M(i,y)&&w(34067),l.__version=u.version,i.onUpdate&&i.onUpdate(i)}t.__version=i.version}(o,t,i):n.bindTexture(34067,o.__webglTexture,33984+i)},this.rebindTextures=function(e,t,n){var i=r.get(e);void 0!==t&&U(i.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&z(e)},this.setupRenderTarget=function(t){var s=t.texture,u=r.get(t),l=r.get(s);t.addEventListener("dispose",C),!0!==t.isWebGLMultipleRenderTargets&&(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=s.version,o.memory.textures++);var h=!0===t.isWebGLCubeRenderTarget,f=!0===t.isWebGLMultipleRenderTargets,d=T(t)||c;if(h){u.__webglFramebuffer=[];for(var p=0;p<6;p++)u.__webglFramebuffer[p]=e.createFramebuffer()}else{if(u.__webglFramebuffer=e.createFramebuffer(),f)if(i.drawBuffers)for(var v=t.texture,m=0,g=v.length;m<g;m++){var y=r.get(v[m]);void 0===y.__webglTexture&&(y.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(c&&t.samples>0&&!1===B(t)){var x=f?s:[s];u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer);for(var _=0;_<x.length;_++){var b=x[_];u.__webglColorRenderbuffer[_]=e.createRenderbuffer(),e.bindRenderbuffer(36161,u.__webglColorRenderbuffer[_]);var E=a.convert(b.format,b.encoding),k=a.convert(b.type),A=S(b.internalFormat,E,k,b.encoding,!0===t.isXRRenderTarget),I=V(t);e.renderbufferStorageMultisample(36161,I,A,t.width,t.height),e.framebufferRenderbuffer(36160,36064+_,36161,u.__webglColorRenderbuffer[_])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),G(u.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}}if(h){n.bindTexture(34067,l.__webglTexture),O(34067,s,d);for(var R=0;R<6;R++)U(u.__webglFramebuffer[R],t,s,36064,34069+R);M(s,d)&&w(34067),n.unbindTexture()}else if(f){for(var L=t.texture,P=0,N=L.length;P<N;P++){var D=L[P],F=r.get(D);n.bindTexture(3553,F.__webglTexture),O(3553,D,d),U(u.__webglFramebuffer,t,D,36064+P,3553),M(D,d)&&w(3553)}n.unbindTexture()}else{var W=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(c?W=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(W,l.__webglTexture),O(W,s,d),U(u.__webglFramebuffer,t,s,36064,W),M(s,d)&&w(W),n.unbindTexture()}t.depthBuffer&&z(t)},this.updateRenderTargetMipmap=function(e){for(var t=T(e)||c,i=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],a=0,o=i.length;a<o;a++){var s=i[a];if(M(s,t)){var u=e.isWebGLCubeRenderTarget?34067:3553,l=r.get(s).__webglTexture;n.bindTexture(u,l),w(u),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(c&&t.samples>0&&!1===B(t)){var i=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],a=t.width,o=t.height,s=16384,u=[],l=t.stencilBuffer?33306:36096,h=r.get(t),f=!0===t.isWebGLMultipleRenderTargets;if(f)for(var d=0;d<i.length;d++)n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+d,36161,null),n.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+d,3553,null,0);n.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,h.__webglFramebuffer);for(var p=0;p<i.length;p++){u.push(36064+p),t.depthBuffer&&u.push(l);var v=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===v&&(t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024)),f&&e.framebufferRenderbuffer(36008,36064,36161,h.__webglColorRenderbuffer[p]),!0===v&&(e.invalidateFramebuffer(36008,[l]),e.invalidateFramebuffer(36009,[l])),f){var g=r.get(i[p]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,g,0)}e.blitFramebuffer(0,0,a,o,0,0,a,o,s,9728),m&&e.invalidateFramebuffer(36008,u)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),f)for(var y=0;y<i.length;y++){n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+y,36161,h.__webglColorRenderbuffer[y]);var x=r.get(i[y]).__webglTexture;n.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+y,3553,x,0)}n.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=z,this.setupFrameBufferTexture=U,this.useMultisampledRTT=B}function Vs(e,t,n){var r=n.isWebGL2;return{convert:function(n){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n===Tt)return 5121;if(1017===n)return 32819;if(1018===n)return 32820;if(1010===n)return 5120;if(1011===n)return 5122;if(n===Mt)return 5123;if(1013===n)return 5124;if(n===wt)return 5125;if(n===St)return 5126;if(n===Et)return r?5131:null!==(i=t.get("OES_texture_half_float"))?i.HALF_FLOAT_OES:null;if(1021===n)return 6406;if(n===At)return 6408;if(1024===n)return 6409;if(1025===n)return 6410;if(n===Ct)return 6402;if(n===It)return 34041;if(1028===n)return 6403;if(1022===n)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(n===gn)return null!==(i=t.get("EXT_sRGB"))?i.SRGB_ALPHA_EXT:null;if(1029===n)return 36244;if(1030===n)return 33319;if(1031===n)return 33320;if(1033===n)return 36249;if(n===Rt||n===Lt||n===Pt||n===Nt)if(a===hn){if(null===(i=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(n===Rt)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Lt)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Pt)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Nt)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(i=t.get("WEBGL_compressed_texture_s3tc")))return null;if(n===Rt)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Lt)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Pt)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Nt)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Ot||n===Dt||n===Ft||n===Ut){if(null===(i=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(n===Ot)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Dt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Ft)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Ut)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return null!==(i=t.get("WEBGL_compressed_texture_etc1"))?i.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===Gt||n===zt){if(null===(i=t.get("WEBGL_compressed_texture_etc")))return null;if(n===Gt)return a===hn?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(n===zt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(n===Vt||n===Bt||n===Wt||n===Ht||n===jt||n===qt||n===Xt||n===Yt||n===Kt||n===Zt||n===Jt||n===Qt||n===$t||n===en){if(null===(i=t.get("WEBGL_compressed_texture_astc")))return null;if(n===Vt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Bt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Wt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Ht)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===jt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===qt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Xt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Yt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Kt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===Zt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===Jt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===Qt)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===$t)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===en)return a===hn?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===tn){if(null===(i=t.get("EXT_texture_compression_bptc")))return null;if(n===tn)return a===hn?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}return n===kt?r?34042:null!==(i=t.get("WEBGL_depth_texture"))?i.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[n]?e[n]:null}}}var Bs=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t(this,r),(e=n.call(this)).isArrayCamera=!0,e.cameras=i,e}return a(r)}(sa),Ws=function(e){Fe(r,e);var n=Ge(r);function r(){var e;return t(this,r),(e=n.call(this)).isGroup=!0,e.type="Group",e}return a(r)}(si),Hs={type:"move"},js=function(){function e(){t(this,e),this._targetRay=null,this._grip=null,this._hand=null}return a(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new Ws,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new Ws,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ar,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ar),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new Ws,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ar,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ar),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var r=null,i=null,a=null,o=this._targetRay,s=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(u&&e.hand){a=!0;var l,c=f(e.hand.values());try{for(c.s();!(l=c.n()).done;){var h=l.value,d=t.getJointPose(h,n);if(void 0===u.joints[h.jointName]){var p=new Ws;p.matrixAutoUpdate=!1,p.visible=!1,u.joints[h.jointName]=p,u.add(p)}var v=u.joints[h.jointName];null!==d&&(v.matrix.fromArray(d.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=d.radius),v.visible=null!==d}}catch(e){c.e(e)}finally{c.f()}var m=u.joints["index-finger-tip"],g=u.joints["thumb-tip"],y=m.position.distanceTo(g.position);u.inputState.pinching&&y>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&y<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(i=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1);null!==o&&(null===(r=t.getPose(e.targetRaySpace,n))&&null!==i&&(r=i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Hs)))}return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==u&&(u.visible=null!==a),this}}]),e}(),qs=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a,o,s,u,l,c,h,f){var d;if(t(this,r),(f=void 0!==f?f:Ct)!==Ct&&f!==It)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===a&&f===Ct&&(a=wt),void 0===a&&f===It&&(a=kt),(d=n.call(this,null,o,s,u,l,c,f,a,h)).isDepthTexture=!0,d.image={width:e,height:i},d.magFilter=void 0!==l?l:gt,d.minFilter=void 0!==c?c:gt,d.flipY=!1,d.generateMipmaps=!1,d}return a(r)}($n),Xs=function(e){Fe(r,e);var n=Ge(r);function r(e,i){var a;t(this,r),a=n.call(this);var o=it(a),s=null,u=1,l=null,c="local-floor",h=null,f=null,d=null,p=null,v=null,m=null,g=i.getContextAttributes(),y=null,x=null,_=[],b=[],T=new sa;T.layers.enable(1),T.viewport=new er;var M=new sa;M.layers.enable(2),M.viewport=new er;var w=[T,M],S=new Bs;S.layers.enable(1),S.layers.enable(2);var E=null,k=null;function A(e){var t=b.indexOf(e.inputSource);if(-1!==t){var n=_[t];void 0!==n&&n.dispatchEvent({type:e.type,data:e.inputSource})}}function C(){s.removeEventListener("select",A),s.removeEventListener("selectstart",A),s.removeEventListener("selectend",A),s.removeEventListener("squeeze",A),s.removeEventListener("squeezestart",A),s.removeEventListener("squeezeend",A),s.removeEventListener("end",C),s.removeEventListener("inputsourceschange",I);for(var t=0;t<_.length;t++){var n=b[t];null!==n&&(b[t]=null,_[t].disconnect(n))}E=null,k=null,e.setRenderTarget(y),v=null,p=null,d=null,s=null,x=null,O.stop(),o.isPresenting=!1,o.dispatchEvent({type:"sessionend"})}function I(e){for(var t=0;t<e.removed.length;t++){var n=e.removed[t],r=b.indexOf(n);r>=0&&(b[r]=null,_[r].dispatchEvent({type:"disconnected",data:n}))}for(var i=0;i<e.added.length;i++){var a=e.added[i],o=b.indexOf(a);if(-1===o){for(var s=0;s<_.length;s++){if(s>=b.length){b.push(a),o=s;break}if(null===b[s]){b[s]=a,o=s;break}}if(-1===o)break}var u=_[o];u&&u.dispatchEvent({type:"connected",data:a})}}a.cameraAutoUpdate=!0,a.enabled=!1,a.isPresenting=!1,a.getController=function(e){var t=_[e];return void 0===t&&(t=new js,_[e]=t),t.getTargetRaySpace()},a.getControllerGrip=function(e){var t=_[e];return void 0===t&&(t=new js,_[e]=t),t.getGripSpace()},a.getHand=function(e){var t=_[e];return void 0===t&&(t=new js,_[e]=t),t.getHandSpace()},a.setFramebufferScaleFactor=function(e){u=e,!0===o.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},a.setReferenceSpaceType=function(e){c=e,!0===o.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},a.getReferenceSpace=function(){return h||l},a.setReferenceSpace=function(e){h=e},a.getBaseLayer=function(){return null!==p?p:v},a.getBinding=function(){return d},a.getFrame=function(){return m},a.getSession=function(){return s},a.setSession=function(){var t=tt(ot().mark((function t(n){var r,a,f,m,_;return ot().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(s=n)){t.next=25;break}if(y=e.getRenderTarget(),s.addEventListener("select",A),s.addEventListener("selectstart",A),s.addEventListener("selectend",A),s.addEventListener("squeeze",A),s.addEventListener("squeezestart",A),s.addEventListener("squeezeend",A),s.addEventListener("end",C),s.addEventListener("inputsourceschange",I),!0===g.xrCompatible){t.next=14;break}return t.next=14,i.makeXRCompatible();case 14:return void 0===s.renderState.layers||!1===e.capabilities.isWebGL2?(r={antialias:void 0!==s.renderState.layers||g.antialias,alpha:g.alpha,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:u},v=new XRWebGLLayer(s,i,r),s.updateRenderState({baseLayer:v}),x=new tr(v.framebufferWidth,v.framebufferHeight,{format:At,type:Tt,encoding:e.outputEncoding,stencilBuffer:g.stencil})):(a=null,f=null,m=null,g.depth&&(m=g.stencil?35056:33190,a=g.stencil?It:Ct,f=g.stencil?kt:wt),_={colorFormat:32856,depthFormat:m,scaleFactor:u},d=new XRWebGLBinding(s,i),p=d.createProjectionLayer(_),s.updateRenderState({layers:[p]}),x=new tr(p.textureWidth,p.textureHeight,{format:At,type:Tt,depthTexture:new qs(p.textureWidth,p.textureHeight,f,void 0,void 0,void 0,void 0,void 0,void 0,a),stencilBuffer:g.stencil,encoding:e.outputEncoding,samples:g.antialias?4:0}),e.properties.get(x).__ignoreDepthValues=p.ignoreDepthValues),x.isXRRenderTarget=!0,this.setFoveation(1),h=null,t.next=20,s.requestReferenceSpace(c);case 20:l=t.sent,O.setContext(s),O.start(),o.isPresenting=!0,o.dispatchEvent({type:"sessionstart"});case 25:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}();var R=new ar,L=new ar;function P(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}a.updateCamera=function(e){if(null!==s){S.near=M.near=T.near=e.near,S.far=M.far=T.far=e.far,E===S.near&&k===S.far||(s.updateRenderState({depthNear:S.near,depthFar:S.far}),E=S.near,k=S.far);var t=e.parent,n=S.cameras;P(S,t);for(var r=0;r<n.length;r++)P(n[r],t);S.matrixWorld.decompose(S.position,S.quaternion,S.scale),e.matrix.copy(S.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);for(var i=e.children,a=0,o=i.length;a<o;a++)i[a].updateMatrixWorld(!0);2===n.length?function(e,t,n){R.setFromMatrixPosition(t.matrixWorld),L.setFromMatrixPosition(n.matrixWorld);var r=R.distanceTo(L),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),u=(i[9]+1)/i[5],l=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],f=o*c,d=o*h,p=r/(-c+h),v=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(v),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var m=o+p,g=s+p,y=f-v,x=d+(r-v),_=u*s/g*m,b=l*s/g*m;e.projectionMatrix.makePerspective(y,x,_,b,m,g)}(S,T,M):S.projectionMatrix.copy(T.projectionMatrix)}},a.getCamera=function(){return S},a.getFoveation=function(){return null!==p?p.fixedFoveation:null!==v?v.fixedFoveation:void 0},a.setFoveation=function(e){null!==p&&(p.fixedFoveation=e),null!==v&&void 0!==v.fixedFoveation&&(v.fixedFoveation=e)};var N=null;var O=new xa;return O.setAnimationLoop((function(t,n){if(f=n.getViewerPose(h||l),m=n,null!==f){var r=f.views;null!==v&&(e.setRenderTargetFramebuffer(x,v.framebuffer),e.setRenderTarget(x));var i=!1;r.length!==S.cameras.length&&(S.cameras.length=0,i=!0);for(var a=0;a<r.length;a++){var o=r[a],s=null;if(null!==v)s=v.getViewport(o);else{var u=d.getViewSubImage(p,o);s=u.viewport,0===a&&(e.setRenderTargetTextures(x,u.colorTexture,p.ignoreDepthValues?void 0:u.depthStencilTexture),e.setRenderTarget(x))}var c=w[a];void 0===c&&((c=new sa).layers.enable(a),c.viewport=new er,w[a]=c),c.matrix.fromArray(o.transform.matrix),c.projectionMatrix.fromArray(o.projectionMatrix),c.viewport.set(s.x,s.y,s.width,s.height),0===a&&S.matrix.copy(c.matrix),!0===i&&S.cameras.push(c)}}for(var g=0;g<_.length;g++){var y=b[g],T=_[g];null!==y&&void 0!==T&&T.update(y,n,h||l)}N&&N(t,n),m=null})),a.setAnimationLoop=function(e){N=e},a.dispose=function(){},a}return a(r)}(yn);function Ys(e,t){function n(n,r){n.opacity.value=r.opacity,r.color&&n.diffuse.value.copy(r.color),r.emissive&&n.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(n.map.value=r.map),r.alphaMap&&(n.alphaMap.value=r.alphaMap),r.bumpMap&&(n.bumpMap.value=r.bumpMap,n.bumpScale.value=r.bumpScale,1===r.side&&(n.bumpScale.value*=-1)),r.displacementMap&&(n.displacementMap.value=r.displacementMap,n.displacementScale.value=r.displacementScale,n.displacementBias.value=r.displacementBias),r.emissiveMap&&(n.emissiveMap.value=r.emissiveMap),r.normalMap&&(n.normalMap.value=r.normalMap,n.normalScale.value.copy(r.normalScale),1===r.side&&n.normalScale.value.negate()),r.specularMap&&(n.specularMap.value=r.specularMap),r.alphaTest>0&&(n.alphaTest.value=r.alphaTest);var i,a,o=t.get(r).envMap;if(o&&(n.envMap.value=o,n.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,n.reflectivity.value=r.reflectivity,n.ior.value=r.ior,n.refractionRatio.value=r.refractionRatio),r.lightMap){n.lightMap.value=r.lightMap;var s=!0!==e.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=r.lightMapIntensity*s}r.aoMap&&(n.aoMap.value=r.aoMap,n.aoMapIntensity.value=r.aoMapIntensity),r.map?i=r.map:r.specularMap?i=r.specularMap:r.displacementMap?i=r.displacementMap:r.normalMap?i=r.normalMap:r.bumpMap?i=r.bumpMap:r.roughnessMap?i=r.roughnessMap:r.metalnessMap?i=r.metalnessMap:r.alphaMap?i=r.alphaMap:r.emissiveMap?i=r.emissiveMap:r.clearcoatMap?i=r.clearcoatMap:r.clearcoatNormalMap?i=r.clearcoatNormalMap:r.clearcoatRoughnessMap?i=r.clearcoatRoughnessMap:r.iridescenceMap?i=r.iridescenceMap:r.iridescenceThicknessMap?i=r.iridescenceThicknessMap:r.specularIntensityMap?i=r.specularIntensityMap:r.specularColorMap?i=r.specularColorMap:r.transmissionMap?i=r.transmissionMap:r.thicknessMap?i=r.thicknessMap:r.sheenColorMap?i=r.sheenColorMap:r.sheenRoughnessMap&&(i=r.sheenRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),n.uvTransform.value.copy(i.matrix)),r.aoMap?a=r.aoMap:r.lightMap&&(a=r.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),n.uv2Transform.value.copy(a.matrix))}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,a,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?n(e,r):r.isMeshToonMaterial?(n(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(n(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(n(e,r),function(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap);n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap);t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,r,o)):r.isMeshMatcapMaterial?(n(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?n(e,r):r.isMeshDistanceMaterial?(n(e,r),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?n(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,a):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Ks(e,t,n,r){var i={},a={},o=[],s=n.isWebGL2?e.getParameter(35375):0;function u(e,t,n){var r=e.value;if(void 0===n[t])return n[t]="number"==typeof r?r:r.clone(),!0;if("number"==typeof r){if(n[t]!==r)return n[t]=r,!0}else{var i=n[t];if(!1===i.equals(r))return i.copy(r),!0}return!1}function l(e){var t=e.value,n={boundary:0,storage:0};return"number"==typeof t?(n.boundary=4,n.storage=4):t.isVector2?(n.boundary=8,n.storage=8):t.isVector3||t.isColor?(n.boundary=16,n.storage=12):t.isVector4?(n.boundary=16,n.storage=16):t.isMatrix3?(n.boundary=48,n.storage=48):t.isMatrix4?(n.boundary=64,n.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),n}function c(t){var n=t.target;n.removeEventListener("dispose",c);var r=o.indexOf(n.__bindingPointIndex);o.splice(r,1),e.deleteBuffer(i[n.id]),delete i[n.id],delete a[n.id]}return{bind:function(e,t){var n=t.program;r.uniformBlockBinding(e,n)},update:function(n,h){var f=i[n.id];void 0===f&&(!function(e){for(var t=e.uniforms,n=0,r=16,i=0,a=0,o=t.length;a<o;a++){var s=t[a],u=l(s);if(s.__data=new Float32Array(u.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=n,a>0)0!==(i=n%r)&&r-i-u.boundary<0&&(n+=r-i,s.__offset=n);n+=u.storage}(i=n%r)>0&&(n+=r-i);e.__size=n,e.__cache={}}(n),f=function(t){var n=function(){for(var e=0;e<s;e++)if(-1===o.indexOf(e))return o.push(e),e;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();t.__bindingPointIndex=n;var r=e.createBuffer(),i=t.__size,a=t.usage;return e.bindBuffer(35345,r),e.bufferData(35345,i,a),e.bindBuffer(35345,null),e.bindBufferBase(35345,n,r),r}(n),i[n.id]=f,n.addEventListener("dispose",c));var d=h.program;r.updateUBOMapping(n,d);var p=t.render.frame;a[n.id]!==p&&(!function(t){var n=i[t.id],r=t.uniforms,a=t.__cache;e.bindBuffer(35345,n);for(var o=0,s=r.length;o<s;o++){var l=r[o];if(!0===u(l,o,a)){var c=l.value,h=l.__offset;"number"==typeof c?(l.__data[0]=c,e.bufferSubData(35345,h,l.__data)):(l.value.isMatrix3?(l.__data[0]=l.value.elements[0],l.__data[1]=l.value.elements[1],l.__data[2]=l.value.elements[2],l.__data[3]=l.value.elements[0],l.__data[4]=l.value.elements[3],l.__data[5]=l.value.elements[4],l.__data[6]=l.value.elements[5],l.__data[7]=l.value.elements[0],l.__data[8]=l.value.elements[6],l.__data[9]=l.value.elements[7],l.__data[10]=l.value.elements[8],l.__data[11]=l.value.elements[0]):c.toArray(l.__data),e.bufferSubData(35345,h,l.__data))}}e.bindBuffer(35345,null)}(n),a[n.id]=p)},dispose:function(){for(var t in i)e.deleteBuffer(i[t]);o=[],i={},a={}}}}function Zs(){var e=Dn("canvas");return e.style.display="block",e}function Js(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isWebGLRenderer=!0;var t,n=void 0!==e.canvas?e.canvas:Zs(),r=void 0!==e.context?e.context:null,i=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,l=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;t=null!==r?r.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;var h=null,f=null,d=[],p=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=cn,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});var v=this,m=!1,g=0,y=0,x=null,_=-1,b=null,T=new er,M=new er,w=null,S=n.width,E=n.height,k=1,A=null,C=null,I=new er(0,0,S,E),R=new er(0,0,S,E),L=!1,P=new ya,N=!1,O=!1,D=null,F=new Dr,U=new Pn,G=new ar,z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function V(){return null===x?k:1}var B,W,H,j,q,X,Y,K,Z,J,Q,$,ee,te,ne,re,ie,ae,oe,se,ue,le,ce,he,fe=r;function de(e,t){for(var r=0;r<e.length;r++){var i=e[r],a=n.getContext(i,t);if(null!==a)return a}return null}try{var pe={alpha:!0,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in n&&n.setAttribute("data-engine","three.js r".concat(st)),n.addEventListener("webglcontextlost",ye,!1),n.addEventListener("webglcontextrestored",xe,!1),n.addEventListener("webglcontextcreationerror",_e,!1),null===fe){var ve=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&ve.shift(),null===(fe=de(ve,pe)))throw de(ve)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===fe.getShaderPrecisionFormat&&(fe.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function me(){B=new qa(fe),W=new Aa(fe,B,e),B.init(W),le=new Vs(fe,B,W),H=new Gs(fe,B,W),j=new Ka,q=new Ss,X=new zs(fe,B,H,q,W,le,j),Y=new Ia(v),K=new ja(v),Z=new _a(fe,W),ce=new Ea(fe,B,Z,W),J=new Xa(fe,Z,j,ce),Q=new $a(fe,J,Z,j),oe=new Qa(fe,W,X),re=new Ca(q),$=new ws(v,Y,K,B,W,ce,re),ee=new Ys(v,q),te=new Cs,ne=new Os(B,W),ae=new Sa(v,Y,H,Q,t,s),ie=new Us(v,Q,W),he=new Ks(fe,j,W,H),se=new ka(fe,B,j,W),ue=new Ya(fe,B,j,W),j.programs=$.programs,v.capabilities=W,v.extensions=B,v.properties=q,v.renderLists=te,v.shadowMap=ie,v.state=H,v.info=j}me();var ge=new Xs(v,fe);function ye(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function xe(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;var e=j.autoReset,t=ie.enabled,n=ie.autoUpdate,r=ie.needsUpdate,i=ie.type;me(),j.autoReset=e,ie.enabled=t,ie.autoUpdate=n,ie.needsUpdate=r,ie.type=i}function _e(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function be(e){var t=e.target;t.removeEventListener("dispose",be),Te(t)}function Te(e){Me(e),q.remove(e)}function Me(e){var t=q.get(e).programs;void 0!==t&&(t.forEach((function(e){$.releaseProgram(e)})),e.isShaderMaterial&&$.releaseShaderCache(e))}this.xr=ge,this.getContext=function(){return fe},this.getContextAttributes=function(){return fe.getContextAttributes()},this.forceContextLoss=function(){var e=B.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=B.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return k},this.setPixelRatio=function(e){void 0!==e&&(k=e,this.setSize(S,E,!1))},this.getSize=function(e){return e.set(S,E)},this.setSize=function(e,t,r){ge.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(S=e,E=t,n.width=Math.floor(e*k),n.height=Math.floor(t*k),!1!==r&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(S*k,E*k).floor()},this.setDrawingBufferSize=function(e,t,r){S=e,E=t,k=r,n.width=Math.floor(e*r),n.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(T)},this.getViewport=function(e){return e.copy(I)},this.setViewport=function(e,t,n,r){e.isVector4?I.set(e.x,e.y,e.z,e.w):I.set(e,t,n,r),H.viewport(T.copy(I).multiplyScalar(k).floor())},this.getScissor=function(e){return e.copy(R)},this.setScissor=function(e,t,n,r){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,n,r),H.scissor(M.copy(R).multiplyScalar(k).floor())},this.getScissorTest=function(){return L},this.setScissorTest=function(e){H.setScissorTest(L=e)},this.setOpaqueSort=function(e){A=e},this.setTransparentSort=function(e){C=e},this.getClearColor=function(e){return e.copy(ae.getClearColor())},this.setClearColor=function(){ae.setClearColor.apply(ae,arguments)},this.getClearAlpha=function(){return ae.getClearAlpha()},this.setClearAlpha=function(){ae.setClearAlpha.apply(ae,arguments)},this.clear=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=0;e&&(r|=16384),t&&(r|=256),n&&(r|=1024),fe.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",ye,!1),n.removeEventListener("webglcontextrestored",xe,!1),n.removeEventListener("webglcontextcreationerror",_e,!1),te.dispose(),ne.dispose(),q.dispose(),Y.dispose(),K.dispose(),Q.dispose(),ce.dispose(),he.dispose(),$.dispose(),ge.dispose(),ge.removeEventListener("sessionstart",Ee),ge.removeEventListener("sessionend",ke),D&&(D.dispose(),D=null),Ae.stop()},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=z);var o=i.isMesh&&i.matrixWorld.determinant()<0,s=De(e,t,n,r,i);H.setMaterial(r,o);var u=n.index,l=n.attributes.position;if(null===u){if(void 0===l||0===l.count)return}else if(0===u.count)return;var c,h=1;!0===r.wireframe&&(u=J.getWireframeAttribute(n),h=2),ce.setup(i,r,s,n,u);var f=se;null!==u&&(c=Z.get(u),(f=ue).setIndex(c));var d=null!==u?u.count:l.count,p=n.drawRange.start*h,v=n.drawRange.count*h,m=null!==a?a.start*h:0,g=null!==a?a.count*h:1/0,y=Math.max(p,m),x=Math.min(d,p+v,m+g)-1,_=Math.max(0,x-y+1);if(0!==_){if(i.isMesh)!0===r.wireframe?(H.setLineWidth(r.wireframeLinewidth*V()),f.setMode(1)):f.setMode(4);else if(i.isLine){var b=r.linewidth;void 0===b&&(b=1),H.setLineWidth(b*V()),i.isLineSegments?f.setMode(1):i.isLineLoop?f.setMode(2):f.setMode(3)}else i.isPoints?f.setMode(0):i.isSprite&&f.setMode(4);if(i.isInstancedMesh)f.renderInstances(y,_,i.count);else if(n.isInstancedBufferGeometry){var T=Math.min(n.instanceCount,n._maxInstanceCount);f.renderInstances(y,_,T)}else f.render(y,_)}},this.compile=function(e,t){function n(e,t,n){!0===e.transparent&&2===e.side?(e.side=1,e.needsUpdate=!0,Ne(e,t,n),e.side=0,e.needsUpdate=!0,Ne(e,t,n),e.side=2):Ne(e,t,n)}(f=ne.get(e)).init(),p.push(f),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))})),f.setupLights(v.physicallyCorrectLights),e.traverse((function(t){var r=t.material;if(r)if(Array.isArray(r))for(var i=0;i<r.length;i++){n(r[i],e,t)}else n(r,e,t)})),p.pop(),f=null};var we=null;function Se(e){we&&we(e)}function Ee(){Ae.stop()}function ke(){Ae.start()}var Ae=new xa;function Ce(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)f.pushLight(e),e.castShadow&&f.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||P.intersectsSprite(e)){r&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);var i=Q.update(e),a=e.material;a.visible&&h.push(e,i,a,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==j.render.frame&&(e.skeleton.update(),e.skeleton.frame=j.render.frame),!e.frustumCulled||P.intersectsObject(e))){r&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);var o=Q.update(e),s=e.material;if(Array.isArray(s))for(var u=o.groups,l=0,c=u.length;l<c;l++){var d=u[l],p=s[d.materialIndex];p&&p.visible&&h.push(e,o,p,n,G.z,d)}else s.visible&&h.push(e,o,s,n,G.z,null)}for(var v=e.children,m=0,g=v.length;m<g;m++)Ce(v[m],t,n,r)}}function Ie(e,t,n,r){var i=e.opaque,a=e.transmissive,o=e.transparent;f.setupLightsView(n),a.length>0&&Re(i,t,n),r&&H.viewport(T.copy(r)),i.length>0&&Le(i,t,n),a.length>0&&Le(a,t,n),o.length>0&&Le(o,t,n),H.buffers.depth.setTest(!0),H.buffers.depth.setMask(!0),H.buffers.color.setMask(!0),H.setPolygonOffset(!1)}function Re(e,t,n){var r=W.isWebGL2;null===D&&(D=new tr(1,1,{generateMipmaps:!0,type:B.has("EXT_color_buffer_half_float")?Et:Tt,minFilter:bt,samples:r&&!0===o?4:0})),v.getDrawingBufferSize(U),r?D.setSize(U.x,U.y):D.setSize(Cn(U.x),Cn(U.y));var i=v.getRenderTarget();v.setRenderTarget(D),v.clear();var a=v.toneMapping;v.toneMapping=0,Le(e,t,n),v.toneMapping=a,X.updateMultisampleRenderTarget(D),X.updateRenderTargetMipmap(D),v.setRenderTarget(i)}function Le(e,t,n){for(var r=!0===t.isScene?t.overrideMaterial:null,i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,u=o.geometry,l=null===r?o.material:r,c=o.group;s.layers.test(n.layers)&&Pe(s,t,n,u,l,c)}}function Pe(e,t,n,r,i,a){e.onBeforeRender(v,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(v,t,n,r,e,a),!0===i.transparent&&2===i.side?(i.side=1,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,a),i.side=0,i.needsUpdate=!0,v.renderBufferDirect(n,t,r,i,e,a),i.side=2):v.renderBufferDirect(n,t,r,i,e,a),e.onAfterRender(v,t,n,r,i,a)}function Ne(e,t,n){!0!==t.isScene&&(t=z);var r=q.get(e),i=f.state.lights,a=f.state.shadowsArray,o=i.state.version,s=$.getParameters(e,i.state,a,t,n),u=$.getProgramCacheKey(s),l=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?K:Y).get(e.envMap||r.environment),void 0===l&&(e.addEventListener("dispose",be),l=new Map,r.programs=l);var c=l.get(u);if(void 0!==c){if(r.currentProgram===c&&r.lightsStateVersion===o)return Oe(e,s),c}else s.uniforms=$.getUniforms(e),e.onBuild(n,s,v),e.onBeforeCompile(s,v),c=$.acquireProgram(s,u),l.set(u,c),r.uniforms=s.uniforms;var h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=re.uniform),Oe(e,s),r.needsLights=Ue(e),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotLightMatrix.value=i.state.spotLightMatrix,h.spotLightMap.value=i.state.spotLightMap,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);var d=c.getUniforms(),p=is.seqWithValue(d.seq,h);return r.currentProgram=c,r.uniformsList=p,c}function Oe(e,t){var n=q.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}function De(e,t,n,r,i){!0!==t.isScene&&(t=z),X.resetTextureUnits();var a=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===x?v.outputEncoding:!0===x.isXRRenderTarget?x.texture.encoding:cn,u=(r.isMeshStandardMaterial?K:Y).get(r.envMap||o),l=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,c=!!r.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,m=r.toneMapped?v.toneMapping:0,g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==g?g.length:0,T=q.get(r),M=f.state.lights;if(!0===N&&(!0===O||e!==b)){var w=e===b&&r.id===_;re.setState(r,e,w)}var S=!1;r.version===T.__version?T.needsLights&&T.lightsStateVersion!==M.state.version||T.outputEncoding!==s||i.isInstancedMesh&&!1===T.instancing?S=!0:i.isInstancedMesh||!0!==T.instancing?i.isSkinnedMesh&&!1===T.skinning?S=!0:i.isSkinnedMesh||!0!==T.skinning?T.envMap!==u||!0===r.fog&&T.fog!==a?S=!0:void 0===T.numClippingPlanes||T.numClippingPlanes===re.numPlanes&&T.numIntersection===re.numIntersection?(T.vertexAlphas!==l||T.vertexTangents!==c||T.morphTargets!==h||T.morphNormals!==d||T.morphColors!==p||T.toneMapping!==m||!0===W.isWebGL2&&T.morphTargetsCount!==y)&&(S=!0):S=!0:S=!0:S=!0:(S=!0,T.__version=r.version);var A=T.currentProgram;!0===S&&(A=Ne(r,t,i));var C=!1,I=!1,R=!1,L=A.getUniforms(),P=T.uniforms;if(H.useProgram(A.program)&&(C=!0,I=!0,R=!0),r.id!==_&&(_=r.id,I=!0),C||b!==e){if(L.setValue(fe,"projectionMatrix",e.projectionMatrix),W.logarithmicDepthBuffer&&L.setValue(fe,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),b!==e&&(b=e,I=!0,R=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var F=L.map.cameraPosition;void 0!==F&&F.setValue(fe,G.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&L.setValue(fe,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh)&&L.setValue(fe,"viewMatrix",e.matrixWorldInverse)}if(i.isSkinnedMesh){L.setOptional(fe,i,"bindMatrix"),L.setOptional(fe,i,"bindMatrixInverse");var U=i.skeleton;U&&(W.floatVertexTextures?(null===U.boneTexture&&U.computeBoneTexture(),L.setValue(fe,"boneTexture",U.boneTexture,X),L.setValue(fe,"boneTextureSize",U.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}var V=n.morphAttributes;if((void 0!==V.position||void 0!==V.normal||void 0!==V.color&&!0===W.isWebGL2)&&oe.update(i,n,r,A),(I||T.receiveShadow!==i.receiveShadow)&&(T.receiveShadow=i.receiveShadow,L.setValue(fe,"receiveShadow",i.receiveShadow)),r.isMeshGouraudMaterial&&null!==r.envMap&&(P.envMap.value=u,P.flipEnvMap.value=u.isCubeTexture&&!1===u.isRenderTargetTexture?-1:1),I&&(L.setValue(fe,"toneMappingExposure",v.toneMappingExposure),T.needsLights&&Fe(P,R),a&&!0===r.fog&&ee.refreshFogUniforms(P,a),ee.refreshMaterialUniforms(P,r,k,E,D),is.upload(fe,T.uniformsList,P,X)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(is.upload(fe,T.uniformsList,P,X),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&L.setValue(fe,"center",i.center),L.setValue(fe,"modelViewMatrix",i.modelViewMatrix),L.setValue(fe,"normalMatrix",i.normalMatrix),L.setValue(fe,"modelMatrix",i.matrixWorld),r.isShaderMaterial||r.isRawShaderMaterial)for(var B=r.uniformsGroups,j=0,Z=B.length;j<Z;j++)if(W.isWebGL2){var J=B[j];he.update(J,A),he.bind(J,A)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.");return A}function Fe(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function Ue(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}Ae.setAnimationLoop(Se),"undefined"!=typeof self&&Ae.setContext(self),this.setAnimationLoop=function(e){we=e,ge.setAnimationLoop(e),null===e?Ae.stop():Ae.start()},ge.addEventListener("sessionstart",Ee),ge.addEventListener("sessionend",ke),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==m){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),!0===ge.enabled&&!0===ge.isPresenting&&(!0===ge.cameraAutoUpdate&&ge.updateCamera(t),t=ge.getCamera()),!0===e.isScene&&e.onBeforeRender(v,e,t,x),(f=ne.get(e,p.length)).init(),p.push(f),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),P.setFromProjectionMatrix(F),O=this.localClippingEnabled,N=re.init(this.clippingPlanes,O,t),(h=te.get(e,d.length)).init(),d.push(h),Ce(e,t,0,v.sortObjects),h.finish(),!0===v.sortObjects&&h.sort(A,C),!0===N&&re.beginShadows();var n=f.state.shadowsArray;if(ie.render(n,e,t),!0===N&&re.endShadows(),!0===this.info.autoReset&&this.info.reset(),ae.render(h,e),f.setupLights(v.physicallyCorrectLights),t.isArrayCamera)for(var r=t.cameras,i=0,a=r.length;i<a;i++){var o=r[i];Ie(h,e,o,o.viewport)}else Ie(h,e,t);null!==x&&(X.updateMultisampleRenderTarget(x),X.updateRenderTargetMipmap(x)),!0===e.isScene&&e.onAfterRender(v,e,t),ce.resetDefaultState(),_=-1,b=null,p.pop(),f=p.length>0?p[p.length-1]:null,d.pop(),h=d.length>0?d[d.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return x},this.setRenderTargetTextures=function(e,t,n){q.get(e.texture).__webglTexture=t,q.get(e.depthTexture).__webglTexture=n;var r=q.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===B.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){var n=q.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;x=e,g=t,y=n;var r=!0;if(e){var i=q.get(e);void 0!==i.__useDefaultFramebuffer?(H.bindFramebuffer(36160,null),r=!1):void 0===i.__webglFramebuffer?X.setupRenderTarget(e):i.__hasExternalTextures&&X.rebindTextures(e,q.get(e.texture).__webglTexture,q.get(e.depthTexture).__webglTexture)}var a=null,o=!1,s=!1;if(e){var u=e.texture;(u.isData3DTexture||u.isDataArrayTexture)&&(s=!0);var l=q.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(a=l[t],o=!0):a=W.isWebGL2&&e.samples>0&&!1===X.useMultisampledRTT(e)?q.get(e).__webglMultisampledFramebuffer:l,T.copy(e.viewport),M.copy(e.scissor),w=e.scissorTest}else T.copy(I).multiplyScalar(k).floor(),M.copy(R).multiplyScalar(k).floor(),w=L;var c=H.bindFramebuffer(36160,a);if(c&&W.drawBuffers&&r&&H.drawBuffers(e,a),H.viewport(T),H.scissor(M),H.setScissorTest(w),o){var h=q.get(e.texture);fe.framebufferTexture2D(36160,36064,34069+t,h.__webglTexture,n)}else if(s){var f=q.get(e.texture),d=t||0;fe.framebufferTextureLayer(36160,36064,f.__webglTexture,n||0,d)}_=-1},this.readRenderTargetPixels=function(e,t,n,r,i,a,o){if(e&&e.isWebGLRenderTarget){var s=q.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){H.bindFramebuffer(36160,s);try{var u=e.texture,l=u.format,c=u.type;if(l!==At&&le.convert(l)!==fe.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var h=c===Et&&(B.has("EXT_color_buffer_half_float")||W.isWebGL2&&B.has("EXT_color_buffer_float"));if(!(c===Tt||le.convert(c)===fe.getParameter(35738)||c===St&&(W.isWebGL2||B.has("OES_texture_float")||B.has("WEBGL_color_buffer_float"))||h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&fe.readPixels(t,n,r,i,le.convert(l),le.convert(c),a)}finally{var f=null!==x?q.get(x).__webglFramebuffer:null;H.bindFramebuffer(36160,f)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Math.pow(2,-n),i=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r);X.setTexture2D(t,0),fe.copyTexSubImage2D(3553,n,0,0,e.x,e.y,i,a),H.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=t.image.width,a=t.image.height,o=le.convert(n.format),s=le.convert(n.type);X.setTexture2D(n,0),fe.pixelStorei(37440,n.flipY),fe.pixelStorei(37441,n.premultiplyAlpha),fe.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?fe.texSubImage2D(3553,r,e.x,e.y,i,a,o,s,t.image.data):t.isCompressedTexture?fe.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):fe.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&fe.generateMipmap(3553),H.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(v.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var a,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,u=e.max.z-e.min.z+1,l=le.convert(r.format),c=le.convert(r.type);if(r.isData3DTexture)X.setTexture3D(r,0),a=32879;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");X.setTexture2DArray(r,0),a=35866}fe.pixelStorei(37440,r.flipY),fe.pixelStorei(37441,r.premultiplyAlpha),fe.pixelStorei(3317,r.unpackAlignment);var h=fe.getParameter(3314),f=fe.getParameter(32878),d=fe.getParameter(3316),p=fe.getParameter(3315),m=fe.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;fe.pixelStorei(3314,g.width),fe.pixelStorei(32878,g.height),fe.pixelStorei(3316,e.min.x),fe.pixelStorei(3315,e.min.y),fe.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?fe.texSubImage3D(a,i,t.x,t.y,t.z,o,s,u,l,c,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),fe.compressedTexSubImage3D(a,i,t.x,t.y,t.z,o,s,u,l,g.data)):fe.texSubImage3D(a,i,t.x,t.y,t.z,o,s,u,l,c,g),fe.pixelStorei(3314,h),fe.pixelStorei(32878,f),fe.pixelStorei(3316,d),fe.pixelStorei(3315,p),fe.pixelStorei(32877,m),0===i&&r.generateMipmaps&&fe.generateMipmap(a),H.unbindTexture()}},this.initTexture=function(e){e.isCubeTexture?X.setTextureCube(e,0):e.isData3DTexture?X.setTexture3D(e,0):e.isDataArrayTexture?X.setTexture2DArray(e,0):X.setTexture2D(e,0),H.unbindTexture()},this.resetState=function(){g=0,y=0,x=null,H.reset(),ce.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var Qs=function(e){Fe(r,e);var n=Ge(r);function r(){return t(this,r),n.apply(this,arguments)}return a(r)}(Js);Qs.prototype.isWebGL1Renderer=!0;var $s=function(e){Fe(r,e);var n=Ge(r);function r(){var e;return t(this,r),(e=n.call(this)).isScene=!0,e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:it(e)})),e}return a(r,[{key:"copy",value:function(e,t){return Pe(Oe(r.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=Pe(Oe(r.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}},{key:"autoUpdate",get:function(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate},set:function(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}]),r}(si);var eu=new ar,tu=new er,nu=new er,ru=new ar,iu=new Dr,au=function(e){Fe(r,e);var n=Ge(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e,i)).isSkinnedMesh=!0,a.type="SkinnedMesh",a.bindMode="attached",a.bindMatrix=new Dr,a.bindMatrixInverse=new Dr,a}return a(r,[{key:"copy",value:function(e,t){return Pe(Oe(r.prototype),"copy",this).call(this,e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}},{key:"bind",value:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var e=new er,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function(e){Pe(Oe(r.prototype),"updateMatrixWorld",this).call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"boneTransform",value:function(e,t){var n=this.skeleton,r=this.geometry;tu.fromBufferAttribute(r.attributes.skinIndex,e),nu.fromBufferAttribute(r.attributes.skinWeight,e),eu.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var i=0;i<4;i++){var a=nu.getComponent(i);if(0!==a){var o=tu.getComponent(i);iu.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(ru.copy(eu).applyMatrix4(iu),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}]),r}($i),ou=function(e){Fe(r,e);var n=Ge(r);function r(){var e;return t(this,r),(e=n.call(this)).isBone=!0,e.type="Bone",e}return a(r)}(si),su=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0,l=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,h=arguments.length>7?arguments[7]:void 0,f=arguments.length>8&&void 0!==arguments[8]?arguments[8]:gt,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:gt,p=arguments.length>10?arguments[10]:void 0,v=arguments.length>11?arguments[11]:void 0;return t(this,r),(e=n.call(this,null,l,c,h,f,d,s,u,p,v)).isDataTexture=!0,e.image={data:i,width:a,height:o},e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return a(r)}($n),uu=new Dr,lu=new Dr,cu=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];t(this,e),this.uuid=Mn(),this.bones=n.slice(0),this.boneInverses=r,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}return a(e,[{key:"init",value:function(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Dr)}}},{key:"calculateInverses",value:function(){this.boneInverses.length=0;for(var e=0,t=this.bones.length;e<t;e++){var n=new Dr;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}},{key:"pose",value:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(var r=0,i=this.bones.length;r<i;r++){var a=this.bones[r];a&&(a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))}}},{key:"update",value:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,a=e.length;i<a;i++){var o=e[i]?e[i].matrixWorld:lu;uu.multiplyMatrices(o,t[i]),uu.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)}},{key:"clone",value:function(){return new e(this.bones,this.boneInverses)}},{key:"computeBoneTexture",value:function(){var e=Math.sqrt(4*this.bones.length);e=An(e),e=Math.max(e,4);var t=new Float32Array(e*e*4);t.set(this.boneMatrices);var n=new su(t,e,e,At,St);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}},{key:"getBoneByName",value:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}},{key:"dispose",value:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}},{key:"fromJSON",value:function(e,t){this.uuid=e.uuid;for(var n=0,r=e.bones.length;n<r;n++){var i=e.bones[n],a=t[i];void 0===a&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),a=new ou),this.bones.push(a),this.boneInverses.push((new Dr).fromArray(e.boneInverses[n]))}return this.init(),this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;for(var t=this.bones,n=this.boneInverses,r=0,i=t.length;r<i;r++){var a=t[r];e.bones.push(a.uuid);var o=n[r];e.boneInverses.push(o.toArray())}return e}}]),e}(),hu=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this)).isLineBasicMaterial=!0,i.type="LineBasicMaterial",i.color=new Yn(16777215),i.linewidth=1,i.linecap="round",i.linejoin="round",i.fog=!0,i.setValues(e),i}return a(r,[{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}]),r}(_i),fu=new ar,du=new ar,pu=new Dr,vu=new Or,mu=new kr,gu=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Oi,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new hu;return t(this,r),(e=n.call(this)).isLine=!0,e.type="Line",e.geometry=i,e.material=a,e.updateMorphTargets(),e}return a(r,[{key:"copy",value:function(e,t){return Pe(Oe(r.prototype),"copy",this).call(this,e,t),this.material=e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,i=t.count;r<i;r++)fu.fromBufferAttribute(t,r-1),du.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=fu.distanceTo(du);e.setAttribute("lineDistance",new ki(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),mu.copy(n.boundingSphere),mu.applyMatrix4(r),mu.radius+=i,!1!==e.ray.intersectsSphere(mu)){pu.copy(r).invert(),vu.copy(e.ray).applyMatrix4(pu);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,u=new ar,l=new ar,c=new ar,h=new ar,f=this.isLineSegments?2:1,d=n.index,p=n.attributes.position;if(null!==d)for(var v=Math.max(0,a.start),m=Math.min(d.count,a.start+a.count)-1;v<m;v+=f){var g=d.getX(v),y=d.getX(v+1);if(u.fromBufferAttribute(p,g),l.fromBufferAttribute(p,y),!(vu.distanceSqToSegment(u,l,h,c)>s)){h.applyMatrix4(this.matrixWorld);var x=e.ray.origin.distanceTo(h);x<e.near||x>e.far||t.push({distance:x,point:c.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var _=Math.max(0,a.start),b=Math.min(p.count,a.start+a.count)-1;_<b;_+=f){if(u.fromBufferAttribute(p,_),l.fromBufferAttribute(p,_+1),!(vu.distanceSqToSegment(u,l,h,c)>s)){h.applyMatrix4(this.matrixWorld);var T=e.ray.origin.distanceTo(h);T<e.near||T>e.far||t.push({distance:T,point:c.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++){var a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}]),r}(si),yu=new ar,xu=new ar,_u=function(e){Fe(r,e);var n=Ge(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e,i)).isLineSegments=!0,a.type="LineSegments",a}return a(r,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[],r=0,i=t.count;r<i;r+=2)yu.fromBufferAttribute(t,r),xu.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+yu.distanceTo(xu);e.setAttribute("lineDistance",new ki(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}]),r}(gu),bu=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this)).isPointsMaterial=!0,i.type="PointsMaterial",i.color=new Yn(16777215),i.map=null,i.alphaMap=null,i.size=1,i.sizeAttenuation=!0,i.fog=!0,i.setValues(e),i}return a(r,[{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}]),r}(_i),Tu=new Dr,Mu=new Or,wu=new kr,Su=new ar,Eu=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Oi,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new bu;return t(this,r),(e=n.call(this)).isPoints=!0,e.type="Points",e.geometry=i,e.material=a,e.updateMorphTargets(),e}return a(r,[{key:"copy",value:function(e,t){return Pe(Oe(r.prototype),"copy",this).call(this,e,t),this.material=e.material,this.geometry=e.geometry,this}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,a=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),wu.copy(n.boundingSphere),wu.applyMatrix4(r),wu.radius+=i,!1!==e.ray.intersectsSphere(wu)){Tu.copy(r).invert(),Mu.copy(e.ray).applyMatrix4(Tu);var o=i/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,u=n.index,l=n.attributes.position;if(null!==u)for(var c=Math.max(0,a.start),h=Math.min(u.count,a.start+a.count);c<h;c++){var f=u.getX(c);Su.fromBufferAttribute(l,f),ku(Su,f,s,r,e,t,this)}else for(var d=Math.max(0,a.start),p=Math.min(l.count,a.start+a.count);d<p;d++)Su.fromBufferAttribute(l,d),ku(Su,d,s,r,e,t,this)}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,i=n.length;r<i;r++){var a=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}]),r}(si);function ku(e,t,n,r,i,a,o){var s=Mu.distanceSqToPoint(e);if(s<n){var u=new ar;Mu.closestPointToPoint(e,u),u.applyMatrix4(r);var l=i.ray.origin.distanceTo(u);if(l<i.near||l>i.far)return;a.push({distance:l,distanceToRay:Math.sqrt(s),point:u,index:t,face:null,object:o})}}var Au=function(){function e(){t(this,e),this.type="Curve",this.arcLengthDivisions=200}return a(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],r=this.getPoint(0),i=0;n.push(0);for(var a=1;a<=e;a++)i+=(t=this.getPoint(a/e)).distanceTo(r),n.push(i),r=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,r=this.getLengths(),i=0,a=r.length;n=t||e*r[a-1];for(var o,s=0,u=a-1;s<=u;)if((o=r[i=Math.floor(s+(u-s)/2)]-n)<0)s=i+1;else{if(!(o>0)){u=i;break}u=i-1}if(r[i=u]===n)return i/(a-1);var l=r[i];return(i+(n-l)/(r[i+1]-l))/(a-1)}},{key:"getTangent",value:function(e,t){var n=1e-4,r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);var a=this.getPoint(r),o=this.getPoint(i),s=t||(a.isVector2?new Pn:new ar);return s.copy(o).sub(a).normalize(),s}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new ar,r=[],i=[],a=[],o=new ar,s=new Dr,u=0;u<=e;u++){var l=u/e;r[u]=this.getTangentAt(l,new ar)}i[0]=new ar,a[0]=new ar;var c=Number.MAX_VALUE,h=Math.abs(r[0].x),f=Math.abs(r[0].y),d=Math.abs(r[0].z);h<=c&&(c=h,n.set(1,0,0)),f<=c&&(c=f,n.set(0,1,0)),d<=c&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),a[0].crossVectors(r[0],i[0]);for(var p=1;p<=e;p++){if(i[p]=i[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(r[p-1],r[p]),o.length()>Number.EPSILON){o.normalize();var v=Math.acos(wn(r[p-1].dot(r[p]),-1,1));i[p].applyMatrix4(s.makeRotationAxis(o,v))}a[p].crossVectors(r[p],i[p])}if(!0===t){var m=Math.acos(wn(i[0].dot(i[e]),-1,1));m/=e,r[0].dot(o.crossVectors(i[0],i[e]))>0&&(m=-m);for(var g=1;g<=e;g++)i[g].applyMatrix4(s.makeRotationAxis(r[g],m*g)),a[g].crossVectors(r[g],i[g])}return{tangents:r,normals:i,binormals:a}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),Cu=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return t(this,r),(e=n.call(this)).isEllipseCurve=!0,e.type="EllipseCurve",e.aX=i,e.aY=a,e.xRadius=o,e.yRadius=s,e.aStartAngle=u,e.aEndAngle=l,e.aClockwise=c,e.aRotation=h,e}return a(r,[{key:"getPoint",value:function(e,t){for(var n=t||new Pn,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var l=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,f=u-this.aY;s=h*l-f*c+this.aX,u=h*c+f*l+this.aY}return n.set(s,u)}},{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),r}(Au),Iu=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a,o,s,u){var l;return t(this,r),(l=n.call(this,e,i,a,a,o,s,u)).isArcCurve=!0,l.type="ArcCurve",l}return a(r)}(Cu);function Ru(){var e=0,t=0,n=0,r=0;function i(i,a,o,s){e=i,t=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,o,s){var u=(t-e)/a-(n-e)/(a+o)+(n-t)/o,l=(n-t)/o-(r-t)/(o+s)+(r-n)/s;i(t,n,u*=o,l*=o)},calc:function(i){var a=i*i;return e+t*i+n*a+r*(a*i)}}}var Lu=new ar,Pu=new Ru,Nu=new Ru,Ou=new Ru,Du=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return t(this,r),(e=n.call(this)).isCatmullRomCurve3=!0,e.type="CatmullRomCurve3",e.points=i,e.closed=a,e.curveType=o,e.tension=s,e}return a(r,[{key:"getPoint",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar,i=r,a=this.points,o=a.length,s=(o-(this.closed?0:1))*e,u=Math.floor(s),l=s-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/o)+1)*o:0===l&&u===o-1&&(u=o-2,l=1),this.closed||u>0?t=a[(u-1)%o]:(Lu.subVectors(a[0],a[1]).add(a[0]),t=Lu);var c=a[u%o],h=a[(u+1)%o];if(this.closed||u+2<o?n=a[(u+2)%o]:(Lu.subVectors(a[o-1],a[o-2]).add(a[o-1]),n=Lu),"centripetal"===this.curveType||"chordal"===this.curveType){var f="chordal"===this.curveType?.5:.25,d=Math.pow(t.distanceToSquared(c),f),p=Math.pow(c.distanceToSquared(h),f),v=Math.pow(h.distanceToSquared(n),f);p<1e-4&&(p=1),d<1e-4&&(d=p),v<1e-4&&(v=p),Pu.initNonuniformCatmullRom(t.x,c.x,h.x,n.x,d,p,v),Nu.initNonuniformCatmullRom(t.y,c.y,h.y,n.y,d,p,v),Ou.initNonuniformCatmullRom(t.z,c.z,h.z,n.z,d,p,v)}else"catmullrom"===this.curveType&&(Pu.initCatmullRom(t.x,c.x,h.x,n.x,this.tension),Nu.initCatmullRom(t.y,c.y,h.y,n.y,this.tension),Ou.initCatmullRom(t.z,c.z,h.z,n.z,this.tension));return i.set(Pu.calc(l),Nu.calc(l),Ou.calc(l)),i}},{key:"copy",value:function(e){Pe(Oe(r.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push((new ar).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),r}(Au);function Fu(e,t,n,r,i){var a=.5*(r-t),o=.5*(i-n),s=e*e;return(2*n-2*r+a+o)*(e*s)+(-3*n+3*r-2*a-o)*s+a*e+n}function Uu(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Gu(e,t,n,r,i){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}var zu=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pn,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pn,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Pn,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Pn;return t(this,r),(e=n.call(this)).isCubicBezierCurve=!0,e.type="CubicBezierCurve",e.v0=i,e.v1=a,e.v2=o,e.v3=s,e}return a(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pn,n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(Gu(e,r.x,i.x,a.x,o.x),Gu(e,r.y,i.y,a.y,o.y)),n}},{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),r}(Au),Vu=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ar,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ar,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ar;return t(this,r),(e=n.call(this)).isCubicBezierCurve3=!0,e.type="CubicBezierCurve3",e.v0=i,e.v1=a,e.v2=o,e.v3=s,e}return a(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar,n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(Gu(e,r.x,i.x,a.x,o.x),Gu(e,r.y,i.y,a.y,o.y),Gu(e,r.z,i.z,a.z,o.z)),n}},{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),r}(Au),Bu=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pn,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pn;return t(this,r),(e=n.call(this)).isLineCurve=!0,e.type="LineCurve",e.v1=i,e.v2=a,e}return a(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pn,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e,t){var n=t||new Pn;return n.copy(this.v2).sub(this.v1).normalize(),n}},{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),r}(Au),Wu=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ar,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar;return t(this,r),(e=n.call(this)).isLineCurve3=!0,e.type="LineCurve3",e.v1=i,e.v2=a,e}return a(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),r}(Au),Hu=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pn,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pn,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Pn;return t(this,r),(e=n.call(this)).isQuadraticBezierCurve=!0,e.type="QuadraticBezierCurve",e.v0=i,e.v1=a,e.v2=o,e}return a(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pn,n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(Uu(e,r.x,i.x,a.x),Uu(e,r.y,i.y,a.y)),n}},{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),r}(Au),ju=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ar,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ar;return t(this,r),(e=n.call(this)).isQuadraticBezierCurve3=!0,e.type="QuadraticBezierCurve3",e.v0=i,e.v1=a,e.v2=o,e}return a(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar,n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(Uu(e,r.x,i.x,a.x),Uu(e,r.y,i.y,a.y),Uu(e,r.z,i.z,a.z)),n}},{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),r}(Au),qu=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t(this,r),(e=n.call(this)).isSplineCurve=!0,e.type="SplineCurve",e.points=i,e}return a(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pn,n=t,r=this.points,i=(r.length-1)*e,a=Math.floor(i),o=i-a,s=r[0===a?a:a-1],u=r[a],l=r[a>r.length-2?r.length-1:a+1],c=r[a>r.length-3?r.length-1:a+2];return n.set(Fu(o,s.x,u.x,l.x,c.x),Fu(o,s.y,u.y,l.y,c.y)),n}},{key:"copy",value:function(e){Pe(Oe(r.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push(i.clone())}return this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var i=this.points[t];e.points.push(i.toArray())}return e}},{key:"fromJSON",value:function(e){Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var i=e.points[t];this.points.push((new Pn).fromArray(i))}return this}}]),r}(Au),Xu=Object.freeze({__proto__:null,ArcCurve:Iu,CatmullRomCurve3:Du,CubicBezierCurve:zu,CubicBezierCurve3:Vu,EllipseCurve:Cu,LineCurve:Bu,LineCurve3:Wu,QuadraticBezierCurve:Hu,QuadraticBezierCurve3:ju,SplineCurve:qu}),Yu=function(e){Fe(r,e);var n=Ge(r);function r(){var e;return t(this,r),(e=n.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return a(r,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Bu(t,e))}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=n){var a=r[i]-n,o=this.curves[i],s=o.getLength(),u=0===s?0:1-a/s;return o.getPointAt(u,t)}i++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],r=0,i=this.curves;r<i.length;r++)for(var a=i[r],o=a.isEllipseCurve?2*t:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),u=0;u<s.length;u++){var l=s[u];e&&e.equals(l)||(n.push(l),e=l)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){Pe(Oe(r.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e}},{key:"fromJSON",value:function(e){Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var i=e.curves[t];this.curves.push((new Xu[i.type]).fromJSON(i))}return this}}]),r}(Au),Ku=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this)).type="Path",i.currentPoint=new Pn,e&&i.setFromPoints(e),i}return a(r,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new Bu(this.currentPoint.clone(),new Pn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,r){var i=new Hu(this.currentPoint.clone(),new Pn(e,t),new Pn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}},{key:"bezierCurveTo",value:function(e,t,n,r,i,a){var o=new zu(this.currentPoint.clone(),new Pn(e,t),new Pn(n,r),new Pn(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new qu(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,r,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,i,a),this}},{key:"absarc",value:function(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this}},{key:"ellipse",value:function(e,t,n,r,i,a,o,s){var u=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(e+u,t+l,n,r,i,a,o,s),this}},{key:"absellipse",value:function(e,t,n,r,i,a,o,s){var u=new Cu(e,t,n,r,i,a,o,s);if(this.curves.length>0){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);return this.currentPoint.copy(c),this}},{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),r}(Yu),Zu=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;t(this,r),(e=n.call(this)).type="CylinderGeometry",e.parameters={radiusTop:i,radiusBottom:a,height:o,radialSegments:s,heightSegments:u,openEnded:l,thetaStart:c,thetaLength:h};var f=it(e);s=Math.floor(s),u=Math.floor(u);var d=[],p=[],v=[],m=[],g=0,y=[],x=o/2,_=0;function b(){for(var e=new ar,t=new ar,n=0,r=(a-i)/o,l=0;l<=u;l++){for(var b=[],T=l/u,M=T*(a-i)+i,w=0;w<=s;w++){var S=w/s,E=S*h+c,k=Math.sin(E),A=Math.cos(E);t.x=M*k,t.y=-T*o+x,t.z=M*A,p.push(t.x,t.y,t.z),e.set(k,r,A).normalize(),v.push(e.x,e.y,e.z),m.push(S,1-T),b.push(g++)}y.push(b)}for(var C=0;C<s;C++)for(var I=0;I<u;I++){var R=y[I][C],L=y[I+1][C],P=y[I+1][C+1],N=y[I][C+1];d.push(R,L,N),d.push(L,P,N),n+=6}f.addGroup(_,n,0),_+=n}function T(e){for(var t=g,n=new Pn,r=new ar,o=0,u=!0===e?i:a,l=!0===e?1:-1,y=1;y<=s;y++)p.push(0,x*l,0),v.push(0,l,0),m.push(.5,.5),g++;for(var b=g,T=0;T<=s;T++){var M=T/s*h+c,w=Math.cos(M),S=Math.sin(M);r.x=u*S,r.y=x*l,r.z=u*w,p.push(r.x,r.y,r.z),v.push(0,l,0),n.x=.5*w+.5,n.y=.5*S*l+.5,m.push(n.x,n.y),g++}for(var E=0;E<s;E++){var k=t+E,A=b+E;!0===e?d.push(A,A+1,k):d.push(A+1,A,k),o+=3}f.addGroup(_,o,!0===e?1:2),_+=o}return b(),!1===l&&(i>0&&T(!0),a>0&&T(!1)),e.setIndex(d),e.setAttribute("position",new ki(p,3)),e.setAttribute("normal",new ki(v,3)),e.setAttribute("uv",new ki(m,2)),e}return a(r,null,[{key:"fromJSON",value:function(e){return new r(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),r}(Oi),Ju=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;return t(this,r),(e=n.call(this,0,i,a,o,s,u,l,c)).type="ConeGeometry",e.parameters={radius:i,height:a,radialSegments:o,heightSegments:s,openEnded:u,thetaStart:l,thetaLength:c},e}return a(r,null,[{key:"fromJSON",value:function(e){return new r(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),r}(Zu),Qu=new ar,$u=new ar,el=new ar,tl=new yi,nl=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(t(this,r),(e=n.call(this)).type="EdgesGeometry",e.parameters={geometry:i,thresholdAngle:a},null!==i){for(var o=4,s=Math.pow(10,o),u=Math.cos(bn*a),l=i.getIndex(),c=i.getAttribute("position"),h=l?l.count:c.count,f=[0,0,0],d=["a","b","c"],p=new Array(3),v={},m=[],g=0;g<h;g+=3){l?(f[0]=l.getX(g),f[1]=l.getX(g+1),f[2]=l.getX(g+2)):(f[0]=g,f[1]=g+1,f[2]=g+2);var y=tl.a,x=tl.b,_=tl.c;if(y.fromBufferAttribute(c,f[0]),x.fromBufferAttribute(c,f[1]),_.fromBufferAttribute(c,f[2]),tl.getNormal(el),p[0]="".concat(Math.round(y.x*s),",").concat(Math.round(y.y*s),",").concat(Math.round(y.z*s)),p[1]="".concat(Math.round(x.x*s),",").concat(Math.round(x.y*s),",").concat(Math.round(x.z*s)),p[2]="".concat(Math.round(_.x*s),",").concat(Math.round(_.y*s),",").concat(Math.round(_.z*s)),p[0]!==p[1]&&p[1]!==p[2]&&p[2]!==p[0])for(var b=0;b<3;b++){var T=(b+1)%3,M=p[b],w=p[T],S=tl[d[b]],E=tl[d[T]],k="".concat(M,"_").concat(w),A="".concat(w,"_").concat(M);A in v&&v[A]?(el.dot(v[A].normal)<=u&&(m.push(S.x,S.y,S.z),m.push(E.x,E.y,E.z)),v[A]=null):k in v||(v[k]={index0:f[b],index1:f[T],normal:el.clone()})}}for(var C in v)if(v[C]){var I=v[C],R=I.index0,L=I.index1;Qu.fromBufferAttribute(c,R),$u.fromBufferAttribute(c,L),m.push(Qu.x,Qu.y,Qu.z),m.push($u.x,$u.y,$u.z)}e.setAttribute("position",new ki(m,3))}return e}return a(r)}(Oi),rl=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this,e)).uuid=Mn(),i.type="Shape",i.holes=[],i}return a(r,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){Pe(Oe(r.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push(i.clone())}return this}},{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e}},{key:"fromJSON",value:function(e){Pe(Oe(r.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var i=e.holes[t];this.holes.push((new Ku).fromJSON(i))}return this}}]),r}(Ku),il=function(e,t){var n,r,i,a,o,s,u,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,c=t&&t.length,h=c?t[0]*l:e.length,f=al(e,0,h,l,!0),d=[];if(!f||f.next===f.prev)return d;if(c&&(f=fl(e,t,f,l)),e.length>80*l){n=i=e[0],r=a=e[1];for(var p=l;p<h;p+=l)(o=e[p])<n&&(n=o),(s=e[p+1])<r&&(r=s),o>i&&(i=o),s>a&&(a=s);u=0!==(u=Math.max(i-n,a-r))?1/u:0}return sl(f,d,l,n,r,u),d};function al(e,t,n,r,i){var a,o;if(i===function(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,n,r)>0)for(a=t;a<n;a+=r)o=kl(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=kl(a,e[a],e[a+1],o);return o&&bl(o,o.next)&&(Al(o),o=o.next),o}function ol(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!bl(r,r.next)&&0!==_l(r.prev,r,r.next))r=r.next;else{if(Al(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function sl(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=ml(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,u,l=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,l*=2}while(o>1)}(i)}(e,r,i,a);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,a?ll(e,r,i,a):ul(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),Al(e),e=u.next,l=u.next;else if((e=u)===l){o?1===o?sl(e=cl(ol(e),t,n),t,n,r,i,a,2):2===o&&hl(e,t,n,r,i,a):sl(ol(e),t,n,r,i,a,1);break}}}function ul(e){var t=e.prev,n=e,r=e.next;if(_l(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(yl(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&_l(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function ll(e,t,n,r){var i=e.prev,a=e,o=e.next;if(_l(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,u=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,l=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=ml(s,u,t,n,r),f=ml(l,c,t,n,r),d=e.prevZ,p=e.nextZ;d&&d.z>=h&&p&&p.z<=f;){if(d!==e.prev&&d!==e.next&&yl(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&_l(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&yl(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&_l(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&yl(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&_l(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&yl(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&_l(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function cl(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!bl(i,a)&&Tl(i,r,r.next,a)&&Sl(i,a)&&Sl(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),Al(r),Al(r.next),r=e=a),r=r.next}while(r!==e);return ol(r)}function hl(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&xl(o,s)){var u=El(o,s);return o=ol(o,o.next),u=ol(u,u.next),sl(o,t,n,r,i,a),void sl(u,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function fl(e,t,n,r){var i,a,o,s=[];for(i=0,a=t.length;i<a;i++)(o=al(e,t[i]*r,i<a-1?t[i+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(gl(o));for(s.sort(dl),i=0;i<s.length;i++)pl(s[i],n),n=ol(n,n.next);return n}function dl(e,t){return e.x-t.x}function pl(e,t){if(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var u,l=n,c=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&yl(a<h?i:o,a,c,h,a<h?o:i,a,r.x,r.y)&&(u=Math.abs(a-r.y)/(i-r.x),Sl(r,e)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&vl(n,r)))&&(n=r,f=u)),r=r.next}while(r!==l);return n}(e,t),t){var n=El(t,e);ol(t,t.next),ol(n,n.next)}}function vl(e,t){return _l(e.prev,e,t.prev)<0&&_l(t.next,e,e.next)<0}function ml(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function gl(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function yl(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function xl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Tl(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Sl(e,t)&&Sl(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(_l(e.prev,e,t.prev)||_l(e,t.prev,t))||bl(e,t)&&_l(e.prev,e,e.next)>0&&_l(t.prev,t,t.next)>0)}function _l(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function bl(e,t){return e.x===t.x&&e.y===t.y}function Tl(e,t,n,r){var i=wl(_l(e,t,n)),a=wl(_l(e,t,r)),o=wl(_l(n,r,e)),s=wl(_l(n,r,t));return i!==a&&o!==s||(!(0!==i||!Ml(e,n,t))||(!(0!==a||!Ml(e,r,t))||(!(0!==o||!Ml(n,e,r))||!(0!==s||!Ml(n,t,r)))))}function Ml(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function wl(e){return e>0?1:e<0?-1:0}function Sl(e,t){return _l(e.prev,e,e.next)<0?_l(e,t,e.next)>=0&&_l(e,e.prev,t)>=0:_l(e,t,e.prev)<0||_l(e,e.next,t)<0}function El(e,t){var n=new Cl(e.i,e.x,e.y),r=new Cl(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function kl(e,t,n,r){var i=new Cl(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Al(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Cl(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Il=function(){function e(){t(this,e)}return a(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],r=[],i=[];Rl(e),Ll(n,e);var a=e.length;t.forEach(Rl);for(var o=0;o<t.length;o++)r.push(a),a+=t[o].length,Ll(n,t[o]);for(var s=il(n,r),u=0;u<s.length;u+=3)i.push(s.slice(u,u+3));return i}}]),e}();function Rl(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Ll(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var Pl=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new rl([new Pn(.5,.5),new Pn(-.5,.5),new Pn(-.5,-.5),new Pn(.5,-.5)]),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t(this,r),(e=n.call(this)).type="ExtrudeGeometry",e.parameters={shapes:i,options:a},i=Array.isArray(i)?i:[i];for(var o=it(e),s=[],u=[],l=0,c=i.length;l<c;l++){var h=i[l];f(h)}function f(e){var t,n,r,i,l,c=[],h=void 0!==a.curveSegments?a.curveSegments:12,f=void 0!==a.steps?a.steps:1,d=void 0!==a.depth?a.depth:1,p=void 0===a.bevelEnabled||a.bevelEnabled,v=void 0!==a.bevelThickness?a.bevelThickness:.2,m=void 0!==a.bevelSize?a.bevelSize:v-.1,g=void 0!==a.bevelOffset?a.bevelOffset:0,y=void 0!==a.bevelSegments?a.bevelSegments:3,x=a.extrudePath,_=void 0!==a.UVGenerator?a.UVGenerator:Nl,b=!1;x&&(t=x.getSpacedPoints(f),b=!0,p=!1,n=x.computeFrenetFrames(f,!1),r=new ar,i=new ar,l=new ar),p||(y=0,v=0,m=0,g=0);var T=e.extractPoints(h),M=T.shape,w=T.holes;if(!Il.isClockWise(M)){M=M.reverse();for(var S=0,E=w.length;S<E;S++){var k=w[S];Il.isClockWise(k)&&(w[S]=k.reverse())}}for(var A=Il.triangulateShape(M,w),C=M,I=0,R=w.length;I<R;I++){var L=w[I];M=M.concat(L)}function P(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var N=M.length,O=A.length;function D(e,t,n){var r,i,a,o=e.x-t.x,s=e.y-t.y,u=n.x-e.x,l=n.y-e.y,c=o*o+s*s,h=o*l-s*u;if(Math.abs(h)>Number.EPSILON){var f=Math.sqrt(c),d=Math.sqrt(u*u+l*l),p=t.x-s/f,v=t.y+o/f,m=((n.x-l/d-p)*l-(n.y+u/d-v)*u)/(o*l-s*u),g=(r=p+o*m-e.x)*r+(i=v+s*m-e.y)*i;if(g<=2)return new Pn(r,i);a=Math.sqrt(g/2)}else{var y=!1;o>Number.EPSILON?u>Number.EPSILON&&(y=!0):o<-Number.EPSILON?u<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(l)&&(y=!0),y?(r=-s,i=o,a=Math.sqrt(c)):(r=o,i=s,a=Math.sqrt(c/2))}return new Pn(r/a,i/a)}for(var F=[],U=0,G=C.length,z=G-1,V=U+1;U<G;U++,z++,V++)z===G&&(z=0),V===G&&(V=0),F[U]=D(C[U],C[z],C[V]);for(var B,W=[],H=F.concat(),j=0,q=w.length;j<q;j++){var X=w[j];B=[];for(var Y=0,K=X.length,Z=K-1,J=Y+1;Y<K;Y++,Z++,J++)Z===K&&(Z=0),J===K&&(J=0),B[Y]=D(X[Y],X[Z],X[J]);W.push(B),H=H.concat(B)}for(var Q=0;Q<y;Q++){for(var $=Q/y,ee=v*Math.cos($*Math.PI/2),te=m*Math.sin($*Math.PI/2)+g,ne=0,re=C.length;ne<re;ne++){var ie=P(C[ne],F[ne],te);Re(ie.x,ie.y,-ee)}for(var ae=0,oe=w.length;ae<oe;ae++){var se=w[ae];B=W[ae];for(var ue=0,le=se.length;ue<le;ue++){var ce=P(se[ue],B[ue],te);Re(ce.x,ce.y,-ee)}}}for(var he=m+g,fe=0;fe<N;fe++){var de=p?P(M[fe],H[fe],he):M[fe];b?(i.copy(n.normals[0]).multiplyScalar(de.x),r.copy(n.binormals[0]).multiplyScalar(de.y),l.copy(t[0]).add(i).add(r),Re(l.x,l.y,l.z)):Re(de.x,de.y,0)}for(var pe=1;pe<=f;pe++)for(var ve=0;ve<N;ve++){var me=p?P(M[ve],H[ve],he):M[ve];b?(i.copy(n.normals[pe]).multiplyScalar(me.x),r.copy(n.binormals[pe]).multiplyScalar(me.y),l.copy(t[pe]).add(i).add(r),Re(l.x,l.y,l.z)):Re(me.x,me.y,d/f*pe)}for(var ge=y-1;ge>=0;ge--){for(var ye=ge/y,xe=v*Math.cos(ye*Math.PI/2),_e=m*Math.sin(ye*Math.PI/2)+g,be=0,Te=C.length;be<Te;be++){var Me=P(C[be],F[be],_e);Re(Me.x,Me.y,d+xe)}for(var we=0,Se=w.length;we<Se;we++){var Ee=w[we];B=W[we];for(var ke=0,Ae=Ee.length;ke<Ae;ke++){var Ce=P(Ee[ke],B[ke],_e);b?Re(Ce.x,Ce.y+t[f-1].y,t[f-1].x+xe):Re(Ce.x,Ce.y,d+xe)}}}function Ie(e,t){for(var n=e.length;--n>=0;){var r=n,i=n-1;i<0&&(i=e.length-1);for(var a=0,o=f+2*y;a<o;a++){var s=N*a,u=N*(a+1);Pe(t+r+s,t+i+s,t+i+u,t+r+u)}}}function Re(e,t,n){c.push(e),c.push(t),c.push(n)}function Le(e,t,n){Ne(e),Ne(t),Ne(n);var r=s.length/3,i=_.generateTopUV(o,s,r-3,r-2,r-1);Oe(i[0]),Oe(i[1]),Oe(i[2])}function Pe(e,t,n,r){Ne(e),Ne(t),Ne(r),Ne(t),Ne(n),Ne(r);var i=s.length/3,a=_.generateSideWallUV(o,s,i-6,i-3,i-2,i-1);Oe(a[0]),Oe(a[1]),Oe(a[3]),Oe(a[1]),Oe(a[2]),Oe(a[3])}function Ne(e){s.push(c[3*e+0]),s.push(c[3*e+1]),s.push(c[3*e+2])}function Oe(e){u.push(e.x),u.push(e.y)}!function(){var e=s.length/3;if(p){for(var t=0,n=N*t,r=0;r<O;r++){var i=A[r];Le(i[2]+n,i[1]+n,i[0]+n)}n=N*(t=f+2*y);for(var a=0;a<O;a++){var u=A[a];Le(u[0]+n,u[1]+n,u[2]+n)}}else{for(var l=0;l<O;l++){var c=A[l];Le(c[2],c[1],c[0])}for(var h=0;h<O;h++){var d=A[h];Le(d[0]+N*f,d[1]+N*f,d[2]+N*f)}}o.addGroup(e,s.length/3-e,0)}(),function(){var e=s.length/3,t=0;Ie(C,t),t+=C.length;for(var n=0,r=w.length;n<r;n++){var i=w[n];Ie(i,t),t+=i.length}o.addGroup(e,s.length/3-e,1)}()}return e.setAttribute("position",new ki(s,3)),e.setAttribute("uv",new ki(u,2)),e.computeVertexNormals(),e}return a(r,[{key:"toJSON",value:function(){var e=Pe(Oe(r.prototype),"toJSON",this).call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var a=e[r];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}],[{key:"fromJSON",value:function(e,t){for(var n=[],i=0,a=e.shapes.length;i<a;i++){var o=t[e.shapes[i]];n.push(o)}var s=e.options.extrudePath;return void 0!==s&&(e.options.extrudePath=(new Xu[s.type]).fromJSON(s)),new r(n,e.options)}}]),r}(Oi),Nl={generateTopUV:function(e,t,n,r,i){var a=t[3*n],o=t[3*n+1],s=t[3*r],u=t[3*r+1],l=t[3*i],c=t[3*i+1];return[new Pn(a,o),new Pn(s,u),new Pn(l,c)]},generateSideWallUV:function(e,t,n,r,i,a){var o=t[3*n],s=t[3*n+1],u=t[3*n+2],l=t[3*r],c=t[3*r+1],h=t[3*r+2],f=t[3*i],d=t[3*i+1],p=t[3*i+2],v=t[3*a],m=t[3*a+1],g=t[3*a+2];return Math.abs(s-c)<Math.abs(o-l)?[new Pn(o,1-u),new Pn(l,1-h),new Pn(f,1-p),new Pn(v,1-g)]:[new Pn(s,1-u),new Pn(c,1-h),new Pn(d,1-p),new Pn(m,1-g)]}};var Ol=function(e){Fe(r,e);var n=Ge(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;t(this,r),(e=n.call(this)).type="SphereGeometry",e.parameters={radius:i,widthSegments:a,heightSegments:o,phiStart:s,phiLength:u,thetaStart:l,thetaLength:c},a=Math.max(3,Math.floor(a)),o=Math.max(2,Math.floor(o));for(var h=Math.min(l+c,Math.PI),f=0,d=[],p=new ar,v=new ar,m=[],g=[],y=[],x=[],_=0;_<=o;_++){var b=[],T=_/o,M=0;0==_&&0==l?M=.5/a:_==o&&h==Math.PI&&(M=-.5/a);for(var w=0;w<=a;w++){var S=w/a;p.x=-i*Math.cos(s+S*u)*Math.sin(l+T*c),p.y=i*Math.cos(l+T*c),p.z=i*Math.sin(s+S*u)*Math.sin(l+T*c),g.push(p.x,p.y,p.z),v.copy(p).normalize(),y.push(v.x,v.y,v.z),x.push(S+M,1-T),b.push(f++)}d.push(b)}for(var E=0;E<o;E++)for(var k=0;k<a;k++){var A=d[E][k+1],C=d[E][k],I=d[E+1][k],R=d[E+1][k+1];(0!==E||l>0)&&m.push(A,C,R),(E!==o-1||h<Math.PI)&&m.push(C,I,R)}return e.setIndex(m),e.setAttribute("position",new ki(g,3)),e.setAttribute("normal",new ki(y,3)),e.setAttribute("uv",new ki(x,2)),e}return a(r,null,[{key:"fromJSON",value:function(e){return new r(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]),r}(Oi);var Dl=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this)).isMeshStandardMaterial=!0,i.defines={STANDARD:""},i.type="MeshStandardMaterial",i.color=new Yn(16777215),i.roughness=1,i.metalness=0,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Yn(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new Pn(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.roughnessMap=null,i.metalnessMap=null,i.alphaMap=null,i.envMap=null,i.envMapIntensity=1,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.fog=!0,i.setValues(e),i}return a(r,[{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),r}(_i),Fl=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this)).isMeshPhongMaterial=!0,i.type="MeshPhongMaterial",i.color=new Yn(16777215),i.specular=new Yn(1118481),i.shininess=30,i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Yn(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new Pn(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.fog=!0,i.setValues(e),i}return a(r,[{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),r}(_i),Ul=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this)).isMeshLambertMaterial=!0,i.type="MeshLambertMaterial",i.color=new Yn(16777215),i.map=null,i.lightMap=null,i.lightMapIntensity=1,i.aoMap=null,i.aoMapIntensity=1,i.emissive=new Yn(0),i.emissiveIntensity=1,i.emissiveMap=null,i.bumpMap=null,i.bumpScale=1,i.normalMap=null,i.normalMapType=0,i.normalScale=new Pn(1,1),i.displacementMap=null,i.displacementScale=1,i.displacementBias=0,i.specularMap=null,i.alphaMap=null,i.envMap=null,i.combine=0,i.reflectivity=1,i.refractionRatio=.98,i.wireframe=!1,i.wireframeLinewidth=1,i.wireframeLinecap="round",i.wireframeLinejoin="round",i.flatShading=!1,i.fog=!0,i.setValues(e),i}return a(r,[{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),r}(_i);function Gl(e,t,n){return Vl(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)}function zl(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)}function Vl(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Bl(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n}function Wl(e,t,n){for(var r=e.length,i=new e.constructor(r),a=0,o=0;o!==r;++a)for(var s=n[a]*t,u=0;u!==t;++u)i[o++]=e[s+u];return i}function Hl(e,t,n,r){for(var i=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[i++];if(void 0!==a){var o=a[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[r])&&(t.push(a.time),n.push.apply(n,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[r])&&(t.push(a.time),o.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else do{void 0!==(o=a[r])&&(t.push(a.time),n.push(o)),a=e[i++]}while(void 0!==a)}}var jl=function(){function e(n,r,i,a){t(this,e),this.parameterPositions=n,this._cachedIndex=0,this.resultBuffer=void 0!==a?a:new r.constructor(i),this.sampleValues=r,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}return a(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var a;n:{r:if(!(e<r)){for(var o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(i=r,e<(r=t[++n]))break t}a=t.length;break n}if(e>=i)break e;var s=t[1];e<s&&(n=2,i=s);for(var u=n-2;;){if(void 0===i)return this._cachedIndex=0,this.copySampleValue_(0);if(n===u)break;if(r=i,e>=(i=t[--n-1]))break t}a=n,n=0}for(;n<a;){var l=n+a>>>1;e<t[l]?a=l:n=l+1}if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,a=0;a!==r;++a)t[a]=n[i+a];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}(),ql=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a,o){var s;return t(this,r),(s=n.call(this,e,i,a,o))._weightPrev=-0,s._offsetPrev=-0,s._weightNext=-0,s._offsetNext=-0,s.DefaultSettings_={endingStart:on,endingEnd:on},s}return a(r,[{key:"intervalChanged_",value:function(e,t,n){var r=this.parameterPositions,i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case sn:i=e,o=2*t-n;break;case un:o=t+r[i=r.length-2]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case sn:a=e,s=2*n-t;break;case un:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}var u=.5*(n-t),l=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-n),this._offsetPrev=i*l,this._offsetNext=a*l}},{key:"interpolate_",value:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,f=this._weightNext,d=(n-t)/(r-t),p=d*d,v=p*d,m=-h*v+2*h*p-h*d,g=(1+h)*v+(-1.5-2*h)*p+(-.5+h)*d+1,y=(-1-f)*v+(1.5+f)*p+.5*d,x=f*v-f*p,_=0;_!==o;++_)i[_]=m*a[l+_]+g*a[u+_]+y*a[s+_]+x*a[c+_];return i}}]),r}(jl),Xl=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a,o){return t(this,r),n.call(this,e,i,a,o)}return a(r,[{key:"interpolate_",value:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=(n-t)/(r-t),c=1-l,h=0;h!==o;++h)i[h]=a[u+h]*c+a[s+h]*l;return i}}]),r}(jl),Yl=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a,o){return t(this,r),n.call(this,e,i,a,o)}return a(r,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),r}(jl),Kl=function(){function e(n,r,i,a){if(t(this,e),void 0===n)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===r||0===r.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+n);this.name=n,this.times=zl(r,this.TimeBufferType),this.values=zl(i,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}return a(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new Yl(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new Xl(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new ql(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case nn:t=this.InterpolantFactoryMethodDiscrete;break;case rn:t=this.InterpolantFactoryMethodLinear;break;case an:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return nn;case this.InterpolantFactoryMethodLinear:return rn;case this.InterpolantFactoryMethodSmooth:return an}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,r=n.length,i=0,a=r-1;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(i=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=Gl(n,i,a),this.values=Gl(this.values,i*o,a*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=n[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==r&&Vl(r))for(var u=0,l=r.length;u!==l;++u){var c=r[u];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,c),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=Gl(this.times),t=Gl(this.values),n=this.getValueSize(),r=this.getInterpolation()===an,i=e.length-1,a=1,o=1;o<i;++o){var s=!1,u=e[o];if(u!==e[o+1]&&(1!==o||u!==e[0]))if(r)s=!0;else for(var l=o*n,c=l-n,h=l+n,f=0;f!==n;++f){var d=t[l+f];if(d!==t[c+f]||d!==t[h+f]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var p=o*n,v=a*n,m=0;m!==n;++m)t[v+m]=t[p+m]}++a}}if(i>0){e[a]=e[i];for(var g=i*n,y=a*n,x=0;x!==n;++x)t[y+x]=t[g+x];++a}return a!==e.length?(this.times=Gl(e,0,a),this.values=Gl(t,0,a*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=Gl(this.times,0),t=Gl(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:zl(e.times,Array),values:zl(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}]),e}();Kl.prototype.TimeBufferType=Float32Array,Kl.prototype.ValueBufferType=Float32Array,Kl.prototype.DefaultInterpolation=rn;var Zl=function(e){Fe(r,e);var n=Ge(r);function r(){return t(this,r),n.apply(this,arguments)}return a(r)}(Kl);Zl.prototype.ValueTypeName="bool",Zl.prototype.ValueBufferType=Array,Zl.prototype.DefaultInterpolation=nn,Zl.prototype.InterpolantFactoryMethodLinear=void 0,Zl.prototype.InterpolantFactoryMethodSmooth=void 0;var Jl=function(e){Fe(r,e);var n=Ge(r);function r(){return t(this,r),n.apply(this,arguments)}return a(r)}(Kl);Jl.prototype.ValueTypeName="color";var Ql=function(e){Fe(r,e);var n=Ge(r);function r(){return t(this,r),n.apply(this,arguments)}return a(r)}(Kl);Ql.prototype.ValueTypeName="number";var $l=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a,o){return t(this,r),n.call(this,e,i,a,o)}return a(r,[{key:"interpolate_",value:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t),u=e*o,l=u+o;u!==l;u+=4)ir.slerpFlat(i,0,a,u-o,a,u,s);return i}}]),r}(jl),ec=function(e){Fe(r,e);var n=Ge(r);function r(){return t(this,r),n.apply(this,arguments)}return a(r,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new $l(this.times,this.values,this.getValueSize(),e)}}]),r}(Kl);ec.prototype.ValueTypeName="quaternion",ec.prototype.DefaultInterpolation=rn,ec.prototype.InterpolantFactoryMethodSmooth=void 0;var tc=function(e){Fe(r,e);var n=Ge(r);function r(){return t(this,r),n.apply(this,arguments)}return a(r)}(Kl);tc.prototype.ValueTypeName="string",tc.prototype.ValueBufferType=Array,tc.prototype.DefaultInterpolation=nn,tc.prototype.InterpolantFactoryMethodLinear=void 0,tc.prototype.InterpolantFactoryMethodSmooth=void 0;var nc=function(e){Fe(r,e);var n=Ge(r);function r(){return t(this,r),n.apply(this,arguments)}return a(r)}(Kl);nc.prototype.ValueTypeName="vector";var rc=function(){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,i=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ln;t(this,e),this.name=n,this.tracks=i,this.duration=r,this.blendMode=a,this.uuid=Mn(),this.duration<0&&this.resetDuration()}return a(e,[{key:"resetDuration",value:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}},{key:"trim",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}},{key:"optimize",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},{key:"clone",value:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,a=n.length;i!==a;++i)t.push(ic(n[i]).scale(r));var o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}},{key:"toJSON",value:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},i=0,a=n.length;i!==a;++i)t.push(Kl.toJSON(n[i]));return r}},{key:"CreateFromMorphTargetSequence",value:function(e,t,n,r){for(var i=t.length,a=[],o=0;o<i;o++){var s=[],u=[];s.push((o+i-1)%i,o,(o+1)%i),u.push(0,1,0);var l=Bl(s);s=Wl(s,1,l),u=Wl(u,1,l),r||0!==s[0]||(s.push(i),u.push(u[0])),a.push(new Ql(".morphTargetInfluences["+t[o].name+"]",s,u).scale(1/n))}return new this(e,-1,a)}},{key:"findByName",value:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(e,t,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],u=s.name.match(i);if(u&&u.length>1){var l=u[1],c=r[l];c||(r[l]=c=[]),c.push(s)}}var h=[];for(var f in r)h.push(this.CreateFromMorphTargetSequence(f,r[f],t,n));return h}},{key:"parseAnimation",value:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,i){if(0!==n.length){var a=[],o=[];Hl(n,a,o,r),0!==a.length&&i.push(new e(t,a,o))}},r=[],i=e.name||"default",a=e.fps||30,o=e.blendMode,s=e.length||-1,u=e.hierarchy||[],l=0;l<u.length;l++){var c=u[l].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},f=void 0;for(f=0;f<c.length;f++)if(c[f].morphTargets)for(var d=0;d<c[f].morphTargets.length;d++)h[c[f].morphTargets[d]]=-1;for(var p in h){for(var v=[],m=[],g=0;g!==c[f].morphTargets.length;++g){var y=c[f];v.push(y.time),m.push(y.morphTarget===p?1:0)}r.push(new Ql(".morphTargetInfluence["+p+"]",v,m))}s=h.length*a}else{var x=".bones["+t[l].name+"]";n(nc,x+".position",c,"pos",r),n(ec,x+".quaternion",c,"rot",r),n(nc,x+".scale",c,"scl",r)}}return 0===r.length?null:new this(i,s,r,o)}}]),e}();function ic(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ql;case"vector":case"vector2":case"vector3":case"vector4":return nc;case"color":return Jl;case"quaternion":return ec;case"bool":case"boolean":return Zl;case"string":return tc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];Hl(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var ac={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},oc=a((function e(n,r,i){t(this,e);var a=this,o=!1,s=0,u=0,l=void 0,c=[];this.onStart=void 0,this.onLoad=n,this.onProgress=r,this.onError=i,this.itemStart=function(e){u++,!1===o&&void 0!==a.onStart&&a.onStart(e,s,u),o=!0},this.itemEnd=function(e){s++,void 0!==a.onProgress&&a.onProgress(e,s,u),s===u&&(o=!1,void 0!==a.onLoad&&a.onLoad())},this.itemError=function(e){void 0!==a.onError&&a.onError(e)},this.resolveURL=function(e){return l?l(e):e},this.setURLModifier=function(e){return l=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){var t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=c.length;t<n;t+=2){var r=c[t],i=c[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}})),sc=new oc,uc=function(){function e(n){t(this,e),this.manager=void 0!==n?n:sc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return a(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),lc={},cc=function(e){Fe(r,e);var n=Ge(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e)).response=i,a}return a(r)}(et(Error)),hc=function(e){Fe(r,e);var n=Ge(r);function r(e){return t(this,r),n.call(this,e)}return a(r,[{key:"load",value:function(e,t,n,r){var i=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=ac.get(e);if(void 0!==a)return this.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;if(void 0===lc[e]){lc[e]=[],lc[e].push({onLoad:t,onProgress:n,onError:r});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,u=this.responseType;fetch(o).then((function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;var n=lc[e],r=t.body.getReader(),i=t.headers.get("Content-Length"),a=i?parseInt(i):0,o=0!==a,s=0,u=new ReadableStream({start:function(e){!function t(){r.read().then((function(r){var i=r.done,u=r.value;if(i)e.close();else{s+=u.byteLength;for(var l=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:a}),c=0,h=n.length;c<h;c++){var f=n[c];f.onProgress&&f.onProgress(l)}e.enqueue(u),t()}}))}()}});return new Response(u)}throw new cc('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText),t)})).then((function(e){switch(u){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((function(e){return(new DOMParser).parseFromString(e,s)}));case"json":return e.json();default:if(void 0===s)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((function(e){return r.decode(e)}))}})).then((function(t){ac.add(e,t);var n=lc[e];delete lc[e];for(var r=0,i=n.length;r<i;r++){var a=n[r];a.onLoad&&a.onLoad(t)}})).catch((function(t){var n=lc[e];if(void 0===n)throw i.manager.itemError(e),t;delete lc[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemError(e)})).finally((function(){i.manager.itemEnd(e)})),this.manager.itemStart(e)}else lc[e].push({onLoad:t,onProgress:n,onError:r})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),r}(uc),fc=function(e){Fe(r,e);var n=Ge(r);function r(e){return t(this,r),n.call(this,e)}return a(r,[{key:"load",value:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=ac.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;var o=Dn("img");function s(){l(),ac.add(e,this),t&&t(this),i.manager.itemEnd(e)}function u(t){l(),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}function l(){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",u,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}]),r}(uc),dc=function(e){Fe(r,e);var n=Ge(r);function r(e){return t(this,r),n.call(this,e)}return a(r,[{key:"load",value:function(e,t,n,r){var i=new ca,a=new fc(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],(function(e){i.images[n]=e,6===++o&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(var u=0;u<e.length;++u)s(u);return i}}]),r}(uc),pc=function(e){Fe(r,e);var n=Ge(r);function r(e){return t(this,r),n.call(this,e)}return a(r,[{key:"load",value:function(e,t,n,r){var i=this,a=new su,o=new hc(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(e,(function(e){var n=i.parse(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:vt,a.wrapT=void 0!==n.wrapT?n.wrapT:vt,a.magFilter=void 0!==n.magFilter?n.magFilter:_t,a.minFilter=void 0!==n.minFilter?n.minFilter:_t,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(a.encoding=n.encoding),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=bt),1===n.mipmapCount&&(a.minFilter=_t),void 0!==n.generateMipmaps&&(a.generateMipmaps=n.generateMipmaps),a.needsUpdate=!0,t&&t(a,n))}),n,r),a}}]),r}(uc),vc=function(e){Fe(r,e);var n=Ge(r);function r(e){return t(this,r),n.call(this,e)}return a(r,[{key:"load",value:function(e,t,n,r){var i=new $n,a=new fc(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}]),r}(uc),mc=function(e){Fe(r,e);var n=Ge(r);function r(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t(this,r),(i=n.call(this)).isLight=!0,i.type="Light",i.color=new Yn(e),i.intensity=a,i}return a(r,[{key:"dispose",value:function(){}},{key:"copy",value:function(e,t){return Pe(Oe(r.prototype),"copy",this).call(this,e,t),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=Pe(Oe(r.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),r}(si),gc=new Dr,yc=new ar,xc=new ar,_c=function(){function e(n){t(this,e),this.camera=n,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Pn(512,512),this.map=null,this.mapPass=null,this.matrix=new Dr,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ya,this._frameExtents=new Pn(1,1),this._viewportCount=1,this._viewports=[new er(0,0,1,1)]}return a(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;yc.setFromMatrixPosition(e.matrixWorld),t.position.copy(yc),xc.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(xc),t.updateMatrixWorld(),gc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gc),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(gc)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),bc=function(e){Fe(r,e);var n=Ge(r);function r(){var e;return t(this,r),(e=n.call(this,new sa(50,1,.5,500))).isSpotLightShadow=!0,e.focus=1,e}return a(r,[{key:"updateMatrices",value:function(e){var t=this.camera,n=2*Tn*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,a=e.distance||t.far;n===t.fov&&i===t.aspect&&a===t.far||(t.fov=n,t.aspect=i,t.far=a,t.updateProjectionMatrix()),Pe(Oe(r.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),r}(_c),Tc=function(e){Fe(r,e);var n=Ge(r);function r(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return t(this,r),(a=n.call(this,e,i)).isSpotLight=!0,a.type="SpotLight",a.position.copy(si.DefaultUp),a.updateMatrix(),a.target=new si,a.distance=o,a.angle=s,a.penumbra=u,a.decay=l,a.map=null,a.shadow=new bc,a}return a(r,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return Pe(Oe(r.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),r}(mc),Mc=new Dr,wc=new ar,Sc=new ar,Ec=function(e){Fe(r,e);var n=Ge(r);function r(){var e;return t(this,r),(e=n.call(this,new sa(90,1,.5,500))).isPointLightShadow=!0,e._frameExtents=new Pn(4,2),e._viewportCount=6,e._viewports=[new er(2,1,1,1),new er(0,1,1,1),new er(3,1,1,1),new er(1,1,1,1),new er(3,0,1,1),new er(1,0,1,1)],e._cubeDirections=[new ar(1,0,0),new ar(-1,0,0),new ar(0,0,1),new ar(0,0,-1),new ar(0,1,0),new ar(0,-1,0)],e._cubeUps=[new ar(0,1,0),new ar(0,1,0),new ar(0,1,0),new ar(0,1,0),new ar(0,0,1),new ar(0,0,-1)],e}return a(r,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),wc.setFromMatrixPosition(e.matrixWorld),n.position.copy(wc),Sc.copy(n.position),Sc.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Sc),n.updateMatrixWorld(),r.makeTranslation(-wc.x,-wc.y,-wc.z),Mc.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Mc)}}]),r}(_c),kc=function(e){Fe(r,e);var n=Ge(r);function r(e,i){var a,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return t(this,r),(a=n.call(this,e,i)).isPointLight=!0,a.type="PointLight",a.distance=o,a.decay=s,a.shadow=new Ec,a}return a(r,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return Pe(Oe(r.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),r}(mc),Ac=function(e){Fe(r,e);var n=Ge(r);function r(){var e;return t(this,r),(e=n.call(this,new Ra(-5,5,5,-5,.5,500))).isDirectionalLightShadow=!0,e}return a(r)}(_c),Cc=function(e){Fe(r,e);var n=Ge(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e,i)).isDirectionalLight=!0,a.type="DirectionalLight",a.position.copy(si.DefaultUp),a.updateMatrix(),a.target=new si,a.shadow=new Ac,a}return a(r,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return Pe(Oe(r.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),r}(mc),Ic=function(e){Fe(r,e);var n=Ge(r);function r(e,i){var a;return t(this,r),(a=n.call(this,e,i)).isAmbientLight=!0,a.type="AmbientLight",a}return a(r)}(mc),Rc=function(){function e(){t(this,e)}return a(e,null,[{key:"decodeText",value:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}},{key:"extractUrlBase",value:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}},{key:"resolveURL",value:function(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}]),e}();var Lc="\\[\\]\\.:\\/",Pc=new RegExp("[\\[\\]\\.:\\/]","g"),Nc="[^\\[\\]\\.:\\/]",Oc="[^"+Lc.replace("\\.","")+"]",Dc=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Nc)+/(WCOD+)?/.source.replace("WCOD",Oc)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Nc)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Nc)+"$"),Fc=["material","materials","bones","map"],Uc=function(){function e(n,r,i){t(this,e);var a=i||Gc.parseTrackName(r);this._targetGroup=n,this._bindings=n.subscribe_(r,a)}return a(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),Gc=function(){function e(n,r,i){t(this,e),this.path=r,this.parsedPath=i||e.parseTrackName(r),this.node=e.findNode(n,this.parsedPath.nodeName)||n,this.rootNode=n,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return a(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,r=n.objectName,i=n.propertyName,a=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=n.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var u=t[i];if(void 0!==u){var l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var c=this.BindingType.Direct;if(void 0!==a){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[a]&&(a=t.morphTargetDictionary[a])}c=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=a}else void 0!==u.fromArray&&void 0!==u.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(c=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}else{var h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+i+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,r){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,r):new e(t,n,r)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(Pc,"")}},{key:"parseTrackName",value:function(e){var t=Dc.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==Fc.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function e(n){for(var r=0;r<n.length;r++){var i=n[r];if(i.name===t||i.uuid===t)return i;var a=e(i.children);if(a)return a}return null}(e.children);if(r)return r}return null}}]),e}();Gc.Composite=Uc,Gc.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Gc.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Gc.prototype.GetterByBindingType=[Gc.prototype._getValue_direct,Gc.prototype._getValue_array,Gc.prototype._getValue_arrayElement,Gc.prototype._getValue_toArray],Gc.prototype.SetterByBindingTypeAndVersioning=[[Gc.prototype._setValue_direct,Gc.prototype._setValue_direct_setNeedsUpdate,Gc.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Gc.prototype._setValue_array,Gc.prototype._setValue_array_setNeedsUpdate,Gc.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Gc.prototype._setValue_arrayElement,Gc.prototype._setValue_arrayElement_setNeedsUpdate,Gc.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Gc.prototype._setValue_fromArray,Gc.prototype._setValue_fromArray_setNeedsUpdate,Gc.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];new Float32Array(1);var zc=function(){function e(n,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;t(this,e),this.ray=new Or(n,r),this.near=i,this.far=a,this.camera=null,this.layers=new Xr,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}return a(e,[{key:"set",value:function(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}},{key:"intersectObject",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return Bc(e,this,n,t),n.sort(Vc),n}},{key:"intersectObjects",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=0,i=e.length;r<i;r++)Bc(e[r],this,n,t);return n.sort(Vc),n}}]),e}();function Vc(e,t){return e.distance-t.distance}function Bc(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r)for(var i=e.children,a=0,o=i.length;a<o;a++)Bc(i[a],t,n,!0)}var Wc=new Pn,Hc=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Pn(1/0,1/0),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Pn(-1/0,-1/0);t(this,e),this.isBox2=!0,this.min=n,this.max=r}return a(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Wc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return Wc.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();var jc=function(){function e(){t(this,e),this.type="ShapePath",this.color=new Yn,this.subPaths=[],this.currentPath=null}return a(e,[{key:"moveTo",value:function(e,t){return this.currentPath=new Ku,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}},{key:"lineTo",value:function(e,t){return this.currentPath.lineTo(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}},{key:"bezierCurveTo",value:function(e,t,n,r,i,a){return this.currentPath.bezierCurveTo(e,t,n,r,i,a),this}},{key:"splineThru",value:function(e){return this.currentPath.splineThru(e),this}},{key:"toShapes",value:function(e){function t(e,t){for(var n=t.length,r=!1,i=n-1,a=0;a<n;i=a++){var o=t[i],s=t[a],u=s.x-o.x,l=s.y-o.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(o=t[a],u=-u,s=t[i],l=-l),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var c=l*(e.x-o.x)-u*(e.y-o.y);if(0===c)return!0;if(c<0)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return r}var n,r,i,a=Il.isClockWise,o=this.subPaths;if(0===o.length)return[];var s=[];if(1===o.length)return r=o[0],(i=new rl).curves=r.curves,s.push(i),s;var u=!a(o[0].getPoints());u=e?!u:u;var l,c,h=[],f=[],d=[],p=0;f[p]=void 0,d[p]=[];for(var v=0,m=o.length;v<m;v++)n=a(l=(r=o[v]).getPoints()),(n=e?!n:n)?(!u&&f[p]&&p++,f[p]={s:new rl,p:l},f[p].s.curves=r.curves,u&&p++,d[p]=[]):d[p].push({h:r,p:l[0]});if(!f[0])return function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],a=new rl;a.curves=i.curves,t.push(a)}return t}(o);if(f.length>1){for(var g=!1,y=0,x=0,_=f.length;x<_;x++)h[x]=[];for(var b=0,T=f.length;b<T;b++)for(var M=d[b],w=0;w<M.length;w++){for(var S=M[w],E=!0,k=0;k<f.length;k++)t(S.p,f[k].p)&&(b!==k&&y++,E?(E=!1,h[k].push(S)):g=!0);E&&h[b].push(S)}y>0&&!1===g&&(d=h)}for(var A=0,C=f.length;A<C;A++){i=f[A].s,s.push(i);for(var I=0,R=(c=d[A]).length;I<R;I++)i.holes.push(c[I].h)}return s}}]),e}();function qc(){var e=document.createElement("canvas");document.body.appendChild(e);var t=new Js({canvas:e,antialias:!0});t.setClearColor("#ffffff",1),t.setSize(10,10);var n=new $s,r=new Ic(8947848);n.add(r);var i=new Cc(8947848);i.position.set(0,0,1),n.add(i);var a=new sa(45,1,.1,1e3);a.position.set(0,0,1),a.up.set(0,1,0),a.lookAt(new ar(0,0,0)),n.add(a);var o=new ba(1,1),s=new $i(o,new Fl({color:13369344}));n.add(s),t.render(n,a);var u=t.getContext(),l=new Uint8Array(4);u.readPixels(5,5,1,1,u.RGBA,u.UNSIGNED_BYTE,l),document.body.removeChild(e);return l[0]<50&&l[1]<50&&l[2]<50}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:st}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=st);var Xc={Phong:1,Physical:2};function Yc(e){for(var t=0,n=0,r=0;r<e.MaterialCount();r++){var i=e.GetMaterial(r);i.type===We.Phong?t+=1:i.type===We.Physical&&(n+=1)}return t>=n?Xc.Phong:Xc.Physical}function Kc(e){return xe(e.r,e.g,e.b)}function Zc(e){return new Yn(e.r/255,e.g/255,e.b/255)}function Jc(e,t){for(var n=new Qe,r=e.attributes.position.array,i=e.attributes.position.itemSize||3,a=0;a<r.length;a+=i){var o=r[a],s=r[a+1],u=r[a+2];n.AddVertex(new ae(o,s,u))}var l=void 0!==e.attributes.color;if(l)for(var c=e.attributes.color.array,h=e.attributes.color.itemSize||3,f=0;f<c.length;f+=h){var d=new Yn(c[f],c[f+1],c[f+2]);n.AddVertexColor(Kc(d))}var p=void 0!==e.attributes.normal;if(p)for(var v=e.attributes.normal.array,m=e.attributes.normal.itemSize||3,g=0;g<v.length;g+=m){var y=v[g],x=v[g+1],_=v[g+2];n.AddNormal(new ae(y,x,_))}var b=void 0!==e.attributes.uv;if(b)for(var T=e.attributes.uv.array,M=e.attributes.uv.itemSize||2,w=0;w<T.length;w+=M){var S=T[w],E=T[w+1];n.AddTextureUV(new Ae(S,E))}var k=null;if(null!==e.index)k=e.index.array;else{k=[];for(var A=0;A<r.length/3;A++)k.push(A)}for(var C=0;C<k.length;C+=3){var I=k[C],R=k[C+1],L=k[C+2],P=new $e(I,R,L);l&&P.SetVertexColors(I,R,L),p&&P.SetNormals(I,R,L),b&&P.SetTextureUVs(I,R,L),null!==t&&P.SetMaterial(t),n.AddTriangle(P)}return n}var Qc=function(){function e(t,n,r,a){i()(this,e),this.eye=t,this.center=n,this.up=r,this.fov=a}return o()(e,[{key:"Clone",value:function(){return new e(this.eye.Clone(),this.center.Clone(),this.up.Clone(),this.fov)}}]),e}();function $c(e,t){return oe(e.eye,t.eye)&&oe(e.center,t.center)&&oe(e.up,t.up)&&ee(e.fov,t.fov)}function eh(e){return Math.round(parseFloat(e))}function th(e){return eh(e.paddingLeft)+eh(e.paddingRight)+(eh(e.borderLeftWidth)+eh(e.borderRightWidth))+(eh(e.marginLeft)+eh(e.marginRight))}function nh(e){return eh(e.paddingTop)+eh(e.paddingBottom)+(eh(e.borderTopWidth)+eh(e.borderBottomWidth))+(eh(e.marginTop)+eh(e.marginBottom))}function rh(e,t,n){var r=getComputedStyle(e);return{width:t-th(r),height:n-nh(r)}}function ih(e,t,n){if(e.getBoundingClientRect){var r=e.getBoundingClientRect();t-=r.left,n-=r.top}return window.pageXOffset&&window.pageYOffset&&(t+=window.pageXOffset,n+=window.pageYOffset),new Ae(t,n)}function ah(e,t,n){var r=document.createElement(e);return t&&(r.className=t),n&&(r.innerHTML=n),r}function oh(e,t,n,r){var i=ah(t,n,r);return e.appendChild(i),i}function sh(e,t,n){return oh(e,"div",t,n)}function uh(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function lh(e,t){t.parentNode.insertBefore(e,t)}function ch(e,t){t.parentNode.insertBefore(e,t.nextSibling)}function hh(e,t){e.style.display=t?"block":"none"}function fh(e){return null!==e.offsetParent}function dh(e,t){e.style.width=t.toString()+"px"}function ph(e,t){e.style.height=t.toString()+"px"}function vh(e){var t=getComputedStyle(e);return e.offsetWidth+eh(t.marginLeft)+eh(t.marginRight)}function mh(e){var t=getComputedStyle(e);return e.offsetHeight+eh(t.marginTop)+eh(t.marginBottom)}function gh(e,t){dh(e,t-th(getComputedStyle(e)))}function yh(e,t){ph(e,t-nh(getComputedStyle(e)))}function xh(e,t){return ah("div",e,t)}function _h(e,t,n){var r=t/n;return e*(r*r*(3-2*r))}function bh(e,t,n){return t*e/n}function Th(e,t,n){var r=t/n,i=r*r;return e*(i/(2*(i-r)+1))}function Mh(e,t,n,r){for(var i=ue(t,e).Normalize(),a=le(e,t),o=[],s=0;s<n;s++){var u=r(a,s,n-1);o.push(e.Clone().Offset(i,u))}return o}var wh=function(){function e(){i()(this,e),this.prev=new Ae(0,0),this.curr=new Ae(0,0),this.diff=new Ae(0,0),this.buttons=[]}return o()(e,[{key:"Down",value:function(e,t){this.buttons.push(t.which),this.curr=this.GetPositionFromEvent(e,t),this.prev=this.curr.Clone()}},{key:"Move",value:function(e,t){this.curr=this.GetPositionFromEvent(e,t),this.diff=Re(this.curr,this.prev),this.prev=this.curr.Clone()}},{key:"Up",value:function(e,t){var n=this.buttons.indexOf(t.which);-1!==n&&this.buttons.splice(n,1),this.curr=this.GetPositionFromEvent(e,t)}},{key:"Leave",value:function(e,t){this.buttons=[],this.curr=this.GetPositionFromEvent(e,t)}},{key:"IsButtonDown",value:function(){return this.buttons.length>0}},{key:"GetButton",value:function(){var e=this.buttons.length;return 0===e?0:this.buttons[e-1]}},{key:"GetPosition",value:function(){return this.curr}},{key:"GetMoveDiff",value:function(){return this.diff}},{key:"GetPositionFromEvent",value:function(e,t){return ih(e,t.clientX,t.clientY)}}]),e}(),Sh=function(){function e(){i()(this,e),this.prevPos=new Ae(0,0),this.currPos=new Ae(0,0),this.diffPos=new Ae(0,0),this.prevDist=0,this.currDist=0,this.diffDist=0,this.fingers=0}return o()(e,[{key:"Start",value:function(e,t){0!==t.touches.length&&(this.fingers=t.touches.length,this.currPos=this.GetPositionFromEvent(e,t),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistanceFromEvent(e,t),this.prevDist=this.currDist)}},{key:"Move",value:function(e,t){0!==t.touches.length&&(this.currPos=this.GetPositionFromEvent(e,t),this.diffPos=Re(this.currPos,this.prevPos),this.prevPos=this.currPos.Clone(),this.currDist=this.GetTouchDistanceFromEvent(e,t),this.diffDist=this.currDist-this.prevDist,this.prevDist=this.currDist)}},{key:"End",value:function(e,t){0!==t.touches.length&&(this.fingers=0,this.currPos=this.GetPositionFromEvent(e,t),this.currDist=this.GetTouchDistanceFromEvent(e,t))}},{key:"IsFingerDown",value:function(){return 0!==this.fingers}},{key:"GetFingerCount",value:function(){return this.fingers}},{key:"GetPosition",value:function(){return this.currPos}},{key:"GetMoveDiff",value:function(){return this.diffPos}},{key:"GetDistanceDiff",value:function(){return this.diffDist}},{key:"GetPositionFromEvent",value:function(e,t){var n=null;if(0!==t.touches.length){var r=t.touches[0];n=ih(e,r.pageX,r.pageY)}return n}},{key:"GetTouchDistanceFromEvent",value:function(e,t){if(2!==t.touches.length)return 0;var n=t.touches[0],r=t.touches[1];return Le(ih(e,n.pageX,n.pageY),ih(e,r.pageX,r.pageY))}}]),e}(),Eh=function(){function e(){i()(this,e),this.isClick=!1,this.startPosition=null}return o()(e,[{key:"Start",value:function(e){this.isClick=!0,this.startPosition=e}},{key:"Move",value:function(e){if(this.isClick)if(null!==this.startPosition){Le(this.startPosition,e)>3&&this.Cancel()}else this.Cancel()}},{key:"End",value:function(){this.startPosition=null}},{key:"Cancel",value:function(){this.isClick=!1,this.startPosition=null}},{key:"IsClick",value:function(){return this.isClick}}]),e}(),kh={None:0,Orbit:1,Pan:2,Zoom:3},Ah=function(){function e(t,n,r){i()(this,e),this.canvas=t,this.camera=n,this.callbacks=r,this.fixUpVector=!0,this.mouse=new wh,this.touch=new Sh,this.clickDetector=new Eh,this.onMouseClick=null,this.onMouseMove=null,this.onContext=null,this.canvas.addEventListener&&(this.canvas.addEventListener("mousedown",this.OnMouseDown.bind(this)),this.canvas.addEventListener("wheel",this.OnMouseWheel.bind(this)),this.canvas.addEventListener("touchstart",this.OnTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.OnTouchMove.bind(this)),this.canvas.addEventListener("touchcancel",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("touchend",this.OnTouchEnd.bind(this)),this.canvas.addEventListener("contextmenu",this.OnContextMenu.bind(this))),document.addEventListener&&(document.addEventListener("mousemove",this.OnMouseMove.bind(this)),document.addEventListener("mouseup",this.OnMouseUp.bind(this)),document.addEventListener("mouseleave",this.OnMouseLeave.bind(this)))}return o()(e,[{key:"SetMouseClickHandler",value:function(e){this.onMouseClick=e}},{key:"SetMouseMoveHandler",value:function(e){this.onMouseMove=e}},{key:"SetContextMenuHandler",value:function(e){this.onContext=e}},{key:"IsFixUpVector",value:function(){return this.fixUpVector}},{key:"SetFixUpVector",value:function(e){this.fixUpVector=e}},{key:"GetCamera",value:function(){return this.camera}},{key:"SetCamera",value:function(e){this.camera=e}},{key:"MoveCamera",value:function(e,t){var n=this;function r(e,t,n,i){e.camera.eye=t.eye[i],e.camera.center=t.center[i],e.camera.up=t.up[i],e.Update(),i<n-1&&requestAnimationFrame((function(){r(e,t,n,i+1)}))}if(null!==e){if(0===t||$c(this.camera,e))this.camera=e;else{var i=Th,a={eye:Mh(this.camera.eye,e.eye,t,i),center:Mh(this.camera.center,e.center,t,i),up:Mh(this.camera.up,e.up,t,i)};requestAnimationFrame((function(){r(n,a,t,0)}))}this.Update()}}},{key:"GetFitToSphereCamera",value:function(e,t){if(K(t))return null;var n=this.camera.Clone(),r=ue(n.center,e);n.eye=ue(n.eye,r),n.center=e.Clone();var i=ue(n.eye,n.center).Normalize(),a=this.camera.fov/2;this.canvas.width<this.canvas.height&&(a=a*this.canvas.width/this.canvas.height);var o=t/Math.sin(a*Y);return n.eye=n.center.Clone().Offset(i,o),n}},{key:"OnMouseDown",value:function(e){e.preventDefault(),this.mouse.Down(this.canvas,e),this.clickDetector.Start(this.mouse.GetPosition())}},{key:"OnMouseMove",value:function(e){if(this.mouse.Move(this.canvas,e),this.clickDetector.Move(this.mouse.GetPosition()),this.onMouseMove){var t=ih(this.canvas,e.clientX,e.clientY);this.onMouseMove(t)}if(this.mouse.IsButtonDown()){var n=this.mouse.GetMoveDiff(),r=this.mouse.GetButton(),i=kh.None;if(1===r?i=e.ctrlKey?kh.Zoom:e.shiftKey?kh.Pan:kh.Orbit:2!==r&&3!==r||(i=kh.Pan),i===kh.Orbit){this.Orbit(.5*n.x,.5*n.y)}else if(i===kh.Pan){var a=.001*le(this.camera.eye,this.camera.center);this.Pan(n.x*a,n.y*a)}else if(i===kh.Zoom){this.Zoom(.005*-n.y)}this.Update()}}},{key:"OnMouseUp",value:function(e){if(this.mouse.Up(this.canvas,e),this.clickDetector.End(),this.clickDetector.IsClick()){var t=this.mouse.GetPosition();this.Click(e.which,t)}}},{key:"OnMouseLeave",value:function(e){this.mouse.Leave(this.canvas,e),this.clickDetector.Cancel()}},{key:"OnTouchStart",value:function(e){e.preventDefault(),this.touch.Start(this.canvas,e),this.clickDetector.Start(this.touch.GetPosition())}},{key:"OnTouchMove",value:function(e){if(e.preventDefault(),this.touch.Move(this.canvas,e),this.clickDetector.Move(this.touch.GetPosition()),this.touch.IsFingerDown()){var t=this.touch.GetMoveDiff(),n=this.touch.GetDistanceDiff(),r=this.touch.GetFingerCount(),i=kh.None;if(1===r?i=kh.Orbit:2===r&&(i=kh.Pan),i===kh.Orbit){this.Orbit(.5*t.x,.5*t.y)}else if(i===kh.Pan){this.Zoom(.005*n);var a=.001*le(this.camera.eye,this.camera.center);this.Pan(t.x*a,t.y*a)}this.Update()}}},{key:"OnTouchEnd",value:function(e){if(e.preventDefault(),this.touch.End(this.canvas,e),this.clickDetector.End(),this.clickDetector.IsClick()){var t=this.touch.GetPosition();1===this.touch.GetFingerCount()&&this.Click(1,t)}}},{key:"OnMouseWheel",value:function(e){var t=e||window.event;t.preventDefault();var n=.1;-t.deltaY/40<0&&(n*=-1),this.Zoom(n),this.Update()}},{key:"OnContextMenu",value:function(e){e.preventDefault(),this.clickDetector.IsClick()&&(this.Context(e.clientX,e.clientY),this.clickDetector.Cancel())}},{key:"Orbit",value:function(e,t){var n=e*Y,r=t*Y,i=ue(this.camera.center,this.camera.eye).Normalize(),a=fe(i,this.camera.up).Normalize();if(this.fixUpVector){var o=he(i,this.camera.up)+r;J(o,0)&&Z(o,Math.PI)&&this.camera.eye.Rotate(a,-r,this.camera.center),this.camera.eye.Rotate(this.camera.up,-n,this.camera.center)}else{var s=fe(a,i).Normalize();this.camera.eye.Rotate(a,-r,this.camera.center),this.camera.eye.Rotate(s,-n,this.camera.center),this.camera.up=s}}},{key:"Pan",value:function(e,t){var n=ue(this.camera.center,this.camera.eye).Normalize(),r=fe(n,this.camera.up).Normalize(),i=fe(r,n).Normalize();this.camera.eye.Offset(r,-e),this.camera.center.Offset(r,-e),this.camera.eye.Offset(i,t),this.camera.center.Offset(i,t)}},{key:"Zoom",value:function(e){var t=ue(this.camera.center,this.camera.eye),n=t.Length()*e;this.camera.eye.Offset(t,n)}},{key:"Update",value:function(){this.callbacks.onUpdate()}},{key:"Click",value:function(e,t){this.onMouseClick&&this.onMouseClick(e,t)}},{key:"Context",value:function(e,t){if(this.onContext){var n={x:e,y:t},r=ih(this.canvas,e,t);this.onContext(n,r)}}}]),e}();function Ch(e,t){function n(e,t){var n,r=d()(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.polygonOffset=t,i.polygonOffsetUnit=1,i.polygonOffsetFactor=1}}catch(e){r.e(e)}finally{r.f()}}n(e.material,t),e.userData.threeMaterials&&n(e.userData.threeMaterials,t)}var Ih=function(){function e(t){i()(this,e),this.scene=t,this.mainObject=null,this.mainEdgeObject=null,this.edgeSettings={showEdges:!1,edgeColor:new ve(0,0,0),edgeThreshold:1}}return o()(e,[{key:"SetMainObject",value:function(e){this.mainObject=e,this.scene.add(this.mainObject),this.edgeSettings.showEdges&&this.GenerateMainEdgeObject()}},{key:"UpdateWorldMatrix",value:function(){null!==this.mainObject&&this.mainObject.updateWorldMatrix(!0,!0)}},{key:"SetEdgeSettings",value:function(e,t,n){var r=!1;if(!e||this.edgeSettings.showEdges&&this.edgeSettings.edgeThreshold===n||(r=!0),this.edgeSettings.showEdges=e,this.edgeSettings.edgeThreshold=n,this.edgeSettings.edgeColor=t,null!==this.mainObject)if(this.edgeSettings.showEdges)if(r)this.ClearMainEdgeObject(),this.GenerateMainEdgeObject();else{var i=Zc(this.edgeSettings.edgeColor);this.EnumerateEdges((function(e){e.material.color=i}))}else this.ClearMainEdgeObject()}},{key:"GenerateMainEdgeObject",value:function(){var e=this,t=Zc(this.edgeSettings.edgeColor);this.mainEdgeObject=new si,this.UpdateWorldMatrix(),this.EnumerateMeshes((function(n){Ch(n,!0);var r=new nl(n.geometry,e.edgeSettings.edgeThreshold),i=new _u(r,new hu({color:t}));i.applyMatrix4(n.matrixWorld),i.userData=n.userData,i.visible=n.visible,e.mainEdgeObject.add(i)})),this.scene.add(this.mainEdgeObject)}},{key:"GetBoundingBox",value:function(e){var t=!1,n=new ur;return this.EnumerateMeshes((function(r){e(r.userData)&&(n.union((new ur).setFromObject(r)),t=!0)})),t?n:null}},{key:"GetBoundingSphere",value:function(e){var t=this.GetBoundingBox(e);if(null===t)return null;var n=new kr;return t.getBoundingSphere(n),n}},{key:"Clear",value:function(){this.ClearMainObject(),this.ClearMainEdgeObject()}},{key:"ClearMainObject",value:function(){null!==this.mainObject&&(this.EnumerateMeshes((function(e){e.geometry.dispose()})),this.scene.remove(this.mainObject),this.mainObject=null)}},{key:"ClearMainEdgeObject",value:function(){null!==this.mainEdgeObject&&(this.EnumerateMeshes((function(e){Ch(e,!1)})),this.EnumerateEdges((function(e){e.geometry.dispose()})),this.scene.remove(this.mainEdgeObject),this.mainEdgeObject=null)}},{key:"EnumerateMeshes",value:function(e){null!==this.mainObject&&this.mainObject.traverse((function(t){t.isMesh&&e(t)}))}},{key:"EnumerateEdges",value:function(e){null!==this.mainEdgeObject&&this.mainEdgeObject.traverse((function(t){t.isLineSegments&&e(t)}))}},{key:"GetMeshIntersectionUnderMouse",value:function(e,t,n,r){if(null===this.mainObject)return null;if(e.x<0||e.x>n||e.y<0||e.y>r)return null;var i=new zc,a=new Pn;a.x=e.x/n*2-1,a.y=-e.y/r*2+1,i.setFromCamera(a,t);for(var o=i.intersectObject(this.mainObject,!0),s=0;s<o.length;s++){var u=o[s];if("Mesh"===u.object.type&&u.object.visible)return u}return null}}]),e}(),Rh=function(){function e(t){i()(this,e),this.scene=t,this.mainObject=null}return o()(e,[{key:"AddObject",value:function(e){null===this.mainObject&&(this.mainObject=new si,this.scene.add(this.mainObject)),this.mainObject.add(e)}},{key:"Clear",value:function(){null!==this.mainObject&&(this.mainObject.traverse((function(e){(e.isMesh||e.isLineSegments)&&e.geometry.dispose()})),this.scene.remove(this.mainObject),this.mainObject=null)}}]),e}(),Lh={Perspective:1,Orthographic:2};function Ph(e){return e===ie.X?new Qc(new ae(2,-3,1.5),new ae(0,0,0),new ae(1,0,0),45):e===ie.Y?new Qc(new ae(-1.5,2,3),new ae(0,0,0),new ae(0,1,0),45):e===ie.Z?new Qc(new ae(-1.5,-3,2),new ae(0,0,0),new ae(0,0,1),45):null}function Nh(e,t){if(!t(e))return!1;var n,r=d()(e.children);try{for(r.s();!(n=r.n()).done;){if(!Nh(n.value,t))return!1}}catch(e){r.e(e)}finally{r.f()}return!0}function Oh(e){var t=null;return Nh(e,(function(e){if(e.isMesh){var n,r=d()(e.material);try{for(r.s();!(n=r.n()).done;){var i=n.value;return"MeshPhongMaterial"===i.type?t=Xc.Phong:"MeshStandardMaterial"===i.type&&(t=Xc.Physical),!1}}catch(e){r.e(e)}finally{r.f()}}return!0})),t}var Dh=function(){function e(){i()(this,e),this.eyeCenterDistance=0,this.forceUpdate=!0}return o()(e,[{key:"ForceUpdate",value:function(){this.forceUpdate=!0}},{key:"ValidatePerspective",value:function(){return!this.forceUpdate||(this.forceUpdate=!1,!1)}},{key:"ValidateOrthographic",value:function(e){return!(this.forceUpdate||!ee(this.eyeCenterDistance,e))||(this.eyeCenterDistance=e,this.forceUpdate=!1,!1)}}]),e}(),Fh=function(){function e(){i()(this,e),this.direction=ie.Z,this.isFixed=!0,this.isFlipped=!1}return o()(e,[{key:"SetDirection",value:function(e,t){this.direction=e,this.isFlipped=!1;var n=Ph(this.direction),r=ue(n.eye,n.center),i=le(t.center,t.eye),a=t.center.Clone().Offset(r,i),o=t.Clone();return this.direction===ie.X?(o.up=new ae(1,0,0),o.eye=a):this.direction===ie.Y?(o.up=new ae(0,1,0),o.eye=a):this.direction===ie.Z&&(o.up=new ae(0,0,1),o.eye=a),o}},{key:"SetFixed",value:function(e,t){return this.isFixed=e,this.isFixed?this.SetDirection(this.direction,t):null}},{key:"Flip",value:function(e){this.isFlipped=!this.isFlipped;var t=e.Clone();return t.up.MultiplyScalar(-1),t}}]),e}(),Uh=function(){function e(t){i()(this,e),this.scene=t,this.type=Xc.Phong,this.cameraMode=Lh.Perspective,this.ambientLight=new Ic(8947848),this.directionalLight=new Cc(8947848),this.environment=null,this.backgroundIsEnvMap=!1,this.scene.add(this.ambientLight),this.scene.add(this.directionalLight)}return o()(e,[{key:"SetShadingType",value:function(e){this.type=e,this.UpdateShading()}},{key:"SetCameraMode",value:function(e){this.cameraMode=e,this.UpdateShading()}},{key:"UpdateShading",value:function(){this.type===Xc.Phong?(this.ambientLight.color.set(8947848),this.directionalLight.color.set(8947848),this.scene.environment=null):this.type===Xc.Physical&&(this.ambientLight.color.set(0),this.directionalLight.color.set(5592405),this.scene.environment=this.environment),this.backgroundIsEnvMap&&this.cameraMode===Lh.Perspective?this.scene.background=this.environment:this.scene.background=null}},{key:"SetEnvironment",value:function(e,t,n){var r=new dc;this.environment=r.load(e,(function(){n()})),this.backgroundIsEnvMap=t}},{key:"UpdateByCamera",value:function(e){var t=ue(e.eye,e.center);this.directionalLight.position.set(t.x,t.y,t.z)}},{key:"CreateHighlightMaterial",value:function(e,t){var n=null;return this.type===Xc.Phong?n=new Fl({color:e,side:2}):this.type===Xc.Physical&&(n=new Dl({color:e,side:2})),null!==n&&t&&(n.polygonOffset=!0,n.polygonOffsetUnit=1,n.polygonOffsetFactor=1),n}}]),e}(),Gh=function(){function e(){i()(this,e),this.canvas=null,this.renderer=null,this.scene=null,this.geometry=null,this.extraGeometry=null,this.camera=null,this.cameraMode=null,this.cameraValidator=null,this.shadingModel=null,this.navigation=null,this.upVector=null,this.settings={animationSteps:40}}return o()(e,[{key:"Init",value:function(e){this.canvas=e,this.canvas.id="viewer";var t={canvas:this.canvas,antialias:!0};this.renderer=new Js(t),window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setClearColor("#ffffff",1),this.renderer.setSize(this.canvas.width,this.canvas.height),this.scene=new $s,this.geometry=new Ih(this.scene),this.extraGeometry=new Rh(this.scene),this.InitNavigation(),this.InitShading(),this.Render()}},{key:"SetMouseClickHandler",value:function(e){this.navigation.SetMouseClickHandler(e)}},{key:"SetMouseMoveHandler",value:function(e){this.navigation.SetMouseMoveHandler(e)}},{key:"SetContextMenuHandler",value:function(e){this.navigation.SetContextMenuHandler(e)}},{key:"SetEnvironmentMapSettings",value:function(e,t){var n=this;this.shadingModel.SetEnvironment(e,t,(function(){n.Render()})),this.shadingModel.UpdateShading(),this.Render()}},{key:"SetBackgroundColor",value:function(e){var t=new Yn(ye(e.r),ye(e.g),ye(e.b)),n=ye(e.a);this.renderer.setClearColor(t,n),this.Render()}},{key:"SetEdgeSettings",value:function(e,t,n){this.geometry.SetEdgeSettings(e,t,n),this.Render()}},{key:"GetCanvas",value:function(){return this.canvas}},{key:"GetCamera",value:function(){return this.navigation.GetCamera()}},{key:"GetCameraMode",value:function(){return this.cameraMode}},{key:"SetCamera",value:function(e){this.navigation.SetCamera(e),this.cameraValidator.ForceUpdate(),this.Render()}},{key:"SetCameraMode",value:function(e){this.cameraMode!==e&&(this.scene.remove(this.camera),e===Lh.Perspective?this.camera=new sa(45,1,.1,1e3):e===Lh.Orthographic&&(this.camera=new Ra(-1,1,1,-1,.1,1e3)),this.scene.add(this.camera),this.cameraMode=e,this.shadingModel.SetCameraMode(e),this.cameraValidator.ForceUpdate(),this.AdjustClippingPlanes(),this.Render())}},{key:"Resize",value:function(e,t){var n=rh(this.canvas,e,t);this.ResizeRenderer(n.width,n.height)}},{key:"ResizeRenderer",value:function(e,t){window.devicePixelRatio&&this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(e,t),this.cameraValidator.ForceUpdate(),this.Render()}},{key:"FitSphereToWindow",value:function(e,t){if(null!==e){var n=new ae(e.center.x,e.center.y,e.center.z),r=e.radius,i=this.navigation.GetFitToSphereCamera(n,r);this.navigation.MoveCamera(i,t?this.settings.animationSteps:0)}}},{key:"AdjustClippingPlanes",value:function(){var e=this.GetBoundingSphere((function(e){return!0}));this.AdjustClippingPlanesToSphere(e)}},{key:"AdjustClippingPlanesToSphere",value:function(e){null!==e&&(e.radius<10?(this.camera.near=.01,this.camera.far=100):e.radius<100?(this.camera.near=.1,this.camera.far=1e3):e.radius<1e3?(this.camera.near=10,this.camera.far=1e4):(this.camera.near=100,this.camera.far=1e6),this.cameraValidator.ForceUpdate(),this.Render())}},{key:"IsFixUpVector",value:function(){return this.navigation.IsFixUpVector()}},{key:"SetFixUpVector",value:function(e){var t=this.navigation.GetCamera(),n=this.upVector.SetFixed(e,t);this.navigation.SetFixUpVector(e),null!==n&&this.navigation.MoveCamera(n,this.settings.animationSteps),this.Render()}},{key:"SetUpVector",value:function(e,t){var n=this.navigation.GetCamera(),r=this.upVector.SetDirection(e,n),i=t?this.settings.animationSteps:0;this.navigation.MoveCamera(r,i),this.Render()}},{key:"FlipUpVector",value:function(){var e=this.navigation.GetCamera(),t=this.upVector.Flip(e);this.navigation.MoveCamera(t,0),this.Render()}},{key:"Render",value:function(){var e=this.navigation.GetCamera();if(this.camera.position.set(e.eye.x,e.eye.y,e.eye.z),this.camera.up.set(e.up.x,e.up.y,e.up.z),this.camera.lookAt(new ar(e.center.x,e.center.y,e.center.z)),this.cameraMode===Lh.Perspective)this.cameraValidator.ValidatePerspective()||(this.camera.aspect=this.canvas.width/this.canvas.height,this.camera.fov=e.fov,this.camera.updateProjectionMatrix());else if(this.cameraMode===Lh.Orthographic){var t=le(e.eye,e.center);if(!this.cameraValidator.ValidateOrthographic(t)){var n=this.canvas.width/this.canvas.height,r=le(e.eye,e.center)*Math.tan(.5*e.fov*Y);this.camera.left=-r*n,this.camera.right=r*n,this.camera.top=r,this.camera.bottom=-r,this.camera.updateProjectionMatrix()}}this.shadingModel.UpdateByCamera(e),this.renderer.render(this.scene,this.camera)}},{key:"SetMainObject",value:function(e){var t=Oh(e);this.geometry.SetMainObject(e),this.shadingModel.SetShadingType(t),this.Render()}},{key:"AddExtraObject",value:function(e){this.extraGeometry.AddObject(e),this.Render()}},{key:"Clear",value:function(){this.geometry.Clear(),this.extraGeometry.Clear(),this.Render()}},{key:"ClearExtra",value:function(){this.extraGeometry.Clear(),this.Render()}},{key:"SetMeshesVisibility",value:function(e){this.geometry.EnumerateMeshes((function(t){var n=e(t.userData);t.visible!==n&&(t.visible=n)})),this.geometry.EnumerateEdges((function(t){var n=e(t.userData);t.visible!==n&&(t.visible=n)})),this.Render()}},{key:"SetMeshesHighlight",value:function(e,t){var n=this.CreateHighlightMaterial(e);this.geometry.EnumerateMeshes((function(e){t(e.userData)?null===e.userData.threeMaterials&&(e.userData.threeMaterials=e.material,e.material=function(e,t){for(var n=[],r=0;r<e.length;r++)n.push(t);return n}(e.material,n)):null!==e.userData.threeMaterials&&(e.material=e.userData.threeMaterials,e.userData.threeMaterials=null)})),this.Render()}},{key:"CreateHighlightMaterial",value:function(e){var t=this.geometry.edgeSettings.showEdges;return this.shadingModel.CreateHighlightMaterial(e,t)}},{key:"GetMeshUserDataUnderMouse",value:function(e){var t=this.GetMeshIntersectionUnderMouse(e);return null===t?null:t.object.userData}},{key:"GetMeshIntersectionUnderMouse",value:function(e){var t=this.GetCanvasSize(),n=this.geometry.GetMeshIntersectionUnderMouse(e,this.camera,t.width,t.height);return null===n?null:n}},{key:"GetBoundingBox",value:function(e){return this.geometry.GetBoundingBox(e)}},{key:"GetBoundingSphere",value:function(e){return this.geometry.GetBoundingSphere(e)}},{key:"EnumerateMeshesUserData",value:function(e){this.geometry.EnumerateMeshes((function(t){e(t.userData)}))}},{key:"InitNavigation",value:function(){var e=this,t=Ph(ie.Z);this.camera=new sa(45,1,.1,1e3),this.cameraMode=Lh.Perspective,this.cameraValidator=new Dh,this.scene.add(this.camera);var n=this.renderer.domElement;this.navigation=new Ah(n,t,{onUpdate:function(){e.Render()}}),this.upVector=new Fh}},{key:"InitShading",value:function(){this.shadingModel=new Uh(this.scene)}},{key:"GetShadingType",value:function(){return this.shadingModel.type}},{key:"GetImageSize",value:function(){var e=new Pn;return this.renderer.getSize(e),{width:parseInt(e.x,10),height:parseInt(e.y,10)}}},{key:"GetCanvasSize",value:function(){var e=this.canvas.width,t=this.canvas.height;return window.devicePixelRatio&&(e/=window.devicePixelRatio,t/=window.devicePixelRatio),{width:e,height:t}}},{key:"GetImageAsDataUrl",value:function(e,t){var n=this.GetImageSize(),r=e,i=t;window.devicePixelRatio&&(r/=window.devicePixelRatio,i/=window.devicePixelRatio),this.ResizeRenderer(r,i),this.Render();var a=this.renderer.domElement.toDataURL();return this.ResizeRenderer(n.width,n.height),a}}]),e}(),zh=o()((function e(t,n,r){i()(this,e),this.name=t,this.source=n,this.data=r}));function Vh(e){var t,n=[],r=d()(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=T(i);n.push(new zh(a,_.Url,i))}}catch(e){r.e(e)}finally{r.f()}return n}function Bh(e){var t,n=[],r=d()(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=T(i.name);n.push(new zh(a,_.File,i))}}catch(e){r.e(e)}finally{r.f()}return n}var Wh=function(){function e(t,n,r){i()(this,e),this.name=T(t),this.extension=M(t),this.source=n,this.data=r,this.content=null}return o()(e,[{key:"SetContent",value:function(e){this.content=e}}]),e}(),Hh=function(){function e(){i()(this,e),this.files=[]}return o()(e,[{key:"FillFromInputFiles",value:function(e){this.files=[];var t,n=d()(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=new Wh(r.name,r.source,r.data);this.files.push(i)}}catch(e){n.e(e)}finally{n.f()}}},{key:"ExtendFromFileList",value:function(e){for(var t=e.GetFiles(),n=0;n<t.length;n++){var r=t[n];this.ContainsFileByPath(r.name)||this.files.push(r)}}},{key:"GetFiles",value:function(){return this.files}},{key:"GetContent",value:function(e){var t=this;l(this.files.length,{runTask:function(n,r){e.onFileListProgress(n,t.files.length),t.GetFileContent(t.files[n],{onReady:r,onProgress:e.onFileLoadProgress})},onReady:e.onReady})}},{key:"ContainsFileByPath",value:function(e){return null!==this.FindFileByPath(e)}},{key:"FindFileByPath",value:function(e){for(var t=T(e).toLowerCase(),n=0;n<this.files.length;n++){var r=this.files[n];if(r.name.toLowerCase()===t)return r}return null}},{key:"IsOnlyUrlSource",value:function(){if(0===this.files.length)return!1;for(var e=0;e<this.files.length;e++){var t=this.files[e];if(t.source!==_.Url&&t.source!==_.Decompressed)return!1}return!0}},{key:"AddFile",value:function(e){this.files.push(e)}},{key:"GetFileContent",value:function(e,t){if(null===e.content){var n=null;if(e.source===_.Url)n=w(e.data,t.onProgress);else{if(e.source!==_.File)return void t.onReady();n=S(e.data,t.onProgress)}n.then((function(t){e.SetContent(t)})).catch((function(){})).finally((function(){t.onReady()}))}else t.onReady()}}]),e}(),jh=o()((function e(t,n,r,a){i()(this,e),this.x=t,this.y=n,this.z=r,this.w=a}));function qh(e,t){return ee(e.x,t.x)&&ee(e.y,t.y)&&ee(e.z,t.z)&&ee(e.w,t.w)}function Xh(e){return new jh(e[0],e[1],e[2],e[3])}function Yh(e,t){var n=t/2,r=Math.sin(n);return new jh(e.x*r,e.y*r,e.z*r,Math.cos(n))}function Kh(e,t,n,r){var i=Math.cos(e/2),a=Math.cos(t/2),o=Math.cos(n/2),s=Math.sin(e/2),u=Math.sin(t/2),l=Math.sin(n/2),c=new jh(0,0,0,1);if("XYZ"===r)c.x=s*a*o+i*u*l,c.y=i*u*o-s*a*l,c.z=i*a*l+s*u*o,c.w=i*a*o-s*u*l;else if("YXZ"===r)c.x=s*a*o+i*u*l,c.y=i*u*o-s*a*l,c.z=i*a*l-s*u*o,c.w=i*a*o+s*u*l;else if("ZXY"===r)c.x=s*a*o-i*u*l,c.y=i*u*o+s*a*l,c.z=i*a*l+s*u*o,c.w=i*a*o-s*u*l;else if("ZYX"===r)c.x=s*a*o-i*u*l,c.y=i*u*o+s*a*l,c.z=i*a*l-s*u*o,c.w=i*a*o+s*u*l;else if("YZX"===r)c.x=s*a*o+i*u*l,c.y=i*u*o+s*a*l,c.z=i*a*l-s*u*o,c.w=i*a*o-s*u*l;else{if("XZY"!==r)return null;c.x=s*a*o-i*u*l,c.y=i*u*o-s*a*l,c.z=i*a*l+s*u*o,c.w=i*a*o+s*u*l}return c}var Zh=function(){function e(t,n,r,a){i()(this,e),this.x=t,this.y=n,this.z=r,this.w=a}return o()(e,[{key:"Clone",value:function(){return new e(this.x,this.y,this.z,this.w)}}]),e}(),Jh=function(){function e(t){i()(this,e),this.matrix=null,null!=t&&(this.matrix=t)}return o()(e,[{key:"IsValid",value:function(){return null!==this.matrix}},{key:"Set",value:function(e){return this.matrix=e,this}},{key:"Get",value:function(){return this.matrix}},{key:"Clone",value:function(){return new e([this.matrix[0],this.matrix[1],this.matrix[2],this.matrix[3],this.matrix[4],this.matrix[5],this.matrix[6],this.matrix[7],this.matrix[8],this.matrix[9],this.matrix[10],this.matrix[11],this.matrix[12],this.matrix[13],this.matrix[14],this.matrix[15]])}},{key:"CreateIdentity",value:function(){return this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}},{key:"IsIdentity",value:function(){for(var t=(new e).CreateIdentity().Get(),n=0;n<16;n++)if(!ee(this.matrix[n],t[n]))return!1;return!0}},{key:"CreateTranslation",value:function(e,t,n){return this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1],this}},{key:"CreateRotation",value:function(e,t,n,r){var i=e+e,a=t+t,o=n+n,s=e*i,u=e*a,l=e*o,c=t*a,h=t*o,f=n*o,d=r*i,p=r*a,v=r*o;return this.matrix=[1-(c+f),u+v,l-p,0,u-v,1-(s+f),h+d,0,l+p,h-d,1-(s+c),0,0,0,0,1],this}},{key:"CreateRotationAxisAngle",value:function(e,t){var n=Yh(e,t);return this.CreateRotation(n.x,n.y,n.z,n.w)}},{key:"CreateScale",value:function(e,t,n){return this.matrix=[e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1],this}},{key:"ComposeTRS",value:function(e,t,n){var r=e.x,i=e.y,a=e.z,o=t.x,s=t.y,u=t.z,l=t.w,c=n.x,h=n.y,f=n.z,d=o+o,p=s+s,v=u+u,m=o*d,g=o*p,y=o*v,x=s*p,_=s*v,b=u*v,T=l*d,M=l*p,w=l*v;return this.matrix=[(1-(x+b))*c,(g+w)*c,(y-M)*c,0,(g-w)*h,(1-(m+b))*h,(_+T)*h,0,(y+M)*f,(_-T)*f,(1-(m+x))*f,0,r,i,a,1],this}},{key:"DecomposeTRS",value:function(){var e=new ae(this.matrix[12],this.matrix[13],this.matrix[14]),t=de(this.matrix[0],this.matrix[1],this.matrix[2]),n=de(this.matrix[4],this.matrix[5],this.matrix[6]),r=de(this.matrix[8],this.matrix[9],this.matrix[10]);re(this.Determinant())&&(t*=-1);var i=new ae(t,n,r),a=this.matrix[0]/t,o=this.matrix[4]/n,s=this.matrix[8]/r,u=this.matrix[1]/t,l=this.matrix[5]/n,c=this.matrix[9]/r,h=this.matrix[2]/t,f=this.matrix[6]/n,d=this.matrix[10]/r,p=null,v=a+l+d;if(v>0){var m=2*Math.sqrt(v+1);p=new jh((f-c)/m,(s-h)/m,(u-o)/m,.25*m)}else if(a>l&&a>d){var g=2*Math.sqrt(1+a-l-d);p=new jh(.25*g,(o+u)/g,(s+h)/g,(f-c)/g)}else if(l>d){var y=2*Math.sqrt(1+l-a-d);p=new jh((o+u)/y,.25*y,(c+f)/y,(s-h)/y)}else{var x=2*Math.sqrt(1+d-a-l);p=new jh((s+h)/x,(c+f)/x,.25*x,(u-o)/x)}return{translation:e,rotation:p,scale:i}}},{key:"Determinant",value:function(){var e=this.matrix[0],t=this.matrix[1],n=this.matrix[2],r=this.matrix[3],i=this.matrix[4],a=this.matrix[5],o=this.matrix[6],s=this.matrix[7],u=this.matrix[8],l=this.matrix[9],c=this.matrix[10],h=this.matrix[11],f=this.matrix[12],d=this.matrix[13],p=this.matrix[14],v=this.matrix[15];return(e*a-t*i)*(c*v-h*p)-(e*o-n*i)*(l*v-h*d)+(e*s-r*i)*(l*p-c*d)+(t*o-n*a)*(u*v-h*f)-(t*s-r*a)*(u*p-c*f)+(n*s-r*o)*(u*d-l*f)}},{key:"Invert",value:function(){var t=this.matrix[0],n=this.matrix[1],r=this.matrix[2],i=this.matrix[3],a=this.matrix[4],o=this.matrix[5],s=this.matrix[6],u=this.matrix[7],l=this.matrix[8],c=this.matrix[9],h=this.matrix[10],f=this.matrix[11],d=this.matrix[12],p=this.matrix[13],v=this.matrix[14],m=this.matrix[15],g=t*o-n*a,y=t*s-r*a,x=t*u-i*a,_=n*s-r*o,b=n*u-i*o,T=r*u-i*s,M=l*p-c*d,w=l*v-h*d,S=l*m-f*d,E=c*v-h*p,k=c*m-f*p,A=h*m-f*v,C=g*A-y*k+x*E+_*S-b*w+T*M;return ee(C,0)?null:new e([(o*A-s*k+u*E)/C,(r*k-n*A-i*E)/C,(p*T-v*b+m*_)/C,(h*b-c*T-f*_)/C,(s*S-a*A-u*w)/C,(t*A-r*S+i*w)/C,(v*x-d*T-m*y)/C,(l*T-h*x+f*y)/C,(a*k-o*S+u*M)/C,(n*S-t*k-i*M)/C,(d*b-p*x+m*g)/C,(c*x-l*b-f*g)/C,(o*w-a*E-s*M)/C,(t*E-n*w+r*M)/C,(p*y-d*_-v*g)/C,(l*_-c*y+h*g)/C])}},{key:"Transpose",value:function(){return new e([this.matrix[0],this.matrix[4],this.matrix[8],this.matrix[12],this.matrix[1],this.matrix[5],this.matrix[9],this.matrix[13],this.matrix[2],this.matrix[6],this.matrix[10],this.matrix[14],this.matrix[3],this.matrix[7],this.matrix[11],this.matrix[15]])}},{key:"InvertTranspose",value:function(){var e=this.Invert();return null===e?null:e.Transpose()}},{key:"MultiplyVector",value:function(e){var t=e.x,n=e.y,r=e.z,i=e.w,a=this.matrix[0],o=this.matrix[1],s=this.matrix[2],u=this.matrix[3],l=this.matrix[4],c=this.matrix[5],h=this.matrix[6],f=this.matrix[7],d=this.matrix[8],p=this.matrix[9],v=this.matrix[10],m=this.matrix[11],g=this.matrix[12],y=this.matrix[13],x=this.matrix[14],_=this.matrix[15];return new Zh(t*a+n*l+r*d+i*g,t*o+n*c+r*p+i*y,t*s+n*h+r*v+i*x,t*u+n*f+r*m+i*_)}},{key:"MultiplyMatrix",value:function(t){var n=this.matrix[0],r=this.matrix[1],i=this.matrix[2],a=this.matrix[3],o=this.matrix[4],s=this.matrix[5],u=this.matrix[6],l=this.matrix[7],c=this.matrix[8],h=this.matrix[9],f=this.matrix[10],d=this.matrix[11],p=this.matrix[12],v=this.matrix[13],m=this.matrix[14],g=this.matrix[15],y=t.matrix[0],x=t.matrix[1],_=t.matrix[2],b=t.matrix[3],T=t.matrix[4],M=t.matrix[5],w=t.matrix[6],S=t.matrix[7],E=t.matrix[8],k=t.matrix[9],A=t.matrix[10],C=t.matrix[11],I=t.matrix[12],R=t.matrix[13],L=t.matrix[14],P=t.matrix[15];return new e([n*y+r*T+i*E+a*I,n*x+r*M+i*k+a*R,n*_+r*w+i*A+a*L,n*b+r*S+i*C+a*P,o*y+s*T+u*E+l*I,o*x+s*M+u*k+l*R,o*_+s*w+u*A+l*L,o*b+s*S+u*C+l*P,c*y+h*T+f*E+d*I,c*x+h*M+f*k+d*R,c*_+h*w+f*A+d*L,c*b+h*S+f*C+d*P,p*y+v*T+m*E+g*I,p*x+v*M+m*k+g*R,p*_+v*w+m*A+g*L,p*b+v*S+m*C+g*P])}}]),e}();function Qh(e,t){for(var n=e.Get(),r=t.Get(),i=0;i<16;i++)if(!ee(n[i],r[i]))return!1;return!0}var $h=function(){function e(t){i()(this,e),null!=t?this.matrix=t:(this.matrix=new Jh,this.matrix.CreateIdentity())}return o()(e,[{key:"SetMatrix",value:function(e){return this.matrix=e,this}},{key:"GetMatrix",value:function(){return this.matrix}},{key:"IsIdentity",value:function(){return this.matrix.IsIdentity()}},{key:"AppendMatrix",value:function(e){return this.matrix=this.matrix.MultiplyMatrix(e),this}},{key:"Append",value:function(e){return this.AppendMatrix(e.GetMatrix()),this}},{key:"TransformCoord3D",value:function(e){var t=new Zh(e.x,e.y,e.z,1),n=this.matrix.MultiplyVector(t);return new ae(n.x,n.y,n.z)}},{key:"Clone",value:function(){return new e(this.matrix.Clone())}}]),e}();function ef(e,t){return Qh(e.GetMatrix(),t.GetMatrix())}var tf={Empty:0,TriangleMesh:1};function nf(e){return e.TriangleCount()>0?tf.TriangleMesh:tf.Empty}function rf(e,t,n){var r=fe(ue(t,e),ue(n,e));return r.Normalize(),r}function af(e,t){if(!t.IsIdentity()){for(var n=0;n<e.VertexCount();n++){var r=e.GetVertex(n),i=t.TransformCoord3D(r);r.x=i.x,r.y=i.y,r.z=i.z}if(e.NormalCount()>0){var a=t.GetMatrix().InvertTranspose();if(null!==a)for(var o=new $h(a),s=0;s<e.NormalCount();s++){var u=e.GetNormal(s),l=o.TransformCoord3D(u);u.x=l.x,u.y=l.y,u.z=l.z}}}}function of(e){for(var t=0;t<e.TriangleCount();t++){var n=e.GetTriangle(t),r=n.v1;n.v1=n.v2,n.v2=r}}var sf=function(){function e(t,n){i()(this,e),this.min=t,this.max=n}return o()(e,[{key:"GetMin",value:function(){return this.min}},{key:"GetMax",value:function(){return this.max}},{key:"GetCenter",value:function(){return new ae((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,(this.min.z+this.max.z)/2)}}]),e}(),uf=function(){function e(){i()(this,e),this.box=new sf(new ae(1/0,1/0,1/0),new ae(-1/0,-1/0,-1/0)),this.isValid=!1}return o()(e,[{key:"GetBox",value:function(){return this.isValid?this.box:null}},{key:"AddPoint",value:function(e){this.box.min.x=Math.min(this.box.min.x,e.x),this.box.min.y=Math.min(this.box.min.y,e.y),this.box.min.z=Math.min(this.box.min.z,e.z),this.box.max.x=Math.max(this.box.max.x,e.x),this.box.max.y=Math.max(this.box.max.y,e.y),this.box.max.z=Math.max(this.box.max.z,e.z),this.isValid=!0}}]),e}(),lf=function(){function e(t,n){i()(this,e),this.boundingBox=t,this.level=n,this.pointItems=[],this.childNodes=[]}return o()(e,[{key:"AddPoint",value:function(e,t,n){var r=this.FindNodeForPoint(e);if(null===r)return!1;if(null!==r.FindPointDirectly(e))return!1;if(r.pointItems.length<n.maxPointsPerNode||r.level>=n.maxTreeDepth)return r.AddPointDirectly(e,t),!0;r.CreateChildNodes();var i=r.pointItems;r.pointItems=[];for(var a=0;a<i.length;a++){var o=i[a];if(!r.AddPoint(o.point,o.data,n))return!1}return r.AddPoint(e,t,n)}},{key:"FindPoint",value:function(e){var t=this.FindNodeForPoint(e);return null===t?null:t.FindPointDirectly(e)}},{key:"AddPointDirectly",value:function(e,t){this.pointItems.push({point:e,data:t})}},{key:"FindPointDirectly",value:function(e){for(var t=0;t<this.pointItems.length;t++){var n=this.pointItems[t];if(oe(e,n.point))return n.data}return null}},{key:"FindNodeForPoint",value:function(e){if(!this.IsPointInBounds(e))return null;if(0===this.childNodes.length)return this;for(var t=0;t<this.childNodes.length;t++){var n=this.childNodes[t].FindNodeForPoint(e);if(null!==n)return n}return null}},{key:"CreateChildNodes",value:function(){function t(t,n,r,i,a,o,s){var u=new sf(new ae(n,r,i),new ae(n+a,r+o,i+s));t.childNodes.push(new e(u,t.level+1))}var n=this.boundingBox.min,r=this.boundingBox.GetCenter(),i=(this.boundingBox.max.x-this.boundingBox.min.x)/2,a=(this.boundingBox.max.y-this.boundingBox.min.y)/2,o=(this.boundingBox.max.z-this.boundingBox.min.z)/2;t(this,n.x,n.y,n.z,i,a,o),t(this,r.x,n.y,n.z,i,a,o),t(this,n.x,r.y,n.z,i,a,o),t(this,r.x,r.y,n.z,i,a,o),t(this,n.x,n.y,r.z,i,a,o),t(this,r.x,n.y,r.z,i,a,o),t(this,n.x,r.y,r.z,i,a,o),t(this,r.x,r.y,r.z,i,a,o)}},{key:"IsPointInBounds",value:function(e){return $(e.x,this.boundingBox.min.x)&&$(e.y,this.boundingBox.min.y)&&$(e.z,this.boundingBox.min.z)&&Q(e.x,this.boundingBox.max.x)&&Q(e.y,this.boundingBox.max.y)&&Q(e.z,this.boundingBox.max.z)}}]),e}(),cf=function(){function e(t,n){i()(this,e),this.options={maxPointsPerNode:10,maxTreeDepth:10},void 0!==n&&(void 0!==n.maxPointsPerNode&&(this.options.maxPointsPerNode=n.maxPointsPerNode),void 0!==n.maxTreeDepth&&(this.options.maxTreeDepth=n.maxTreeDepth)),this.rootNode=new lf(t,0)}return o()(e,[{key:"AddPoint",value:function(e,t){return this.rootNode.AddPoint(e,t,this.options)}},{key:"FindPoint",value:function(e){return this.rootNode.FindPoint(e)}}]),e}(),hf=function(){function e(t,n){i()(this,e),this.nodeId=t,this.meshIndex=n}return o()(e,[{key:"IsEqual",value:function(e){return this.nodeId===e.nodeId&&this.meshIndex===e.meshIndex}},{key:"GetKey",value:function(){return this.nodeId.toString()+":"+this.meshIndex.toString()}}]),e}(),ff=function(e){Ue()(n,e);var t=ze()(n);function n(e,r,a){var o;return i()(this,n),(o=t.call(this)).id=e,o.node=r,o.mesh=a,o}return o()(n,[{key:"GetId",value:function(){return this.id}},{key:"GetTransformation",value:function(){return this.node.GetWorldTransformation()}},{key:"GetMesh",value:function(){return this.mesh}},{key:"VertexCount",value:function(){return this.mesh.VertexCount()}},{key:"VertexColorCount",value:function(){return this.mesh.VertexColorCount()}},{key:"NormalCount",value:function(){return this.mesh.NormalCount()}},{key:"TextureUVCount",value:function(){return this.mesh.TextureUVCount()}},{key:"TriangleCount",value:function(){return this.mesh.TriangleCount()}},{key:"EnumerateVertices",value:function(e){var t=this.node.GetWorldTransformation();t.IsIdentity()?this.mesh.EnumerateVertices(e):this.mesh.EnumerateVertices((function(n){var r=t.TransformCoord3D(n);e(r)}))}},{key:"EnumerateTriangleVertexIndices",value:function(e){this.mesh.EnumerateTriangleVertexIndices(e)}},{key:"EnumerateTriangleVertices",value:function(e){var t=this.node.GetWorldTransformation();t.IsIdentity()?this.mesh.EnumerateTriangleVertices(e):this.mesh.EnumerateTriangleVertices((function(n,r,i){var a=t.TransformCoord3D(n),o=t.TransformCoord3D(r),s=t.TransformCoord3D(i);e(a,o,s)}))}},{key:"PropertyGroupCount",value:function(){return this.mesh.PropertyGroupCount()}},{key:"AddPropertyGroup",value:function(e){return this.mesh.AddPropertyGroup(e)}},{key:"GetPropertyGroup",value:function(e){return this.mesh.GetPropertyGroup(e)}},{key:"GetTransformedMesh",value:function(){var e=this.node.GetWorldTransformation(),t=this.mesh.Clone();return af(t,e),t}}]),n}(Je),df=function(){function e(){i()(this,e),this.nextId=0}return o()(e,[{key:"GenerateId",value:function(){var e=this.nextId;return this.nextId+=1,e}}]),e}(),pf={GroupNode:0,MeshNode:1},vf=function(){function e(){i()(this,e),this.type=pf.GroupNode,this.name="",this.parent=null,this.transformation=new $h,this.childNodes=[],this.meshIndices=[],this.idGenerator=new df,this.id=this.idGenerator.GenerateId()}return o()(e,[{key:"IsEmpty",value:function(){return 0===this.childNodes.length&&0===this.meshIndices.length}},{key:"GetType",value:function(){return this.type}},{key:"SetType",value:function(e){this.type=e}},{key:"GetId",value:function(){return this.id}},{key:"GetName",value:function(){return this.name}},{key:"SetName",value:function(e){this.name=e}},{key:"HasParent",value:function(){return null!==this.parent}},{key:"GetParent",value:function(){return this.parent}},{key:"GetTransformation",value:function(){return this.transformation}},{key:"GetWorldTransformation",value:function(){for(var e=this.transformation.Clone(),t=this.parent;null!==t;)e.Append(t.transformation),t=t.parent;return e}},{key:"SetTransformation",value:function(e){this.transformation=e}},{key:"AddChildNode",value:function(e){return e.parent=this,e.idGenerator=this.idGenerator,e.id=e.idGenerator.GenerateId(),this.childNodes.push(e),this.childNodes.length-1}},{key:"RemoveChildNode",value:function(e){e.parent=null;var t=this.childNodes.indexOf(e);this.childNodes.splice(t,1)}},{key:"GetChildNodes",value:function(){return this.childNodes}},{key:"ChildNodeCount",value:function(){return this.childNodes.length}},{key:"GetChildNode",value:function(e){return this.childNodes[e]}},{key:"AddMeshIndex",value:function(e){return this.meshIndices.push(e),this.meshIndices.length-1}},{key:"MeshIndexCount",value:function(){return this.meshIndices.length}},{key:"GetMeshIndex",value:function(e){return this.meshIndices[e]}},{key:"GetMeshIndices",value:function(){return this.meshIndices}},{key:"Enumerate",value:function(e){e(this);var t,n=d()(this.childNodes);try{for(n.s();!(t=n.n()).done;){t.value.Enumerate(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"EnumerateChildren",value:function(e){var t,n=d()(this.childNodes);try{for(n.s();!(t=n.n()).done;){var r=t.value;e(r),r.EnumerateChildren(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"EnumerateMeshIndices",value:function(e){var t,n=d()(this.meshIndices);try{for(n.s();!(t=n.n()).done;){e(t.value)}}catch(e){n.e(e)}finally{n.f()}var r,i=d()(this.childNodes);try{for(i.s();!(r=i.n()).done;){r.value.EnumerateMeshIndices(e)}}catch(e){i.e(e)}finally{i.f()}}}]),e}(),mf=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this)).root=new vf,e.materials=[],e.meshes=[],e}return o()(n,[{key:"GetRootNode",value:function(){return this.root}},{key:"MaterialCount",value:function(){return this.materials.length}},{key:"MeshCount",value:function(){return this.meshes.length}},{key:"MeshInstanceCount",value:function(){var e=0;return this.root.Enumerate((function(t){e+=t.MeshIndexCount()})),e}},{key:"VertexCount",value:function(){var e=0;return this.EnumerateMeshInstances((function(t){e+=t.VertexCount()})),e}},{key:"VertexColorCount",value:function(){var e=0;return this.EnumerateMeshInstances((function(t){e+=t.VertexColorCount()})),e}},{key:"NormalCount",value:function(){var e=0;return this.EnumerateMeshInstances((function(t){e+=t.NormalCount()})),e}},{key:"TextureUVCount",value:function(){var e=0;return this.EnumerateMeshInstances((function(t){e+=t.TextureUVCount()})),e}},{key:"TriangleCount",value:function(){var e=0;return this.EnumerateMeshInstances((function(t){e+=t.TriangleCount()})),e}},{key:"AddMaterial",value:function(e){return this.materials.push(e),this.materials.length-1}},{key:"GetMaterial",value:function(e){return this.materials[e]}},{key:"AddMesh",value:function(e){return this.meshes.push(e),this.meshes.length-1}},{key:"AddMeshToRootNode",value:function(e){var t=this.AddMesh(e);return this.root.AddMeshIndex(t),t}},{key:"RemoveMesh",value:function(e){this.meshes.splice(e,1),this.root.Enumerate((function(t){for(var n=0;n<t.meshIndices.length;n++)t.meshIndices[n]===e?(t.meshIndices.splice(n,1),n-=1):t.meshIndices[n]>e&&(t.meshIndices[n]-=1)}))}},{key:"GetMesh",value:function(e){return this.meshes[e]}},{key:"GetMeshInstance",value:function(e){var t=null;if(this.root.Enumerate((function(n){n.GetId()===e.nodeId&&(t=n)})),null===t)return null;if(-1===t.GetMeshIndices().indexOf(e.meshIndex))return null;var n=this.GetMesh(e.meshIndex),r=new hf(t.GetId(),e.meshIndex);return new ff(r,t,n)}},{key:"EnumerateMeshes",value:function(e){var t,n=d()(this.meshes);try{for(n.s();!(t=n.n()).done;){e(t.value)}}catch(e){n.e(e)}finally{n.f()}}},{key:"EnumerateMeshInstances",value:function(e){var t=this;this.root.Enumerate((function(n){var r,i=d()(n.GetMeshIndices());try{for(i.s();!(r=i.n()).done;){var a=r.value,o=new hf(n.GetId(),a),s=t.GetMesh(a),u=new ff(o,n,s);e(u)}}catch(e){i.e(e)}finally{i.f()}}))}},{key:"EnumerateTransformedMeshes",value:function(e){this.EnumerateMeshInstances((function(t){var n=t.GetTransformedMesh();e(n)}))}},{key:"EnumerateVertices",value:function(e){this.EnumerateMeshInstances((function(t){t.EnumerateVertices(e)}))}},{key:"EnumerateTriangleVertexIndices",value:function(e){this.EnumerateMeshInstances((function(t){t.EnumerateTriangleVertexIndices(e)}))}},{key:"EnumerateTriangleVertices",value:function(e){this.EnumerateMeshInstances((function(t){t.EnumerateTriangleVertices(e)}))}}]),n}(Je),gf=o()((function e(){i()(this,e),this.edges=[],this.triangles=[]})),yf=o()((function e(t,n){i()(this,e),this.vertex1=t,this.vertex2=n,this.triangles=[]})),xf=o()((function e(t,n){i()(this,e),this.edge=t,this.reversed=n})),_f=o()((function e(){i()(this,e),this.triEdge1=null,this.triEdge2=null,this.triEdge3=null})),bf=function(){function e(){i()(this,e),this.vertices=[],this.edges=[],this.triangleEdges=[],this.triangles=[],this.edgeStartToEndVertexMap=new Map}return o()(e,[{key:"AddVertex",value:function(){return this.vertices.push(new gf),this.vertices.length-1}},{key:"AddTriangle",value:function(e,t,n){function r(e,t,n){e[t].triangles.push(n)}function i(e,t,n,r){var i=e[n],a=t[r];i.edges.push(a.edge)}function a(e,t,n,r){e[t[n].edge].triangles.push(r)}var o=this.triangles.length,s=new _f;s.triEdge1=this.AddTriangleEdge(e,t),s.triEdge2=this.AddTriangleEdge(t,n),s.triEdge3=this.AddTriangleEdge(n,e),r(this.vertices,e,o),r(this.vertices,t,o),r(this.vertices,n,o),i(this.vertices,this.triangleEdges,e,s.triEdge1),i(this.vertices,this.triangleEdges,t,s.triEdge2),i(this.vertices,this.triangleEdges,n,s.triEdge3),a(this.edges,this.triangleEdges,s.triEdge1,o),a(this.edges,this.triangleEdges,s.triEdge2,o),a(this.edges,this.triangleEdges,s.triEdge3,o),this.triangles.push(s)}},{key:"AddTriangleEdge",value:function(e,t){var n=e,r=t,i=!1;t<e&&(n=t,r=e,i=!0);var a=this.AddEdge(n,r);return this.triangleEdges.push(new xf(a,i)),this.triangleEdges.length-1}},{key:"AddEdge",value:function(e,t){this.edgeStartToEndVertexMap.has(e)||this.edgeStartToEndVertexMap.set(e,[]);for(var n=this.edgeStartToEndVertexMap.get(e),r=0;r<n.length;r++){var i=n[r];if(i.endVertex===t)return i.edgeIndex}var a=this.edges.length;return n.push({endVertex:t,edgeIndex:a}),this.edges.push(new yf(e,t)),a}}]),e}();function Tf(e){var t=!0;return e.EnumerateMeshInstances((function(e){nf(e)!==tf.Empty&&(t=!1)})),t}function Mf(e){var t=new uf;return e.EnumerateVertices((function(e){t.AddPoint(e)})),t.GetBox()}function wf(e){function t(e,t,n){var r=t.FindPoint(e);return null===r&&(r=n.AddVertex(),t.AddPoint(e,r)),r}var n=Mf(e),r=new cf(n),i=new bf;return e.EnumerateTriangleVertices((function(e,n,a){var o=t(e,r,i),s=t(n,r,i),u=t(a,r,i);i.AddTriangle(o,s,u)})),i}function Sf(e){function t(e,t,n){var r=e.triangles[t],i=e.triangleEdges[r.triEdge1],a=e.triangleEdges[r.triEdge2],o=e.triangleEdges[r.triEdge3];return i.edge===n?i.reversed:a.edge===n?a.reversed:o.edge===n?o.reversed:null}if(e instanceof mf){var n=!0;return e.EnumerateMeshInstances((function(e){n&&(n=Sf(e))})),n}for(var r=wf(e),i=0;i<r.edges.length;i++){var a=r.edges[i];if(2!==a.triangles.length)return!1;var o=t(r,a.triangles[0],i),s=t(r,a.triangles[1],i);if(null===o||null===s||o===s)return!1}return!0}function Ef(e){for(var t=0;t<e.MaterialCount();t++){var n=e.GetMaterial(t);if(n.isDefault&&!n.vertexColors)return!0}return!1}function kf(e,t){for(var n=0;n<e.MaterialCount();n++){var r=e.GetMaterial(n);r.isDefault&&(r.color=t)}}var Af={Text:1,Integer:2,Number:3,Boolean:4,Percent:5,Color:6},Cf=function(){function e(t,n,r){i()(this,e),this.type=t,this.name=n,this.value=r}return o()(e,[{key:"Clone",value:function(){var t=this.type===Af.Color;return new e(this.type,this.name,t?this.value.Clone():this.value)}}]),e}(),If=function(){function e(t){i()(this,e),this.name=t,this.properties=[]}return o()(e,[{key:"PropertyCount",value:function(){return this.properties.length}},{key:"AddProperty",value:function(e){this.properties.push(e)}},{key:"GetProperty",value:function(e){return this.properties[e]}},{key:"Clone",value:function(){var t,n=new e(this.name),r=d()(this.properties);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.AddProperty(i.Clone())}}catch(e){r.e(e)}finally{r.f()}return n}}]),e}();function Rf(e){return e.type===Af.Text?x(e.value):e.type===Af.Integer?e.value.toLocaleString():e.type===Af.Number?e.value.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):e.type===Af.Boolean?e.value?"True":"False":e.type===Af.Percent?parseInt(100*e.value,10).toString()+"%":e.type===Af.Color?"#"+Me(e.value):null}var Lf=function(){function e(t){i()(this,e),this.params={getDefaultMaterialColor:function(){return new ve(0,0,0)}},g(t,this.params),this.defaultMaterialIndex=null}return o()(e,[{key:"Finalize",value:function(e){this.Reset(),this.FinalizeMeshes(e),this.FinalizeMaterials(e),this.FinalizeNodes(e)}},{key:"FinalizeMaterials",value:function(e){if(0!==e.VertexColorCount()){for(var t=new Map,n=0;n<e.MeshCount();n++)for(var r=e.GetMesh(n),i=0;i<r.TriangleCount();i++){var a=r.GetTriangle(i),o=a.HasVertexColors();t.has(a.mat)?o||t.set(a.mat,!1):t.set(a.mat,o)}var s,u=d()(t);try{for(u.s();!(s=u.n()).done;){var l=rt()(s.value,2),c=l[0],h=l[1];e.GetMaterial(c).vertexColors=h}}catch(e){u.e(e)}finally{u.f()}}}},{key:"FinalizeMeshes",value:function(e){for(var t=0;t<e.MeshCount();t++){var n=e.GetMesh(t);nf(n)!==tf.Empty?this.FinalizeMesh(e,n):(e.RemoveMesh(t),t-=1)}}},{key:"FinalizeMesh",value:function(e,t){for(var n={calculateCurveNormals:!1},r=0;r<t.TriangleCount();r++){var i=t.GetTriangle(r);this.FinalizeTriangle(t,i,n),null===i.mat&&(i.mat=this.GetDefaultMaterialIndex(e))}n.calculateCurveNormals&&function(e){function t(e,t,n,r,i){function a(e,t){for(var n=0;n<e.length;n++)if(oe(e[n],t))return!0;return!1}for(var o=[],s=i.get(n),u=0;u<s.length;u++){var l=s[u],c=e.GetTriangle(l);if(t.curve===c.curve){var h=r[l];a(o,h)||o.push(h)}}for(var f=new ae(0,0,0),d=0;d<o.length;d++)f=se(f,o[d]);return f.MultiplyScalar(1/o.length),f.Normalize(),e.AddNormal(f)}for(var n=[],r=new Map,i=0;i<e.VertexCount();i++)r.set(i,[]);for(var a=0;a<e.TriangleCount();a++){var o=e.GetTriangle(a),s=rf(e.GetVertex(o.v0),e.GetVertex(o.v1),e.GetVertex(o.v2));n.push(s),r.get(o.v0).push(a),r.get(o.v1).push(a),r.get(o.v2).push(a)}for(var u=0;u<e.TriangleCount();u++){var l=e.GetTriangle(u);if(!l.HasNormals()){var c=t(e,l,l.v0,n,r),h=t(e,l,l.v1,n,r),f=t(e,l,l.v2,n,r);l.SetNormals(c,h,f)}}}(t)}},{key:"FinalizeTriangle",value:function(e,t,n){if(!t.HasNormals())if(null===t.curve||0===t.curve){var r=rf(e.GetVertex(t.v0),e.GetVertex(t.v1),e.GetVertex(t.v2)),i=e.AddNormal(r);t.SetNormals(i,i,i)}else n.calculateCurveNormals=!0;null===t.curve&&(t.curve=0)}},{key:"FinalizeNodes",value:function(e){var t=e.GetRootNode(),n=[];t.EnumerateChildren((function(e){e.IsEmpty()&&n.push(e)}));for(var r=0;r<n.length;r++){var i=n[r],a=i.GetParent();null!==a&&(a.RemoveChildNode(i),a.IsEmpty()&&n.push(a))}}},{key:"GetDefaultMaterialIndex",value:function(e){if(null===this.defaultMaterialIndex){var t=this.params.getDefaultMaterialColor(),n=new qe;n.color=t,n.isDefault=!0,this.defaultMaterialIndex=e.AddMaterial(n)}return this.defaultMaterialIndex}},{key:"Reset",value:function(){this.defaultMaterialIndex=null}}]),e}();function Pf(e,t){new Lf(t).Finalize(e)}function Nf(e){function t(e){return!!function(e){return null!=e}(e)&&!isNaN(e)}function n(e,n){return!!t(e)&&!(e<0||e>=n)}function r(e,r){function i(e,r,i){if(!n(i.v0,r.VertexCount()))return!1;if(!n(i.v1,r.VertexCount()))return!1;if(!n(i.v2,r.VertexCount()))return!1;if(i.HasVertexColors()){if(!n(i.c0,r.VertexColorCount()))return!1;if(!n(i.c1,r.VertexColorCount()))return!1;if(!n(i.c2,r.VertexColorCount()))return!1}if(!n(i.n0,r.NormalCount()))return!1;if(!n(i.n1,r.NormalCount()))return!1;if(!n(i.n2,r.NormalCount()))return!1;if(i.HasTextureUVs()){if(!n(i.u0,r.TextureUVCount()))return!1;if(!n(i.u1,r.TextureUVCount()))return!1;if(!n(i.u2,r.TextureUVCount()))return!1}return!!n(i.mat,e.MaterialCount())&&!!t(i.curve)}for(var a=0;a<r.VertexCount();a++){var o=r.GetVertex(a);if(!t(o.x))return!1;if(!t(o.y))return!1;if(!t(o.z))return!1}for(var s=0;s<r.VertexColorCount();s++){var u=r.GetVertexColor(s);if(!t(u.r))return!1;if(!t(u.g))return!1;if(!t(u.b))return!1}for(var l=0;l<r.NormalCount();l++){var c=r.GetNormal(l);if(!t(c.x))return!1;if(!t(c.y))return!1;if(!t(c.z))return!1}for(var h=0;h<r.TextureUVCount();h++){var f=r.GetTextureUV(h);if(!t(f.x))return!1;if(!t(f.y))return!1}for(var d=0;d<r.TriangleCount();d++){var p=r.GetTriangle(d);if(!i(e,r,p))return!1}return!0}for(var i=0;i<e.MeshCount();i++){var a=e.GetMesh(i);if(!r(e,a))return!1}return!0}var Of=function(){function e(){i()(this,e),this.name=null,this.extension=null,this.callbacks=null,this.model=null,this.error=null,this.message=null}return o()(e,[{key:"Import",value:function(e,t,n,r){var i=this;this.Clear(),this.name=e,this.extension=t,this.callbacks=r,this.model=new mf,this.error=!1,this.message=null,this.ResetContent(),this.ImportContent(n,(function(){i.CreateResult(r)}))}},{key:"Clear",value:function(){this.name=null,this.extension=null,this.callbacks=null,this.model=null,this.error=null,this.message=null,this.ClearContent()}},{key:"CreateResult",value:function(e){return this.error?(e.onError(),void e.onComplete()):Tf(this.model)?(this.SetError("The model doesn't contain any meshes."),e.onError(),void e.onComplete()):(Pf(this.model,{getDefaultMaterialColor:this.callbacks.getDefaultMaterialColor}),e.onSuccess(),void e.onComplete())}},{key:"CanImportExtension",value:function(e){return!1}},{key:"GetUpDirection",value:function(){return ie.Z}},{key:"ClearContent",value:function(){}},{key:"ResetContent",value:function(){}},{key:"ImportContent",value:function(e,t){}},{key:"GetModel",value:function(){return this.model}},{key:"SetError",value:function(e){this.error=!0,null!=e&&(this.message=e)}},{key:"WasError",value:function(){return this.error}},{key:"GetErrorMessage",value:function(){return this.message}}]),e}();function Df(e,t,n){var r=e.substring(t),i=r.indexOf(n);return-1!==i&&(r=r.substring(0,i)),r.trim()}function Ff(e,t){if(null!==t){var n=e.indexOf(t);-1!==n&&(e=e.substring(0,n).trim())}return e.split(/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+/)}function Uf(e,t){function n(e,t){var n=e.trim();n.length>0&&t(n)}for(var r=0,i=e.indexOf("\n",r);-1!==i;)n(e.substring(r,i),t),r=i+1,i=e.indexOf("\n",r);n(e.substring(r),t)}function Gf(e){return 0==(e&e-1)}function zf(e){if(Gf(e))return e;var t=Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)));return parseInt(t,10)}function Vf(e){e.transparent=!1,Z(e.opacity,1)&&(e.transparent=!0)}var Bf=function(){function e(t){i()(this,e),this.model=t,this.colorToMaterialIndex=new Map}return o()(e,[{key:"GetMaterialIndex",value:function(e,t,n,r){var i=Te(e)+Te(t)+Te(n),a=null!=r;if(a&&(i+=Te(r)),this.colorToMaterialIndex.has(i))return this.colorToMaterialIndex.get(i);var o=new qe;o.name=i.toUpperCase(),o.color=new ve(e,t,n),a&&r<255&&(o.opacity=r/255,Vf(o));var s=this.model.AddMaterial(o);return this.colorToMaterialIndex.set(i,s),s}}]),e}(),Wf=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this)).rhino=null,e}return o()(n,[{key:"CanImportExtension",value:function(e){return"3dm"===e}},{key:"GetUpDirection",value:function(){return ie.Z}},{key:"ClearContent",value:function(){this.instanceIdToObject=null,this.instanceIdToDefinition=null}},{key:"ResetContent",value:function(){this.instanceIdToObject=new Map,this.instanceIdToDefinition=new Map}},{key:"ImportContent",value:function(e,t){var n=this;null===this.rhino?O("loaders/rhino3dm.min.js").then((function(){rhino3dm().then((function(r){n.rhino=r,n.ImportRhinoContent(e),t()}))})).catch((function(){n.SetError("Failed to load rhino3dm."),t()})):(this.ImportRhinoContent(e),t())}},{key:"ImportRhinoContent",value:function(e){var t=this.rhino.File3dm.fromByteArray(e);null!==t?(this.ImportRhinoDocument(t),Tf(this.model)&&this.SetError("The model doesn't contain any 3D meshes. Try to save the model while you are in shaded view in Rhino.")):this.SetError("Failed to read Rhino file.")}},{key:"ImportRhinoDocument",value:function(e){this.InitRhinoInstances(e),this.ImportRhinoUserStrings(e),this.ImportRhinoGeometry(e)}},{key:"InitRhinoInstances",value:function(e){for(var t=e.objects(),n=0;n<t.count;n++){var r=t.get(n),i=r.attributes();i.isInstanceDefinitionObject&&this.instanceIdToObject.set(i.id,r)}for(var a=e.instanceDefinitions(),o=0;o<a.count();o++){var s=a.get(o);this.instanceIdToDefinition.set(s.id,s)}}},{key:"ImportRhinoUserStrings",value:function(e){var t=e.strings();if(t.count()>0){for(var n=new If("Document user texts"),r=0;r<t.count();r++){var i=t.get(r);n.AddProperty(new Cf(Af.Text,i[0],i[1]))}this.model.AddPropertyGroup(n)}}},{key:"ImportRhinoGeometry",value:function(e){for(var t=e.objects(),n=0;n<t.count;n++){var r=t.get(n);this.ImportRhinoGeometryObject(e,r,[])}}},{key:"ImportRhinoGeometryObject",value:function(e,t,n){var r=t.geometry(),i=t.attributes(),a=r.objectType;if(!i.isInstanceDefinitionObject||0!==n.length){var o=null,s=!1;if(a===this.rhino.ObjectType.Mesh)o=r,s=!1;else if(a===this.rhino.ObjectType.Extrusion)o=r.getMesh(this.rhino.MeshType.Any),s=!0;else if(a===this.rhino.ObjectType.Brep){o=new this.rhino.Mesh;for(var u=r.faces(),l=0;l<u.count;l++){var c=u.get(l),h=c.getMesh(this.rhino.MeshType.Any);h&&(o.append(h),h.delete()),c.delete()}u.delete(),o.compact(),s=!0}else if(a===this.rhino.ObjectType.SubD)r.subdivide(3),o=this.rhino.Mesh.createFromSubDControlNet(r),s=!0;else if(a===this.rhino.ObjectType.InstanceReference){var f=r.parentIdefId;if(this.instanceIdToDefinition.has(f))for(var d=this.instanceIdToDefinition.get(f).getObjectIds(),p=0;p<d.length;p++){var v=d[p];if(this.instanceIdToObject.has(v)){var m=this.instanceIdToObject.get(v);n.push(t),this.ImportRhinoGeometryObject(e,m,n),n.pop()}}}null!==o&&(this.ImportRhinoMesh(e,o,t,n),s&&o.delete())}}},{key:"ImportRhinoMesh",value:function(e,t,n,r){var i=n.attributes(),a=this.GetMaterialIndex(e,n,r),o=Jc(t.toThreejsJSON().data,a);o.SetName(i.name);var s=i.getUserStrings();if(s.length>0){for(var u=new If("User texts"),l=0;l<s.length;l++){var c=s[l];u.AddProperty(new Cf(Af.Text,c[0],c[1]))}o.AddPropertyGroup(u)}if(0!==r.length){for(var h=(new Jh).CreateIdentity(),f=r.length-1;f>=0;f--){var d=r[f].geometry().xform.toFloatArray(!1),p=new Jh(d);h=h.MultiplyMatrix(p)}af(o,new $h(h))}this.model.AddMeshToRootNode(o)}},{key:"GetMaterialIndex",value:function(e,t,n){var r=function t(n,r,i){var a=r.attributes();if(a.materialSource===n.ObjectMaterialSource.MaterialFromObject){var o=a.materialIndex;if(o>-1)return e.materials().get(o)}else if(a.materialSource===n.ObjectMaterialSource.MaterialFromLayer){var s=a.layerIndex;if(s>-1){var u=e.layers().get(s).renderMaterialIndex;if(u>-1)return e.materials().get(u)}}else if(a.materialSource===n.ObjectMaterialSource.MaterialFromParent&&0!==i.length)return t(n,i[0],[]);return null}(this.rhino,t,n);return null===r?null:function(e,t,n){for(var r=function(e,t){function n(e,t){e.Set(t.r,t.g,t.b)}function r(e){return 0===e.r&&0===e.g&&0===e.b}function i(e){return 255===e.r&&255===e.g&&255===e.b}var a=null,o=e.physicallyBased();o.supported?((a=new Xe).metalness=o.metallic?1:0,a.roughness=o.roughness):(n((a=new qe).ambient,e.ambientColor),n(a.specular,e.specularColor)),a.name=e.name,n(a.color,e.diffuseColor),a.opacity=1-e.transparency,Vf(a),r(a.color)&&!i(e.reflectionColor)&&n(a.color,e.reflectionColor),r(a.color)&&!i(e.transparentColor)&&n(a.color,e.transparentColor);var s=e.getBitmapTexture();if(s){var u=new Ve,l=T(s.fileName),c=t.getFileBuffer(l);u.name=l,u.buffer=c,a.diffuseMap=u}return a}(t,n),i=0;i<e.MaterialCount();i++){if(e.GetMaterial(i).IsEqual(r))return i}return e.AddMaterial(r)}(this.model,r,this.callbacks)}}]),n}(Of),Hf=19789,jf=15677,qf=45055,Xf=40960,Yf=40976,Kf=40992,Zf=41008,Jf=41024,Qf=41025,$f=41040,ed=16,td=17,nd=18,rd=19,id=41472,ad=41728,od=41816,sd=41818,ud=41812,ld=41814,cd=41820,hd=48,fd=49,dd=16384,pd=16640,vd=16656,md=16704,gd=16672,yd=16736,xd=16688,_d=16720,bd=45056,Td=45058,Md=45072,wd=45073,Sd=45075,Ed=45088,kd=45089,Ad=45090,Cd=45104,Id=o()((function e(){i()(this,e),this.id=-1,this.name="",this.flags=-1,this.parentId=-1,this.instanceName="",this.pivot=[0,0,0],this.positions=[],this.rotations=[],this.scales=[]})),Rd=function(){function e(){i()(this,e),this.nodes=[],this.nodeIdToNode=new Map}return o()(e,[{key:"IsEmpty",value:function(){return 0===this.nodes.length}},{key:"AddNode",value:function(e){this.nodes.push(e),this.nodeIdToNode.set(e.nodeId,e)}},{key:"GetNodes",value:function(){return this.nodes}}]),e}(),Ld=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"3ds"===e}},{key:"GetUpDirection",value:function(){return ie.Z}},{key:"ClearContent",value:function(){this.materialNameToIndex=null,this.meshNameToIndex=null,this.nodeList=null}},{key:"ResetContent",value:function(){this.materialNameToIndex=new Map,this.meshNameToIndex=new Map,this.nodeList=new Rd}},{key:"ImportContent",value:function(e,t){this.ProcessBinary(e),t()}},{key:"ProcessBinary",value:function(e){var t=this,n=new C(e,!0),r=n.GetByteLength();this.ReadChunks(n,r,(function(e,r){e===Hf?t.ReadMainChunk(n,r):t.SkipChunk(n,r)}))}},{key:"ReadMainChunk",value:function(e,t){var n=this,r=this.GetChunkEnd(e,t);this.ReadChunks(e,r,(function(t,r){t===jf?n.ReadEditorChunk(e,r):t===bd?n.ReadKeyFrameChunk(e,r):n.SkipChunk(e,r)})),this.BuildNodeHierarchy()}},{key:"ReadEditorChunk",value:function(e,t){var n=this,r=this.GetChunkEnd(e,t);this.ReadChunks(e,r,(function(t,r){t===qf?n.ReadMaterialChunk(e,r):t===dd?n.ReadObjectChunk(e,r):n.SkipChunk(e,r)}))}},{key:"ReadMaterialChunk",value:function(e,t){var n=this,r=new qe,i=this.GetChunkEnd(e,t),a=null,o=null;this.ReadChunks(e,i,(function(t,i){t===Xf?r.name=n.ReadName(e):t===Yf?r.ambient=n.ReadColorChunk(e,i):t===Kf?r.color=n.ReadColorChunk(e,i):t===Zf?r.specular=n.ReadColorChunk(e,i):t===Jf?a=n.ReadPercentageChunk(e,i):t===Qf?o=n.ReadPercentageChunk(e,i):t===$f?(r.opacity=1-n.ReadPercentageChunk(e,i),Vf(r)):t===id?(r.diffuseMap=n.ReadTextureMapChunk(e,i),Vf(r)):n.SkipChunk(e,i)})),null!==a&&null!==o&&(r.shininess=a*o/10);var s=this.model.AddMaterial(r);this.materialNameToIndex.set(r.name,s)}},{key:"ReadTextureMapChunk",value:function(e,t){var n=this,r=new Ve,i=this.GetChunkEnd(e,t);return this.ReadChunks(e,i,(function(t,i){if(t===ad){var a=n.ReadName(e),o=n.callbacks.getFileBuffer(a);r.name=a,r.buffer=o}else t===od?r.offset.x=e.ReadFloat32():t===sd?r.offset.y=e.ReadFloat32():t===ud?r.scale.x=e.ReadFloat32():t===ld?r.scale.y=e.ReadFloat32():t===cd?r.rotation=e.ReadFloat32()*Y:n.SkipChunk(e,i)})),r}},{key:"ReadColorChunk",value:function(e,t){var n=this,r=new ve(0,0,0),i=this.GetChunkEnd(e,t),a=!1;return this.ReadChunks(e,i,(function(t,i){t===td?a||(r.r=e.ReadUnsignedCharacter8(),r.g=e.ReadUnsignedCharacter8(),r.b=e.ReadUnsignedCharacter8()):t===nd?(r.r=e.ReadUnsignedCharacter8(),r.g=e.ReadUnsignedCharacter8(),r.b=e.ReadUnsignedCharacter8(),a=!0):t===ed?a||(r.r=ge(e.ReadFloat32()),r.g=ge(e.ReadFloat32()),r.b=ge(e.ReadFloat32())):t===rd?(r.r=ge(e.ReadFloat32()),r.g=ge(e.ReadFloat32()),r.b=ge(e.ReadFloat32()),a=!0):n.SkipChunk(e,i)})),r}},{key:"ReadPercentageChunk",value:function(e,t){var n=this,r=0,i=this.GetChunkEnd(e,t);return this.ReadChunks(e,i,(function(t,i){t===hd?r=e.ReadUnsignedInteger16()/100:t===fd?r=e.ReadFloat32():n.SkipChunk(e,i)})),r}},{key:"ReadObjectChunk",value:function(e,t){var n=this,r=this.GetChunkEnd(e,t),i=this.ReadName(e);this.ReadChunks(e,r,(function(t,r){t===pd?n.ReadMeshChunk(e,r,i):n.SkipChunk(e,r)}))}},{key:"ReadMeshChunk",value:function(e,t,n){var r=this;var i=new Qe;i.SetName(n);var a=this.GetChunkEnd(e,t),o=null;if(this.ReadChunks(e,a,(function(t,n){t===vd?r.ReadVerticesChunk(i,e):t===md?r.ReadTextureVerticesChunk(i,e):t===gd?r.ReadFacesChunk(i,e,n):t===yd?o=r.ReadTransformationChunk(e):r.SkipChunk(e,n)})),i.VertexCount()===i.TextureUVCount())for(var s=0;s<i.TriangleCount();s++){var u=i.GetTriangle(s);u.SetTextureUVs(u.v0,u.v1,u.v2)}var l=new Jh(o);!function(e,t){if(t.IsValid()){var n=re(t.Determinant());if(n)t=(new Jh).CreateScale(-1,1,1).MultiplyMatrix(t);var r=t.Invert();if(null!==r)af(e,new $h(r)),n&&of(e)}}(i,l);var c=this.model.AddMesh(i);this.meshNameToIndex.set(i.GetName(),c)}},{key:"ReadVerticesChunk",value:function(e,t){for(var n=t.ReadUnsignedInteger16(),r=0;r<n;r++){var i=t.ReadFloat32(),a=t.ReadFloat32(),o=t.ReadFloat32();e.AddVertex(new ae(i,a,o))}}},{key:"ReadTextureVerticesChunk",value:function(e,t){for(var n=t.ReadUnsignedInteger16(),r=0;r<n;r++){var i=t.ReadFloat32(),a=t.ReadFloat32();e.AddTextureUV(new Ae(i,a))}}},{key:"ReadFacesChunk",value:function(e,t,n){for(var r=this,i=this.GetChunkEnd(t,n),a=t.ReadUnsignedInteger16(),o=0;o<a;o++){var s=t.ReadUnsignedInteger16(),u=t.ReadUnsignedInteger16(),l=t.ReadUnsignedInteger16();t.ReadUnsignedInteger16(),e.AddTriangle(new $e(s,u,l))}this.ReadChunks(t,i,(function(n,i){n===xd?r.ReadFaceMaterialsChunk(e,t):n===_d?r.ReadFaceSmoothingGroupsChunk(e,a,t):r.SkipChunk(t,i)}))}},{key:"ReadFaceMaterialsChunk",value:function(e,t){for(var n=this.ReadName(t),r=this.materialNameToIndex.get(n),i=t.ReadUnsignedInteger16(),a=0;a<i;a++){var o=t.ReadUnsignedInteger16(),s=e.GetTriangle(o);void 0!==r&&(s.mat=r)}}},{key:"ReadFaceSmoothingGroupsChunk",value:function(e,t,n){for(var r=0;r<t;r++){var i=n.ReadUnsignedInteger32();e.GetTriangle(r).curve=i}}},{key:"ReadTransformationChunk",value:function(e){for(var t=[],n=0;n<4;n++){for(var r=0;r<3;r++)t.push(e.ReadFloat32());n<3?t.push(0):t.push(1)}return t}},{key:"ReadKeyFrameChunk",value:function(e,t){var n=this,r=this.GetChunkEnd(e,t);this.ReadChunks(e,r,(function(t,r){t===Td?n.ReadObjectNodeChunk(e,r):n.SkipChunk(e,r)}))}},{key:"BuildNodeHierarchy",value:function(){function e(e,t){var n=new Jh;if(n.ComposeTRS(pe(function(e){return 0===e.positions.length?[0,0,0]:e.positions[0]}(e)),Xh(function(e){return 0===e.rotations.length?[0,0,0,1]:function(e){var t=[0,0,0,1],n=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);if(n>0){var r=-.5*e[3],i=Math.sin(r)/n;t=[i*e[0],i*e[1],i*e[2],Math.cos(r)]}return t}(e.rotations[0])}(e)),pe(function(e){return 0===e.scales.length?[1,1,1]:e.scales[0]}(e))),t){var r=e.pivot;n=(new Jh).CreateTranslation(-r[0],-r[1],-r[2]).MultiplyMatrix(n)}return new $h(n)}var t=this.model.GetRootNode();if(this.nodeList.IsEmpty())for(var n=0;n<this.model.MeshCount();n++)t.AddMeshIndex(n);else{var r,i=new Map,a=d()(this.nodeList.GetNodes());try{for(a.s();!(r=a.n()).done;){var o=r.value,s=new vf;if(o.name.length>0&&"$$$DUMMY"!==o.name&&(s.SetName(o.name),o.instanceName.length>0&&s.SetName(s.GetName()+" "+o.instanceName)),65535!==o.parentId&&i.has(o.parentId))i.get(o.parentId).AddChildNode(s);else t.AddChildNode(s);i.set(o.id,s);var u=this.meshNameToIndex.has(o.name);s.SetTransformation(e(o,u)),u&&(s.SetType(pf.MeshNode),s.AddMeshIndex(this.meshNameToIndex.get(o.name)))}}catch(e){a.e(e)}finally{a.f()}}}},{key:"ReadObjectNodeChunk",value:function(e,t){var n=this;function r(e,t,n){var r=[];t.Skip(10);for(var i=t.ReadInteger32(),a=0;a<i;a++){t.ReadInteger32(),0!==t.ReadUnsignedInteger16()&&t.ReadFloat32();var o=null;if(n===kd){var s=t.ReadFloat32();(o=e.ReadVector(t))[3]=s}else o=e.ReadVector(t);r.push(o)}return r}var i=new Id,a=this.GetChunkEnd(e,t);this.ReadChunks(e,a,(function(t,a){t===Md?(i.name=n.ReadName(e),i.flags=e.ReadUnsignedInteger32(),i.parentId=e.ReadUnsignedInteger16()):t===wd?i.instanceName=n.ReadName(e):t===Sd?i.pivot=n.ReadVector(e):t===Ed?i.positions=r(n,e,Ed):t===kd?i.rotations=r(n,e,kd):t===Ad?i.scales=r(n,e,Ad):t===Cd?i.id=e.ReadUnsignedInteger16():n.SkipChunk(e,a)})),this.nodeList.AddNode(i)}},{key:"ReadName",value:function(e){for(var t="",n=0,r=0;r<64&&0!==(n=e.ReadCharacter8());)t+=String.fromCharCode(n),r+=1;return t}},{key:"ReadVector",value:function(e){return[e.ReadFloat32(),e.ReadFloat32(),e.ReadFloat32()]}},{key:"ReadChunks",value:function(e,t,n){for(;e.GetPosition()<=t-6;){n(e.ReadUnsignedInteger16(),e.ReadUnsignedInteger32())}}},{key:"GetChunkEnd",value:function(e,t){return e.GetPosition()+t-6}},{key:"SkipChunk",value:function(e,t){e.Skip(t-6)}}]),n}(Of),Pd=5120,Nd=5121,Od=5122,Dd=5123,Fd=5125,Ud=5126,Gd=0,zd=1,Vd=2,Bd=3,Wd=4,Hd=5,jd=6,qd=4,Xd=5,Yd=6,Kd=1179937895,Zd=1313821514,Jd=5130562;function Qd(e){return xe(be(e[0]),be(e[1]),be(e[2]))}var $d=function(){function e(t){i()(this,e),this.reader=new C(t,!0),this.componentType=null,this.dataType=null,this.byteStride=null,this.dataCount=null,this.sparseReader=null}return o()(e,[{key:"SetComponentType",value:function(e){this.componentType=e}},{key:"SetDataType",value:function(e){"SCALAR"===e?this.dataType=Gd:"VEC2"===e?this.dataType=zd:"VEC3"===e?this.dataType=Vd:"VEC4"===e?this.dataType=Bd:"MAT2"===e?this.dataType=Wd:"MAT3"===e?this.dataType=Hd:"MAT4"===e&&(this.dataType=jd)}},{key:"SetByteStride",value:function(e){this.byteStride=e}},{key:"SetDataCount",value:function(e){this.dataCount=e}},{key:"SetSparseReader",value:function(e,t){this.sparseReader={indexReader:e,valueReader:t}}},{key:"ReadArrayBuffer",value:function(e){return this.reader.ReadArrayBuffer(e)}},{key:"GetDataCount",value:function(){return this.dataCount}},{key:"ReadData",value:function(){if(null===this.dataType)return null;if(this.dataType===Gd){var e=this.ReadComponent();return this.SkipBytesByStride(1),e}if(this.dataType===zd){var t=this.ReadComponent(),n=this.ReadComponent();return this.SkipBytesByStride(2),new Ae(t,n)}if(this.dataType===Vd){var r=this.ReadComponent(),i=this.ReadComponent(),a=this.ReadComponent();return this.SkipBytesByStride(3),new ae(r,i,a)}if(this.dataType===Bd){var o=this.ReadComponent(),s=this.ReadComponent(),u=this.ReadComponent(),l=this.ReadComponent();return this.SkipBytesByStride(4),new Zh(o,s,u,l)}return null}},{key:"EnumerateData",value:function(e){if(null===this.sparseReader)for(var t=0;t<this.dataCount;t++)e(this.ReadData());else{for(var n=[],r=0;r<this.sparseReader.indexReader.GetDataCount();r++){var i=this.sparseReader.indexReader.ReadData(),a=this.sparseReader.valueReader.ReadData();n.push({index:i,value:a})}for(var o=0,s=0;s<this.dataCount;s++){var u=this.ReadData();o<n.length&&n[o].index===s?(e(n[o].value),o+=1):e(u)}}}},{key:"SkipBytes",value:function(e){this.reader.Skip(e)}},{key:"ReadComponent",value:function(){return null===this.componentType?null:this.componentType===Pd?this.reader.ReadCharacter8():this.componentType===Nd?this.reader.ReadUnsignedCharacter8():this.componentType===Od?this.reader.ReadInteger16():this.componentType===Dd?this.reader.ReadUnsignedInteger16():this.componentType===Fd?this.reader.ReadInteger32():this.componentType===Ud?this.reader.ReadFloat32():null}},{key:"SkipBytesByStride",value:function(e){if(null!==this.byteStride){var t=e*this.GetComponentSize();this.reader.Skip(this.byteStride-t)}}},{key:"GetComponentSize",value:function(){return this.componentType===Pd||this.componentType===Nd?1:this.componentType===Od||this.componentType===Dd?2:this.componentType===Fd||this.componentType===Ud?4:0}}]),e}(),ep=function(){function e(){i()(this,e),this.supportedExtensions=["KHR_draco_mesh_compression","KHR_materials_pbrSpecularGlossiness","KHR_texture_transform"],this.draco=null}return o()(e,[{key:"LoadLibraries",value:function(e,t){var n=this;void 0!==e&&null===this.draco&&-1!==e.indexOf("KHR_draco_mesh_compression")?O("loaders/draco_decoder.js").then((function(){DracoDecoderModule().then((function(e){n.draco=e,t.onSuccess()}))})).catch((function(){t.onError("Failed to load draco decoder.")})):t.onSuccess()}},{key:"GetUnsupportedExtensions",value:function(e){var t=[];if(void 0===e)return t;for(var n=0;n<e.length;n++){var r=e[n];-1===this.supportedExtensions.indexOf(r)&&t.push(r)}return t}},{key:"ProcessMaterial",value:function(e,t,n){if(void 0===e.extensions)return null;var r=e.extensions.KHR_materials_pbrSpecularGlossiness;if(void 0===r)return null;var i=new qe,a=r.diffuseFactor;void 0!==a&&(i.color=Qd(a),i.opacity=a[3]);var o=r.diffuseTexture;void 0!==o&&(i.diffuseMap=n(o));var s=r.specularFactor;void 0!==s&&(i.specular=Qd(s));var u=r.specularGlossinessTexture;void 0!==u&&(i.specularMap=n(u));var l=r.glossinessFactor;return void 0!==l&&(i.shininess=l),i}},{key:"ProcessTexture",value:function(e,t){if(void 0!==e.extensions){var n=e.extensions.KHR_texture_transform;void 0!==n&&(void 0!==n.offset&&(t.offset.x=n.offset[0],t.offset.y=-n.offset[1]),void 0!==n.scale&&(t.scale.x=n.scale[0],t.scale.y=n.scale[1]),void 0!==n.rotation&&(t.rotation=-n.rotation))}}},{key:"ProcessPrimitive",value:function(e,t,n,r){function i(e,t,n,r,i){var a=t.GetAttributeByUniqueId(n,r),o=a.num_components(),s=n.num_points()*o,u=4*s,l=e._malloc(u);t.GetAttributeDataArrayForAllPoints(n,a,e.DT_FLOAT32,u,l);var c=new Float32Array(e.HEAPF32.buffer,l,s).slice();if(2===o)for(var h=0;h<c.length;h+=2)i(new Ae(c[h+0],c[h+1]));else if(3===o)for(var f=0;f<c.length;f+=3)i(new ae(c[f+0],c[f+1],c[f+2]));else if(4===o)for(var d=0;d<c.length;d+=4)i(new Zh(c[d+0],c[d+1],c[d+2],c[d+3]));e._free(l)}if(null===this.draco)return!1;if(void 0===n.extensions||void 0===n.extensions.KHR_draco_mesh_compression)return!1;var a=new this.draco.Decoder,o=new this.draco.DecoderBuffer,s=n.extensions.KHR_draco_mesh_compression,u=t.bufferViews[s.bufferView],l=e.GetReaderFromBufferView(u).ReadArrayBuffer(u.byteLength);if(o.Init(new Int8Array(l),l.byteLength),a.GetEncodedGeometryType(o)!==this.draco.TRIANGULAR_MESH)return!0;var c=new this.draco.Mesh;if(!a.DecodeBufferToMesh(o,c).ok())return!0;var h=void 0!==s.attributes.POSITION,f=void 0!==s.attributes.NORMAL,d=void 0!==s.attributes.TEXCOORD_0;if(!h)return!0;var p=r.VertexCount(),v=r.VertexColorCount(),m=r.NormalCount(),g=r.TextureUVCount();i(this.draco,a,c,s.attributes.POSITION,(function(e){r.AddVertex(e)})),f&&i(this.draco,a,c,s.attributes.NORMAL,(function(e){r.AddNormal(e)})),d&&i(this.draco,a,c,s.attributes.TEXCOORD_0,(function(e){e.y=-e.y,r.AddTextureUV(e)}));var y=3*c.num_faces(),x=4*y,_=this.draco._malloc(x);a.GetTrianglesUInt32Array(c,x,_);for(var b=new Uint32Array(this.draco.HEAPU32.buffer,_,y).slice(),T=0;T<b.length;T+=3){var M=b[T],w=b[T+1],S=b[T+2];e.AddTriangle(n,r,M,w,S,false,f,d,p,v,m,g)}return this.draco._free(_),!0}}]),e}(),tp=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this)).gltfExtensions=new ep,e}return o()(n,[{key:"CanImportExtension",value:function(e){return"gltf"===e||"glb"===e}},{key:"GetUpDirection",value:function(){return ie.Y}},{key:"ClearContent",value:function(){this.bufferContents=null,this.imageIndexToTextureParams=null}},{key:"ResetContent",value:function(){this.bufferContents=[],this.imageIndexToTextureParams=new Map}},{key:"ImportContent",value:function(e,t){"gltf"===this.extension?this.ProcessGltf(e,t):"glb"===this.extension&&this.ProcessBinaryGltf(e,t)}},{key:"ProcessGltf",value:function(e,t){var n=D(e),r=JSON.parse(n);if("2.0"!==r.asset.version)return this.SetError("Invalid glTF version."),void t();for(var i=0;i<r.buffers.length;i++){var a=null,o=r.buffers[i],s=z(o.uri);if(null!==s)a=s.buffer;else{var u=this.callbacks.getFileBuffer(o.uri);null!==u&&(a=u)}if(null===a)return this.SetError("One of the requested buffers is missing."),void t();this.bufferContents.push(a)}this.ProcessMainFile(r,t)}},{key:"ProcessBinaryGltf",value:function(e,t){function n(e){var t=e.ReadUnsignedInteger32();return{type:e.ReadUnsignedInteger32(),buffer:e.ReadArrayBuffer(t)}}var r=new C(e,!0);if(r.ReadUnsignedInteger32()!==Kd)return this.SetError("Invalid glTF file."),void t();if(2!==r.ReadUnsignedInteger32())return this.SetError("Invalid glTF version."),void t();if(r.ReadUnsignedInteger32()!==r.GetByteLength())return this.SetError("Invalid glTF file."),void t();for(var i=null;!r.End();){var a=n(r);a.type===Zd?i=D(a.buffer):a.type===Jd&&this.bufferContents.push(a.buffer)}if(null!==i){var o=JSON.parse(i);this.ProcessMainFile(o,t)}}},{key:"ProcessMainFile",value:function(e,t){var n=this,r=this.gltfExtensions.GetUnsupportedExtensions(e.extensionsRequired);if(r.length>0)return this.SetError("Unsupported extension: "+r.join(", ")+"."),void t();this.gltfExtensions.LoadLibraries(e.extensionsRequired,{onSuccess:function(){n.ImportModel(e),t()},onError:function(e){n.SetError(e),t()}})}},{key:"ImportModel",value:function(e){var t=e.materials;if(void 0!==t){var n,r=d()(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.ImportMaterial(e,i)}}catch(e){r.e(e)}finally{r.f()}}var a=e.meshes;if(void 0!==a){var o,s=d()(a);try{for(s.s();!(o=s.n()).done;){var u=o.value;this.ImportMesh(e,u)}}catch(e){s.e(e)}finally{s.f()}}this.ImportNodes(e),this.ImportModelProperties(e)}},{key:"ImportModelProperties",value:function(e){function t(e,t,n){var r=new If(t);for(var i in n)if(Object.prototype.hasOwnProperty.call(n,i)&&"string"==typeof n[i]){var a=new Cf(Af.Text,i,n[i]);r.AddProperty(a)}return r.PropertyCount()>0&&e.AddPropertyGroup(r),r}t(this.model,"Asset properties",e.asset),e.asset.extras&&t(this.model,"Extras",e.asset.extras)}},{key:"GetDefaultScene",value:function(e){var t=e.scene||0;return t>=e.scenes.length?null:e.scenes[t]}},{key:"ImportMaterial",value:function(e,t){var n=this,r=new Xe;if(void 0!==t.name&&(r.name=t.name),r.color=Qd([1,1,1]),void 0!==t.pbrMetallicRoughness){var i=t.pbrMetallicRoughness.baseColorFactor;void 0!==i&&(r.color=Qd(i),r.opacity=i[3]);var a=t.pbrMetallicRoughness.metallicFactor;void 0!==a&&(r.metalness=a);var o=t.pbrMetallicRoughness.roughnessFactor;void 0!==o&&(r.roughness=o);var s=t.emissiveFactor;void 0!==s&&(r.emissive=Qd(s)),r.diffuseMap=this.ImportTexture(e,t.pbrMetallicRoughness.baseColorTexture),r.metalnessMap=this.ImportTexture(e,t.pbrMetallicRoughness.metallicRoughnessTexture),r.normalMap=this.ImportTexture(e,t.normalTexture),r.emissiveMap=this.ImportTexture(e,t.emissiveTexture),null!==r.diffuseMap&&(r.multiplyDiffuseMap=!0);var u=t.alphaMode;void 0!==u&&("BLEND"===u?r.transparent=!0:"MASK"===u&&(r.transparent=!0,r.alphaTest=t.alphaCutoff||.5))}var l=this.gltfExtensions.ProcessMaterial(t,r,(function(t){return n.ImportTexture(e,t)}));null!==l&&(r=l),this.model.AddMaterial(r)}},{key:"ImportTexture",value:function(e,t){if(null==t)return null;var n=new Ve,r=e.textures[t.index].source,i=e.images[r],a=null;if(this.imageIndexToTextureParams.has(r))a=this.imageIndexToTextureParams.get(r);else{a={name:null,mimeType:null,buffer:null};var o=r.toString();if(void 0!==i.uri){var s=z(i.uri);if(null!==s)a.name="Embedded_"+o+"."+V(s.mimeType),a.mimeType=s.mimeType,a.buffer=s.buffer;else{var u=this.callbacks.getFileBuffer(i.uri);a.name=i.uri,a.buffer=u}}else if(void 0!==i.bufferView){var l=e.bufferViews[i.bufferView],c=this.GetReaderFromBufferView(l);if(null!==c){var h=c.ReadArrayBuffer(l.byteLength);a.name="Binary_"+o+"."+V(i.mimeType),a.mimeType=i.mimeType,a.buffer=h}}this.imageIndexToTextureParams.set(r,a)}return n.name=a.name,n.mimeType=a.mimeType,n.buffer=a.buffer,this.gltfExtensions.ProcessTexture(t,n),n}},{key:"ImportMesh",value:function(e,t){var n=new Qe;this.model.AddMesh(n),void 0!==t.name&&n.SetName(t.name);for(var r=0;r<t.primitives.length;r++){var i=t.primitives[r];this.ImportPrimitive(e,i,n)}}},{key:"ImportPrimitive",value:function(e,t,n){function r(e,t,n){var r=t.attributes[n];if(void 0===r)return!1;var i=e.accessors[r];return void 0!==i&&0!==i.count}if(!this.gltfExtensions.ProcessPrimitive(this,e,t,n)&&void 0!==t.attributes){var i=r(e,t,"POSITION"),a=r(e,t,"COLOR_0"),o=r(e,t,"NORMAL"),s=r(e,t,"TEXCOORD_0"),u=void 0!==t.indices,l=qd;if(void 0!==t.mode&&(l=t.mode),l===qd||l===Xd||l===Yd){var c=n.VertexCount(),h=n.VertexColorCount(),f=n.NormalCount(),d=n.TextureUVCount();if(i){var p=e.accessors[t.attributes.POSITION],v=this.GetReaderFromAccessor(e,p);if(null!==v){if(v.EnumerateData((function(e){n.AddVertex(e)})),a){var m=e.accessors[t.attributes.COLOR_0],g=this.GetReaderFromAccessor(e,m);if(null===g)return;g.EnumerateData((function(e){var t=function(e,t){function n(e,t){var n=e;return t===Nd?n/=255:t===Dd&&(n/=65535),ge(be(n))}return new ve(n(e[0],t),n(e[1],t),n(e[2],t))}([e.x,e.y,e.z],g.componentType);n.AddVertexColor(t)}))}if(o){var y=e.accessors[t.attributes.NORMAL],x=this.GetReaderFromAccessor(e,y);if(null===x)return;x.EnumerateData((function(e){n.AddNormal(e)}))}if(s){var _=e.accessors[t.attributes.TEXCOORD_0],b=this.GetReaderFromAccessor(e,_);if(null===b)return;b.EnumerateData((function(e){e.y=-e.y,n.AddTextureUV(e)}))}var T=[];if(u){var M=e.accessors[t.indices],w=this.GetReaderFromAccessor(e,M);if(null===w)return;w.EnumerateData((function(e){T.push(e)}))}else for(var S=n.VertexCount()-c,E=0;E<S;E++)T.push(E);if(l===qd)for(var k=0;k<T.length;k+=3){var A=T[k],C=T[k+1],I=T[k+2];this.AddTriangle(t,n,A,C,I,a,o,s,c,h,f,d)}else if(l===Xd)for(var R=0;R<T.length-2;R++){var L=T[R],P=T[R+1],N=T[R+2];if(R%2==1){var O=P;P=N,N=O}this.AddTriangle(t,n,L,P,N,a,o,s,c,h,f,d)}else if(l===Yd)for(var D=1;D<T.length-1;D++){var F=T[0],U=T[D],G=T[D+1];this.AddTriangle(t,n,F,U,G,a,o,s,c,h,f,d)}}}}}}},{key:"AddTriangle",value:function(e,t,n,r,i,a,o,s,u,l,c,h){var f=new $e(u+n,u+r,u+i);a&&f.SetVertexColors(l+n,l+r,l+i),o&&f.SetNormals(c+n,c+r,c+i),s&&f.SetTextureUVs(h+n,h+r,h+i),void 0!==e.material&&(f.mat=e.material),t.AddTriangle(f)}},{key:"ImportNodes",value:function(e){var t=this.GetDefaultScene(e);if(null!==t){var n,r=this.model.GetRootNode(),i=d()(t.nodes);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=e.nodes[a];this.ImportNode(e,o,r)}}catch(e){i.e(e)}finally{i.f()}}}},{key:"ImportNode",value:function(e,t,n){if(void 0!==t.children||void 0!==t.mesh){var r=new vf;if(void 0!==t.name&&r.SetName(t.name),r.SetTransformation(function(e){var t=(new Jh).CreateIdentity();if(void 0!==e.matrix)t.Set(e.matrix);else{var n=[0,0,0],r=[0,0,0,1],i=[1,1,1];void 0!==e.translation&&(n=e.translation),void 0!==e.rotation&&(r=e.rotation),void 0!==e.scale&&(i=e.scale),t.ComposeTRS(pe(n),Xh(r),pe(i))}return new $h(t)}(t)),n.AddChildNode(r),void 0!==t.children){var i,a=d()(t.children);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=e.nodes[o];this.ImportNode(e,s,r)}}catch(e){a.e(e)}finally{a.f()}}void 0!==t.mesh&&(void 0!==t.children&&0!==t.children.length||r.SetType(pf.MeshNode),r.AddMeshIndex(t.mesh))}}},{key:"GetReaderFromBufferView",value:function(e){var t=e.buffer||0,n=this.bufferContents[t];if(null==n)return null;var r=new $d(n);r.SkipBytes(e.byteOffset||0);var i=e.byteStride;return void 0!==i&&0!==i&&r.SetByteStride(i),r}},{key:"GetReaderFromAccessor",value:function(e,t){var n=t.bufferView||0,r=e.bufferViews[n],i=this.GetReaderFromBufferView(r);if(null===i)return null;if(i.SetComponentType(t.componentType),i.SetDataType(t.type),i.SetDataCount(t.count),i.SkipBytes(t.byteOffset||0),void 0!==t.sparse){var a=this.GetReaderFromSparseAccessor(e,t.sparse.indices,t.sparse.indices.componentType,"SCALAR",t.sparse.count),o=this.GetReaderFromSparseAccessor(e,t.sparse.values,t.componentType,t.type,t.sparse.count);null!==a&&null!==o&&i.SetSparseReader(a,o)}return i}},{key:"GetReaderFromSparseAccessor",value:function(e,t,n,r,i){if(void 0===t.bufferView)return null;var a=e.bufferViews[t.bufferView],o=this.GetReaderFromBufferView(a);return null===o?null:(o.SetComponentType(n),o.SetDataType(r),o.SetDataCount(i),o.SkipBytes(t.byteOffset||0),o)}}]),n}(Of),np=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this)).ifc=null,e}return o()(n,[{key:"CanImportExtension",value:function(e){return"ifc"===e}},{key:"GetUpDirection",value:function(){return ie.Y}},{key:"ClearContent",value:function(){this.expressIDToMesh=null,this.colorToMaterial=null}},{key:"ResetContent",value:function(){this.expressIDToMesh=new Map,this.colorToMaterial=new Bf(this.model)}},{key:"ImportContent",value:function(e,t){var n=this;null===this.ifc?O("loaders/web-ifc-api-browser.js").then((function(){n.ifc=new WebIFC.IfcAPI,n.ifc.Init().then((function(){n.ImportIfcContent(e),t()}))})).catch((function(){n.SetError("Failed to load web-ifc."),t()})):(this.ImportIfcContent(e),t())}},{key:"ImportIfcContent",value:function(e){for(var t=new Uint8Array(e),n=this.ifc.OpenModel(t,{COORDINATE_TO_ORIGIN:!0}),r=this.ifc.LoadAllGeometry(n),i=0;i<r.size();i++){var a=r.get(i);a.geometries.size()>0&&this.ImportIfcMesh(n,a)}this.ImportProperties(n),this.ifc.CloseModel(n)}},{key:"ImportIfcMesh",value:function(e,t){var n=new Qe;n.SetName("Mesh "+t.expressID.toString());for(var r=0,i=t.geometries,a=0;a<i.size();a++){for(var o=i.get(a),s=this.ifc.GetGeometry(e,o.geometryExpressID),u=this.ifc.GetVertexArray(s.GetVertexData(),s.GetVertexDataSize()),l=this.ifc.GetIndexArray(s.GetIndexData(),s.GetIndexDataSize()),c=this.GetMaterialIndexByColor(o.color),h=new Jh(o.flatTransformation),f=new $h(h),d=0;d<u.length;d+=6){var p=u[d],v=u[d+1],m=u[d+2],g=new ae(p,v,m),y=f.TransformCoord3D(g);n.AddVertex(y)}for(var x=0;x<l.length;x+=3){var _=l[x],b=l[x+1],T=l[x+2],M=new $e(r+_,r+b,r+T);M.SetMaterial(c),n.AddTriangle(M)}r+=u.length/6}this.expressIDToMesh.set(t.expressID,n),this.model.AddMeshToRootNode(n)}},{key:"ImportProperties",value:function(e){for(var t=this,n=this.ifc.GetLineIDsWithType(e,WebIFC.IFCRELDEFINESBYPROPERTIES),r=function(r){var i=n.get(r),a=t.ifc.GetLine(e,i);if(Array.isArray(a.RelatingPropertyDefinition))return"continue";a.RelatedObjects.forEach((function(n){var r=null;t.expressIDToMesh.has(n.value)?r=t.expressIDToMesh.get(n.value):t.ifc.GetLine(e,n.value,!0).type===WebIFC.IFCBUILDING&&(r=t.model);if(null!==r){var i=a.RelatingPropertyDefinition,o=t.ifc.GetLine(e,i.value,!0);if(o&&o.HasProperties){var s=new If(o.Name.value);o.HasProperties.forEach((function(e){if(e&&e.Name&&e.NominalValue){var n=null,r=t.GetIFCString(e.Name.value),i=null;switch(e.NominalValue.label){case"IFCTEXT":case"IFCLABEL":case"IFCIDENTIFIER":n=new Cf(Af.Text,r,t.GetIFCString(e.NominalValue.value));break;case"IFCBOOLEAN":case"IFCLOGICAL":i="Unknown","T"===e.NominalValue.value?i="True":"F"===e.NominalValue.value&&(i="False"),n=new Cf(Af.Text,r,i);break;case"IFCINTEGER":case"IFCCOUNTMEASURE":n=new Cf(Af.Integer,r,e.NominalValue.value);break;case"IFCREAL":case"IFCLENGTHMEASURE":case"IFCPOSITIVELENGTHMEASURE":case"IFCAREAMEASURE":case"IFCVOLUMEMEASURE":case"IFCRATIOMEASURE":case"IFCPOSITIVERATIOMEASURE":case"IFCMASSMEASURE":case"IFCMASSPERLENGTHMEASURE":case"IFCPLANEANGLEMEASURE":case"IFCTHERMALTRANSMITTANCEMEASURE":n=new Cf(Af.Number,r,e.NominalValue.value);break;default:console.log(e.NominalValue.label),console.log(e.NominalValue.value)}null!==n&&s.AddProperty(n)}})),s.PropertyCount()>0&&r.AddPropertyGroup(s)}}}))},i=0;i<n.size();i++)r(i)}},{key:"GetMaterialIndexByColor",value:function(e){var t=xe(e.x,e.y,e.z),n=parseInt(255*e.w,10);return this.colorToMaterial.GetMaterialIndex(t.r,t.g,t.b,n)}},{key:"GetIFCString",value:function(e){var t=this.DecodeIFCString(e);return 0===t.length&&(t="-"),t}},{key:"DecodeIFCString",value:function(e){for(var t=/\\X2\\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?)\\X0\\/gi,n=e,r=t.exec(e);r;){var i=String.fromCharCode(parseInt(r[1],16));n=n.replace(r[0],i),r=t.exec(e)}return n}}]),n}(Of),rp=function(){function e(){i()(this,e),this.name=null,this.material=null}return o()(e,[{key:"SetName",value:function(e){return this.name=e,this}},{key:"SetMaterial",value:function(e){return this.material=e,this}}]),e}(),ip=function(){function e(t){i()(this,e),this.params=t||new rp,this.mesh=new Qe,null!==this.params.name&&this.mesh.SetName(this.params.name),this.curve=null}return o()(e,[{key:"GetMesh",value:function(){return this.mesh}},{key:"AddVertex",value:function(e,t,n){var r=new ae(e,t,n);return this.mesh.AddVertex(r)}},{key:"AddVertices",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];t.push(this.AddVertex(r.x,r.y,r.z))}return t}},{key:"SetCurve",value:function(e){this.curve=e}},{key:"ResetCurve",value:function(){this.curve=null}},{key:"AddTriangle",value:function(e,t,n){var r=new $e(e,t,n);return null!==this.params.material&&(r.mat=this.params.material),null!==this.curve&&r.SetCurve(this.curve),this.mesh.AddTriangle(r)}},{key:"AddTriangleInverted",value:function(e,t,n){this.AddTriangle(e,n,t)}},{key:"AddConvexPolygon",value:function(e){for(var t=0;t<e.length-2;t++)this.AddTriangle(e[0],e[t+1],e[t+2])}},{key:"AddConvexPolygonInverted",value:function(e){for(var t=0;t<e.length-2;t++)this.AddTriangleInverted(e[0],e[t+1],e[t+2])}}]),e}(),ap=function(){function e(t){i()(this,e),this.generator=t}return o()(e,[{key:"GenerateSurfaceBetweenPolygons",value:function(e,t){if(e.length===t.length)for(var n=e.length,r=0;r<n;r++){var i=r,a=r<n-1?i+1:0;this.generator.AddConvexPolygon([e[i],e[a],t[a],t[i]])}}},{key:"GenerateTriangleFan",value:function(e,t){for(var n=e.length,r=0;r<n;r++){var i=r,a=r<n-1?i+1:0;this.generator.AddTriangle(t,e[i],e[a])}}}]),e}();function op(e,t){return new Ae(e*Math.cos(t),e*Math.sin(t))}function sp(e,t,n,r){if(!ne(t)||!ne(n)||!ne(r))return null;var i=new ip(e);return i.AddVertex(0,0,0),i.AddVertex(t,0,0),i.AddVertex(t,n,0),i.AddVertex(0,n,0),i.AddVertex(0,0,r),i.AddVertex(t,0,r),i.AddVertex(t,n,r),i.AddVertex(0,n,r),i.AddConvexPolygon([0,3,2,1]),i.AddConvexPolygon([0,1,5,4]),i.AddConvexPolygon([1,2,6,5]),i.AddConvexPolygon([2,3,7,6]),i.AddConvexPolygon([3,0,4,7]),i.AddConvexPolygon([4,5,6,7]),i.GetMesh()}function up(e,t,n,r,i,a){if(re(t)||re(n))return null;if(!ne(r)||i<3)return null;var o=K(t),s=K(n);if(o&&s)return null;var u=new ip(e),l=new ap(u),c=2*Math.PI/i,h=a?1:null,f=[];if(o)f.push(u.AddVertex(0,0,r));else for(var d=0;d<i;d++){var p=op(t,d*c);f.push(u.AddVertex(p.x,p.y,r))}var v=[];if(s)v.push(u.AddVertex(0,0,0));else for(var m=0;m<i;m++){var g=op(n,m*c);v.push(u.AddVertex(g.x,g.y,0))}return o?(u.SetCurve(h),l.GenerateTriangleFan(v,f[0]),u.ResetCurve(),u.AddConvexPolygonInverted(v)):s?(u.SetCurve(h),l.GenerateTriangleFan(f.slice().reverse(),v[0]),u.ResetCurve(),u.AddConvexPolygon(f)):(u.SetCurve(h),l.GenerateSurfaceBetweenPolygons(v,f),u.ResetCurve(),u.AddConvexPolygonInverted(v),u.AddConvexPolygon(f)),u.GetMesh()}function lp(e,t,n,r,i){return up(e,t,t,n,r,i)}function cp(e,t,n,r){function i(e,t,n){return new ae(e*Math.sin(t)*Math.cos(n),e*Math.sin(t)*Math.sin(n),e*Math.cos(t))}if(!ne(t)||n<3)return null;var a=new ip(e),o=new ap(a);a.SetCurve(r?1:null);for(var s=[],u=n+1,l=Math.PI/n,c=2*Math.PI/n,h=1;h<u-1;h++){for(var f=[],d=h*l,p=0;p<n;p++){var v=i(t,d,-(p*c));f.push(a.AddVertex(v.x,v.y,v.z))}h>1&&o.GenerateSurfaceBetweenPolygons(s[s.length-1],f),s.push(f)}var m=a.AddVertex(0,0,t),g=a.AddVertex(0,0,-t);return o.GenerateTriangleFan(s[0].slice().reverse(),m),o.GenerateTriangleFan(s[s.length-1],g),a.ResetCurve(),a.GetMesh()}function hp(e,t,n){function r(e,t,n,r,i){var a=new ae(n,r,i);a.MultiplyScalar(t/a.Length()),e.AddVertex(a.x,a.y,a.z)}if(!ne(n))return null;var i=new ip(e);if("tetrahedron"===t){r(i,n,1,1,1),r(i,n,-1,-1,1),r(i,n,-1,1,-1),r(i,n,1,-1,-1),i.AddTriangle(0,1,3),i.AddTriangle(0,2,1),i.AddTriangle(0,3,2),i.AddTriangle(1,2,3)}else if("hexahedron"===t){r(i,n,1,1,1),r(i,n,1,1,-1),r(i,n,1,-1,1),r(i,n,1,-1,-1),r(i,n,-1,1,1),r(i,n,-1,1,-1),r(i,n,-1,-1,1),r(i,n,-1,-1,-1),i.AddConvexPolygon([0,1,5,4]),i.AddConvexPolygon([0,2,3,1]),i.AddConvexPolygon([0,4,6,2]),i.AddConvexPolygon([1,3,7,5]),i.AddConvexPolygon([2,6,7,3]),i.AddConvexPolygon([4,5,7,6])}else if("octahedron"===t){r(i,n,1,0,0),r(i,n,-1,0,0),r(i,n,0,1,0),r(i,n,0,-1,0),r(i,n,0,0,1),r(i,n,0,0,-1),i.AddTriangle(0,2,4),i.AddTriangle(0,3,5),i.AddTriangle(0,4,3),i.AddTriangle(0,5,2),i.AddTriangle(1,2,5),i.AddTriangle(1,3,4),i.AddTriangle(1,4,2),i.AddTriangle(1,5,3)}else if("dodecahedron"===t){var a=(1+Math.sqrt(5))/2,o=1/a;r(i,n,1,1,1),r(i,n,1,1,-1),r(i,n,1,-1,1),r(i,n,-1,1,1),r(i,n,1,-1,-1),r(i,n,-1,1,-1),r(i,n,-1,-1,1),r(i,n,-1,-1,-1),r(i,n,0,+o,+a),r(i,n,0,+o,-a),r(i,n,0,-o,+a),r(i,n,0,-o,-a),r(i,n,+o,+a,0),r(i,n,+o,-a,0),r(i,n,-o,+a,0),r(i,n,-o,-a,0),r(i,n,+a,0,+o),r(i,n,-a,0,+o),r(i,n,+a,0,-o),r(i,n,-a,0,-o),i.AddConvexPolygon([0,8,10,2,16]),i.AddConvexPolygon([0,16,18,1,12]),i.AddConvexPolygon([0,12,14,3,8]),i.AddConvexPolygon([1,9,5,14,12]),i.AddConvexPolygon([1,18,4,11,9]),i.AddConvexPolygon([2,10,6,15,13]),i.AddConvexPolygon([2,13,4,18,16]),i.AddConvexPolygon([3,14,5,19,17]),i.AddConvexPolygon([3,17,6,10,8]),i.AddConvexPolygon([4,13,15,7,11]),i.AddConvexPolygon([5,9,11,7,19]),i.AddConvexPolygon([6,17,19,7,15])}else if("icosahedron"===t){var s=(1+Math.sqrt(5))/2;r(i,n,0,1,+s),r(i,n,0,1,-s),r(i,n,0,-1,+s),r(i,n,0,-1,-s),r(i,n,1,+s,0),r(i,n,1,-s,0),r(i,n,-1,+s,0),r(i,n,-1,-s,0),r(i,n,+s,0,1),r(i,n,+s,0,-1),r(i,n,-s,0,1),r(i,n,-s,0,-1),i.AddTriangle(0,2,8),i.AddTriangle(0,4,6),i.AddTriangle(0,6,10),i.AddTriangle(0,8,4),i.AddTriangle(0,10,2),i.AddTriangle(1,3,11),i.AddTriangle(1,4,9),i.AddTriangle(1,6,4),i.AddTriangle(1,9,3),i.AddTriangle(1,11,6),i.AddTriangle(2,5,8),i.AddTriangle(2,7,5),i.AddTriangle(2,10,7),i.AddTriangle(3,5,7),i.AddTriangle(3,7,11),i.AddTriangle(3,9,5),i.AddTriangle(4,8,9),i.AddTriangle(5,9,8),i.AddTriangle(6,11,10),i.AddTriangle(7,10,11)}return i.GetMesh()}var fp=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"o3dv"===e}},{key:"GetUpDirection",value:function(){return ie.Z}},{key:"ClearContent",value:function(){}},{key:"ResetContent",value:function(){}},{key:"ImportContent",value:function(e,t){var n=D(e),r=JSON.parse(n);if(void 0!==r.root){if(void 0!==r.materials)for(var i=0;i<r.materials.length;i++){var a=r.materials[i];this.ImportMaterial(a)}if(void 0!==r.meshes)for(var o=0;o<r.meshes.length;o++){var s=r.meshes[o];this.ImportMesh(s)}var u=r.nodes[r.root];this.ImportNode(r,u,this.model.GetRootNode()),this.ImportProperties(this.model,r),t()}else t()}},{key:"ImportMaterial",value:function(e){var t=new Xe;t.color.Set(255,255,255),void 0!==e.name&&(t.name=e.name),void 0!==e.color&&(t.color=Ee(e.color)),t.metalness=m(e.metalness,0),t.roughness=m(e.roughness,1),this.model.AddMaterial(t)}},{key:"ImportMesh",value:function(e){var t=new rp;void 0!==e.name&&t.SetName(e.name),void 0!==e.material&&t.SetMaterial(e.material);var n=e.parameters;if(void 0!==n){var r=null;if("cuboid"===e.type){if(void 0===n.size_x||void 0===n.size_y||void 0===n.size_z)return;r=sp(t,n.size_x,n.size_y,n.size_z)}else if("cylinder"===e.type){if(void 0===n.radius||void 0===n.height)return;var i=m(n.segments,25),a=m(n.smooth,!0);r=lp(t,n.radius,n.height,i,a)}else if("cone"===e.type){if(void 0===n.top_radius||void 0===n.bottom_radius||void 0===n.height)return;var o=m(n.segments,25),s=m(n.smooth,!0);r=up(t,n.top_radius,n.bottom_radius,n.height,o,s)}else if("sphere"===e.type){if(void 0===n.radius)return;var u=m(n.segments,20),l=m(n.smooth,!0);r=cp(t,n.radius,u,l)}else if("platonic"===e.type){if(void 0===n.solid_type)return;var c=m(n.radius,1);r=hp(t,n.solid_type,c)}null!==r&&(this.ImportProperties(r,e),this.model.AddMesh(r))}}},{key:"ImportNode",value:function(e,t,n){if(void 0!==t.name&&n.SetName(t.name),void 0!==t.transformation){var r=this.GetTransformation(t.transformation);n.SetTransformation(r)}if(void 0!==t.children){var i,a=d()(t.children);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=e.nodes[o],u=new vf;n.AddChildNode(u),this.ImportNode(e,s,u)}}catch(e){a.e(e)}finally{a.f()}}void 0!==t.mesh&&(void 0!==t.children&&0!==t.children.length||n.SetType(pf.MeshNode),n.AddMeshIndex(t.mesh))}},{key:"ImportProperties",value:function(e,t){if(void 0!==t.properties){var n=new If("Properties");e.AddPropertyGroup(n);var r,i=d()(t.properties);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=new Cf(Af.Text,a.name,a.value);n.AddProperty(o)}}catch(e){i.e(e)}finally{i.f()}}}},{key:"GetTransformation",value:function(e){var t=new ae(0,0,0),n=new jh(0,0,0,1),r=new ae(1,1,1);void 0!==e.translation&&(t=pe(e.translation)),void 0!==e.rotation&&(n=Xh(e.rotation)),void 0!==e.scale&&(r=pe(e.scale));var i=(new Jh).ComposeTRS(t,n,r);return new $h(i)}}]),n}(Of),dp=function(){function e(t){i()(this,e),this.mesh=t,this.globalToMeshVertices=new Map,this.globalToMeshVertexColors=new Map,this.globalToMeshNormals=new Map,this.globalToMeshUvs=new Map}return o()(e,[{key:"AddVertex",value:function(e,t){var n=this;return this.GetLocalIndex(e,t,this.globalToMeshVertices,(function(e){return n.mesh.AddVertex(new ae(e.x,e.y,e.z))}))}},{key:"AddVertexColor",value:function(e,t){var n=this;return this.GetLocalIndex(e,t,this.globalToMeshVertexColors,(function(e){return n.mesh.AddVertexColor(new ve(e.r,e.g,e.b))}))}},{key:"AddNormal",value:function(e,t){var n=this;return this.GetLocalIndex(e,t,this.globalToMeshNormals,(function(e){return n.mesh.AddNormal(new ae(e.x,e.y,e.z))}))}},{key:"AddUV",value:function(e,t){var n=this;return this.GetLocalIndex(e,t,this.globalToMeshUvs,(function(e){return n.mesh.AddTextureUV(new Ae(e.x,e.y))}))}},{key:"AddTriangle",value:function(e){this.mesh.AddTriangle(e)}},{key:"GetLocalIndex",value:function(e,t,n,r){if(isNaN(e)||e<0||e>=t.length)return null;if(n.has(e))return n.get(e);var i=r(t[e]);return n.set(e,i),i}}]),e}();function pp(e,t,n){return xe(parseFloat(e),parseFloat(t),parseFloat(n))}var vp=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"obj"===e}},{key:"GetUpDirection",value:function(){return ie.Y}},{key:"ClearContent",value:function(){this.globalVertices=null,this.globalVertexColors=null,this.globalNormals=null,this.globalUvs=null,this.currentMeshConverter=null,this.currentMaterial=null,this.currentMaterialIndex=null,this.meshNameToConverter=null,this.materialNameToIndex=null}},{key:"ResetContent",value:function(){this.globalVertices=[],this.globalVertexColors=[],this.globalNormals=[],this.globalUvs=[],this.currentMeshConverter=null,this.currentMaterial=null,this.currentMaterialIndex=null,this.meshNameToConverter=new Map,this.materialNameToIndex=new Map}},{key:"ImportContent",value:function(e,t){var n=this;Uf(D(e),(function(e){n.WasError()||n.ProcessLine(e)})),t()}},{key:"ProcessLine",value:function(e){if("#"!==e[0]){var t=Ff(e,"#");if(0!==t.length){var n=t[0].toLowerCase();t.shift(),this.ProcessMeshParameter(n,t,e)||this.ProcessMaterialParameter(n,t,e)}}}},{key:"AddNewMesh",value:function(e){if(this.meshNameToConverter.has(e))this.currentMeshConverter=this.meshNameToConverter.get(e);else{var t=new Qe;t.SetName(e),this.model.AddMeshToRootNode(t),this.currentMeshConverter=new dp(t),this.meshNameToConverter.set(e,this.currentMeshConverter)}}},{key:"ProcessMeshParameter",value:function(e,t,n){if("g"===e||"o"===e){if(0===t.length)return!0;var r=Df(n,e.length,"#");return this.AddNewMesh(r),!0}return"v"===e?(t.length<3||(this.globalVertices.push(new ae(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),t.length>=6&&this.globalVertexColors.push(pp(t[3],t[4],t[5]))),!0):"vn"===e?(t.length<3||this.globalNormals.push(new ae(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),!0):"vt"===e?(t.length<2||this.globalUvs.push(new Ae(parseFloat(t[0]),parseFloat(t[1]))),!0):"f"===e&&(t.length<3||this.ProcessFace(t),!0)}},{key:"ProcessMaterialParameter",value:function(e,t,n){var r=this;function i(e,t,n){var r=new Ve,i=Df(t,e.length,"#"),a=n.getFileBuffer(i);return r.name=i,r.buffer=a,r}if("newmtl"===e){if(0===t.length)return!0;var a=new qe,o=Df(n,e.length,"#"),s=this.model.AddMaterial(a);return a.name=o,this.currentMaterial=a,this.materialNameToIndex.set(o,s),!0}if("usemtl"===e){if(0===t.length)return!0;var u=Df(n,e.length,"#");return this.materialNameToIndex.has(u)&&(this.currentMaterialIndex=this.materialNameToIndex.get(u)),!0}if("mtllib"===e){if(0===t.length)return!0;var l=Df(n,e.length,"#"),c=this.callbacks.getFileBuffer(l);if(null!==c)Uf(D(c),(function(e){r.WasError()||r.ProcessLine(e)}));return!0}return"map_kd"===e?(null===this.currentMaterial||0===t.length||(this.currentMaterial.diffuseMap=i(e,n,this.callbacks),Vf(this.currentMaterial)),!0):"map_ks"===e?(null===this.currentMaterial||0===t.length||(this.currentMaterial.specularMap=i(e,n,this.callbacks)),!0):"map_bump"===e||"bump"===e?(null===this.currentMaterial||0===t.length||(this.currentMaterial.bumpMap=i(e,n,this.callbacks)),!0):"ka"===e?(null===this.currentMaterial||t.length<3||(this.currentMaterial.ambient=pp(t[0],t[1],t[2])),!0):"kd"===e?(null===this.currentMaterial||t.length<3||(this.currentMaterial.color=pp(t[0],t[1],t[2])),!0):"ks"===e?(null===this.currentMaterial||t.length<3||(this.currentMaterial.specular=pp(t[0],t[1],t[2])),!0):"ns"===e?(null===this.currentMaterial||t.length<1||(this.currentMaterial.shininess=parseFloat(t[0])/1e3),!0):"tr"===e?(null===this.currentMaterial||t.length<1||(this.currentMaterial.opacity=1-parseFloat(t[0]),Vf(this.currentMaterial)),!0):"d"===e&&(null===this.currentMaterial||t.length<1||(this.currentMaterial.opacity=parseFloat(t[0]),Vf(this.currentMaterial)),!0)}},{key:"ProcessFace",value:function(e){function t(e,t){return e>0?e-1:t+e}for(var n=[],r=[],i=[],a=[],o=0;o<e.length;o++){var s=e[o].split("/");n.push(t(parseInt(s[0],10),this.globalVertices.length)),this.globalVertices.length===this.globalVertexColors.length&&r.push(t(parseInt(s[0],10),this.globalVertices.length)),s.length>1&&s[1].length>0&&a.push(t(parseInt(s[1],10),this.globalUvs.length)),s.length>2&&s[2].length>0&&i.push(t(parseInt(s[2],10),this.globalNormals.length))}null===this.currentMeshConverter&&this.AddNewMesh("");for(var u=0;u<n.length-2;u++){var l=this.currentMeshConverter.AddVertex(n[0],this.globalVertices),c=this.currentMeshConverter.AddVertex(n[u+1],this.globalVertices),h=this.currentMeshConverter.AddVertex(n[u+2],this.globalVertices);if(null===l||null===c||null===h){this.SetError("Invalid vertex index.");break}var f=new $e(l,c,h);if(r.length===n.length){var d=this.currentMeshConverter.AddVertexColor(r[0],this.globalVertexColors),p=this.currentMeshConverter.AddVertexColor(r[u+1],this.globalVertexColors),v=this.currentMeshConverter.AddVertexColor(r[u+2],this.globalVertexColors);if(null===d||null===p||null===v){this.SetError("Invalid vertex color index.");break}f.SetVertexColors(d,p,v)}if(i.length===n.length){var m=this.currentMeshConverter.AddNormal(i[0],this.globalNormals),g=this.currentMeshConverter.AddNormal(i[u+1],this.globalNormals),y=this.currentMeshConverter.AddNormal(i[u+2],this.globalNormals);if(null===m||null===g||null===y){this.SetError("Invalid normal index.");break}f.SetNormals(m,g,y)}if(a.length===n.length){var x=this.currentMeshConverter.AddUV(a[0],this.globalUvs),_=this.currentMeshConverter.AddUV(a[u+1],this.globalUvs),b=this.currentMeshConverter.AddUV(a[u+2],this.globalUvs);if(null===x||null===_||null===b){this.SetError("Invalid uv index.");break}f.SetTextureUVs(x,_,b)}null!==this.currentMaterialIndex&&(f.mat=this.currentMaterialIndex),this.currentMeshConverter.AddTriangle(f)}}}]),n}(Of),mp=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"off"===e}},{key:"GetUpDirection",value:function(){return ie.Y}},{key:"ClearContent",value:function(){this.mesh=null,this.status=null,this.colorToMaterial=null}},{key:"ResetContent",value:function(){this.mesh=new Qe,this.model.AddMeshToRootNode(this.mesh),this.status={vertexCount:0,faceCount:0,foundVertex:0,foundFace:0},this.colorToMaterial=new Bf(this.model)}},{key:"ImportContent",value:function(e,t){var n=this;Uf(D(e),(function(e){n.WasError()||n.ProcessLine(e)})),t()}},{key:"ProcessLine",value:function(e){function t(e){return-1!==e.indexOf(".")?ge(parseFloat(e)):parseInt(e,10)}if("#"!==e[0]){var n=Ff(e,"#");if(0!==n.length&&"OFF"!==n[0])if(0!==this.status.vertexCount||0!==this.status.faceCount){if(this.status.foundVertex<this.status.vertexCount)return n.length>=3&&(this.mesh.AddVertex(new ae(parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2]))),this.status.foundVertex+=1),void(n.length>=6&&this.mesh.AddVertexColor(new ve(t(n[3]),t(n[4]),t(n[5]))));var r=this.mesh.VertexCount()===this.mesh.VertexColorCount();if(this.status.foundFace<this.status.faceCount){if(n.length>=4){var i=parseInt(n[0],10);if(n.length<i+1)return;var a=null;if(!r&&n.length>=i+4){var o=new ve(t(n[i+1]),t(n[i+2]),t(n[i+3]));a=this.colorToMaterial.GetMaterialIndex(o.r,o.g,o.b)}for(var s=0;s<i-2;s++){var u=parseInt(n[1]),l=parseInt(n[s+2]),c=parseInt(n[s+3]),h=new $e(u,l,c);r?h.SetVertexColors(u,l,c):h.SetMaterial(a),this.mesh.AddTriangle(h)}this.status.foundFace+=1}}else;}else n.length>1&&(this.status.vertexCount=parseInt(n[0],10),this.status.faceCount=parseInt(n[1],10))}}}]),n}(Of),gp=1,yp=2,xp=3,_p=4,bp=function(){function e(){i()(this,e),this.format=null,this.elements=[]}return o()(e,[{key:"SetFormat",value:function(e){this.format=e}},{key:"AddElement",value:function(e,t){this.elements.push({name:e,count:t,format:[]})}},{key:"GetElements",value:function(){return this.elements}},{key:"AddSingleFormat",value:function(e,t){this.elements[this.elements.length-1].format.push({name:t,isSingle:!0,elemType:e})}},{key:"AddListFormat",value:function(e,t,n){this.elements[this.elements.length-1].format.push({name:n,isSingle:!1,countType:e,elemType:t})}},{key:"GetElement",value:function(e){for(var t=0;t<this.elements.length;t++){var n=this.elements[t];if(n.name===e)return n}return null}},{key:"Check",value:function(){var e=this.GetElement("vertex");if(null===e||0===e.length||e.format.length<3)return yp;var t=this.GetElement("face");if("ascii"===this.format){if(null===t||0===t.count||t.format.length<0)return xp}else{if("binary_little_endian"!==this.format&&"binary_big_endian"!==this.format)return _p;var n=this.GetElement("tristrips"),r=null!==t&&t.count>0&&t.format.length>0,i=null!==n&&n.count>0&&n.format.length>0;if(!r&&!i)return xp}return gp}}]),e}(),Tp=function(){function e(t){i()(this,e),this.model=t,this.colorToMaterial=new Map}return o()(e,[{key:"GetMaterialIndexByColor",value:function(e){var t="Color "+Te(e[0])+Te(e[1])+Te(e[2])+Te(e[3]);if(this.colorToMaterial.has(t))return this.colorToMaterial.get(t);var n=new qe;n.name=t,n.color=new ve(e[0],e[1],e[2]),n.opacity=e[3]/255,Vf(n);var r=this.model.AddMaterial(n);return this.colorToMaterial.set(t,r),r}}]),e}(),Mp=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"ply"===e}},{key:"GetUpDirection",value:function(){return ie.Y}},{key:"ClearContent",value:function(){this.mesh=null}},{key:"ResetContent",value:function(){this.mesh=new Qe,this.model.AddMeshToRootNode(this.mesh)}},{key:"ImportContent",value:function(e,t){var n=this.GetHeaderContent(e),r=this.ReadHeader(n),i=r.Check();if(i===gp)if("ascii"===r.format){var a=D(e);a=a.substring(n.length),this.ReadAsciiContent(r,a)}else"binary_little_endian"!==r.format&&"binary_big_endian"!==r.format||this.ReadBinaryContent(r,e,n.length);else i===yp?this.SetError("The model contains no vertices."):i===xp?this.SetError("The model contains no faces."):this.SetError("Invalid header information.");t()}},{key:"GetHeaderContent",value:function(e){var t="",n=new Uint8Array(e),r=0;for(r=0;r<e.byteLength&&!(t+=String.fromCharCode(n[r])).endsWith("end_header");r++);for(r+=1;r<e.byteLength;){var i=String.fromCharCode(n[r]);if(t+=i,r+=1,"\n"===i)break}return t}},{key:"ReadHeader",value:function(e){var t=new bp;return Uf(e,(function(e){var n=Ff(e,null);0!==n.length&&"comment"!==n[0]&&"ply"!==n[0]&&("format"===n[0]&&n.length>=2?t.SetFormat(n[1]):"element"===n[0]&&n.length>=3?t.AddElement(n[1],parseInt(n[2],10)):"property"===n[0]&&n.length>=3&&("list"===n[1]&&n.length>=5?t.AddListFormat(n[2],n[3],n[4]):t.AddSingleFormat(n[1],n[2])))})),t}},{key:"ReadAsciiContent",value:function(e,t){var n=this,r=e.GetElement("vertex"),i=e.GetElement("face"),a=0,o=0;Uf(t,(function(e){if(!n.WasError()){var t=Ff(e,null);if(0!==t.length&&"comment"!==t[0])if(a<r.count)t.length>=3&&(n.mesh.AddVertex(new ae(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))),a+=1);else if(null!==i&&o<i.count){if(t.length>=4){var s=parseInt(t[0],10);if(t.length<s+1)return;for(var u=0;u<s-2;u++){var l=parseInt(t[1]),c=parseInt(t[u+2]),h=parseInt(t[u+3]),f=new $e(l,c,h);n.mesh.AddTriangle(f)}o+=1}}else;}}))}},{key:"ReadBinaryContent",value:function(e,t,n){function r(e,t){function n(e,t){return"char"===t||"int8"===t?e.ReadCharacter8():"uchar"===t||"uint8"===t?e.ReadUnsignedCharacter8():"short"===t||"int16"===t?e.ReadInteger16():"ushort"===t||"uint16"===t?e.ReadUnsignedInteger16():"int"===t||"int32"===t?e.ReadInteger32():"uint"===t||"uint32"===t?e.ReadUnsignedInteger32():"float"===t||"float32"===t?e.ReadFloat32():"double"===t||"double64"===t?e.ReadDouble64():null}if(t.isSingle)return n(e,t.elemType);for(var r=[],i=n(e,t.countType),a=0;a<i;a++)r.push(n(e,t.elemType));return r}function i(e,t,n){for(var i=n;i<t.length;i++)r(e,t[i])}function a(e,t,n){for(var i=null,a=null,o=null,s=255,u=n;u<t.length;u++){var l=t[u],c=r(e,l);"red"===l.name?i=c:"green"===l.name?a=c:"blue"===l.name?o=c:"alpha"===l.name&&(s=c)}return null!==i&&null!==a&&null!==o?[i,a,o,s]:null}var o=null;if("binary_little_endian"===e.format)o=new C(t,!0);else{if("binary_big_endian"!==e.format)return;o=new C(t,!1)}o.Skip(n);for(var s=new Tp(this.model),u=e.GetElements(),l=0;l<u.length;l++){var c=u[l];if("vertex"===c.name)for(var h=0;h<c.count;h++){var f=r(o,c.format[0]),d=r(o,c.format[1]),p=r(o,c.format[2]),v=a(o,c.format,3);null!==v&&this.mesh.AddVertexColor(new ve(v[0],v[1],v[2])),this.mesh.AddVertex(new ae(f,d,p))}else if("face"===c.name)for(var m=0;m<c.count;m++)for(var g=r(o,c.format[0]),y=a(o,c.format,1),x=0;x<g.length-2;x++){var _=g[0],b=g[x+1],T=g[x+2],M=new $e(_,b,T);null!==y?M.mat=s.GetMaterialIndexByColor(y):this.mesh.VertexColorCount()>0&&M.SetVertexColors(_,b,T),this.mesh.AddTriangle(M)}else if("tristrips"===c.name)for(var w=0;w<c.count;w++){var S=r(o,c.format[0]);i(o,c.format,1);for(var E=!0,k=0;k<S.length-2;k++){var A=S[k],I=S[k+1],R=S[k+2];if(-1!==R){if(!E){var L=I;I=R,R=L}E=!E;var P=new $e(A,I,R);this.mesh.AddTriangle(P)}else k+=2,E=!0}}else i(o,c.format,0)}}}]),n}(Of),wp=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this)).worker=null,e}return o()(n,[{key:"CanImportExtension",value:function(e){return"stp"===e||"step"===e||"igs"===e||"iges"===e||"brp"===e||"brep"===e}},{key:"GetUpDirection",value:function(){return ie.Y}},{key:"ClearContent",value:function(){null!==this.worker&&(this.worker.terminate(),this.worker=null)}},{key:"ResetContent",value:function(){this.worker=null}},{key:"ImportContent",value:function(e,t){var n=this,r=N("loaders/occt-import-js-worker.js");this.worker=new Worker(r),this.worker.addEventListener("message",(function(e){n.ImportResultJson(e.data,t)})),this.worker.addEventListener("error",(function(e){n.SetError("Failed to load occt-import-js."),t()}));var i=null;if("stp"===this.extension||"step"===this.extension)i="step";else if("igs"===this.extension||"iges"===this.extension)i="iges";else{if("brp"!==this.extension&&"brep"!==this.extension)return void t();i="brep"}var a=new Uint8Array(e);this.worker.postMessage({format:i,buffer:a})}},{key:"ImportResultJson",value:function(e,t){if(e.success){var n=new Bf(this.model),r=this.model.GetRootNode();this.ImportNode(e,e.root,r,n),t()}else t()}},{key:"ImportNode",value:function(e,t,n,r){var i,a=d()(t.meshes);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=e.meshes[o],u=this.ImportMesh(s,r),l=this.model.AddMesh(u);n.AddMeshIndex(l)}}catch(e){a.e(e)}finally{a.f()}var c,h=d()(t.children);try{for(h.s();!(c=h.n()).done;){var f=c.value,p=new vf;p.SetName(f.name),n.AddChildNode(p),this.ImportNode(e,f,p,r)}}catch(e){h.e(e)}finally{h.f()}}},{key:"ImportMesh",value:function(e,t){var n=null;if(e.color){var r=xe(e.color[0],e.color[1],e.color[2]);n=t.GetMaterialIndex(r.r,r.g,r.b,null)}var i=Jc(e,n);if(e.name&&i.SetName(e.name),e.face_colors){var a,o=d()(e.face_colors);try{for(o.s();!(a=o.n()).done;)for(var s=a.value,u=xe(s.color[0],s.color[1],s.color[2]),l=t.GetMaterialIndex(u.r,u.g,u.b,null),c=s.first;c<=s.last;c++){i.GetTriangle(c).SetMaterial(l)}}catch(e){o.e(e)}finally{o.f()}}return i}}]),n}(Of),Sp=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"stl"===e}},{key:"GetUpDirection",value:function(){return ie.Z}},{key:"ClearContent",value:function(){this.mesh=null,this.triangle=null}},{key:"ResetContent",value:function(){this.mesh=new Qe,this.model.AddMeshToRootNode(this.mesh),this.triangle=null}},{key:"ImportContent",value:function(e,t){var n=this;this.IsBinaryStlFile(e)?this.ProcessBinary(e):Uf(D(e),(function(e){n.WasError()||n.ProcessLine(e)}));t()}},{key:"IsBinaryStlFile",value:function(e){var t=e.byteLength;if(t<84)return!1;var n=new C(e,!0);return n.Skip(80),t===50*n.ReadUnsignedInteger32()+84}},{key:"ProcessLine",value:function(e){if("#"!==e[0]){var t=Ff(e,"#");if(0!==t.length){var n=t[0];if("solid"!==n){if("facet"!==n){if("vertex"!==n||null===this.triangle)return"endfacet"===n&&null!==this.triangle?(-1!==this.triangle.v0&&-1!==this.triangle.v1&&null!==this.triangle.v2&&this.mesh.AddTriangle(this.triangle),void(this.triangle=null)):void 0;if(t.length>=4){var r=this.mesh.AddVertex(new ae(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])));-1===this.triangle.v0?this.triangle.v0=r:-1===this.triangle.v1?this.triangle.v1=r:-1===this.triangle.v2&&(this.triangle.v2=r)}}else if(this.triangle=new $e(-1,-1,-1),t.length>=5&&"normal"===t[1]){var i=new ae(parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4]));if(ne(i.Length())){var a=this.mesh.AddNormal(i);this.triangle.SetNormals(a,a,a)}}}else if(t.length>1){var o=Df(e,n.length,"#");this.mesh.SetName(o)}}}}},{key:"ProcessBinary",value:function(e){function t(e){var t=new ae;return t.x=e.ReadFloat32(),t.y=e.ReadFloat32(),t.z=e.ReadFloat32(),t}function n(e,n){var r=t(n);return e.AddVertex(r)}var r=new C(e,!0);r.Skip(80);for(var i=r.ReadUnsignedInteger32(),a=0;a<i;a++){var o=t(r),s=n(this.mesh,r),u=n(this.mesh,r),l=n(this.mesh,r);r.Skip(2);var c=new $e(s,u,l);if(ne(o.Length())){var h=this.mesh.AddNormal(o);c.SetNormals(h,h,h)}this.mesh.AddTriangle(c)}}}]),n}(Of),Ep=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"bim"===e}},{key:"GetUpDirection",value:function(){return ie.Z}},{key:"ClearContent",value:function(){this.meshIdToMesh=null,this.colorToMaterial=null}},{key:"ResetContent",value:function(){this.meshIdToMesh=new Map,this.colorToMaterial=new Bf(this.model)}},{key:"ImportContent",value:function(e,t){var n=D(e),r=null;try{r=JSON.parse(n)}catch(e){return this.SetError("Failed to parse bim file."),void t()}var i,a=d()(r.meshes);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.meshIdToMesh.set(o.mesh_id,o)}}catch(e){a.e(e)}finally{a.f()}this.ImportProperties(r,this.model);var s,u=d()(r.elements);try{for(u.s();!(s=u.n()).done;){var l=s.value,c=this.ImportElement(l);c.SetName(l.type),this.ImportProperties(l,c)}}catch(e){u.e(e)}finally{u.f()}t()}},{key:"ImportElement",value:function(e){var t=this,n=this.colorToMaterial.GetMaterialIndex(e.color.r,e.color.g,e.color.b,e.color.a),r=this.model.GetRootNode(),i=this.meshIdToMesh.get(e.mesh_id),a=this.ImportMesh(i,(function(r){return e.face_colors?t.colorToMaterial.GetMaterialIndex(e.face_colors[4*r+0],e.face_colors[4*r+1],e.face_colors[4*r+2],e.face_colors[4*r+3]):n})),o=this.model.AddMesh(a),s=new vf;s.SetType(pf.MeshNode),s.AddMeshIndex(o);var u=new ae(0,0,0);e.vector&&(u=new ae(e.vector.x,e.vector.y,e.vector.z));var l=new jh(0,0,0,1);e.rotation&&(l=new jh(e.rotation.qx,e.rotation.qy,e.rotation.qz,e.rotation.qw));var c=new ae(1,1,1),h=(new Jh).ComposeTRS(u,l,c);return s.SetTransformation(new $h(h)),r.AddChildNode(s),a}},{key:"ImportMesh",value:function(e,t){for(var n=new Qe,r=0;r<e.coordinates.length;r+=3)n.AddVertex(new ae(e.coordinates[r+0],e.coordinates[r+1],e.coordinates[r+2]));for(var i=0;i<e.indices.length;i+=3){var a=new $e(e.indices[i+0],e.indices[i+1],e.indices[i+2]);a.SetMaterial(t(i/3)),n.AddTriangle(a)}return n}},{key:"ImportProperties",value:function(e,t){function n(e,t,n){if(null!=n){var r=new Cf(Af.Text,t,n);e.AddProperty(r)}}if(e.info&&!y(e.info)){var r=e.info,i=new If("Info");for(var a in n(i,"Guid",e.guid),n(i,"Type",e.type),r)Object.prototype.hasOwnProperty.call(r,a)&&"string"==typeof r[a]&&n(i,a,r[a]);t.AddPropertyGroup(i)}}}]),n}(Of),kp=function(e){Fe(r,e);var n=Ge(r);function r(e){return t(this,r),n.call(this,e)}return a(r,[{key:"parse",value:function(e){var t=0,n=1,r=2,i=3,a=9,o=10,s=11,u=48,l=4,c=0,h=1,f=2,d=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var p=0,v=new Uint8Array(e),m={id_length:v[p++],colormap_type:v[p++],image_type:v[p++],colormap_index:v[p++]|v[p++]<<8,colormap_length:v[p++]|v[p++]<<8,colormap_size:v[p++],origin:[v[p++]|v[p++]<<8,v[p++]|v[p++]<<8],width:v[p++]|v[p++]<<8,height:v[p++]|v[p++]<<8,pixel_size:v[p++],flags:v[p++]};!function(e){switch(e.image_type){case n:case a:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case r:case i:case o:case s:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(m),m.id_length+p>e.length&&console.error("THREE.TGALoader: No data."),p+=m.id_length;var g=!1,y=!1,x=!1;switch(m.image_type){case a:g=!0,y=!0;break;case n:y=!0;break;case o:g=!0;break;case r:break;case s:g=!0,x=!0;break;case i:x=!0}var _=new Uint8Array(m.width*m.height*4),b=function(e,t,n,r,i){var a,o,s=n.pixel_size>>3,u=n.width*n.height*s;if(t&&(o=i.subarray(r,r+=n.colormap_length*(n.colormap_size>>3))),e){var l,c,h;a=new Uint8Array(u);for(var f=0,d=new Uint8Array(s);f<u;)if(c=1+(127&(l=i[r++])),128&l){for(h=0;h<s;++h)d[h]=i[r++];for(h=0;h<c;++h)a.set(d,f+h*s);f+=s*c}else{for(c*=s,h=0;h<c;++h)a[f+h]=i[r++];f+=c}}else a=i.subarray(r,r+=t?n.width*n.height:u);return{pixel_data:a,palettes:o}}(g,y,m,p,v);return function(e,t,n,r,i){var a,o,s,p,v,g;switch((m.flags&u)>>l){default:case f:a=0,s=1,v=t,o=0,p=1,g=n;break;case c:a=0,s=1,v=t,o=n-1,p=-1,g=-1;break;case d:a=t-1,s=-1,v=-1,o=0,p=1,g=n;break;case h:a=t-1,s=-1,v=-1,o=n-1,p=-1,g=-1}if(x)switch(m.pixel_size){case 8:!function(e,t,n,r,i,a,o,s){var u,l,c,h=0,f=m.width;for(c=t;c!==r;c+=n)for(l=i;l!==o;l+=a,h++)u=s[h],e[4*(l+f*c)+0]=u,e[4*(l+f*c)+1]=u,e[4*(l+f*c)+2]=u,e[4*(l+f*c)+3]=255}(e,o,p,g,a,s,v,r);break;case 16:!function(e,t,n,r,i,a,o,s){var u,l,c=0,h=m.width;for(l=t;l!==r;l+=n)for(u=i;u!==o;u+=a,c+=2)e[4*(u+h*l)+0]=s[c+0],e[4*(u+h*l)+1]=s[c+0],e[4*(u+h*l)+2]=s[c+0],e[4*(u+h*l)+3]=s[c+1]}(e,o,p,g,a,s,v,r);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(m.pixel_size){case 8:!function(e,t,n,r,i,a,o,s,u){var l,c,h,f=u,d=0,p=m.width;for(h=t;h!==r;h+=n)for(c=i;c!==o;c+=a,d++)l=s[d],e[4*(c+p*h)+3]=255,e[4*(c+p*h)+2]=f[3*l+0],e[4*(c+p*h)+1]=f[3*l+1],e[4*(c+p*h)+0]=f[3*l+2]}(e,o,p,g,a,s,v,r,i);break;case 16:!function(e,t,n,r,i,a,o,s){var u,l,c,h=0,f=m.width;for(c=t;c!==r;c+=n)for(l=i;l!==o;l+=a,h+=2)u=s[h+0]+(s[h+1]<<8),e[4*(l+f*c)+0]=(31744&u)>>7,e[4*(l+f*c)+1]=(992&u)>>2,e[4*(l+f*c)+2]=(31&u)<<3,e[4*(l+f*c)+3]=32768&u?0:255}(e,o,p,g,a,s,v,r);break;case 24:!function(e,t,n,r,i,a,o,s){var u,l,c=0,h=m.width;for(l=t;l!==r;l+=n)for(u=i;u!==o;u+=a,c+=3)e[4*(u+h*l)+3]=255,e[4*(u+h*l)+2]=s[c+0],e[4*(u+h*l)+1]=s[c+1],e[4*(u+h*l)+0]=s[c+2]}(e,o,p,g,a,s,v,r);break;case 32:!function(e,t,n,r,i,a,o,s){var u,l,c=0,h=m.width;for(l=t;l!==r;l+=n)for(u=i;u!==o;u+=a,c+=4)e[4*(u+h*l)+2]=s[c+0],e[4*(u+h*l)+1]=s[c+1],e[4*(u+h*l)+0]=s[c+2],e[4*(u+h*l)+3]=s[c+3]}(e,o,p,g,a,s,v,r);break;default:console.error("THREE.TGALoader: Format not supported.")}}(_,m.width,m.height,b.pixel_data,b.palettes),{data:_,width:m.width,height:m.height,flipY:!0,generateMipmaps:!0,minFilter:bt}}}]),r}(pc),Ap=n(888),Cp={},Ip=function(e){return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},Rp=function(e){return new Worker(e)};try{URL.revokeObjectURL(Ip(""))}catch(e){Ip=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},Rp=function(e){return new Worker(e,{type:"module"})}}var Lp=Uint8Array,Pp=Uint16Array,Np=Uint32Array,Op=new Lp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Dp=new Lp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Fp=new Lp([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Up=function(e,t){for(var n=new Pp(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new Np(n[30]);for(r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return[n,i]},Gp=Up(Op,2),zp=Gp[0],Vp=Gp[1];zp[28]=258,Vp[258]=28;for(var Bp=Up(Dp,0),Wp=Bp[0],Hp=Bp[1],jp=new Pp(32768),qp=0;qp<32768;++qp){var Xp=(43690&qp)>>>1|(21845&qp)<<1;Xp=(61680&(Xp=(52428&Xp)>>>2|(13107&Xp)<<2))>>>4|(3855&Xp)<<4,jp[qp]=((65280&Xp)>>>8|(255&Xp)<<8)>>>1}var Yp=function(e,t,n){for(var r=e.length,i=0,a=new Pp(t);i<r;++i)++a[e[i]-1];var o,s=new Pp(t);for(i=0;i<t;++i)s[i]=s[i-1]+a[i-1]<<1;if(n){o=new Pp(1<<t);var u=15-t;for(i=0;i<r;++i)if(e[i])for(var l=i<<4|e[i],c=t-e[i],h=s[e[i]-1]++<<c,f=h|(1<<c)-1;h<=f;++h)o[jp[h]>>>u]=l}else for(o=new Pp(r),i=0;i<r;++i)e[i]&&(o[i]=jp[s[e[i]-1]++]>>>15-e[i]);return o},Kp=new Lp(288);for(qp=0;qp<144;++qp)Kp[qp]=8;for(qp=144;qp<256;++qp)Kp[qp]=9;for(qp=256;qp<280;++qp)Kp[qp]=7;for(qp=280;qp<288;++qp)Kp[qp]=8;var Zp=new Lp(32);for(qp=0;qp<32;++qp)Zp[qp]=5;var Jp=Yp(Kp,9,0),Qp=Yp(Kp,9,1),$p=Yp(Zp,5,0),ev=Yp(Zp,5,1),tv=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},nv=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},rv=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},iv=function(e){return(e/8|0)+(7&e&&1)},av=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof Pp?Pp:e instanceof Np?Np:Lp)(n-t);return r.set(e.subarray(t,n)),r},ov=function(e,t,n){var r=e.length;if(!r||n&&!n.l&&r<5)return t||new Lp(0);var i=!t||n,a=!n||n.i;n||(n={}),t||(t=new Lp(3*r));var o=function(e){var n=t.length;if(e>n){var r=new Lp(Math.max(2*n,e));r.set(t),t=r}},s=n.f||0,u=n.p||0,l=n.b||0,c=n.l,h=n.d,f=n.m,d=n.n,p=8*r;do{if(!c){n.f=s=nv(e,u,1);var v=nv(e,u+1,3);if(u+=3,!v){var m=e[(k=iv(u)+4)-4]|e[k-3]<<8,g=k+m;if(g>r){if(a)throw"unexpected EOF";break}i&&o(l+m),t.set(e.subarray(k,g),l),n.b=l+=m,n.p=u=8*g;continue}if(1==v)c=Qp,h=ev,f=9,d=5;else{if(2!=v)throw"invalid block type";var y=nv(e,u,31)+257,x=nv(e,u+10,15)+4,_=y+nv(e,u+5,31)+1;u+=14;for(var b=new Lp(_),T=new Lp(19),M=0;M<x;++M)T[Fp[M]]=nv(e,u+3*M,7);u+=3*x;var w=tv(T),S=(1<<w)-1,E=Yp(T,w,1);for(M=0;M<_;){var k,A=E[nv(e,u,S)];if(u+=15&A,(k=A>>>4)<16)b[M++]=k;else{var C=0,I=0;for(16==k?(I=3+nv(e,u,3),u+=2,C=b[M-1]):17==k?(I=3+nv(e,u,7),u+=3):18==k&&(I=11+nv(e,u,127),u+=7);I--;)b[M++]=C}}var R=b.subarray(0,y),L=b.subarray(y);f=tv(R),d=tv(L),c=Yp(R,f,1),h=Yp(L,d,1)}if(u>p){if(a)throw"unexpected EOF";break}}i&&o(l+131072);for(var P=(1<<f)-1,N=(1<<d)-1,O=u;;O=u){var D=(C=c[rv(e,u)&P])>>>4;if((u+=15&C)>p){if(a)throw"unexpected EOF";break}if(!C)throw"invalid length/literal";if(D<256)t[l++]=D;else{if(256==D){O=u,c=null;break}var F=D-254;if(D>264){var U=Op[M=D-257];F=nv(e,u,(1<<U)-1)+zp[M],u+=U}var G=h[rv(e,u)&N],z=G>>>4;if(!G)throw"invalid distance";u+=15&G;L=Wp[z];if(z>3){U=Dp[z];L+=rv(e,u)&(1<<U)-1,u+=U}if(u>p){if(a)throw"unexpected EOF";break}i&&o(l+131072);for(var V=l+F;l<V;l+=4)t[l]=t[l-L],t[l+1]=t[l+1-L],t[l+2]=t[l+2-L],t[l+3]=t[l+3-L];l=V}}n.l=c,n.p=O,n.b=l,c&&(s=1,n.m=f,n.d=h,n.n=d)}while(!s);return l==t.length?t:av(t,0,l)},sv=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},uv=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},lv=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var i=n.length,a=n.slice();if(!i)return[mv,0];if(1==i){var o=new Lp(n[0].s+1);return o[n[0].s]=1,[o,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var s=n[0],u=n[1],l=0,c=1,h=2;for(n[0]={s:-1,f:s.f+u.f,l:s,r:u};c!=i-1;)s=n[n[l].f<n[h].f?l++:h++],u=n[l!=c&&n[l].f<n[h].f?l++:h++],n[c++]={s:-1,f:s.f+u.f,l:s,r:u};var f=a[0].s;for(r=1;r<i;++r)a[r].s>f&&(f=a[r].s);var d=new Pp(f+1),p=cv(n[c-1],d,0);if(p>t){r=0;var v=0,m=p-t,g=1<<m;for(a.sort((function(e,t){return d[t.s]-d[e.s]||e.f-t.f}));r<i;++r){var y=a[r].s;if(!(d[y]>t))break;v+=g-(1<<p-d[y]),d[y]=t}for(v>>>=m;v>0;){var x=a[r].s;d[x]<t?v-=1<<t-d[x]++-1:++r}for(;r>=0&&v;--r){var _=a[r].s;d[_]==t&&(--d[_],++v)}p=t}return[new Lp(d),p]},cv=function e(t,n,r){return-1==t.s?Math.max(e(t.l,n,r+1),e(t.r,n,r+1)):n[t.s]=r},hv=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new Pp(++t),r=0,i=e[0],a=1,o=function(e){n[r++]=e},s=1;s<=t;++s)if(e[s]==i&&s!=t)++a;else{if(!i&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(i),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(i);a=1,i=e[s]}return[n.subarray(0,r),t]},fv=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},dv=function(e,t,n){var r=n.length,i=iv(t+2);e[i]=255&r,e[i+1]=r>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var a=0;a<r;++a)e[i+a+4]=n[a];return 8*(i+4+r)},pv=function(e,t,n,r,i,a,o,s,u,l,c){sv(t,c++,n),++i[256];for(var h=lv(i,15),f=h[0],d=h[1],p=lv(a,15),v=p[0],m=p[1],g=hv(f),y=g[0],x=g[1],_=hv(v),b=_[0],T=_[1],M=new Pp(19),w=0;w<y.length;++w)M[31&y[w]]++;for(w=0;w<b.length;++w)M[31&b[w]]++;for(var S=lv(M,7),E=S[0],k=S[1],A=19;A>4&&!E[Fp[A-1]];--A);var C,I,R,L,P=l+5<<3,N=fv(i,Kp)+fv(a,Zp)+o,O=fv(i,f)+fv(a,v)+o+14+3*A+fv(M,E)+(2*M[16]+3*M[17]+7*M[18]);if(P<=N&&P<=O)return dv(t,c,e.subarray(u,u+l));if(sv(t,c,1+(O<N)),c+=2,O<N){C=Yp(f,d,0),I=f,R=Yp(v,m,0),L=v;var D=Yp(E,k,0);sv(t,c,x-257),sv(t,c+5,T-1),sv(t,c+10,A-4),c+=14;for(w=0;w<A;++w)sv(t,c+3*w,E[Fp[w]]);c+=3*A;for(var F=[y,b],U=0;U<2;++U){var G=F[U];for(w=0;w<G.length;++w){var z=31&G[w];sv(t,c,D[z]),c+=E[z],z>15&&(sv(t,c,G[w]>>>5&127),c+=G[w]>>>12)}}}else C=Jp,I=Kp,R=$p,L=Zp;for(w=0;w<s;++w)if(r[w]>255){z=r[w]>>>18&31;uv(t,c,C[z+257]),c+=I[z+257],z>7&&(sv(t,c,r[w]>>>23&31),c+=Op[z]);var V=31&r[w];uv(t,c,R[V]),c+=L[V],V>3&&(uv(t,c,r[w]>>>5&8191),c+=Dp[V])}else uv(t,c,C[r[w]]),c+=I[r[w]];return uv(t,c,C[256]),c+I[256]},vv=new Np([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),mv=new Lp(0),gv=function(e,t,n,r,i,a){var o=e.length,s=new Lp(r+o+5*(1+Math.ceil(o/7e3))+i),u=s.subarray(r,s.length-i),l=0;if(!t||o<8)for(var c=0;c<=o;c+=65535){var h=c+65535;h<o?l=dv(u,l,e.subarray(c,h)):(u[c]=a,l=dv(u,l,e.subarray(c,o)))}else{for(var f=vv[t-1],d=f>>>13,p=8191&f,v=(1<<n)-1,m=new Pp(32768),g=new Pp(v+1),y=Math.ceil(n/3),x=2*y,_=function(t){return(e[t]^e[t+1]<<y^e[t+2]<<x)&v},b=new Np(25e3),T=new Pp(288),M=new Pp(32),w=0,S=0,E=(c=0,0),k=0,A=0;c<o;++c){var C=_(c),I=32767&c,R=g[C];if(m[I]=R,g[C]=I,k<=c){var L=o-c;if((w>7e3||E>24576)&&L>423){l=pv(e,u,0,b,T,M,S,E,A,c-A,l),E=w=S=0,A=c;for(var P=0;P<286;++P)T[P]=0;for(P=0;P<30;++P)M[P]=0}var N=2,O=0,D=p,F=I-R&32767;if(L>2&&C==_(c-F))for(var U=Math.min(d,L)-1,G=Math.min(32767,c),z=Math.min(258,L);F<=G&&--D&&I!=R;){if(e[c+N]==e[c+N-F]){for(var V=0;V<z&&e[c+V]==e[c+V-F];++V);if(V>N){if(N=V,O=F,V>U)break;var B=Math.min(F,V-2),W=0;for(P=0;P<B;++P){var H=c-F+P+32768&32767,j=H-m[H]+32768&32767;j>W&&(W=j,R=H)}}}F+=(I=R)-(R=m[I])+32768&32767}if(O){b[E++]=268435456|Vp[N]<<18|Hp[O];var q=31&Vp[N],X=31&Hp[O];S+=Op[q]+Dp[X],++T[257+q],++M[X],k=c+N,++w}else b[E++]=e[c],++T[e[c]]}}l=pv(e,u,a,b,T,M,S,E,A,c-A,l),!a&&7&l&&(l=dv(u,l+1,mv))}return av(s,0,r+iv(l)+i)},yv=function(){for(var e=new Np(256),t=0;t<256;++t){for(var n=t,r=9;--r;)n=(1&n&&3988292384)^n>>>1;e[t]=n}return e}(),xv=function(){var e=-1;return{p:function(t){for(var n=e,r=0;r<t.length;++r)n=yv[255&n^t[r]]^n>>>8;e=n},d:function(){return~e}}},_v=function(){var e=1,t=0;return{p:function(n){for(var r=e,i=t,a=n.length,o=0;o!=a;){for(var s=Math.min(o+2655,a);o<s;++o)i+=r+=n[o];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}e=r,t=i},d:function(){return(255&(e%=65521))<<24|e>>>8<<16|(255&(t%=65521))<<8|t>>>8}}},bv=function(e,t,n,r,i){return gv(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!i)},Tv=function(e,t){var n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n},Mv=function(e,t,n){for(var r=e(),i=e.toString(),a=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<r.length;++o){var s=r[o],u=a[o];if("function"==typeof s){t+=";"+u+"=";var l=s.toString();if(s.prototype)if(-1!=l.indexOf("[native code]")){var c=l.indexOf(" ",8)+1;t+=l.slice(c,l.indexOf("(",c))}else for(var h in t+=l,s.prototype)t+=";"+u+".prototype."+h+"="+s.prototype[h].toString();else t+=l}else n[u]=s}return[t,n]},wv=[],Sv=function(e,t,n,r){var i;if(!wv[n]){for(var a="",o={},s=e.length-1,u=0;u<s;++u)a=(i=Mv(e[u],a,o))[0],o=i[1];wv[n]=Mv(e[s],a,o)}var l=Tv({},wv[n][1]);return function(e,t,n,r,i){var a=Rp(Cp[t]||(Cp[t]=Ip(e)));return a.onerror=function(e){return i(e.error,null)},a.onmessage=function(e){return i(null,e.data)},a.postMessage(n,r),a}(wv[n][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",n,l,function(e){var t=[];for(var n in e)(e[n]instanceof Lp||e[n]instanceof Pp||e[n]instanceof Np)&&t.push((e[n]=new e[n].constructor(e[n])).buffer);return t}(l),r)},Ev=function(){return[Lp,Pp,Np,Op,Dp,Fp,zp,Wp,Qp,ev,jp,Yp,tv,nv,rv,iv,av,ov,tm,Lv,Pv]},kv=function(){return[Lp,Pp,Np,Op,Dp,Fp,Vp,Hp,Jp,Kp,$p,Zp,jp,vv,mv,Yp,sv,uv,lv,cv,hv,fv,dv,pv,iv,av,gv,bv,Jv,Lv]},Av=function(){return[Vv,Hv,zv,xv,yv]},Cv=function(){return[Bv,Wv]},Iv=function(){return[jv,zv,_v]},Rv=function(){return[qv]},Lv=function(e){return postMessage(e,[e.buffer])},Pv=function(e){return e&&e.size&&new Lp(e.size)},Nv=function(e,t,n,r,i,a){var o=Sv(n,r,i,(function(e,t){o.terminate(),a(e,t)}));return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}},Ov=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},Dv=function(e,t,n,r,i){var a,o=Sv(e,r,i,(function(e,n){e?(o.terminate(),t.ondata.call(t,e)):(n[1]&&o.terminate(),t.ondata.call(t,e,n[0],n[1]))}));o.postMessage(n),t.push=function(e,n){if(a)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,a=n],[e.buffer])},t.terminate=function(){o.terminate()}},Fv=function(e,t){return e[t]|e[t+1]<<8},Uv=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Gv=function(e,t){return Uv(e,t)+4294967296*Uv(e,t+4)},zv=function(e,t,n){for(;n;++t)e[t]=n,n>>>=8},Vv=function(e,t){var n=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:9==t.level?2:0,e[9]=3,0!=t.mtime&&zv(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),n){e[3]=8;for(var r=0;r<=n.length;++r)e[r+10]=n.charCodeAt(r)}},Bv=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},Wv=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Hv=function(e){return 10+(e.filename&&e.filename.length+1||0)},jv=function(e,t){var n=t.level,r=0==n?0:n<6?1:9==n?3:2;e[0]=120,e[1]=r<<6|(r?32-2*r:1)},qv=function(e){if(8!=(15&e[0])||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function Xv(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var Yv=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(bv(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),Kv=function(){return function(e,t){Dv([kv,function(){return[Ov,Yv]}],this,Xv.call(this,e,t),(function(e){var t=new Yv(e.data);onmessage=Ov(t)}),6)}}();function Zv(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Nv(e,t,[kv],(function(e){return Lv(Jv(e.data[0],e.data[1]))}),0,n)}function Jv(e,t){return bv(e,t||{},0,0)}var Qv=function(){function e(e){this.s={},this.p=new Lp(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new Lp(t+e.length);n.set(this.p),n.set(e,t),this.p=n},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=ov(this.p,this.o,this.s);this.ondata(av(n,t,this.s.b),this.d),this.o=av(n,this.s.b-32768),this.s.b=this.o.length,this.p=av(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),$v=function(){return function(e){this.ondata=e,Dv([Ev,function(){return[Ov,Qv]}],this,0,(function(){var e=new Qv;onmessage=Ov(e)}),7)}}();function em(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Nv(e,t,[Ev],(function(e){return Lv(tm(e.data[0],Pv(e.data[1])))}),1,n)}function tm(e,t){return ov(e,t)}var nm=function(){function e(e,t){this.c=xv(),this.l=0,this.v=1,Yv.call(this,e,t)}return e.prototype.push=function(e,t){Yv.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=bv(e,this.o,this.v&&Hv(this.o),t&&8,!t);this.v&&(Vv(n,this.o),this.v=0),t&&(zv(n,n.length-8,this.c.d()),zv(n,n.length-4,this.l)),this.ondata(n,t)},e}(),rm=function(){return function(e,t){Dv([kv,Av,function(){return[Ov,Yv,nm]}],this,Xv.call(this,e,t),(function(e){var t=new nm(e.data);onmessage=Ov(t)}),8)}}();function im(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Nv(e,t,[kv,Av,function(){return[am]}],(function(e){return Lv(am(e.data[0],e.data[1]))}),2,n)}function am(e,t){t||(t={});var n=xv(),r=e.length;n.p(e);var i=bv(e,t,Hv(t),8),a=i.length;return Vv(i,t),zv(i,a-8,n.d()),zv(i,a-4,r),i}var om=function(){function e(e){this.v=1,Qv.call(this,e)}return e.prototype.push=function(e,t){if(Qv.prototype.e.call(this,e),this.v){var n=this.p.length>3?Bv(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Qv.prototype.c.call(this,t)},e}(),sm=function(){return function(e){this.ondata=e,Dv([Ev,Cv,function(){return[Ov,Qv,om]}],this,0,(function(){var e=new om;onmessage=Ov(e)}),9)}}();function um(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Nv(e,t,[Ev,Cv,function(){return[lm]}],(function(e){return Lv(lm(e.data[0]))}),3,n)}function lm(e,t){return ov(e.subarray(Bv(e),-8),t||new Lp(Wv(e)))}var cm=function(){function e(e,t){this.c=_v(),this.v=1,Yv.call(this,e,t)}return e.prototype.push=function(e,t){Yv.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var n=bv(e,this.o,this.v&&2,t&&4,!t);this.v&&(jv(n,this.o),this.v=0),t&&zv(n,n.length-4,this.c.d()),this.ondata(n,t)},e}(),hm=function(){return function(e,t){Dv([kv,Iv,function(){return[Ov,Yv,cm]}],this,Xv.call(this,e,t),(function(e){var t=new cm(e.data);onmessage=Ov(t)}),10)}}();function fm(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Nv(e,t,[kv,Iv,function(){return[dm]}],(function(e){return Lv(dm(e.data[0],e.data[1]))}),4,n)}function dm(e,t){t||(t={});var n=_v();n.p(e);var r=bv(e,t,2,4);return jv(r,t),zv(r,r.length-4,n.d()),r}var pm=function(){function e(e){this.v=1,Qv.call(this,e)}return e.prototype.push=function(e,t){if(Qv.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Qv.prototype.c.call(this,t)},e}(),vm=function(){return function(e){this.ondata=e,Dv([Ev,Rv,function(){return[Ov,Qv,pm]}],this,0,(function(){var e=new pm;onmessage=Ov(e)}),11)}}();function mm(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return Nv(e,t,[Ev,Rv,function(){return[gm]}],(function(e){return Lv(gm(e.data[0],Pv(e.data[1])))}),5,n)}function gm(e,t){return ov((qv(e),e.subarray(2,-4)),t)}var ym=function(){function e(e){this.G=om,this.I=Qv,this.Z=pm,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new Lp(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var r=this,i=function(){r.ondata.apply(r,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(i):8!=(15&this.p[0])||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(i):new this.Z(i),this.s.push(this.p,t),this.p=null}}},e}(),xm=function(){function e(e){this.G=sm,this.I=$v,this.Z=vm,this.ondata=e}return e.prototype.push=function(e,t){ym.prototype.push.call(this,e,t)},e}();function _m(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";return 31==e[0]&&139==e[1]&&8==e[2]?um(e,t,n):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?em(e,t,n):mm(e,t,n)}function bm(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?lm(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?tm(e,t):gm(e,t)}var Tm=function e(t,n,r,i){for(var a in t){var o=t[a],s=n+a;o instanceof Lp?r[s]=[o,i]:Array.isArray(o)?r[s]=[o[0],Tv(i,o[1])]:e(o,s+"/",r,i)}},Mm="undefined"!=typeof TextEncoder&&new TextEncoder,wm="undefined"!=typeof TextDecoder&&new TextDecoder,Sm=0;try{wm.decode(mv,{stream:!0}),Sm=1}catch(e){}var Em=function(e){for(var t="",n=0;;){var r=e[n++],i=(r>127)+(r>223)+(r>239);if(n+i>e.length)return[t,av(e,n-1)];i?3==i?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=1&i?String.fromCharCode((31&r)<<6|63&e[n++]):String.fromCharCode((15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}},km=function(){function e(e){this.ondata=e,Sm?this.t=new TextDecoder:this.p=mv}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new Lp(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var r=Em(n),i=r[0],a=r[1];if(t){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(i,t)}},e}(),Am=function(){function e(e){this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Cm(e),this.d=t||!1)},e}();function Cm(e,t){if(t){for(var n=new Lp(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n}if(Mm)return Mm.encode(e);var i=e.length,a=new Lp(e.length+(e.length>>1)),o=0,s=function(e){a[o++]=e};for(r=0;r<i;++r){if(o+5>a.length){var u=new Lp(o+8+(i-r<<1));u.set(a),a=u}var l=e.charCodeAt(r);l<128||t?s(l):l<2048?(s(192|l>>6),s(128|63&l)):l>55295&&l<57344?(s(240|(l=65536+(1047552&l)|1023&e.charCodeAt(++r))>>18),s(128|l>>12&63),s(128|l>>6&63),s(128|63&l)):(s(224|l>>12),s(128|l>>6&63),s(128|63&l))}return av(a,0,o)}function Im(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(wm)return wm.decode(e);var i=Em(e),a=i[0];if(i[1].length)throw"invalid utf-8 data";return a}var Rm=function(e){return 1==e?3:e<6?2:9==e?1:0},Lm=function(e,t){return t+30+Fv(e,t+26)+Fv(e,t+28)},Pm=function(e,t,n){var r=Fv(e,t+28),i=Im(e.subarray(t+46,t+46+r),!(2048&Fv(e,t+8))),a=t+46+r,o=Uv(e,t+20),s=n&&4294967295==o?Nm(e,a):[o,Uv(e,t+24),Uv(e,t+42)],u=s[0],l=s[1],c=s[2];return[Fv(e,t+10),u,l,i,a+Fv(e,t+30)+Fv(e,t+32),c]},Nm=function(e,t){for(;1!=Fv(e,t);t+=4+Fv(e,t+2));return[Gv(e,t+12),Gv(e,t+4),Gv(e,t+20)]},Om=function(e){var t=0;if(e)for(var n in e){var r=e[n].length;if(r>65535)throw"extra field too long";t+=r+4}return t},Dm=function(e,t,n,r,i,a,o,s){var u=r.length,l=n.extra,c=s&&s.length,h=Om(l);zv(e,t,null!=o?33639248:67324752),t+=4,null!=o&&(e[t++]=20,e[t++]=n.os),e[t]=20,t+=2,e[t++]=n.flag<<1|(null==a&&8),e[t++]=i&&8,e[t++]=255&n.compression,e[t++]=n.compression>>8;var f=new Date(null==n.mtime?Date.now():n.mtime),d=f.getFullYear()-1980;if(d<0||d>119)throw"date not in range 1980-2099";if(zv(e,t,d<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>>1),t+=4,null!=a&&(zv(e,t,n.crc),zv(e,t+4,a),zv(e,t+8,n.size)),zv(e,t+12,u),zv(e,t+14,h),t+=16,null!=o&&(zv(e,t,c),zv(e,t+6,n.attrs),zv(e,t+10,o),t+=14),e.set(r,t),t+=u,h)for(var p in l){var v=l[p],m=v.length;zv(e,t,+p),zv(e,t+2,m),e.set(v,t+4),t+=4+m}return c&&(e.set(s,t),t+=c),t},Fm=function(e,t,n,r,i){zv(e,t,101010256),zv(e,t+8,n),zv(e,t+10,n),zv(e,t+12,r),zv(e,t+16,i)},Um=function(){function e(e){this.filename=e,this.c=xv(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}(),Gm=function(){function e(e,t){var n=this;t||(t={}),Um.call(this,e),this.d=new Yv(t,(function(e,t){n.ondata(null,e,t)})),this.compression=8,this.flag=Rm(t.level)}return e.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},e.prototype.push=function(e,t){Um.prototype.push.call(this,e,t)},e}(),zm=function(){function e(e,t){var n=this;t||(t={}),Um.call(this,e),this.d=new Kv(t,(function(e,t,r){n.ondata(e,t,r)})),this.compression=8,this.flag=Rm(t.level),this.terminate=this.d.terminate}return e.prototype.process=function(e,t){this.d.push(e,t)},e.prototype.push=function(e,t){Um.prototype.push.call(this,e,t)},e}(),Vm=function(){function e(e){this.ondata=e,this.u=[],this.d=1}return e.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=Cm(e.filename),r=n.length,i=e.comment,a=i&&Cm(i),o=r!=e.filename.length||a&&i.length!=a.length,s=r+Om(e.extra)+30;if(r>65535)throw"filename too long";var u=new Lp(s);Dm(u,0,e,n,o);var l=[u],c=function(){for(var e=0,n=l;e<n.length;e++){var r=n[e];t.ondata(null,r,!1)}l=[]},h=this.d;this.d=0;var f=this.u.length,d=Tv(e,{f:n,u:o,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(c(),h){var e=t.u[f+1];e?e.r():t.d=1}h=1}}),p=0;e.ondata=function(n,r,i){if(n)t.ondata(n,r,i),t.terminate();else if(p+=r.length,l.push(r),i){var a=new Lp(16);zv(a,0,134695760),zv(a,4,e.crc),zv(a,8,p),zv(a,12,e.size),l.push(a),d.c=p,d.b=s+p+16,d.crc=e.crc,d.size=e.size,h&&d.r(),h=1}else h&&c()},this.u.push(d)},e.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var e=0,t=0,n=0,r=0,i=this.u;r<i.length;r++){n+=46+(u=i[r]).f.length+Om(u.extra)+(u.o?u.o.length:0)}for(var a=new Lp(n+22),o=0,s=this.u;o<s.length;o++){var u=s[o];Dm(a,e,u,u.f,u.u,u.c,t,u.o),e+=46+u.f.length+Om(u.extra)+(u.o?u.o.length:0),t+=u.b}Fm(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},e.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++){t[e].t()}this.d=2},e}();function Bm(e,t,n){if(n||(n=t,t={}),"function"!=typeof n)throw"no callback";var r={};Tm(e,"",r,t);var i=Object.keys(r),a=i.length,o=0,s=0,u=a,l=new Array(a),c=[],h=function(){for(var e=0;e<c.length;++e)c[e]()},f=function(){var e=new Lp(s+22),t=o,r=s-o;s=0;for(var i=0;i<u;++i){var a=l[i];try{var c=a.c.length;Dm(e,s,a,a.f,a.u,c);var h=30+a.f.length+Om(a.extra),f=s+h;e.set(a.c,f),Dm(e,o,a,a.f,a.u,c,s,a.m),o+=16+h+(a.m?a.m.length:0),s=f+c}catch(e){return n(e,null)}}Fm(e,o,l.length,r,t),n(null,e)};a||f();for(var d=function(e){var t=i[e],u=r[t],d=u[0],p=u[1],v=xv(),m=d.length;v.p(d);var g=Cm(t),y=g.length,x=p.comment,_=x&&Cm(x),b=_&&_.length,T=Om(p.extra),M=0==p.level?0:8,w=function(r,i){if(r)h(),n(r,null);else{var u=i.length;l[e]=Tv(p,{size:m,crc:v.d(),c:i,f:g,m:_,u:y!=t.length||_&&x.length!=b,compression:M}),o+=30+y+T+u,s+=76+2*(y+T)+(b||0)+u,--a||f()}};if(y>65535&&w("filename too long",null),M)if(m<16e4)try{w(null,Jv(d,p))}catch(e){w(e,null)}else c.push(Zv(d,p,w));else w(null,d)},p=0;p<u;++p)d(p);return h}function Wm(e,t){t||(t={});var n={},r=[];Tm(e,"",n,t);var i=0,a=0;for(var o in n){var s=n[o],u=s[0],l=s[1],c=0==l.level?0:8,h=(M=Cm(o)).length,f=l.comment,d=f&&Cm(f),p=d&&d.length,v=Om(l.extra);if(h>65535)throw"filename too long";var m=c?Jv(u,l):u,g=m.length,y=xv();y.p(u),r.push(Tv(l,{size:u.length,crc:y.d(),c:m,f:M,m:d,u:h!=o.length||d&&f.length!=p,o:i,compression:c})),i+=30+h+v+g,a+=76+2*(h+v)+(p||0)+g}for(var x=new Lp(a+22),_=i,b=a-i,T=0;T<r.length;++T){var M=r[T];Dm(x,M.o,M,M.f,M.u,M.c.length);var w=30+M.f.length+Om(M.extra);x.set(M.c,M.o+w),Dm(x,i,M,M.f,M.u,M.c.length,M.o,M.m),i+=16+w+(M.m?M.m.length:0)}return Fm(x,i,r.length,b,_),x}var Hm=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}(),jm=function(){function e(){var e=this;this.i=new Qv((function(t,n){e.ondata(null,t,n)}))}return e.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},e.compression=8,e}(),qm=function(){function e(e,t){var n=this;t<32e4?this.i=new Qv((function(e,t){n.ondata(null,e,t)})):(this.i=new $v((function(e,t,r){n.ondata(e,t,r)})),this.terminate=this.i.terminate)}return e.prototype.push=function(e,t){this.i.terminate&&(e=av(e,0)),this.i.push(e,t)},e.compression=8,e}(),Xm=function(){function e(e){this.onfile=e,this.k=[],this.o={0:Hm},this.p=mv}return e.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,e.length),i=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(i,!this.c):this.k[0].push(i),(e=e.subarray(r)).length)return this.push(e,t)}else{var a=0,o=0,s=void 0,u=void 0;this.p.length?e.length?((u=new Lp(this.p.length+e.length)).set(this.p),u.set(e,this.p.length)):u=this.p:u=e;for(var l=u.length,c=this.c,h=c&&this.d,f=function(){var e,t=Uv(u,o);if(67324752==t){a=1,s=o,d.d=null,d.c=0;var r=Fv(u,o+6),i=Fv(u,o+8),h=2048&r,f=8&r,p=Fv(u,o+26),v=Fv(u,o+28);if(l>o+30+p+v){var m=[];d.k.unshift(m),a=2;var g,y=Uv(u,o+18),x=Uv(u,o+22),_=Im(u.subarray(o+30,o+=30+p),!h);4294967295==y?(e=f?[-2]:Nm(u,o),y=e[0],x=e[1]):f&&(y=-1),o+=v,d.c=y;var b={name:_,compression:i,start:function(){if(!b.ondata)throw"no callback";if(y){var e=n.o[i];if(!e)throw"unknown compression type "+i;(g=y<0?new e(_):new e(_,y,x)).ondata=function(e,t,n){b.ondata(e,t,n)};for(var t=0,r=m;t<r.length;t++){var a=r[t];g.push(a,!1)}n.k[0]==m&&n.c?n.d=g:g.push(mv,!0)}else b.ondata(null,mv,!0)},terminate:function(){g&&g.terminate&&g.terminate()}};y>=0&&(b.size=y,b.originalSize=x),d.onfile(b)}return"break"}if(c){if(134695760==t)return s=o+=12+(-2==c&&8),a=3,d.c=0,"break";if(33639248==t)return s=o-=4,a=3,d.c=0,"break"}},d=this;o<l-4;++o){if("break"===f())break}if(this.p=mv,c<0){var p=a?u.subarray(0,s-12-(-2==c&&8)-(134695760==Uv(u,s-16)&&4)):u.subarray(0,o);h?h.push(p,!!a):this.k[+(2==a)].push(p)}if(2&a)return this.push(u.subarray(o),t);this.p=u.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},e.prototype.register=function(e){this.o[e.compression]=e},e}();function Ym(e,t){if("function"!=typeof t)throw"no callback";for(var n=[],r=function(){for(var e=0;e<n.length;++e)n[e]()},i={},a=e.length-22;101010256!=Uv(e,a);--a)if(!a||e.length-a>65558)return void t("invalid zip file",null);var o=Fv(e,a+8);o||t(null,{});var s=o,u=Uv(e,a+16),l=4294967295==u;if(l){if(a=Uv(e,a-12),101075792!=Uv(e,a))return void t("invalid zip file",null);s=o=Uv(e,a+32),u=Uv(e,a+48)}for(var c=function(a){var s=Pm(e,u,l),c=s[0],h=s[1],f=s[2],d=s[3],p=s[4],v=s[5],m=Lm(e,v);u=p;var g=function(e,n){e?(r(),t(e,null)):(i[d]=n,--o||t(null,i))};if(c)if(8==c){var y=e.subarray(m,m+h);if(h<32e4)try{g(null,tm(y,new Lp(f)))}catch(e){g(e,null)}else n.push(em(y,{size:f},g))}else g("unknown compression type "+c,null);else g(null,av(e,m,m+h))},h=0;h<s;++h)c();return r}function Km(e){for(var t={},n=e.length-22;101010256!=Uv(e,n);--n)if(!n||e.length-n>65558)throw"invalid zip file";var r=Fv(e,n+8);if(!r)return{};var i=Uv(e,n+16),a=4294967295==i;if(a){if(n=Uv(e,n-12),101075792!=Uv(e,n))throw"invalid zip file";r=Uv(e,n+32),i=Uv(e,n+48)}for(var o=0;o<r;++o){var s=Pm(e,i,a),u=s[0],l=s[1],c=s[2],h=s[3],f=s[4],d=s[5],p=Lm(e,d);if(i=f,u){if(8!=u)throw"unknown compression type "+u;t[h]=tm(e.subarray(p,p+l),new Lp(c))}else t[h]=av(e,p,p+l)}return t}function Zm(e,t,n){var r=n.length-e-1;if(t>=n[r])return r-1;if(t<=n[e])return e;for(var i=e,a=r,o=Math.floor((i+a)/2);t<n[o]||t>=n[o+1];)t<n[o]?a=o:i=o,o=Math.floor((i+a)/2);return o}function Jm(e,t,n,r){var i=[],a=[],o=[];i[0]=1;for(var s=1;s<=n;++s){a[s]=t-r[e+1-s],o[s]=r[e+s]-t;for(var u=0,l=0;l<s;++l){var c=o[l+1],h=a[s-l],f=i[l]/(c+h);i[l]=u+c*f,u=h*f}i[s]=u}return i}function Qm(e,t,n,r){for(var i=Zm(e,r,t),a=Jm(i,r,e,t),o=new er(0,0,0,0),s=0;s<=e;++s){var u=n[i-e+s],l=a[s],c=u.w*l;o.x+=u.x*c,o.y+=u.y*c,o.z+=u.z*c,o.w+=u.w*l}return o}function $m(e,t){for(var n=1,r=2;r<=e;++r)n*=r;for(var i=1,a=2;a<=t;++a)i*=a;for(var o=2;o<=e-t;++o)i*=o;return n/i}function eg(e,t,n,r,i){var a=function(e,t,n,r,i){for(var a=i<e?i:e,o=[],s=Zm(e,r,t),u=function(e,t,n,r,i){for(var a=[],o=0;o<=n;++o)a[o]=0;for(var s=[],u=0;u<=r;++u)s[u]=a.slice(0);for(var l=[],c=0;c<=n;++c)l[c]=a.slice(0);l[0][0]=1;for(var h=a.slice(0),f=a.slice(0),d=1;d<=n;++d){h[d]=t-i[e+1-d],f[d]=i[e+d]-t;for(var p=0,v=0;v<d;++v){var m=f[v+1],g=h[d-v];l[d][v]=m+g;var y=l[v][d-1]/l[d][v];l[v][d]=p+m*y,p=g*y}l[d][d]=p}for(var x=0;x<=n;++x)s[0][x]=l[x][n];for(var _=0;_<=n;++_){for(var b=0,T=1,M=[],w=0;w<=n;++w)M[w]=a.slice(0);M[0][0]=1;for(var S=1;S<=r;++S){var E=0,k=_-S,A=n-S;_>=S&&(M[T][0]=M[b][0]/l[A+1][k],E=M[T][0]*l[k][A]);for(var C=_-1<=A?S-1:n-_,I=k>=-1?1:-k;I<=C;++I)M[T][I]=(M[b][I]-M[b][I-1])/l[A+1][k+I],E+=M[T][I]*l[k+I][A];_<=A&&(M[T][S]=-M[b][S-1]/l[A+1][_],E+=M[T][S]*l[_][A]),s[S][_]=E;var R=b;b=T,T=R}}for(var L=n,P=1;P<=r;++P){for(var N=0;N<=n;++N)s[P][N]*=L;L*=n-P}return s}(s,r,e,a,t),l=[],c=0;c<n.length;++c){var h=n[c].clone(),f=h.w;h.x*=f,h.y*=f,h.z*=f,l[c]=h}for(var d=0;d<=a;++d){for(var p=l[s-e].clone().multiplyScalar(u[d][0]),v=1;v<=e;++v)p.add(l[s-e+v].clone().multiplyScalar(u[d][v]));o[d]=p}for(var m=a+1;m<=i+1;++m)o[m]=new er(0,0,0);return o}(e,t,n,r,i);return function(e){for(var t=e.length,n=[],r=[],i=0;i<t;++i){var a=e[i];n[i]=new ar(a.x,a.y,a.z),r[i]=a.w}for(var o=[],s=0;s<t;++s){for(var u=n[s].clone(),l=1;l<=s;++l)u.sub(o[s-l].clone().multiplyScalar($m(s,l)*r[l]));o[s]=u.divideScalar(r[0])}return o}(a)}var tg,ng,rg,ig=function(e){Fe(r,e);var n=Ge(r);function r(e,i,a,o,s){var u;t(this,r),(u=n.call(this)).degree=e,u.knots=i,u.controlPoints=[],u.startKnot=o||0,u.endKnot=s||u.knots.length-1;for(var l=0;l<a.length;++l){var c=a[l];u.controlPoints[l]=new er(c.x,c.y,c.z,c.w)}return u}return a(r,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar,n=t,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),i=Qm(this.degree,this.knots,this.controlPoints,r);return 1!==i.w&&i.divideScalar(i.w),n.set(i.x,i.y,i.z)}},{key:"getTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ar,n=t,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),i=eg(this.degree,this.knots,this.controlPoints,r,1);return n.copy(i[1]).normalize(),n}}]),r}(Au),ag=function(e){Fe(r,e);var n=Ge(r);function r(e){return t(this,r),n.call(this,e)}return a(r,[{key:"load",value:function(e,t,n,r){var i=this,a=""===i.path?Rc.extractUrlBase(e):i.path,o=new hc(this.manager);o.setPath(i.path),o.setResponseType("arraybuffer"),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(n,a))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e,t){if(i="Kaydara FBX Binary  \0",(r=e).byteLength>=i.length&&i===Tg(r,0,i.length))tg=(new cg).parse(e);else{var n=Tg(e);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;function r(t){var r=e[t-1];return e=e.slice(n+t),n++,r}for(var i=0;i<t.length;++i){if(r(1)===t[i])return!1}return!0}(n))throw new Error("THREE.FBXLoader: Unknown format.");if(dg(n)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+dg(n));tg=(new lg).parse(n)}var r,i,a=new vc(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new og(a,this.manager).parse(tg)}}]),r}(uc),og=function(){function e(n,r){t(this,e),this.textureLoader=n,this.manager=r}return a(e,[{key:"parse",value:function(){ng=this.parseConnections();var e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),i=(new sg).parse(r);return this.parseScene(r,i,n),rg}},{key:"parseConnections",value:function(){var e=new Map;"Connections"in tg&&tg.Connections.connections.forEach((function(t){var n=t[0],r=t[1],i=t[2];e.has(n)||e.set(n,{parents:[],children:[]});var a={ID:r,relationship:i};e.get(n).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});var o={ID:n,relationship:i};e.get(r).children.push(o)}));return e}},{key:"parseImages",value:function(){var e={},t={};if("Video"in tg.Objects){var n=tg.Objects.Video;for(var r in n){var i=n[r];if(e[parseInt(r)]=i.RelativeFilename||i.Filename,"Content"in i){var a=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,o="string"==typeof i.Content&&""!==i.Content;if(a||o){var s=this.parseImage(n[r]);t[i.RelativeFilename||i.Filename]=s}}}}for(var u in e){var l=e[u];void 0!==t[l]?e[u]=t[l]:e[u]=e[u].split("\\").pop()}return e}},{key:"parseImage",value:function(e){var t,n=e.Content,r=e.RelativeFilename||e.Filename,i=r.slice(r.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",r),t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+i+'" is not supported.')}if("string"==typeof n)return"data:"+t+";base64,"+n;var a=new Uint8Array(n);return window.URL.createObjectURL(new Blob([a],{type:t}))}},{key:"parseTextures",value:function(e){var t=new Map;if("Texture"in tg.Objects){var n=tg.Objects.Texture;for(var r in n){var i=this.parseTexture(n[r],e);t.set(parseInt(r),i)}}return t}},{key:"parseTexture",value:function(e,t){var n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;var r=e.WrapModeU,i=e.WrapModeV,a=void 0!==r?r.value:0,o=void 0!==i?i.value:0;if(n.wrapS=0===a?pt:vt,n.wrapT=0===o?pt:vt,"Scaling"in e){var s=e.Scaling.value;n.repeat.x=s[0],n.repeat.y=s[1]}if("Translation"in e){var u=e.Translation.value;n.offset.x=u[0],n.offset.y=u[1]}return n}},{key:"loadTexture",value:function(e,t){var n,r,i=this.textureLoader.path,a=ng.get(e.id).children;void 0!==a&&a.length>0&&void 0!==t[a[0].ID]&&(0!==(n=t[a[0].ID]).indexOf("blob:")&&0!==n.indexOf("data:")||this.textureLoader.setPath(void 0));var o=e.FileName.slice(-3).toLowerCase();if("tga"===o){var s=this.manager.getHandler(".tga");null===s?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),r=new $n):(s.setPath(this.textureLoader.path),r=s.load(n))}else"psd"===o?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),r=new $n):r=this.textureLoader.load(n);return this.textureLoader.setPath(i),r}},{key:"parseMaterials",value:function(e){var t=new Map;if("Material"in tg.Objects){var n=tg.Objects.Material;for(var r in n){var i=this.parseMaterial(n[r],e);null!==i&&t.set(parseInt(r),i)}}return t}},{key:"parseMaterial",value:function(e,t){var n=e.id,r=e.attrName,i=e.ShadingModel;if("object"===Ap(i)&&(i=i.value),!ng.has(n))return null;var a,o=this.parseParameters(e,t,n);switch(i.toLowerCase()){case"phong":a=new Fl;break;case"lambert":a=new Ul;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',i),a=new Fl}return a.setValues(o),a.name=r,a}},{key:"parseParameters",value:function(e,t,n){var r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=(new Yn).fromArray(e.Diffuse.value):!e.DiffuseColor||"Color"!==e.DiffuseColor.type&&"ColorRGB"!==e.DiffuseColor.type||(r.color=(new Yn).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=(new Yn).fromArray(e.Emissive.value):!e.EmissiveColor||"Color"!==e.EmissiveColor.type&&"ColorRGB"!==e.EmissiveColor.type||(r.emissive=(new Yn).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=(new Yn).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(r.specular=(new Yn).fromArray(e.SpecularColor.value));var i=this;return ng.get(n).children.forEach((function(e){var n=e.relationship;switch(n){case"Bump":r.bumpMap=i.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":r.aoMap=i.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=i.getTexture(t,e.ID),void 0!==r.map&&(r.map.encoding=hn);break;case"DisplacementColor":r.displacementMap=i.getTexture(t,e.ID);break;case"EmissiveColor":r.emissiveMap=i.getTexture(t,e.ID),void 0!==r.emissiveMap&&(r.emissiveMap.encoding=hn);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=i.getTexture(t,e.ID);break;case"ReflectionColor":r.envMap=i.getTexture(t,e.ID),void 0!==r.envMap&&(r.envMap.mapping=ht,r.envMap.encoding=hn);break;case"SpecularColor":r.specularMap=i.getTexture(t,e.ID),void 0!==r.specularMap&&(r.specularMap.encoding=hn);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=i.getTexture(t,e.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",n)}})),r}},{key:"getTexture",value:function(e,t){return"LayeredTexture"in tg.Objects&&t in tg.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=ng.get(t).children[0].ID),e.get(t)}},{key:"parseDeformers",value:function(){var e={},t={};if("Deformer"in tg.Objects){var n=tg.Objects.Deformer;for(var r in n){var i=n[r],a=ng.get(parseInt(r));if("Skin"===i.attrType){var o=this.parseSkeleton(a,n);o.ID=r,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),o.geometryID=a.parents[0].ID,e[r]=o}else if("BlendShape"===i.attrType){var s={id:r};s.rawTargets=this.parseMorphTargets(a,n),s.id=r,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=s}}}return{skeletons:e,morphTargets:t}}},{key:"parseSkeleton",value:function(e,t){var n=[];return e.children.forEach((function(e){var r=t[e.ID];if("Cluster"===r.attrType){var i={ID:e.ID,indices:[],weights:[],transformLink:(new Dr).fromArray(r.TransformLink.a)};"Indexes"in r&&(i.indices=r.Indexes.a,i.weights=r.Weights.a),n.push(i)}})),{rawBones:n,bones:[]}}},{key:"parseMorphTargets",value:function(e,t){for(var n=[],r=0;r<e.children.length;r++){var i=e.children[r],a=t[i.ID],o={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;o.geoID=ng.get(parseInt(i.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,n.push(o)}return n}},{key:"parseScene",value:function(e,t,n){rg=new Ws;var r=this.parseModels(e.skeletons,t,n),i=tg.Objects.Model,a=this;r.forEach((function(e){var t=i[e.ID];a.setLookAtProperties(e,t),ng.get(e.ID).parents.forEach((function(t){var n=r.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&rg.add(e)})),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),rg.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);var t=xg(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}}));var o=(new ug).parse();1===rg.children.length&&rg.children[0].isGroup&&(rg.children[0].animations=o,rg=rg.children[0]),rg.animations=o}},{key:"parseModels",value:function(e,t,n){var r=new Map,i=tg.Objects.Model;for(var a in i){var o=parseInt(a),s=i[a],u=ng.get(o),l=this.buildSkeleton(u,e,o,s.attrName);if(!l){switch(s.attrType){case"Camera":l=this.createCamera(u);break;case"Light":l=this.createLight(u);break;case"Mesh":l=this.createMesh(u,t,n);break;case"NurbsCurve":l=this.createCurve(u,t);break;case"LimbNode":case"Root":l=new ou;break;default:l=new Ws}l.name=s.attrName?Gc.sanitizeNodeName(s.attrName):"",l.ID=o}this.getTransformData(l,s),r.set(o,l)}return r}},{key:"buildSkeleton",value:function(e,t,n,r){var i=null;return e.parents.forEach((function(e){var a=function(a){var o=t[a];o.rawBones.forEach((function(t,a){if(t.ID===e.ID){var s=i;(i=new ou).matrixWorld.copy(t.transformLink),i.name=r?Gc.sanitizeNodeName(r):"",i.ID=n,o.bones[a]=i,null!==s&&i.add(s)}}))};for(var o in t)a(o)})),i}},{key:"createCamera",value:function(e){var t,n;if(e.children.forEach((function(e){var t=tg.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new si;else{var r=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(r=1);var i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);var a=1e3;void 0!==n.FarPlane&&(a=n.FarPlane.value/1e3);var o=window.innerWidth,s=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(o=n.AspectWidth.value,s=n.AspectHeight.value);var u=o/s,l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);var c=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new sa(l,u,i,a),null!==c&&t.setFocalLength(c);break;case 1:t=new Ra(-o/2,o/2,s/2,-s/2,i,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new si}}return t}},{key:"createLight",value:function(e){var t,n;if(e.children.forEach((function(e){var t=tg.Objects.NodeAttribute[e.ID];void 0!==t&&(n=t)})),void 0===n)t=new si;else{var r;r=void 0===n.LightType?0:n.LightType.value;var i=16777215;void 0!==n.Color&&(i=(new Yn).fromArray(n.Color.value));var a=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(a=0);var o=0;void 0!==n.FarAttenuationEnd&&(o=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(r){case 0:t=new kc(i,a,o,1);break;case 1:t=new Cc(i,a);break;case 2:var s=Math.PI/3;void 0!==n.InnerAngle&&(s=Ln.degToRad(n.InnerAngle.value));var u=0;void 0!==n.OuterAngle&&(u=Ln.degToRad(n.OuterAngle.value),u=Math.max(u,1)),t=new Tc(i,a,o,s,u,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new kc(i,a)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}},{key:"createMesh",value:function(e,t,n){var r,i=null,a=null,o=[];return e.children.forEach((function(e){t.has(e.ID)&&(i=t.get(e.ID)),n.has(e.ID)&&o.push(n.get(e.ID))})),o.length>1?a=o:o.length>0?a=o[0]:(a=new Fl({color:13421772}),o.push(a)),"color"in i.attributes&&o.forEach((function(e){e.vertexColors=!0})),i.FBX_Deformer?(r=new au(i,a)).normalizeSkinWeights():r=new $i(i,a),r}},{key:"createCurve",value:function(e,t){var n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),r=new hu({color:3342591,linewidth:1});return new gu(n,r)}},{key:"getTransformData",value:function(e,t){var n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?_g(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}},{key:"setLookAtProperties",value:function(e,t){"LookAtProperty"in t&&ng.get(e.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var n=tg.Objects.Model[t.ID];if("Lcl_Translation"in n){var r=n.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(r),rg.add(e.target)):e.lookAt((new ar).fromArray(r))}}}))}},{key:"bindSkeleton",value:function(e,t,n){var r=this.parsePoseNodes(),i=function(i){var a=e[i];ng.get(parseInt(a.ID)).parents.forEach((function(e){if(t.has(e.ID)){var i=e.ID;ng.get(i).parents.forEach((function(e){n.has(e.ID)&&n.get(e.ID).bind(new cu(a.bones),r[e.ID])}))}}))};for(var a in e)i(a)}},{key:"parsePoseNodes",value:function(){var e={};if("Pose"in tg.Objects){var t=tg.Objects.Pose;for(var n in t)if("BindPose"===t[n].attrType&&t[n].NbPoseNodes>0){var r=t[n].PoseNode;Array.isArray(r)?r.forEach((function(t){e[t.Node]=(new Dr).fromArray(t.Matrix.a)})):e[r.Node]=(new Dr).fromArray(r.Matrix.a)}}return e}},{key:"createAmbientLight",value:function(){if("GlobalSettings"in tg&&"AmbientColor"in tg.GlobalSettings){var e=tg.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(0!==t||0!==n||0!==r){var i=new Yn(t,n,r);rg.add(new Ic(i,1))}}}}]),e}(),sg=function(){function e(){t(this,e)}return a(e,[{key:"parse",value:function(e){var t=new Map;if("Geometry"in tg.Objects){var n=tg.Objects.Geometry;for(var r in n){var i=ng.get(parseInt(r)),a=this.parseGeometry(i,n[r],e);t.set(parseInt(r),a)}}return t}},{key:"parseGeometry",value:function(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}},{key:"parseMeshGeometry",value:function(e,t,n){var r=n.skeletons,i=[],a=e.parents.map((function(e){return tg.Objects.Model[e.ID]}));if(0!==a.length){var o=e.children.reduce((function(e,t){return void 0!==r[t.ID]&&(e=r[t.ID]),e}),null);e.children.forEach((function(e){void 0!==n.morphTargets[e.ID]&&i.push(n.morphTargets[e.ID])}));var s=a[0],u={};"RotationOrder"in s&&(u.eulerOrder=_g(s.RotationOrder.value)),"InheritType"in s&&(u.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(u.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(u.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(u.scale=s.GeometricScaling.value);var l=xg(u);return this.genGeometry(t,o,i,l)}}},{key:"genGeometry",value:function(e,t,n,r){var i=new Oi;e.attrName&&(i.name=e.attrName);var a=this.parseGeoNode(e,t),o=this.genBuffers(a),s=new ki(o.vertex,3);if(s.applyMatrix4(r),i.setAttribute("position",s),o.colors.length>0&&i.setAttribute("color",new ki(o.colors,3)),t&&(i.setAttribute("skinIndex",new Si(o.weightsIndices,4)),i.setAttribute("skinWeight",new ki(o.vertexWeights,4)),i.FBX_Deformer=t),o.normal.length>0){var u=(new Nn).getNormalMatrix(r),l=new ki(o.normal,3);l.applyNormalMatrix(u),i.setAttribute("normal",l)}if(o.uvs.forEach((function(e,t){var n="uv"+(t+1).toString();0===t&&(n="uv"),i.setAttribute(n,new ki(o.uvs[t],2))})),a.material&&"AllSame"!==a.material.mappingType){var c=o.materialIndex[0],h=0;if(o.materialIndex.forEach((function(e,t){e!==c&&(i.addGroup(h,t-h,c),c=e,h=t)})),i.groups.length>0){var f=i.groups[i.groups.length-1],d=f.start+f.count;d!==o.materialIndex.length&&i.addGroup(d,o.materialIndex.length-d,c)}0===i.groups.length&&i.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(i,e,n,r),i}},{key:"parseGeoNode",value:function(e,t){var n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];for(var r=0;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(r,i){void 0===n.weightTable[r]&&(n.weightTable[r]=[]),n.weightTable[r].push({id:t,weight:e.weights[i]})}))}))),n}},{key:"genBuffers",value:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,r=0,i=!1,a=[],o=[],s=[],u=[],l=[],c=[],h=this;return e.vertexIndices.forEach((function(f,d){var p,v=!1;f<0&&(f^=-1,v=!0);var m=[],g=[];if(a.push(3*f,3*f+1,3*f+2),e.color){var y=mg(d,n,f,e.color);s.push(y[0],y[1],y[2])}if(e.skeleton){if(void 0!==e.weightTable[f]&&e.weightTable[f].forEach((function(e){g.push(e.weight),m.push(e.id)})),g.length>4){i||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),i=!0);var x=[0,0,0,0],_=[0,0,0,0];g.forEach((function(e,t){var n=e,r=m[t];_.forEach((function(e,t,i){if(n>e){i[t]=n,n=e;var a=x[t];x[t]=r,r=a}}))})),m=x,g=_}for(;g.length<4;)g.push(0),m.push(0);for(var b=0;b<4;++b)l.push(g[b]),c.push(m[b])}if(e.normal){var T=mg(d,n,f,e.normal);o.push(T[0],T[1],T[2])}e.material&&"AllSame"!==e.material.mappingType&&(p=mg(d,n,f,e.material)[0])<0&&(console.warn("THREE.FBXLoader: Invalid material index:",p),p=0),e.uv&&e.uv.forEach((function(e,t){var r=mg(d,n,f,e);void 0===u[t]&&(u[t]=[]),u[t].push(r[0]),u[t].push(r[1])})),r++,v&&(h.genFace(t,e,a,p,o,s,u,l,c,r),n++,r=0,a=[],o=[],s=[],u=[],l=[],c=[])})),t}},{key:"genFace",value:function(e,t,n,r,i,a,o,s,u,l){for(var c=function(l){e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(l-1)]]),e.vertex.push(t.vertexPositions[n[3*(l-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(l-1)+2]]),e.vertex.push(t.vertexPositions[n[3*l]]),e.vertex.push(t.vertexPositions[n[3*l+1]]),e.vertex.push(t.vertexPositions[n[3*l+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(l-1)]),e.vertexWeights.push(s[4*(l-1)+1]),e.vertexWeights.push(s[4*(l-1)+2]),e.vertexWeights.push(s[4*(l-1)+3]),e.vertexWeights.push(s[4*l]),e.vertexWeights.push(s[4*l+1]),e.vertexWeights.push(s[4*l+2]),e.vertexWeights.push(s[4*l+3]),e.weightsIndices.push(u[0]),e.weightsIndices.push(u[1]),e.weightsIndices.push(u[2]),e.weightsIndices.push(u[3]),e.weightsIndices.push(u[4*(l-1)]),e.weightsIndices.push(u[4*(l-1)+1]),e.weightsIndices.push(u[4*(l-1)+2]),e.weightsIndices.push(u[4*(l-1)+3]),e.weightsIndices.push(u[4*l]),e.weightsIndices.push(u[4*l+1]),e.weightsIndices.push(u[4*l+2]),e.weightsIndices.push(u[4*l+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(l-1)]),e.colors.push(a[3*(l-1)+1]),e.colors.push(a[3*(l-1)+2]),e.colors.push(a[3*l]),e.colors.push(a[3*l+1]),e.colors.push(a[3*l+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(i[0]),e.normal.push(i[1]),e.normal.push(i[2]),e.normal.push(i[3*(l-1)]),e.normal.push(i[3*(l-1)+1]),e.normal.push(i[3*(l-1)+2]),e.normal.push(i[3*l]),e.normal.push(i[3*l+1]),e.normal.push(i[3*l+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(o[n][0]),e.uvs[n].push(o[n][1]),e.uvs[n].push(o[n][2*(l-1)]),e.uvs[n].push(o[n][2*(l-1)+1]),e.uvs[n].push(o[n][2*l]),e.uvs[n].push(o[n][2*l+1])}))},h=2;h<l;h++)c(h)}},{key:"addMorphTargets",value:function(e,t,n,r){if(0!==n.length){e.morphTargetsRelative=!0,e.morphAttributes.position=[];var i=this;n.forEach((function(n){n.rawTargets.forEach((function(n){var a=tg.Objects.Geometry[n.geoID];void 0!==a&&i.genMorphGeometry(e,t,a,r,n.name)}))}))}}},{key:"genMorphGeometry",value:function(e,t,n,r,i){for(var a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==n.Vertices?n.Vertices.a:[],s=void 0!==n.Indexes?n.Indexes.a:[],u=3*e.attributes.position.count,l=new Float32Array(u),c=0;c<s.length;c++){var h=3*s[c];l[h]=o[3*c],l[h+1]=o[3*c+1],l[h+2]=o[3*c+2]}var f={vertexIndices:a,vertexPositions:l},d=this.genBuffers(f),p=new ki(d.vertex,3);p.name=i||n.attrName,p.applyMatrix4(r),e.morphAttributes.position.push(p)}},{key:"parseNormals",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a,i=[];return"IndexToDirect"===n&&("NormalIndex"in e?i=e.NormalIndex.a:"NormalsIndex"in e&&(i=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:i,mappingType:t,referenceType:n}}},{key:"parseUVs",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a,i=[];return"IndexToDirect"===n&&(i=e.UVIndex.a),{dataSize:2,buffer:r,indices:i,mappingType:t,referenceType:n}}},{key:"parseVertexColors",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a,i=[];return"IndexToDirect"===n&&(i=e.ColorIndex.a),{dataSize:4,buffer:r,indices:i,mappingType:t,referenceType:n}}},{key:"parseMaterialIndices",value:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var r=e.Materials.a,i=[],a=0;a<r.length;++a)i.push(a);return{dataSize:1,buffer:r,indices:i,mappingType:t,referenceType:n}}},{key:"parseNurbsGeometry",value:function(e){if(void 0===ig)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Oi;var t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Oi;for(var n,r,i=t-1,a=e.KnotVector.a,o=[],s=e.Points.a,u=0,l=s.length;u<l;u+=4)o.push((new er).fromArray(s,u));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){n=i,r=a.length-1-n;for(var c=0;c<i;++c)o.push(o[c])}var h=new ig(i,a,o,n,r).getPoints(12*o.length);return(new Oi).setFromPoints(h)}}]),e}(),ug=function(){function e(){t(this,e)}return a(e,[{key:"parse",value:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var n in t){var r=t[n],i=this.addClip(r);e.push(i)}return e}},{key:"parseClips",value:function(){if(void 0!==tg.Objects.AnimationCurve){var e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);var t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}}},{key:"parseAnimationCurveNodes",value:function(){var e=tg.Objects.AnimationCurveNode,t=new Map;for(var n in e){var r=e[n];if(null!==r.attrName.match(/S|R|T|DeformPercent/)){var i={id:r.id,attr:r.attrName,curves:{}};t.set(i.id,i)}}return t}},{key:"parseAnimationCurves",value:function(e){var t=tg.Objects.AnimationCurve;for(var n in t){var r={id:t[n].id,times:t[n].KeyTime.a.map(pg),values:t[n].KeyValueFloat.a},i=ng.get(r.id);if(void 0!==i){var a=i.parents[0].ID,o=i.parents[0].relationship;o.match(/X/)?e.get(a).curves.x=r:o.match(/Y/)?e.get(a).curves.y=r:o.match(/Z/)?e.get(a).curves.z=r:o.match(/d|DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=r)}}}},{key:"parseAnimationLayers",value:function(e){var t=tg.Objects.AnimationLayer,n=new Map,r=function(t){var r=[],i=ng.get(parseInt(t));void 0!==i&&(i.children.forEach((function(t,n){if(e.has(t.ID)){var i=e.get(t.ID);if(void 0!==i.curves.x||void 0!==i.curves.y||void 0!==i.curves.z){if(void 0===r[n]){var a=ng.get(t.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID;if(void 0!==a){var o=tg.Objects.Model[a.toString()];if(void 0===o)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",t);var s={modelName:o.attrName?Gc.sanitizeNodeName(o.attrName):"",ID:o.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};rg.traverse((function(e){e.ID===o.id&&(s.transform=e.matrix,e.userData.transformData&&(s.eulerOrder=e.userData.transformData.eulerOrder))})),s.transform||(s.transform=new Dr),"PreRotation"in o&&(s.preRotation=o.PreRotation.value),"PostRotation"in o&&(s.postRotation=o.PostRotation.value),r[n]=s}}r[n]&&(r[n][i.attr]=i)}else if(void 0!==i.curves.morph){if(void 0===r[n]){var u=ng.get(t.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,l=ng.get(u).parents[0].ID,c=ng.get(l).parents[0].ID,h=ng.get(c).parents[0].ID,f=tg.Objects.Model[h],d={modelName:f.attrName?Gc.sanitizeNodeName(f.attrName):"",morphName:tg.Objects.Deformer[u].attrName};r[n]=d}r[n][i.attr]=i}}})),n.set(parseInt(t),r))};for(var i in t)r(i);return n}},{key:"parseAnimStacks",value:function(e){var t=tg.Objects.AnimationStack,n={};for(var r in t){var i=ng.get(parseInt(r)).children;i.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var a=e.get(i[0].ID);n[r]={name:t[r].attrName,layer:a}}return n}},{key:"addClip",value:function(e){var t=[],n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new rc(e.name,-1,t)}},{key:"generateTracks",value:function(e){var t=[],n=new ar,r=new ir,i=new ar;if(e.transform&&e.transform.decompose(n,r,i),n=n.toArray(),r=(new qr).setFromQuaternion(r,e.eulerOrder).toArray(),i=i.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var a=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==a&&t.push(a)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var o=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);void 0!==o&&t.push(o)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,i,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var u=this.generateMorphTrack(e);void 0!==u&&t.push(u)}return t}},{key:"generateVectorTrack",value:function(e,t,n,r){var i=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(i,t,n);return new nc(e+"."+r,i,a)}},{key:"generateRotationTrack",value:function(e,t,n,r,i,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(Ln.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(Ln.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(Ln.degToRad));var o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,n);void 0!==r&&((r=r.map(Ln.degToRad)).push(a),r=(new qr).fromArray(r),r=(new ir).setFromEuler(r)),void 0!==i&&((i=i.map(Ln.degToRad)).push(a),i=(new qr).fromArray(i),i=(new ir).setFromEuler(i).invert());for(var u=new ir,l=new qr,c=[],h=0;h<s.length;h+=3)l.set(s[h],s[h+1],s[h+2],a),u.setFromEuler(l),void 0!==r&&u.premultiply(r),void 0!==i&&u.multiply(i),u.toArray(c,h/3*4);return new ec(e+".quaternion",o,c)}},{key:"generateMorphTrack",value:function(e){var t=e.DeformPercent.curves.morph,n=t.values.map((function(e){return e/100})),r=rg.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Ql(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}},{key:"getTimesForAllAxes",value:function(e){var t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort((function(e,t){return e-t}))).length>1){for(var n=1,r=t[0],i=1;i<t.length;i++){var a=t[i];a!==r&&(t[n]=a,r=a,n++)}t=t.slice(0,n)}return t}},{key:"getKeyframeTrackValues",value:function(e,t,n){var r=n,i=[],a=-1,o=-1,s=-1;return e.forEach((function(e){if(t.x&&(a=t.x.times.indexOf(e)),t.y&&(o=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==a){var n=t.x.values[a];i.push(n),r[0]=n}else i.push(r[0]);if(-1!==o){var u=t.y.values[o];i.push(u),r[1]=u}else i.push(r[1]);if(-1!==s){var l=t.z.values[s];i.push(l),r[2]=l}else i.push(r[2])})),i}},{key:"interpolateRotations",value:function(e){for(var t=1;t<e.values.length;t++){var n=e.values[t-1],r=e.values[t]-n,i=Math.abs(r);if(i>=180){for(var a=i/180,o=r/a,s=n+o,u=e.times[t-1],l=(e.times[t]-u)/a,c=u+l,h=[],f=[];c<e.times[t];)h.push(c),c+=l,f.push(s),s+=o;e.times=Mg(e.times,t,h),e.values=Mg(e.values,t,f)}}}}]),e}(),lg=function(){function e(){t(this,e)}return a(e,[{key:"getPrevNode",value:function(){return this.nodeStack[this.currentIndent-2]}},{key:"getCurrentNode",value:function(){return this.nodeStack[this.currentIndent-1]}},{key:"getCurrentProp",value:function(){return this.currentProp}},{key:"pushStack",value:function(e){this.nodeStack.push(e),this.currentIndent+=1}},{key:"popStack",value:function(){this.nodeStack.pop(),this.currentIndent-=1}},{key:"setCurrentProp",value:function(e,t){this.currentProp=e,this.currentPropName=t}},{key:"parse",value:function(e){this.currentIndent=0,this.allNodes=new fg,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,r){var i=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(!i&&!a){var o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,n[++r]):u?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes}},{key:"parseNodeBegin",value:function(e,t){var n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),i={name:n},a=this.parseNodeAttr(r),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,i):n in o?("PoseNode"===n?o.PoseNode.push(i):void 0!==o[n].id&&(o[n]={},o[n][o[n].id]=o[n]),""!==a.id&&(o[n][a.id]=i)):"number"==typeof a.id?(o[n]={},o[n][a.id]=i):"Properties70"!==n&&(o[n]="PoseNode"===n?[i]:i),"number"==typeof a.id&&(i.id=a.id),""!==a.name&&(i.attrName=a.name),""!==a.type&&(i.attrType=a.type),this.pushStack(i)}},{key:"parseNodeAttr",value:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}},{key:"parseNodeProperty",value:function(e,t,n){var r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),i=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===r&&","===i&&(i=n.replace(/"/g,"").replace(/,$/,"").trim());var a=this.getCurrentNode();if("Properties70"!==a.name){if("C"===r){var o=i.split(",").slice(1),s=parseInt(o[0]),u=parseInt(o[1]),l=i.split(",").slice(3);r="connections",function(e,t){for(var n=0,r=e.length,i=t.length;n<i;n++,r++)e[r]=t[n]}(i=[s,u],l=l.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===a[r]&&(a[r]=[])}"Node"===r&&(a.id=i),r in a&&Array.isArray(a[r])?a[r].push(i):"a"!==r?a[r]=i:a.a=i,this.setCurrentProp(a,r),"a"===r&&","!==i.slice(-1)&&(a.a=bg(i))}else this.parseNodeSpecialProperty(e,r,i)}},{key:"parseNodePropertyContinued",value:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=bg(t.a))}},{key:"parseNodeSpecialProperty",value:function(e,t,n){var r=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),i=r[0],a=r[1],o=r[2],s=r[3],u=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=bg(u)}this.getPrevNode()[i]={type:a,type2:o,flag:s,value:u},this.setCurrentProp(this.getPrevNode(),i)}}]),e}(),cg=function(){function n(){t(this,n)}return a(n,[{key:"parse",value:function(e){var t=new hg(e);t.skip(23);var n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);for(var r=new fg;!this.endOfContent(t);){var i=this.parseNode(t,n);null!==i&&r.add(i.name,i)}return r}},{key:"endOfContent",value:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}},{key:"parseNode",value:function(e,t){var n={},r=t>=7500?e.getUint64():e.getUint32(),i=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();var a=e.getUint8(),o=e.getString(a);if(0===r)return null;for(var s=[],u=0;u<i;u++)s.push(this.parseProperty(e));var l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(n.singleProperty=1===i&&e.getOffset()===r;r>e.getOffset();){var f=this.parseNode(e,t);null!==f&&this.parseSubNode(o,n,f)}return n.propertyList=s,"number"==typeof l&&(n.id=l),""!==c&&(n.attrName=c),""!==h&&(n.attrType=h),""!==o&&(n.name=o),n}},{key:"parseSubNode",value:function(e,t,n){if(!0===n.singleProperty){var r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if("Connections"===e&&"C"===n.name){var i=[];n.propertyList.forEach((function(e,t){0!==t&&i.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(i)}else if("Properties70"===n.name){Object.keys(n).forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){var a,o=n.propertyList[0],s=n.propertyList[1],u=n.propertyList[2],l=n.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),a="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[o]={type:s,type2:u,flag:l,value:a}}else void 0===t[n.name]?"number"==typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)}},{key:"parseProperty",value:function(t){var n,r=t.getString(1);switch(r){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return n=t.getUint32(),t.getArrayBuffer(n);case"S":return n=t.getUint32(),t.getString(n);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var i=t.getUint32(),a=t.getUint32(),o=t.getUint32();if(0===a)switch(r){case"b":case"c":return t.getBooleanArray(i);case"d":return t.getFloat64Array(i);case"f":return t.getFloat32Array(i);case"i":return t.getInt32Array(i);case"l":return t.getInt64Array(i)}void 0===e&&console.error("THREE.FBXLoader: External library fflate.min.js required.");var s=gm(new Uint8Array(t.getArrayBuffer(o))),u=new hg(s.buffer);switch(r){case"b":case"c":return u.getBooleanArray(i);case"d":return u.getFloat64Array(i);case"f":return u.getFloat32Array(i);case"i":return u.getInt32Array(i);case"l":return u.getInt64Array(i)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+r)}}}]),n}(),hg=function(){function e(n,r){t(this,e),this.dv=new DataView(n),this.offset=0,this.littleEndian=void 0===r||r}return a(e,[{key:"getOffset",value:function(){return this.offset}},{key:"size",value:function(){return this.dv.buffer.byteLength}},{key:"skip",value:function(e){this.offset+=e}},{key:"getBoolean",value:function(){return 1==(1&this.getUint8())}},{key:"getBooleanArray",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t}},{key:"getUint8",value:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e}},{key:"getInt16",value:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}},{key:"getInt32",value:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}},{key:"getInt32Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt32());return t}},{key:"getUint32",value:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}},{key:"getInt64",value:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e}},{key:"getInt64Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t}},{key:"getUint64",value:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}},{key:"getFloat32",value:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}},{key:"getFloat32Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat32());return t}},{key:"getFloat64",value:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}},{key:"getFloat64Array",value:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat64());return t}},{key:"getArrayBuffer",value:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}},{key:"getString",value:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),Rc.decodeText(new Uint8Array(t))}}]),e}(),fg=function(){function e(){t(this,e)}return a(e,[{key:"add",value:function(e,t){this[e]=t}}]),e}();function dg(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function pg(e){return e/46186158e3}var vg=[];function mg(e,t,n,r){var i;switch(r.mappingType){case"ByPolygonVertex":i=e;break;case"ByPolygon":i=t;break;case"ByVertice":i=n;break;case"AllSame":i=r.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+r.mappingType)}"IndexToDirect"===r.referenceType&&(i=r.indices[i]);var a=i*r.dataSize,o=a+r.dataSize;return function(e,t,n,r){for(var i=n,a=0;i<r;i++,a++)e[a]=t[i];return e}(vg,r.buffer,a,o)}var gg=new qr,yg=new ar;function xg(e){var t=new Dr,n=new Dr,r=new Dr,i=new Dr,a=new Dr,o=new Dr,s=new Dr,u=new Dr,l=new Dr,c=new Dr,h=new Dr,f=new Dr,d=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(yg.fromArray(e.translation)),e.preRotation){var p=e.preRotation.map(Ln.degToRad);p.push(e.eulerOrder||qr.DefaultOrder),n.makeRotationFromEuler(gg.fromArray(p))}if(e.rotation){var v=e.rotation.map(Ln.degToRad);v.push(e.eulerOrder||qr.DefaultOrder),r.makeRotationFromEuler(gg.fromArray(v))}if(e.postRotation){var m=e.postRotation.map(Ln.degToRad);m.push(e.eulerOrder||qr.DefaultOrder),i.makeRotationFromEuler(gg.fromArray(m)),i.invert()}e.scale&&a.scale(yg.fromArray(e.scale)),e.scalingOffset&&s.setPosition(yg.fromArray(e.scalingOffset)),e.scalingPivot&&o.setPosition(yg.fromArray(e.scalingPivot)),e.rotationOffset&&u.setPosition(yg.fromArray(e.rotationOffset)),e.rotationPivot&&l.setPosition(yg.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(h.copy(e.parentMatrix),c.copy(e.parentMatrixWorld));var g=n.clone().multiply(r).multiply(i),y=new Dr;y.extractRotation(c);var x=new Dr;x.copyPosition(c);var _=x.clone().invert().multiply(c),b=y.clone().invert().multiply(_),T=a,M=new Dr;if(0===d)M.copy(y).multiply(g).multiply(b).multiply(T);else if(1===d)M.copy(y).multiply(b).multiply(g).multiply(T);else{var w=(new Dr).scale((new ar).setFromMatrixScale(h)).clone().invert(),S=b.clone().multiply(w);M.copy(y).multiply(g).multiply(S).multiply(T)}var E=l.clone().invert(),k=o.clone().invert(),A=t.clone().multiply(u).multiply(l).multiply(n).multiply(r).multiply(i).multiply(E).multiply(s).multiply(o).multiply(a).multiply(k),C=(new Dr).copyPosition(A),I=c.clone().multiply(C);return f.copyPosition(I),(A=f.clone().multiply(M)).premultiply(c.invert()),A}function _g(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function bg(e){return e.split(",").map((function(e){return parseFloat(e)}))}function Tg(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),Rc.decodeText(new Uint8Array(e,t,n))}function Mg(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}var wg=function(e){Fe(r,e);var n=Ge(r);function r(e){return t(this,r),n.call(this,e)}return a(r,[{key:"load",value:function(e,t,n,r){var i=this,a=""===i.path?Rc.extractUrlBase(e):i.path,o=new hc(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(n,a))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e,t){function n(e,t){for(var n=[],r=e.childNodes,i=0,a=r.length;i<a;i++){var o=r[i];o.nodeName===t&&n.push(o)}return n}function r(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),n=new Array(t.length),r=0,i=t.length;r<i;r++)n[r]=t[r];return n}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),n=new Array(t.length),r=0,i=t.length;r<i;r++)n[r]=parseFloat(t[r]);return n}function a(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),n=new Array(t.length),r=0,i=t.length;r<i;r++)n[r]=parseInt(t[r]);return n}function o(e){return e.substring(1)}function s(e){return 0===Object.keys(e).length}function u(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function l(e){return void 0!==e?e.textContent:"Y_UP"}function c(e,t,r,i){var a=n(e,t)[0];if(void 0!==a)for(var o=n(a,r),s=0;s<o.length;s++)i(o[s])}function h(e,t){for(var n in e){e[n].build=t(e[n])}}function f(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function d(e){for(var t={inputs:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"input"===i.nodeName){var a=o(i.getAttribute("source")),s=i.getAttribute("semantic");t.inputs[s]=a}}return t}function p(e){var t={},n=e.getAttribute("target").split("/"),r=n.shift(),i=n.shift(),a=-1!==i.indexOf("("),s=-1!==i.indexOf(".");if(s)n=i.split("."),i=n.shift(),t.member=n.shift();else if(a){var u=i.split("(");i=u.shift();for(var l=0;l<u.length;l++)u[l]=parseInt(u[l].replace(/\)/,""));t.indices=u}return t.id=r,t.sid=i,t.arraySyntax=a,t.memberSyntax=s,t.sampler=o(e.getAttribute("source")),t}function v(e){var t=[],n=e.channels,r=e.samplers,i=e.sources;for(var a in n)if(n.hasOwnProperty(a)){var o=n[a],s=r[o.sampler],u=s.inputs.INPUT,l=s.inputs.OUTPUT;b(g(o,i[u],i[l]),t)}return t}function m(e){return f(tt.animations[e],v)}function g(e,t,n){var r,i,a,o,s,u,l=tt.nodes[e.id],c=Ue(l.id),h=l.transforms[e.sid],f=l.matrix.clone().transpose(),d={};switch(h){case"matrix":for(a=0,o=t.array.length;a<o;a++)if(r=t.array[a],i=a*n.stride,void 0===d[r]&&(d[r]={}),!0===e.arraySyntax){var p=n.array[i],v=e.indices[0]+4*e.indices[1];d[r][v]=p}else for(s=0,u=n.stride;s<u;s++)d[r][s]=n.array[i+s];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',h)}var m=function(e,t){var n=[];for(var r in e)n.push({time:parseFloat(r),value:e[r]});n.sort(a);for(var i=0;i<16;i++)T(n,i,t.elements[i]);return n;function a(e,t){return e.time-t.time}}(d,f);return{name:c.uuid,keyframes:m}}var y=new ar,x=new ar,_=new ir;function b(e,t){for(var n=e.keyframes,r=e.name,i=[],a=[],o=[],s=[],u=0,l=n.length;u<l;u++){var c=n[u],h=c.time,f=c.value;ke.fromArray(f).transpose(),ke.decompose(y,_,x),i.push(h),a.push(y.x,y.y,y.z),o.push(_.x,_.y,_.z,_.w),s.push(x.x,x.y,x.z)}return a.length>0&&t.push(new nc(r+".position",i,a)),o.length>0&&t.push(new ec(r+".quaternion",i,o)),s.length>0&&t.push(new nc(r+".scale",i,s)),t}function T(e,t,n){var r,i,a,o=!0;for(i=0,a=e.length;i<a;i++)void 0===(r=e[i]).value[t]?r.value[t]=null:o=!1;if(!0===o)for(i=0,a=e.length;i<a;i++)(r=e[i]).value[t]=n;else!function(e,t){for(var n,r,i=0,a=e.length;i<a;i++){var o=e[i];if(null===o.value[t]){if(n=M(e,i,t),r=w(e,i,t),null===n){o.value[t]=r.value[t];continue}if(null===r){o.value[t]=n.value[t];continue}S(o,n,r,t)}}}(e,t)}function M(e,t,n){for(;t>=0;){var r=e[t];if(null!==r.value[n])return r;t--}return null}function w(e,t,n){for(;t<e.length;){var r=e[t];if(null!==r.value[n])return r;t++}return null}function S(e,t,n,r){n.time-t.time!=0?e.value[r]=(e.time-t.time)*(n.value[r]-t.value[r])/(n.time-t.time)+t.value[r]:e.value[r]=t.value[r]}function E(e){for(var t=[],n=e.name,r=e.end-e.start||-1,i=e.animations,a=0,o=i.length;a<o;a++)for(var s=m(i[a]),u=0,l=s.length;u<l;u++)t.push(s[u]);return new rc(n,r,t)}function k(e){return f(tt.clips[e],E)}function A(e){for(var t={sources:{}},n=0,r=e.childNodes.length;n<r;n++){var a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(a.textContent);break;case"source":var o=a.getAttribute("id");t.sources[o]=se(a);break;case"joints":t.joints=C(a);break;case"vertex_weights":t.vertexWeights=I(a)}}return t}function C(e){for(var t={inputs:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"input"===i.nodeName){var a=i.getAttribute("semantic"),s=o(i.getAttribute("source"));t.inputs[a]=s}}return t}function I(e){for(var t={inputs:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var s=i.getAttribute("semantic"),u=o(i.getAttribute("source")),l=parseInt(i.getAttribute("offset"));t.inputs[s]={id:u,offset:l};break;case"vcount":t.vcount=a(i.textContent);break;case"v":t.v=a(i.textContent)}}return t}function R(e){var t={id:e.id},n=tt.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,n,r,i=4,a={joints:[],indices:{array:[],stride:i},weights:{array:[],stride:i}},o=e.sources,s=e.vertexWeights,u=s.vcount,l=s.v,c=s.inputs.JOINT.offset,h=s.inputs.WEIGHT.offset,f=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],p=o[s.inputs.WEIGHT.id].array,v=0;for(t=0,r=u.length;t<r;t++){var m=u[t],g=[];for(n=0;n<m;n++){var y=l[v+c],x=p[l[v+h]];g.push({index:y,weight:x}),v+=2}for(g.sort(M),n=0;n<i;n++){var _=g[n];void 0!==_?(a.indices.array.push(_.index),a.weights.array.push(_.weight)):(a.indices.array.push(0),a.weights.array.push(0))}}e.bindShapeMatrix?a.bindMatrix=(new Dr).fromArray(e.bindShapeMatrix).transpose():a.bindMatrix=(new Dr).identity();for(t=0,r=f.array.length;t<r;t++){var b=f.array[t],T=(new Dr).fromArray(d.array,t*d.stride).transpose();a.joints.push({name:b,boneInverse:T})}return a;function M(e,t){return t.weight-e.weight}}(e.skin),n.sources.skinIndices=t.skin.indices,n.sources.skinWeights=t.skin.weights),t}function L(e){return f(tt.controllers[e],R)}function P(e){return void 0!==e.build?e.build:e.init_from}function N(e){var t=tt.images[e];return void 0!==t?f(t,P):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function O(e){for(var t={surfaces:{},samplers:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"newparam":D(i,t);break;case"technique":t.technique=G(i);break;case"extra":t.extra=j(i)}}return t}function D(e,t){for(var n=e.getAttribute("sid"),r=0,i=e.childNodes.length;r<i;r++){var a=e.childNodes[r];if(1===a.nodeType)switch(a.nodeName){case"surface":t.surfaces[n]=F(a);break;case"sampler2D":t.samplers[n]=U(a)}}}function F(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"init_from"===i.nodeName)t.init_from=i.textContent}return t}function U(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"source"===i.nodeName)t.source=i.textContent}return t}function G(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=i.nodeName,t.parameters=z(i);break;case"extra":t.extra=j(i)}}return t}function z(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[i.nodeName]=V(i);break;case"transparent":t[i.nodeName]={opaque:i.hasAttribute("opaque")?i.getAttribute("opaque"):"A_ONE",data:V(i)}}}return t}function V(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"color":t[a.nodeName]=i(a.textContent);break;case"float":t[a.nodeName]=parseFloat(a.textContent);break;case"texture":t[a.nodeName]={id:a.getAttribute("texture"),extra:B(a)}}}return t}function B(e){for(var t={technique:{}},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"extra"===i.nodeName)W(i,t)}return t}function W(e,t){for(var n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"technique"===i.nodeName)H(i,t)}}function H(e,t){for(var n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":"TRUE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=1:"FALSE"===i.textContent.toUpperCase()?t.technique[i.nodeName]=0:t.technique[i.nodeName]=parseInt(i.textContent);break;case"bump":t[i.nodeName]=X(i)}}}function j(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"technique"===i.nodeName)t.technique=q(i)}return t}function q(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"double_sided":t[i.nodeName]=parseInt(i.textContent);break;case"bump":t[i.nodeName]=X(i)}}return t}function X(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"texture"===i.nodeName)t[i.nodeName]={id:i.getAttribute("texture"),texcoord:i.getAttribute("texcoord"),extra:B(i)}}return t}function Y(e){return e}function K(e){var t,n=e.slice(2+(e.lastIndexOf(".")-1>>>0));if("tga"===(n=n.toLowerCase()))t=Ye;else t=Ze;return t}function Z(e){var t,n=function(e){return f(tt.effects[e],Y)}(e.url),r=n.profile.technique;switch(r.type){case"phong":case"blinn":t=new Fl;break;case"lambert":t=new Ul;break;default:t=new bi}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=n.profile.samplers[e.id],i=null;if(void 0!==r){var a=n.profile.surfaces[r.source];i=N(a.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),i=N(e.id);if(null!==i){var o=K(i);if(void 0!==o){var u=o.load(i),l=e.extra;if(void 0!==l&&void 0!==l.technique&&!1===s(l.technique)){var c=l.technique;u.wrapS=c.wrapU?pt:vt,u.wrapT=c.wrapV?pt:vt,u.offset.set(c.offsetU||0,c.offsetV||0),u.repeat.set(c.repeatU||1,c.repeatV||1)}else u.wrapS=pt,u.wrapT=pt;return null!==t&&(u.encoding=t),u}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",i),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",e.id),null}t.name=e.name||"";var a=r.parameters;for(var o in a){var u=a[o];switch(o){case"diffuse":u.color&&t.color.fromArray(u.color),u.texture&&(t.map=i(u.texture,hn));break;case"specular":u.color&&t.specular&&t.specular.fromArray(u.color),u.texture&&(t.specularMap=i(u.texture));break;case"bump":u.texture&&(t.normalMap=i(u.texture));break;case"ambient":u.texture&&(t.lightMap=i(u.texture,hn));break;case"shininess":u.float&&t.shininess&&(t.shininess=u.float);break;case"emission":u.color&&t.emissive&&t.emissive.fromArray(u.color),u.texture&&(t.emissiveMap=i(u.texture,hn))}}t.color.convertSRGBToLinear(),t.specular&&t.specular.convertSRGBToLinear(),t.emissive&&t.emissive.convertSRGBToLinear();var l=a.transparent,c=a.transparency;if(void 0===c&&l&&(c={float:1}),void 0===l&&c&&(l={opaque:"A_ONE",data:{color:[1,1,1,1]}}),l&&c)if(l.data.texture)t.transparent=!0;else{var h=l.data.color;switch(l.opaque){case"A_ONE":t.opacity=h[3]*c.float;break;case"RGB_ZERO":t.opacity=1-h[0]*c.float;break;case"A_ZERO":t.opacity=1-h[3]*c.float;break;case"RGB_ONE":t.opacity=h[0]*c.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',l.opaque)}t.opacity<1&&(t.transparent=!0)}if(void 0!==r.extra&&void 0!==r.extra.technique){var d=r.extra.technique;for(var p in d){var v=d[p];switch(p){case"double_sided":t.side=1===v?2:0;break;case"bump":t.normalMap=i(v.texture),t.normalScale=new Pn(1,1)}}}return t}function J(e){return f(tt.materials[e],Z)}function Q(e){for(var t=0;t<e.childNodes.length;t++){var n=e.childNodes[t];if("technique_common"===n.nodeName)return $(n)}return{}}function $(e){for(var t={},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];switch(r.nodeName){case"perspective":case"orthographic":t.technique=r.nodeName,t.parameters=ee(r)}}return t}function ee(e){for(var t={},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[r.nodeName]=parseFloat(r.textContent)}}return t}function te(e){var t;switch(e.optics.technique){case"perspective":t=new sa(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var n=e.optics.parameters.ymag,r=e.optics.parameters.xmag,i=e.optics.parameters.aspect_ratio;r=void 0===r?n*i:r,n=void 0===n?r/i:n,t=new Ra(-(r*=.5),r,n*=.5,-n,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new sa}return t.name=e.name||"",t}function ne(e){var t=tt.cameras[e];return void 0!==t?f(t,te):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function re(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=i.nodeName,t.parameters=ie(i)}}return t}function ie(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var a=e.childNodes[n];if(1===a.nodeType)switch(a.nodeName){case"color":var o=i(a.textContent);t.color=(new Yn).fromArray(o).convertSRGBToLinear();break;case"falloff_angle":t.falloffAngle=parseFloat(a.textContent);break;case"quadratic_attenuation":var s=parseFloat(a.textContent);t.distance=s?Math.sqrt(1/s):0}}return t}function ae(e){var t;switch(e.technique){case"directional":t=new Cc;break;case"point":t=new kc;break;case"spot":t=new Tc;break;case"ambient":t=new Ic}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function oe(e){var t=tt.lights[e];return void 0!==t?f(t,ae):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function se(e){for(var t={array:[],stride:3},a=0;a<e.childNodes.length;a++){var o=e.childNodes[a];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=i(o.textContent);break;case"Name_array":t.array=r(o.textContent);break;case"technique_common":var s=n(o,"accessor")[0];void 0!==s&&(t.stride=parseInt(s.getAttribute("stride")))}}return t}function ue(e){for(var t={},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];1===r.nodeType&&(t[r.getAttribute("semantic")]=o(r.getAttribute("source")))}return t}function le(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"input":var s=o(i.getAttribute("source")),u=i.getAttribute("semantic"),l=parseInt(i.getAttribute("offset")),c=parseInt(i.getAttribute("set")),h=c>0?u+c:u;t.inputs[h]={id:s,offset:l},t.stride=Math.max(t.stride,l+1),"TEXCOORD"===u&&(t.hasUV=!0);break;case"vcount":t.vcount=a(i.textContent);break;case"p":t.p=a(i.textContent)}}return t}function ce(e){for(var t=0,n=0,r=e.length;n<r;n++){!0===e[n].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function he(e){var t={},n=e.sources,r=e.vertices,i=e.primitives;if(0===i.length)return{};var a=function(e){for(var t={},n=0;n<e.length;n++){var r=e[n];void 0===t[r.type]&&(t[r.type]=[]),t[r.type].push(r)}return t}(i);for(var o in a){var s=a[o];ce(s),t[o]=fe(s,n,r)}return t}function fe(e,t,n){for(var r={},i={array:[],stride:0},a={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},u={array:[],stride:0},l=[],c=4,h=[],f=4,d=new Oi,p=[],v=0,m=0;m<e.length;m++){var g=e[m],y=g.inputs,x=0;switch(g.type){case"lines":case"linestrips":x=2*g.count;break;case"triangles":x=3*g.count;break;case"polylist":for(var _=0;_<g.count;_++){var b=g.vcount[_];switch(b){case 3:x+=3;break;case 4:x+=6;break;default:x+=3*(b-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",g.type)}for(var T in d.addGroup(v,x,m),v+=x,g.material&&p.push(g.material),y){var M=y[T];switch(T){case"VERTEX":for(var w in n){var S=n[w];switch(w){case"POSITION":var E=i.array.length;if(de(g,t[S],M.offset,i.array),i.stride=t[S].stride,t.skinWeights&&t.skinIndices&&(de(g,t.skinIndices,M.offset,l),de(g,t.skinWeights,M.offset,h)),!1===g.hasUV&&!0===e.uvsNeedsFix)for(var k=(i.array.length-E)/i.stride,A=0;A<k;A++)o.array.push(0,0);break;case"NORMAL":de(g,t[S],M.offset,a.array),a.stride=t[S].stride;break;case"COLOR":de(g,t[S],M.offset,u.array),u.stride=t[S].stride;break;case"TEXCOORD":de(g,t[S],M.offset,o.array),o.stride=t[S].stride;break;case"TEXCOORD1":de(g,t[S],M.offset,s.array),o.stride=t[S].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',w)}}break;case"NORMAL":de(g,t[M.id],M.offset,a.array),a.stride=t[M.id].stride;break;case"COLOR":de(g,t[M.id],M.offset,u.array,!0),u.stride=t[M.id].stride;break;case"TEXCOORD":de(g,t[M.id],M.offset,o.array),o.stride=t[M.id].stride;break;case"TEXCOORD1":de(g,t[M.id],M.offset,s.array),s.stride=t[M.id].stride}}}return i.array.length>0&&d.setAttribute("position",new ki(i.array,i.stride)),a.array.length>0&&d.setAttribute("normal",new ki(a.array,a.stride)),u.array.length>0&&d.setAttribute("color",new ki(u.array,u.stride)),o.array.length>0&&d.setAttribute("uv",new ki(o.array,o.stride)),s.array.length>0&&d.setAttribute("uv2",new ki(s.array,s.stride)),l.length>0&&d.setAttribute("skinIndex",new ki(l,c)),h.length>0&&d.setAttribute("skinWeight",new ki(h,f)),r.data=d,r.type=e[0].type,r.materialKeys=p,r}function de(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=e.p,o=e.stride,s=e.vcount;function u(e){for(var t=a[e+n]*c,o=t+c;t<o;t++)r.push(l[t]);if(i){var s=r.length-c-1;Je.setRGB(r[s+0],r[s+1],r[s+2]).convertSRGBToLinear(),r[s+0]=Je.r,r[s+1]=Je.g,r[s+2]=Je.b}}var l=t.array,c=t.stride;if(void 0!==e.vcount)for(var h=0,f=0,d=s.length;f<d;f++){var p=s[f];if(4===p){var v=h+0*o,m=h+1*o,g=h+2*o,y=h+3*o;u(v),u(m),u(y),u(m),u(g),u(y)}else if(3===p){var x=h+0*o,_=h+1*o,b=h+2*o;u(x),u(_),u(b)}else if(p>4)for(var T=1,M=p-2;T<=M;T++){var w=h+0*o,S=h+o*T,E=h+o*(T+1);u(w),u(S),u(E)}h+=o*p}else for(var k=0,A=a.length;k<A;k+=o)u(k)}function pe(e){return f(tt.geometries[e],he)}function ve(e){return void 0!==e.build?e.build:e}function me(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"joint":t.joints[r.getAttribute("sid")]=ge(r);break;case"link":t.links.push(xe(r))}}}function ge(e){for(var t,n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":t=ye(r)}}return t}function ye(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new ar,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"axis":var a=i(r.textContent);t.axis.fromArray(a);break;case"limits":var o=r.getElementsByTagName("max")[0],s=r.getElementsByTagName("min")[0];t.limits.max=parseFloat(o.textContent),t.limits.min=parseFloat(s.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function xe(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":t.attachments.push(_e(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(r))}}return t}function _e(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"link":t.links.push(xe(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(be(r))}}return t}function be(e){var t={type:e.nodeName},n=i(e.textContent);switch(t.type){case"matrix":t.obj=new Dr,t.obj.fromArray(n).transpose();break;case"translate":t.obj=new ar,t.obj.fromArray(n);break;case"rotate":t.obj=new ar,t.obj.fromArray(n),t.angle=Ln.degToRad(n[3])}return t}function Te(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType&&"technique_common"===r.nodeName)Me(r,t)}}function Me(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType)switch(r.nodeName){case"inertia":t.inertia=i(r.textContent);break;case"mass":t.mass=i(r.textContent)[0]}}}function we(e){for(var t={target:e.getAttribute("target").split("/").pop()},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType&&"axis"===r.nodeName){var i=r.getElementsByTagName("param")[0];t.axis=i.textContent;var a=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=a.substring(0,a.length-1)}}return t}function Se(e){return void 0!==e.build?e.build:e}function Ee(e){for(var t=[],n=We.querySelector('[id="'+e.id+'"]'),r=0;r<n.childNodes.length;r++){var a=n.childNodes[r];if(1===a.nodeType){var o=void 0,s=void 0;switch(a.nodeName){case"matrix":o=i(a.textContent);var u=(new Dr).fromArray(o).transpose();t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:u});break;case"translate":case"scale":o=i(a.textContent),s=(new ar).fromArray(o),t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:s});break;case"rotate":o=i(a.textContent),s=(new ar).fromArray(o);var l=Ln.degToRad(o[3]);t.push({sid:a.getAttribute("sid"),type:a.nodeName,obj:s,angle:l})}}}return t}var ke=new Dr,Ae=new ar;function Ce(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new Dr,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType){var a=void 0;switch(r.nodeName){case"node":t.nodes.push(r.getAttribute("id")),Ce(r);break;case"instance_camera":t.instanceCameras.push(o(r.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(Ie(r));break;case"instance_light":t.instanceLights.push(o(r.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(Ie(r));break;case"instance_node":t.instanceNodes.push(o(r.getAttribute("url")));break;case"matrix":a=i(r.textContent),t.matrix.multiply(ke.fromArray(a).transpose()),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":a=i(r.textContent),Ae.fromArray(a),t.matrix.multiply(ke.makeTranslation(Ae.x,Ae.y,Ae.z)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":a=i(r.textContent);var s=Ln.degToRad(a[3]);t.matrix.multiply(ke.makeRotationAxis(Ae.fromArray(a),s)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":a=i(r.textContent),t.matrix.scale(Ae.fromArray(a)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}}return Fe(t.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",t.id):tt.nodes[t.id]=t,t}function Ie(e){for(var t={id:o(e.getAttribute("url")),materials:{},skeletons:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];switch(r.nodeName){case"bind_material":for(var i=r.getElementsByTagName("instance_material"),a=0;a<i.length;a++){var s=i[a],u=s.getAttribute("symbol"),l=s.getAttribute("target");t.materials[u]=o(l)}break;case"skeleton":t.skeletons.push(o(r.textContent))}}return t}function Re(e,t){var n,r,i,a=[],o=[];for(n=0;n<e.length;n++){var s=e[n];if(Fe(s))Le(Ue(s),t,a);else if(ze(s))for(var u=tt.visualScenes[s].children,l=0;l<u.length;l++){var c=u[l];if("JOINT"===c.type)Le(Ue(c.id),t,a)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",s)}for(n=0;n<t.length;n++)for(r=0;r<a.length;r++)if((i=a[r]).bone.name===t[n].name){o[n]=i,i.processed=!0;break}for(n=0;n<a.length;n++)!1===(i=a[n]).processed&&(o.push(i),i.processed=!0);var h=[],f=[];for(n=0;n<o.length;n++)i=o[n],h.push(i.bone),f.push(i.boneInverse);return new cu(h,f)}function Le(e,t,n){e.traverse((function(e){if(!0===e.isBone){for(var r,i=0;i<t.length;i++){var a=t[i];if(a.name===e.name){r=a.boneInverse;break}}void 0===r&&(r=new Dr),n.push({bone:e,boneInverse:r,processed:!1})}}))}function Pe(e){for(var t,n=[],r=e.matrix,i=e.nodes,a=e.type,o=e.instanceCameras,s=e.instanceControllers,u=e.instanceLights,l=e.instanceGeometries,c=e.instanceNodes,h=0,f=i.length;h<f;h++)n.push(Ue(i[h]));for(var d=0,p=o.length;d<p;d++){var v=ne(o[d]);null!==v&&n.push(v.clone())}for(var m=0,g=s.length;m<g;m++)for(var y=s[m],x=L(y.id),_=De(pe(x.id),y.materials),b=Re(y.skeletons,x.skin.joints),T=0,M=_.length;T<M;T++){var w=_[T];w.isSkinnedMesh&&(w.bind(b,x.skin.bindMatrix),w.normalizeSkinWeights()),n.push(w)}for(var S=0,E=u.length;S<E;S++){var k=oe(u[S]);null!==k&&n.push(k.clone())}for(var A=0,C=l.length;A<C;A++)for(var I=l[A],R=De(pe(I.id),I.materials),P=0,N=R.length;P<N;P++)n.push(R[P]);for(var O=0,D=c.length;O<D;O++)n.push(Ue(c[O]).clone());if(0===i.length&&1===n.length)t=n[0];else{t="JOINT"===a?new ou:new Ws;for(var F=0;F<n.length;F++)t.add(n[F])}return t.name="JOINT"===a?e.sid:e.name,t.matrix.copy(r),t.matrix.decompose(t.position,t.quaternion,t.scale),t}var Ne=new bi({color:16711935});function Oe(e,t){for(var n=[],r=0,i=e.length;r<i;r++){var a=t[e[r]];void 0===a?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[r]),n.push(Ne)):n.push(J(a))}return n}function De(e,t){var n=[];for(var r in e){var i=e[r],a=Oe(i.materialKeys,t);0===a.length&&("lines"===r||"linestrips"===r?a.push(new hu):a.push(new Fl));var o=void 0!==i.data.attributes.skinIndex,s=1===a.length?a[0]:a,u=void 0;switch(r){case"lines":u=new _u(i.data,s);break;case"linestrips":u=new gu(i.data,s);break;case"triangles":case"polylist":u=o?new au(i.data,s):new $i(i.data,s)}n.push(u)}return n}function Fe(e){return void 0!==tt.nodes[e]}function Ue(e){return f(tt.nodes[e],Pe)}function Ge(e){var t=new Ws;t.name=e.name;for(var n=e.children,r=0;r<n.length;r++){var i=n[r];t.add(Ue(i.id))}return t}function ze(e){return void 0!==tt.visualScenes[e]}function Ve(e){return f(tt.visualScenes[e],Ge)}if(0===e.length)return{scene:new $s};var Be=(new DOMParser).parseFromString(e,"application/xml"),We=n(Be,"COLLADA")[0],He=Be.getElementsByTagName("parsererror")[0];if(void 0!==He){var je,qe=n(He,"div")[0];return je=qe?qe.textContent:function(e){for(var t="",n=[e];n.length;){var r=n.shift();r.nodeType===Node.TEXT_NODE?t+=r.textContent:(t+="\n",n.push.apply(n,r.childNodes))}return t.trim()}(He),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",je),null}var Xe=We.getAttribute("version");console.log("THREE.ColladaLoader: File version",Xe);var Ye,Ke=function(e){return{unit:u(n(e,"unit")[0]),upAxis:l(n(e,"up_axis")[0])}}(n(We,"asset")[0]),Ze=new vc(this.manager);Ze.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),kp&&(Ye=new kp(this.manager)).setPath(this.resourcePath||t);var Je=new Yn,Qe=[],$e={},et=0,tt={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};c(We,"library_animations","animation",(function e(t){for(var n={sources:{},samplers:{},channels:{}},r=!1,i=0,a=t.childNodes.length;i<a;i++){var o=t.childNodes[i];if(1===o.nodeType){var s=void 0;switch(o.nodeName){case"source":s=o.getAttribute("id"),n.sources[s]=se(o);break;case"sampler":s=o.getAttribute("id"),n.samplers[s]=d(o);break;case"channel":s=o.getAttribute("target"),n.channels[s]=p(o);break;case"animation":e(o),r=!0;break;default:console.log(o)}}}!1===r&&(tt.animations[t.getAttribute("id")||Ln.generateUUID()]=n)})),c(We,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"instance_animation"===i.nodeName)t.animations.push(o(i.getAttribute("url")))}tt.clips[e.getAttribute("id")]=t})),c(We,"library_controllers","controller",(function(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType)switch(i.nodeName){case"skin":t.id=o(i.getAttribute("source")),t.skin=A(i);break;case"morph":t.id=o(i.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}tt.controllers[e.getAttribute("id")]=t})),c(We,"library_images","image",(function(e){var t={init_from:n(e,"init_from")[0].textContent};tt.images[e.getAttribute("id")]=t})),c(We,"library_effects","effect",(function(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"profile_COMMON"===i.nodeName)t.profile=O(i)}tt.effects[e.getAttribute("id")]=t})),c(We,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"instance_effect"===i.nodeName)t.url=o(i.getAttribute("url"))}tt.materials[e.getAttribute("id")]=t})),c(We,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"optics"===i.nodeName)t.optics=Q(i)}tt.cameras[e.getAttribute("id")]=t})),c(We,"library_lights","light",(function(e){for(var t={},n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(1===i.nodeType&&"technique_common"===i.nodeName)t=re(i)}tt.lights[e.getAttribute("id")]=t})),c(We,"library_geometries","geometry",(function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=n(e,"mesh")[0];if(void 0!==r){for(var i=0;i<r.childNodes.length;i++){var a=r.childNodes[i];if(1===a.nodeType){var o=a.getAttribute("id");switch(a.nodeName){case"source":t.sources[o]=se(a);break;case"vertices":t.vertices=ue(a);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",a.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(le(a));break;default:console.log(a)}}}tt.geometries[e.getAttribute("id")]=t}})),c(We,"library_nodes","node",Ce),c(We,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),n=0;n<t.length;n++){var r=t[n];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+et++)}}(e);for(var r=n(e,"node"),i=0;i<r.length;i++)t.children.push(Ce(r[i]));tt.visualScenes[e.getAttribute("id")]=t})),c(We,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType&&"technique_common"===r.nodeName)me(r,t)}tt.kinematicsModels[e.getAttribute("id")]=t})),c(We,"library_physics_models","physics_model",(function(e){for(var t={name:e.getAttribute("name")||"",rigidBodies:{}},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType&&"rigid_body"===r.nodeName)t.rigidBodies[r.getAttribute("name")]={},Te(r,t.rigidBodies[r.getAttribute("name")])}tt.physicsModels[e.getAttribute("id")]=t})),c(We,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType&&"bind_joint_axis"===r.nodeName)t.bindJointAxis.push(we(r))}tt.kinematicsScenes[o(e.getAttribute("url"))]=t})),h(tt.animations,v),h(tt.clips,E),h(tt.controllers,R),h(tt.images,P),h(tt.effects,Y),h(tt.materials,Z),h(tt.cameras,te),h(tt.lights,ae),h(tt.geometries,he),h(tt.visualScenes,Ge),function(){var e=tt.clips;if(!0===s(e)){if(!1===s(tt.animations)){var t=[];for(var n in tt.animations)for(var r=m(n),i=0,a=r.length;i<a;i++)t.push(r[i]);Qe.push(new rc("default",-1,t))}}else for(var o in e)Qe.push(k(o))}(),function(){var e=Object.keys(tt.kinematicsModels)[0],t=Object.keys(tt.kinematicsScenes)[0],n=Object.keys(tt.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var r=function(e){return f(tt.kinematicsModels[e],ve)}(e),i=function(e){return f(tt.kinematicsScenes[e],Se)}(t),a=Ve(n),o=i.bindJointAxis,s={},u=0,l=o.length;u<l;u++){var c=o[u],h=We.querySelector('[sid="'+c.target+'"]');if(h){var d=h.parentElement;v(c.jointIndex,d)}}var p=new Dr;$e={joints:r&&r.joints,getJointValue:function(e){var t=s[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var n=s[e];if(n){var r=n.joint;if(t>r.limits.max||t<r.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+").");else if(r.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var i=n.object,a=r.axis,o=n.transforms;ke.identity();for(var u=0;u<o.length;u++){var l=o[u];if(l.sid&&-1!==l.sid.indexOf(e))switch(r.type){case"revolute":ke.multiply(p.makeRotationAxis(a,Ln.degToRad(t)));break;case"prismatic":ke.multiply(p.makeTranslation(a.x*t,a.y*t,a.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+r.type)}else switch(l.type){case"matrix":ke.multiply(l.obj);break;case"translate":ke.multiply(p.makeTranslation(l.obj.x,l.obj.y,l.obj.z));break;case"scale":ke.scale(l.obj);break;case"rotate":ke.multiply(p.makeRotationAxis(l.obj,l.angle))}}i.matrix.copy(ke),i.matrix.decompose(i.position,i.quaternion,i.scale),s[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function v(e,t){var n=t.getAttribute("name"),i=r.joints[e];a.traverse((function(r){r.name===n&&(s[e]={object:r,transforms:Ee(t),joint:i,position:i.zeroPosition})}))}}();var nt=function(e){return Ve(o(n(e,"instance_visual_scene")[0].getAttribute("url")))}(n(We,"scene")[0]);return nt.animations=Qe,"Z_UP"===Ke.upAxis&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),nt.quaternion.setFromEuler(new qr(-Math.PI/2,0,0))),nt.scale.multiplyScalar(Ke.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Qe},kinematics:$e,library:tt,scene:nt}}}]),r}(uc),Sg=n(798),Eg=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;if(t(this,r),i=n.call(this,e),void 0===Sg.Z)throw Error("THREE.VRMLLoader: External library chevrotain.min.js required.");return i}return a(r,[{key:"load",value:function(e,t,n,r){var i=this,a=""===i.path?Rc.extractUrlBase(e):i.path,o=new hc(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(n,a))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e,n){var r={};function i(e){e.DEF&&(r[e.DEF]=e);for(var t=e.fields,n=0,a=t.length;n<a;n++){var o=t[n];if("node"===o.type)for(var s=o.values,u=0,l=s.length;u<l;u++)i(s[u])}}function o(e){return e.USE?(t=e.USE,(n=o(r[t])).isObject3D||n.isMaterial?n.clone():n):(void 0!==e.build||(e.build=function(e){var t,n=e.name;switch(n){case"Anchor":case"Group":case"Transform":case"Collision":t=function(e){for(var t=new Ws,n=e.fields,r=0,i=n.length;r<i;r++){var a=n[r],o=a.name,s=a.values;switch(o){case"bboxCenter":case"bboxSize":case"center":case"description":case"collide":case"parameter":case"scaleOrientation":case"proxy":case"url":break;case"children":l(s,t);break;case"rotation":var u=new ar(s[0],s[1],s[2]),c=s[3];t.quaternion.setFromAxisAngle(u,c);break;case"scale":t.scale.set(s[0],s[1],s[2]);break;case"translation":t.position.set(s[0],s[1],s[2]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"Background":t=function(e){for(var t,n,r,i,a=new Ws,o=e.fields,s=0,u=o.length;s<u;s++){var l=o[s],c=l.name,h=l.values;switch(c){case"groundAngle":t=h;break;case"groundColor":n=h;break;case"backUrl":case"bottomUrl":case"frontUrl":case"leftUrl":case"rightUrl":case"topUrl":break;case"skyAngle":r=h;break;case"skyColor":i=h;break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}var f=1e4;if(i){var d=new Ol(f,32,16),p=new bi({fog:!1,side:1,depthWrite:!1,depthTest:!1});i.length>3?(I(d,f,r,C(i),!0),p.vertexColors=!0):p.color.setRGB(i[0],i[1],i[2]);var v=new $i(d,p);a.add(v)}if(n&&n.length>0){var m=new Ol(f,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),g=new bi({fog:!1,side:1,vertexColors:!0,depthWrite:!1,depthTest:!1});I(m,f,t,C(n),!1);var y=new $i(m,g);a.add(y)}return a.renderOrder=-1/0,a}(e);break;case"Shape":t=function(e){for(var t,n,r=e.fields,i=new bi({color:0}),a=0,s=r.length;a<s;a++){var u=r[a],l=u.name,c=u.values;switch(l){case"appearance":null!==c[0]&&(i=o(c[0]));break;case"geometry":null!==c[0]&&(t=o(c[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",l)}}if(t&&t.attributes.position){var h=t._type;if("points"===h){var f=new bu({color:16777215});void 0!==t.attributes.color?f.vertexColors=!0:i.isMeshPhongMaterial&&f.color.copy(i.emissive),n=new Eu(t,f)}else if("line"===h){var d=new hu({color:16777215});void 0!==t.attributes.color?d.vertexColors=!0:i.isMeshPhongMaterial&&d.color.copy(i.emissive),n=new _u(t,d)}else void 0!==t._solid&&(i.side=t._solid?0:2),void 0!==t.attributes.color&&(i.vertexColors=!0),n=new $i(t,i)}else(n=new si).visible=!1;return n}(e);break;case"Appearance":t=function(e){for(var t,n=new Fl,r=e.fields,i=0,a=r.length;i<a;i++){var s=r[i],u=s.name,l=s.values;switch(u){case"material":if(null!==l[0]){var c=o(l[0]);c.diffuseColor&&n.color.copy(c.diffuseColor),c.emissiveColor&&n.emissive.copy(c.emissiveColor),c.shininess&&(n.shininess=c.shininess),c.specularColor&&n.specular.copy(c.specularColor),c.transparency&&(n.opacity=1-c.transparency),c.transparency>0&&(n.transparent=!0)}else n=new bi({color:0});break;case"texture":var h=l[0];null!==h&&("ImageTexture"!==h.name&&"PixelTexture"!==h.name||(n.map=o(h)));break;case"textureTransform":null!==l[0]&&(t=o(l[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}if(n.map){if(n.map.__type){switch(n.map.__type){case Ig.INTENSITY_ALPHA:n.opacity=1;break;case Ig.RGB:n.color.set(16777215);break;case Ig.RGBA:n.color.set(16777215),n.opacity=1}delete n.map.__type}t&&(n.map.center.copy(t.center),n.map.rotation=t.rotation,n.map.repeat.copy(t.scale),n.map.offset.copy(t.translation))}return n}(e);break;case"Material":t=function(e){for(var t={},n=e.fields,r=0,i=n.length;r<i;r++){var a=n[r],o=a.name,s=a.values;switch(o){case"ambientIntensity":break;case"diffuseColor":t.diffuseColor=new Yn(s[0],s[1],s[2]);break;case"emissiveColor":case"specularColor":t.emissiveColor=new Yn(s[0],s[1],s[2]);break;case"shininess":t.shininess=s[0];break;case"transparency":t.transparency=s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"ImageTexture":t=function(e){for(var t,n=pt,r=pt,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],u=s.name,l=s.values;switch(u){case"url":var c=l[0];c&&(t=R.load(c));break;case"repeatS":!1===l[0]&&(n=vt);break;case"repeatT":!1===l[0]&&(r=vt);break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}t&&(t.wrapS=n,t.wrapT=r);return t}(e);break;case"PixelTexture":t=function(e){for(var t,n=pt,r=pt,i=e.fields,a=0,o=i.length;a<o;a++){var l=i[a],c=l.name,h=l.values;switch(c){case"image":for(var f=h[0],d=h[1],p=u(h[2]),v=new Uint8Array(4*f*d),m={r:0,g:0,b:0,a:0},g=3,y=0,x=h.length;g<x;g++,y++){s(h[g],p,m);var _=4*y;v[_+0]=m.r,v[_+1]=m.g,v[_+2]=m.b,v[_+3]=m.a}(t=new su(v,f,d)).needsUpdate=!0,t.__type=p;break;case"repeatS":!1===h[0]&&(n=vt);break;case"repeatT":!1===h[0]&&(r=vt);break;default:console.warn("THREE.VRMLLoader: Unknown field:",c)}}t&&(t.wrapS=n,t.wrapT=r);return t}(e);break;case"TextureTransform":t=function(e){for(var t={center:new Pn,rotation:new Pn,scale:new Pn,translation:new Pn},n=e.fields,r=0,i=n.length;r<i;r++){var a=n[r],o=a.name,s=a.values;switch(o){case"center":t.center.set(s[0],s[1]);break;case"rotation":t.rotation=s[0];break;case"scale":t.scale.set(s[0],s[1]);break;case"translation":t.translation.set(s[0],s[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"IndexedFaceSet":t=function(e){for(var t,n,r,i,a,s,u,l,d=!0,p=!0,v=0,m=!0,g=!0,y=e.fields,x=0,_=y.length;x<_;x++){var M=y[x],S=M.name,E=M.values;switch(S){case"color":var A=E[0];null!==A&&(t=o(A));break;case"coord":var C=E[0];null!==C&&(n=o(C));break;case"normal":var I=E[0];null!==I&&(r=o(I));break;case"texCoord":var R=E[0];null!==R&&(i=o(R));break;case"ccw":d=E[0];break;case"colorIndex":a=E;break;case"colorPerVertex":m=E[0];break;case"convex":break;case"coordIndex":s=E;break;case"creaseAngle":v=E[0];break;case"normalIndex":u=E;break;case"normalPerVertex":g=E[0];break;case"solid":p=E[0];break;case"texCoordIndex":l=E;break;default:console.warn("THREE.VRMLLoader: Unknown field:",S)}}if(void 0===s)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new Oi;var L,P,N,O=c(s,d);if(t){if(!0===m)if(a&&a.length>0)L=b(O,c(a,d),t,3);else L=w(O,new ki(t,3));else if(a&&a.length>0)L=T(O,h(f(t,a),s));else L=T(O,h(t,s))}if(r){if(!0===g)if(u&&u.length>0)P=b(O,c(u,d),r,3);else P=w(O,new ki(r,3));else if(u&&u.length>0)P=T(O,h(f(r,u),s));else P=T(O,h(r,s))}else P=k(O,n,v);if(i){if(l&&l.length>0)N=b(O,c(l,d),i,2);else N=w(O,new ki(i,2))}var D=new Oi,F=w(O,new ki(n,3));D.setAttribute("position",F),D.setAttribute("normal",P),L&&D.setAttribute("color",L);N&&D.setAttribute("uv",N);return D._solid=p,D._type="mesh",D}(e);break;case"IndexedLineSet":t=function(e){for(var t,n,r,i,a,s=!0,u=e.fields,l=0,c=u.length;l<c;l++){var h=u[l],v=h.name,m=h.values;switch(v){case"color":var g=m[0];null!==g&&(t=o(g));break;case"coord":var y=m[0];null!==y&&(n=o(y));break;case"colorIndex":r=m;break;case"colorPerVertex":s=m[0];break;case"coordIndex":i=m;break;default:console.warn("THREE.VRMLLoader: Unknown field:",v)}}var x=d(i);if(t){if(!0===s)if(r.length>0)a=b(x,d(r),t,3);else a=w(x,new ki(t,3));else if(r.length>0)a=M(x,p(f(t,r),i));else a=M(x,p(t,i))}var _=new Oi,T=w(x,new ki(n,3));_.setAttribute("position",T),a&&_.setAttribute("color",a);return _._type="line",_}(e);break;case"PointSet":t=function(e){for(var t,n,r=e.fields,i=0,a=r.length;i<a;i++){var s=r[i],u=s.name,l=s.values;switch(u){case"color":var c=l[0];null!==c&&(t=o(c));break;case"coord":var h=l[0];null!==h&&(n=o(h));break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}var f=new Oi;f.setAttribute("position",new ki(n,3)),t&&f.setAttribute("color",new ki(t,3));return f._type="points",f}(e);break;case"Box":t=function(e){for(var t=new ar(2,2,2),n=e.fields,r=0,i=n.length;r<i;r++){var a=n[r],o=a.name,s=a.values;if("size"===o)t.x=s[0],t.y=s[1],t.z=s[2];else console.warn("THREE.VRMLLoader: Unknown field:",o)}return new ta(t.x,t.y,t.z)}(e);break;case"Cone":t=function(e){for(var t=1,n=2,r=!1,i=e.fields,a=0,o=i.length;a<o;a++){var s=i[a],u=s.name,l=s.values;switch(u){case"bottom":r=!l[0];break;case"bottomRadius":t=l[0];break;case"height":n=l[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",u)}}return new Ju(t,n,16,1,r)}(e);break;case"Cylinder":t=function(e){for(var t=1,n=2,r=e.fields,i=0,a=r.length;i<a;i++){var o=r[i],s=o.name,u=o.values;switch(s){case"bottom":case"side":case"top":break;case"radius":t=u[0];break;case"height":n=u[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",s)}}return new Zu(t,t,n,16,1)}(e);break;case"Sphere":t=function(e){for(var t=1,n=e.fields,r=0,i=n.length;r<i;r++){var a=n[r],o=a.name,s=a.values;if("radius"===o)t=s[0];else console.warn("THREE.VRMLLoader: Unknown field:",o)}return new Ol(t,16,16)}(e);break;case"ElevationGrid":t=function(e){for(var t,n,r,i,a=!0,s=!0,u=!0,l=!0,c=0,h=2,f=2,d=1,p=1,v=e.fields,m=0,g=v.length;m<g;m++){var y=v[m],x=y.name,_=y.values;switch(x){case"color":var b=_[0];null!==b&&(t=o(b));break;case"normal":var T=_[0];null!==T&&(n=o(T));break;case"texCoord":var M=_[0];null!==M&&(r=o(M));break;case"height":i=_;break;case"ccw":l=_[0];break;case"colorPerVertex":a=_[0];break;case"creaseAngle":c=_[0];break;case"normalPerVertex":s=_[0];break;case"solid":u=_[0];break;case"xDimension":h=_[0];break;case"xSpacing":d=_[0];break;case"zDimension":f=_[0];break;case"zSpacing":p=_[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",x)}}for(var S=[],E=[],A=[],C=[],I=0;I<f;I++)for(var R=0;R<h;R++){var L=I*h+R,P=d*I,N=i[L],O=p*R;if(S.push(P,N,O),t&&!0===a){var D=t[3*L+0],F=t[3*L+1],U=t[3*L+2];A.push(D,F,U)}if(n&&!0===s){var G=n[3*L+0],z=n[3*L+1],V=n[3*L+2];E.push(G,z,V)}if(r){var B=r[2*L+0],W=r[2*L+1];C.push(B,W)}else C.push(I/(h-1),R/(f-1))}for(var H=[],j=0;j<h-1;j++)for(var q=0;q<f-1;q++){var X=j+q*h,Y=j+(q+1)*h,K=j+1+(q+1)*h,Z=j+1+q*h;!0===l?(H.push(X,K,Y),H.push(K,X,Z)):(H.push(X,Y,K),H.push(K,Z,X))}var J,Q,$=w(H,new ki(S,3)),ee=w(H,new ki(C,2));if(t)if(!1===a){for(var te=0;te<h-1;te++)for(var ne=0;ne<f-1;ne++){var re=te+ne*(h-1),ie=t[3*re+0],ae=t[3*re+1],oe=t[3*re+2];A.push(ie,ae,oe),A.push(ie,ae,oe),A.push(ie,ae,oe),A.push(ie,ae,oe),A.push(ie,ae,oe),A.push(ie,ae,oe)}J=new ki(A,3)}else J=w(H,new ki(A,3));if(n)if(!1===s){for(var se=0;se<h-1;se++)for(var ue=0;ue<f-1;ue++){var le=se+ue*(h-1),ce=n[3*le+0],he=n[3*le+1],fe=n[3*le+2];E.push(ce,he,fe),E.push(ce,he,fe),E.push(ce,he,fe),E.push(ce,he,fe),E.push(ce,he,fe),E.push(ce,he,fe)}Q=new ki(E,3)}else Q=w(H,new ki(E,3));else Q=k(H,S,c);var de=new Oi;de.setAttribute("position",$),de.setAttribute("normal",Q),de.setAttribute("uv",ee),J&&de.setAttribute("color",J);return de._solid=u,de._type="mesh",de}(e);break;case"Extrusion":t=function(e){for(var t,n,r=[1,1,1,-1,-1,-1,-1,1,1,1],i=[0,0,0,0,1,0],a=!0,o=!0,s=0,u=!0,l=!0,c=e.fields,h=0,f=c.length;h<f;h++){var d=c[h],p=d.name,v=d.values;switch(p){case"beginCap":a=v[0];break;case"ccw":o=v[0];break;case"convex":break;case"creaseAngle":s=v[0];break;case"crossSection":r=v;break;case"endCap":u=v[0];break;case"orientation":n=v;break;case"scale":t=v;break;case"solid":l=v[0];break;case"spine":i=v;break;default:console.warn("THREE.VRMLLoader: Unknown field:",p)}}for(var m=r[0]===r[r.length-2]&&r[1]===r[r.length-1],g=[],y=new ar,x=new ar,_=new ar,b=new ar,T=new ir,M=0,S=0,E=0,A=i.length;M<A;M+=3,S+=2,E+=4){y.fromArray(i,M),x.x=t?t[S+0]:1,x.y=1,x.z=t?t[S+1]:1,_.x=n?n[E+0]:0,_.y=n?n[E+1]:0,_.z=n?n[E+2]:1;for(var C=n?n[E+3]:0,I=0,R=r.length;I<R;I+=2)b.x=r[I+0],b.y=0,b.z=r[I+1],b.multiply(x),T.setFromAxisAngle(_,C),b.applyQuaternion(T),b.add(y),g.push(b.x,b.y,b.z)}for(var L=[],P=i.length/3,N=r.length/2,O=0;O<P-1;O++)for(var D=0;D<N-1;D++){var F=D+O*N,U=D+1+O*N,G=D+(O+1)*N,z=D+1+(O+1)*N;D===N-2&&!0===m&&(U=O*N,z=(O+1)*N),!0===o?(L.push(F,U,G),L.push(G,U,z)):(L.push(F,G,U),L.push(G,z,U))}if(!0===a||!0===u){for(var V=[],B=0,W=r.length;B<W;B+=2)V.push(new Pn(r[B],r[B+1]));for(var H=Il.triangulateShape(V,[]),j=[],q=0,X=H.length;q<X;q++){var Y=H[q];j.push(Y[0],Y[1],Y[2])}if(!0===a)for(var K=0,Z=j.length;K<Z;K+=3)!0===o?L.push(j[K+0],j[K+1],j[K+2]):L.push(j[K+0],j[K+2],j[K+1]);if(!0===u)for(var J=N*(P-1),Q=0,$=j.length;Q<$;Q+=3)!0===o?L.push(J+j[Q+0],J+j[Q+2],J+j[Q+1]):L.push(J+j[Q+0],J+j[Q+1],J+j[Q+2])}var ee=w(L,new ki(g,3)),te=k(L,g,s),ne=new Oi;return ne.setAttribute("position",ee),ne.setAttribute("normal",te),ne._solid=l,ne._type="mesh",ne}(e);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":t=function(e){return e.fields[0].values}(e);break;case"WorldInfo":t=function(e){for(var t={},n=e.fields,r=0,i=n.length;r<i;r++){var a=n[r],o=a.name,s=a.values;switch(o){case"title":t.title=s[0];break;case"info":t.info=s;break;default:console.warn("THREE.VRMLLoader: Unknown field:",o)}}return t}(e);break;case"Billboard":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"Text":case"FontStyle":case"MovieTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",n)}void 0!==t&&void 0!==e.DEF&&!0===t.hasOwnProperty("name")&&(t.name=e.DEF);return t}(e)),e.build);var t,n}function s(e,t,n){var r;switch(t){case Ig.INTENSITY:r=parseInt(e),n.r=r,n.g=r,n.b=r,n.a=1;break;case Ig.INTENSITY_ALPHA:r=parseInt("0x"+e.substring(2,4)),n.r=r,n.g=r,n.b=r,n.a=parseInt("0x"+e.substring(4,6));break;case Ig.RGB:n.r=parseInt("0x"+e.substring(2,4)),n.g=parseInt("0x"+e.substring(4,6)),n.b=parseInt("0x"+e.substring(6,8)),n.a=1;break;case Ig.RGBA:n.r=parseInt("0x"+e.substring(2,4)),n.g=parseInt("0x"+e.substring(4,6)),n.b=parseInt("0x"+e.substring(6,8)),n.a=parseInt("0x"+e.substring(8,10))}}function u(e){var t;switch(e){case 1:t=Ig.INTENSITY;break;case 2:t=Ig.INTENSITY_ALPHA;break;case 3:t=Ig.RGB;break;case 4:t=Ig.RGBA}return t}function l(e,t){for(var n=0,r=e.length;n<r;n++){var i=o(e[n]);i instanceof si&&t.add(i)}}function c(e,t){for(var n=[],r=0,i=0,a=e.length;i<a;i++){var o=e[r],s=e[i+(t?1:2)],u=e[i+(t?2:1)];n.push(o,s,u),(-1===e[i+3]||i+3>=a)&&(r=(i+=3)+1)}return n}function h(e,t){for(var n=[],r=0,i=0,a=t.length;i<a;i++){var o=3*r,s=e[o],u=e[o+1],l=e[o+2];n.push(s,u,l),(-1===t[i+3]||i+3>=a)&&(i+=3,r++)}return n}function f(e,t){for(var n=[],r=0,i=t.length;r<i;r++){var a=3*t[r],o=e[a],s=e[a+1],u=e[a+2];n.push(o,s,u)}return n}function d(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],a=e[n+1];t.push(i,a),(-1===e[n+2]||n+2>=r)&&(n+=2)}return t}function p(e,t){for(var n=[],r=0,i=0,a=t.length;i<a;i++){var o=3*r,s=e[o],u=e[o+1],l=e[o+2];n.push(s,u,l),(-1===t[i+2]||i+2>=a)&&(i+=2,r++)}return n}var v=new ar,m=new ar,g=new ar,y=new Pn,x=new Pn,_=new Pn;function b(e,t,n,r){for(var i=[],a=0,o=e.length;a<o;a+=3){var s=t[a],u=t[a+1],l=t[a+2];2===r?(y.fromArray(n,s*r),x.fromArray(n,u*r),_.fromArray(n,l*r),i.push(y.x,y.y),i.push(x.x,x.y),i.push(_.x,_.y)):(v.fromArray(n,s*r),m.fromArray(n,u*r),g.fromArray(n,l*r),i.push(v.x,v.y,v.z),i.push(m.x,m.y,m.z),i.push(g.x,g.y,g.z))}return new ki(i,r)}function T(e,t){for(var n=[],r=0,i=0,a=e.length;r<a;r+=3,i++)v.fromArray(t,3*i),n.push(v.x,v.y,v.z),n.push(v.x,v.y,v.z),n.push(v.x,v.y,v.z);return new ki(n,3)}function M(e,t){for(var n=[],r=0,i=0,a=e.length;r<a;r+=2,i++)v.fromArray(t,3*i),n.push(v.x,v.y,v.z),n.push(v.x,v.y,v.z);return new ki(n,3)}function w(e,t){for(var n=t.array,r=t.itemSize,i=new n.constructor(e.length*r),a=0,o=0,s=0,u=e.length;s<u;s++){a=e[s]*r;for(var l=0;l<r;l++)i[o++]=n[a++]}return new ki(i,r)}var S=new ar,E=new ar;function k(e,t,n){for(var r=[],i={},a=0,o=e.length;a<o;a+=3){var s=e[a],u=e[a+1],l=e[a+2],c=new Cg(s,u,l);v.fromArray(t,3*s),m.fromArray(t,3*u),g.fromArray(t,3*l),E.subVectors(g,m),S.subVectors(v,m),E.cross(S),E.normalize(),c.normal.copy(E),void 0===i[s]&&(i[s]=[]),void 0===i[u]&&(i[u]=[]),void 0===i[l]&&(i[l]=[]),i[s].push(c.normal),i[u].push(c.normal),i[l].push(c.normal),r.push(c)}for(var h=[],f=0,d=r.length;f<d;f++){var p=r[f],y=A(i[p.a],p.normal,n),x=A(i[p.b],p.normal,n),_=A(i[p.c],p.normal,n);v.fromArray(t,3*p.a),m.fromArray(t,3*p.b),g.fromArray(t,3*p.c),h.push(y.x,y.y,y.z),h.push(x.x,x.y,x.z),h.push(_.x,_.y,_.z)}return new ki(h,3)}function A(e,t,n){var r=new ar;if(0===n)r.copy(t);else for(var i=0,a=e.length;i<a;i++)e[i].angleTo(t)<n&&r.add(e[i]);return r.normalize()}function C(e){for(var t=[],n=0,r=e.length;n<r;n+=3)t.push(new Yn(e[n],e[n+1],e[n+2]));return t}function I(e,t,n,r,i){for(var a=[],o=!0===i?0:Math.PI,s=0,u=r.length;s<u;s++){var l=0===s?0:n[s-1];l=!0===i?l:o-l;var c=new ar;c.setFromSphericalCoords(t,l,0),a.push(c)}for(var h=e.index,f=e.attributes.position,d=new wi(new Float32Array(3*e.attributes.position.count),3),p=new ar,v=new Yn,m=0;m<h.count;m++){var g=h.getX(m);p.fromBufferAttribute(f,g);for(var y=void 0,x=void 0,_=1,b=1;b<a.length;b++){x=b;var T=a[y=b-1],M=a[x];if(!0===i){if(p.y<=T.y&&p.y>M.y){_=Math.abs(T.y-p.y)/Math.abs(T.y-M.y);break}}else if(p.y>=T.y&&p.y<M.y){_=Math.abs(T.y-p.y)/Math.abs(T.y-M.y);break}}var w=r[y],S=r[x];v.copy(w).lerp(S,_),d.setXYZ(g,v.r,v.g,v.b)}e.setAttribute("color",d)}var R=new vc(this.manager);if(R.setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin),-1===e.indexOf("#VRML V2.0"))throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");var L=function(e){var n=function(){for(var e=Sg.Z.createToken,t=e({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),n=e({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/,longer_alt:t}),r=["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"],i=e({name:"Version",pattern:/#VRML.*/,longer_alt:n}),a=e({name:"NodeName",pattern:new RegExp(r.join("|")),longer_alt:n}),o=e({name:"DEF",pattern:/DEF/,longer_alt:n}),s=e({name:"USE",pattern:/USE/,longer_alt:n}),u=e({name:"ROUTE",pattern:/ROUTE/,longer_alt:n}),l=e({name:"TO",pattern:/TO/,longer_alt:n}),c=e({name:"StringLiteral",pattern:/"(?:[^\\"\n\r]|\\[bfnrtv"\\/]|\\u[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F])*"/}),h=e({name:"HexLiteral",pattern:/0[xX][0-9a-fA-F]+/}),f=e({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),d=e({name:"TrueLiteral",pattern:/TRUE/}),p=e({name:"FalseLiteral",pattern:/FALSE/}),v=e({name:"NullLiteral",pattern:/NULL/}),m=e({name:"LSquare",pattern:/\[/}),g=e({name:"RSquare",pattern:/]/}),y=e({name:"LCurly",pattern:/{/}),x=e({name:"RCurly",pattern:/}/}),_=e({name:"Comment",pattern:/#.*/,group:Sg.Z.Lexer.SKIPPED}),b=[e({name:"WhiteSpace",pattern:/[ ,\s]/,group:Sg.Z.Lexer.SKIPPED}),a,o,s,u,l,d,p,v,i,n,t,c,h,f,m,g,y,x,_],T={},M=0,w=b.length;M<w;M++){var S=b[M];T[S.name]=S}return{tokens:b,tokenVocabulary:T}}(),r=new kg(n.tokens),i=new Ag(n.tokenVocabulary),o=function(e){var n=function(e){Fe(i,e);var n=Ge(i);function i(){var e;return t(this,i),(e=n.call(this)).validateVisitor(),e}return a(i,[{key:"vrml",value:function(e){for(var t={version:this.visit(e.version),nodes:[],routes:[]},n=0,r=e.node.length;n<r;n++){var i=e.node[n];t.nodes.push(this.visit(i))}if(e.route)for(var a=0,o=e.route.length;a<o;a++){var s=e.route[a];t.routes.push(this.visit(s))}return t}},{key:"version",value:function(e){return e.Version[0].image}},{key:"node",value:function(e){var t={name:e.NodeName[0].image,fields:[]};if(e.field)for(var n=0,r=e.field.length;n<r;n++){var i=e.field[n];t.fields.push(this.visit(i))}return e.def&&(t.DEF=this.visit(e.def[0])),t}},{key:"field",value:function(e){var t,n={name:e.Identifier[0].image,type:null,values:null};return e.singleFieldValue&&(t=this.visit(e.singleFieldValue[0])),e.multiFieldValue&&(t=this.visit(e.multiFieldValue[0])),n.type=t.type,n.values=t.values,n}},{key:"def",value:function(e){return(e.Identifier||e.NodeName)[0].image}},{key:"use",value:function(e){return{USE:(e.Identifier||e.NodeName)[0].image}}},{key:"singleFieldValue",value:function(e){return r(this,e)}},{key:"multiFieldValue",value:function(e){return r(this,e)}},{key:"route",value:function(e){return{FROM:e.RouteIdentifier[0].image,TO:e.RouteIdentifier[1].image}}}]),i}(e);function r(e,t){var n={type:null,values:[]};if(t.node){n.type="node";for(var r=0,i=t.node.length;r<i;r++){var a=t.node[r];n.values.push(e.visit(a))}}if(t.use){n.type="use";for(var o=0,s=t.use.length;o<s;o++){var u=t.use[o];n.values.push(e.visit(u))}}if(t.StringLiteral){n.type="string";for(var l=0,c=t.StringLiteral.length;l<c;l++){var h=t.StringLiteral[l];n.values.push(h.image.replace(/'|"/g,""))}}if(t.NumberLiteral){n.type="number";for(var f=0,d=t.NumberLiteral.length;f<d;f++){var p=t.NumberLiteral[f];n.values.push(parseFloat(p.image))}}if(t.HexLiteral){n.type="hex";for(var v=0,m=t.HexLiteral.length;v<m;v++){var g=t.HexLiteral[v];n.values.push(g.image)}}if(t.TrueLiteral){n.type="boolean";for(var y=0,x=t.TrueLiteral.length;y<x;y++){"TRUE"===t.TrueLiteral[y].image&&n.values.push(!0)}}if(t.FalseLiteral){n.type="boolean";for(var _=0,b=t.FalseLiteral.length;_<b;_++){"FALSE"===t.FalseLiteral[_].image&&n.values.push(!1)}}return t.NullLiteral&&(n.type="null",t.NullLiteral.forEach((function(){n.values.push(null)}))),n}return new n}(i.getBaseCstVisitorConstructor()),s=r.lex(e);i.input=s.tokens;var u=i.vrml();if(i.errors.length>0)throw console.error(i.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return o.visit(u)}(e),P=function(e){for(var t=e.nodes,n=new $s,r=0,a=t.length;r<a;r++){i(t[r])}for(var s=0,u=t.length;s<u;s++){var l=t[s],c=o(l);c instanceof si&&n.add(c),"WorldInfo"===l.name&&(n.userData.worldInfo=c)}return n}(L);return P}}]),r}(uc),kg=function(){function e(n){t(this,e),this.lexer=new Sg.Z.Lexer(n)}return a(e,[{key:"lex",value:function(e){var t=this.lexer.tokenize(e);if(t.errors.length>0)throw console.error(t.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return t}}]),e}(),Ag=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;t(this,r),i=n.call(this,e);var a=it(i),o=e.Version,s=e.LCurly,u=e.RCurly,l=e.LSquare,c=e.RSquare,h=e.Identifier,f=e.RouteIdentifier,d=e.StringLiteral,p=e.HexLiteral,v=e.NumberLiteral,m=e.TrueLiteral,g=e.FalseLiteral,y=e.NullLiteral,x=e.DEF,_=e.USE,b=e.ROUTE,T=e.TO,M=e.NodeName;return a.RULE("vrml",(function(){a.SUBRULE(a.version),a.AT_LEAST_ONE((function(){a.SUBRULE(a.node)})),a.MANY((function(){a.SUBRULE(a.route)}))})),a.RULE("version",(function(){a.CONSUME(o)})),a.RULE("node",(function(){a.OPTION((function(){a.SUBRULE(a.def)})),a.CONSUME(M),a.CONSUME(s),a.MANY((function(){a.SUBRULE(a.field)})),a.CONSUME(u)})),a.RULE("field",(function(){a.CONSUME(h),a.OR2([{ALT:function(){a.SUBRULE(a.singleFieldValue)}},{ALT:function(){a.SUBRULE(a.multiFieldValue)}}])})),a.RULE("def",(function(){a.CONSUME(x),a.OR([{ALT:function(){a.CONSUME(h)}},{ALT:function(){a.CONSUME(M)}}])})),a.RULE("use",(function(){a.CONSUME(_),a.OR([{ALT:function(){a.CONSUME(h)}},{ALT:function(){a.CONSUME(M)}}])})),a.RULE("singleFieldValue",(function(){a.AT_LEAST_ONE((function(){a.OR([{ALT:function(){a.SUBRULE(a.node)}},{ALT:function(){a.SUBRULE(a.use)}},{ALT:function(){a.CONSUME(d)}},{ALT:function(){a.CONSUME(p)}},{ALT:function(){a.CONSUME(v)}},{ALT:function(){a.CONSUME(m)}},{ALT:function(){a.CONSUME(g)}},{ALT:function(){a.CONSUME(y)}}])}))})),a.RULE("multiFieldValue",(function(){a.CONSUME(l),a.MANY((function(){a.OR([{ALT:function(){a.SUBRULE(a.node)}},{ALT:function(){a.SUBRULE(a.use)}},{ALT:function(){a.CONSUME(d)}},{ALT:function(){a.CONSUME(p)}},{ALT:function(){a.CONSUME(v)}},{ALT:function(){a.CONSUME(y)}}])})),a.CONSUME(c)})),a.RULE("route",(function(){a.CONSUME(b),a.CONSUME(f),a.CONSUME(T),a.CONSUME2(f)})),i.performSelfAnalysis(),i}return a(r)}(Sg.Z.CstParser),Cg=a((function e(n,r,i){t(this,e),this.a=n,this.b=r,this.c=i,this.normal=new ar})),Ig={INTENSITY:1,INTENSITY_ALPHA:2,RGB:3,RGBA:4},Rg=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this,e)).availableExtensions=[],i}return a(r,[{key:"load",value:function(e,t,n,r){var i=this,a=new hc(i.manager);a.setPath(i.path),a.setResponseType("arraybuffer"),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){var t=this,n=new vc(this.manager);function r(e){for(var t=[],n=(new DOMParser).parseFromString(e,"application/xml").querySelectorAll("Relationship"),r=0;r<n.length;r++){var i=n[r],a={target:i.getAttribute("Target"),id:i.getAttribute("Id"),type:i.getAttribute("Type")};t.push(a)}return t}function i(e){for(var t={id:e.getAttribute("id"),basematerials:[]},n=e.querySelectorAll("base"),r=0;r<n.length;r++){var i=u(n[r]);i.index=r,t.basematerials.push(i)}return t}function a(e){for(var t={id:e.getAttribute("id"),texid:e.getAttribute("texid"),displaypropertiesid:e.getAttribute("displaypropertiesid")},n=e.querySelectorAll("tex2coord"),r=[],i=0;i<n.length;i++){var a=n[i],o=a.getAttribute("u"),s=a.getAttribute("v");r.push(parseFloat(o),parseFloat(s))}return t.uvs=new Float32Array(r),t}function o(e){for(var t={id:e.getAttribute("id"),displaypropertiesid:e.getAttribute("displaypropertiesid")},n=e.querySelectorAll("color"),r=[],i=new Yn,a=0;a<n.length;a++){var o=n[a].getAttribute("color");i.setStyle(o.substring(0,7)),i.convertSRGBToLinear(),r.push(i.r,i.g,i.b)}return t.colors=new Float32Array(r),t}function s(e){for(var t={id:e.getAttribute("id")},n=e.querySelectorAll("pbmetallic"),r=[],i=0;i<n.length;i++){var a=n[i];r.push({name:a.getAttribute("name"),metallicness:parseFloat(a.getAttribute("metallicness")),roughness:parseFloat(a.getAttribute("roughness"))})}return t.data=r,t}function u(e){var t={};return t.name=e.getAttribute("name"),t.displaycolor=e.getAttribute("displaycolor"),t.displaypropertiesid=e.getAttribute("displaypropertiesid"),t}function l(e){var t={};t.objectId=e.getAttribute("objectid");var n=e.getAttribute("transform");return n&&(t.transform=c(n)),t}function c(e){var t=[];e.split(" ").forEach((function(e){t.push(parseFloat(e))}));var n=new Dr;return n.set(t[0],t[3],t[6],t[9],t[1],t[4],t[7],t[10],t[2],t[5],t[8],t[11],0,0,0,1),n}function h(e){var t={type:e.getAttribute("type")},n=e.getAttribute("id");n&&(t.id=n);var r=e.getAttribute("pid");r&&(t.pid=r);var i=e.getAttribute("pindex");i&&(t.pindex=i);var a=e.getAttribute("thumbnail");a&&(t.thumbnail=a);var o=e.getAttribute("partnumber");o&&(t.partnumber=o);var s=e.getAttribute("name");s&&(t.name=s);var u=e.querySelector("mesh");u&&(t.mesh=function(e){for(var t={},n=[],r=e.querySelectorAll("vertices vertex"),i=0;i<r.length;i++){var a=r[i],o=a.getAttribute("x"),s=a.getAttribute("y"),u=a.getAttribute("z");n.push(parseFloat(o),parseFloat(s),parseFloat(u))}t.vertices=new Float32Array(n);for(var l=[],c=[],h=e.querySelectorAll("triangles triangle"),f=0;f<h.length;f++){var d=h[f],p=d.getAttribute("v1"),v=d.getAttribute("v2"),m=d.getAttribute("v3"),g=d.getAttribute("p1"),y=d.getAttribute("p2"),x=d.getAttribute("p3"),_=d.getAttribute("pid"),b={};b.v1=parseInt(p,10),b.v2=parseInt(v,10),b.v3=parseInt(m,10),c.push(b.v1,b.v2,b.v3),g&&(b.p1=parseInt(g,10)),y&&(b.p2=parseInt(y,10)),x&&(b.p3=parseInt(x,10)),_&&(b.pid=_),0<Object.keys(b).length&&l.push(b)}return t.triangleProperties=l,t.triangles=new Uint32Array(c),t}(u));var c=e.querySelector("components");return c&&(t.components=function(e){for(var t=[],n=e.querySelectorAll("component"),r=0;r<n.length;r++){var i=l(n[r]);t.push(i)}return t}(c)),t}function f(e){var t={unit:e.getAttribute("unit")||"millimeter"},n=e.querySelectorAll("metadata");n&&(t.metadata=function(e){for(var t={},n=0;n<e.length;n++){var r=e[n],i=r.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(i)&&(t[i]=r.textContent)}return t}(n));var r=e.querySelector("resources");r&&(t.resources=function(e){for(var t={basematerials:{}},n=e.querySelectorAll("basematerials"),r=0;r<n.length;r++){var u=i(n[r]);t.basematerials[u.id]=u}t.texture2d={};for(var l,c=e.querySelectorAll("texture2d"),f=0;f<c.length;f++){var d={id:(l=c[f]).getAttribute("id"),path:l.getAttribute("path"),contenttype:l.getAttribute("contenttype"),tilestyleu:l.getAttribute("tilestyleu"),tilestylev:l.getAttribute("tilestylev"),filter:l.getAttribute("filter")};t.texture2d[d.id]=d}t.colorgroup={};for(var p=e.querySelectorAll("colorgroup"),v=0;v<p.length;v++){var m=o(p[v]);t.colorgroup[m.id]=m}t.pbmetallicdisplayproperties={};for(var g=e.querySelectorAll("pbmetallicdisplayproperties"),y=0;y<g.length;y++){var x=s(g[y]);t.pbmetallicdisplayproperties[x.id]=x}t.texture2dgroup={};for(var _=e.querySelectorAll("texture2dgroup"),b=0;b<_.length;b++){var T=a(_[b]);t.texture2dgroup[T.id]=T}t.object={};for(var M=e.querySelectorAll("object"),w=0;w<M.length;w++){var S=h(M[w]);t.object[S.id]=S}return t}(r));var u=e.querySelector("build");return u&&(t.build=function(e){for(var t=[],n=e.querySelectorAll("item"),r=0;r<n.length;r++){var i=n[r],a={objectId:i.getAttribute("objectid")},o=i.getAttribute("transform");o&&(a.transform=c(o)),t.push(a)}return t}(u)),t}function d(e,t,r,i){var a=e.texid,o=r.resources.texture2d[a];if(o){var s=i[o.path],u=o.contenttype,l=new Blob([s],{type:u}),c=URL.createObjectURL(l),h=n.load(c,(function(){URL.revokeObjectURL(c)}));switch(h.encoding=hn,o.tilestyleu){case"wrap":default:h.wrapS=pt;break;case"mirror":h.wrapS=mt;break;case"none":case"clamp":h.wrapS=vt}switch(o.tilestylev){case"wrap":default:h.wrapT=pt;break;case"mirror":h.wrapT=mt;break;case"none":case"clamp":h.wrapT=vt}switch(o.filter){case"auto":default:h.magFilter=_t,h.minFilter=bt;break;case"linear":h.magFilter=_t,h.minFilter=_t;break;case"nearest":h.magFilter=gt,h.minFilter=gt}return h}return null}function p(e,t,n,r,i,a,o){for(var s=o.pindex,u={},l=0,c=t.length;l<c;l++){var h=t[l],f=void 0!==h.p1?h.p1:s;void 0===u[f]&&(u[f]=[]),u[f].push(h)}for(var d=Object.keys(u),p=[],v=0,m=d.length;v<m;v++){for(var g=d[v],y=u[g],x=_(e.basematerials[g],r,i,a,o,b),T=new Oi,M=[],w=n.vertices,S=0,E=y.length;S<E;S++){var k=y[S];M.push(w[3*k.v1+0]),M.push(w[3*k.v1+1]),M.push(w[3*k.v1+2]),M.push(w[3*k.v2+0]),M.push(w[3*k.v2+1]),M.push(w[3*k.v2+2]),M.push(w[3*k.v3+0]),M.push(w[3*k.v3+1]),M.push(w[3*k.v3+2])}T.setAttribute("position",new ki(M,3));var A=new $i(T,x);p.push(A)}return p}function v(e,t,n,r,i,a,o){for(var s=new Oi,u=[],l=[],c=n.vertices,h=e.uvs,f=0,p=t.length;f<p;f++){var v=t[f];u.push(c[3*v.v1+0]),u.push(c[3*v.v1+1]),u.push(c[3*v.v1+2]),u.push(c[3*v.v2+0]),u.push(c[3*v.v2+1]),u.push(c[3*v.v2+2]),u.push(c[3*v.v3+0]),u.push(c[3*v.v3+1]),u.push(c[3*v.v3+2]),l.push(h[2*v.p1+0]),l.push(h[2*v.p1+1]),l.push(h[2*v.p2+0]),l.push(h[2*v.p2+1]),l.push(h[2*v.p3+0]),l.push(h[2*v.p3+1])}s.setAttribute("position",new ki(u,3)),s.setAttribute("uv",new ki(l,2));var m=_(e,r,i,a,o,d),g=new Fl({map:m,flatShading:!0});return new $i(s,g)}function m(e,t,n,r){for(var i=new Oi,a=[],o=[],s=n.vertices,u=e.colors,l=0,c=t.length;l<c;l++){var h=t[l],f=h.v1,d=h.v2,p=h.v3;a.push(s[3*f+0]),a.push(s[3*f+1]),a.push(s[3*f+2]),a.push(s[3*d+0]),a.push(s[3*d+1]),a.push(s[3*d+2]),a.push(s[3*p+0]),a.push(s[3*p+1]),a.push(s[3*p+2]);var v=void 0!==h.p1?h.p1:r.pindex,m=void 0!==h.p2?h.p2:v,g=void 0!==h.p3?h.p3:v;o.push(u[3*v+0]),o.push(u[3*v+1]),o.push(u[3*v+2]),o.push(u[3*m+0]),o.push(u[3*m+1]),o.push(u[3*m+2]),o.push(u[3*g+0]),o.push(u[3*g+1]),o.push(u[3*g+2])}i.setAttribute("position",new ki(a,3)),i.setAttribute("color",new ki(o,3));var y=new Fl({vertexColors:!0,flatShading:!0});return new $i(i,y)}function g(e){var t=new Oi;t.setIndex(new wi(e.triangles,1)),t.setAttribute("position",new wi(e.vertices,3));var n=new Fl({color:16777215,flatShading:!0});return new $i(t,n)}function y(e,t){return void 0!==t.resources.texture2dgroup[e]?"texture":void 0!==t.resources.basematerials[e]?"material":void 0!==t.resources.colorgroup[e]?"vertexColors":"default"===e?"default":void 0}function x(e,t,n,r,i){for(var a=new Ws,o=function(e,t){for(var n={},r=e.triangleProperties,i=t.pid,a=0,o=r.length;a<o;a++){var s=r[a],u=void 0!==s.pid?s.pid:i;void 0===u&&(u="default"),void 0===n[u]&&(n[u]=[]),n[u].push(s)}return n}(e,i),s=function(e,t,n,r,i,a){for(var o=Object.keys(e),s=[],u=0,l=o.length;u<l;u++){var c=o[u],h=e[c];switch(y(c,r)){case"material":for(var f=p(r.resources.basematerials[c],h,t,n,r,i,a),d=0,x=f.length;d<x;d++)s.push(f[d]);break;case"texture":var _=r.resources.texture2dgroup[c];s.push(v(_,h,t,n,r,i,a));break;case"vertexColors":var b=r.resources.colorgroup[c];s.push(m(b,h,t,a));break;case"default":s.push(g(t));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}if(a.name)for(var T=0;T<s.length;T++)s[T].name=a.name;return s}(o,e,t,n,r,i),u=0,l=s.length;u<l;u++)a.add(s[u]);return a}function _(e,t,n,r,i,a){return void 0!==e.build||(e.build=a(e,t,n,r,i)),e.build}function b(e,t,n){var r,i=e.displaypropertiesid,a=n.resources.pbmetallicdisplayproperties;if(null!==i&&void 0!==a[i]){var o=a[i].data[e.index];r=new Dl({flatShading:!0,roughness:o.roughness,metalness:o.metallicness})}else r=new Fl({flatShading:!0});r.name=e.name;var s=e.displaycolor,u=s.substring(0,7);return r.color.setStyle(u),r.color.convertSRGBToLinear(),9===s.length&&(r.opacity=parseInt(s.charAt(7)+s.charAt(8),16)/255),r}function T(e,t,n,r){for(var i=new Ws,a=0;a<e.length;a++){var o=e[a],s=t[o.objectId];void 0===s&&(M(o.objectId,t,n,r),s=t[o.objectId]);var u=s.clone(),l=o.transform;l&&u.applyMatrix4(l),i.add(u)}return i}function M(e,n,r,i){var a=r.resources.object[e];if(a.mesh){var o=a.mesh;!function(e,n,r){if(e){for(var i=[],a=Object.keys(e),o=0;o<a.length;o++)for(var s=a[o],u=0;u<t.availableExtensions.length;u++){var l=t.availableExtensions[u];l.ns===s&&i.push(l)}for(var c=0;c<i.length;c++){var h=i[c];h.apply(r,e[h.ns],n)}}}(r.extensions,o,r.xml),n[a.id]=_(o,n,r,i,a,x)}else{var s=a.components;n[a.id]=_(s,n,r,i,a,T)}a.name&&(n[a.id].name=a.name)}var w=function(e){var t,n,i,a=null,o=null,s=[],u=[],l={},c={};try{a=Km(new Uint8Array(e))}catch(e){if(e instanceof ReferenceError)return console.error("THREE.3MFLoader: fflate missing and file is compressed."),null}for(o in a)o.match(/\_rels\/.rels$/)?t=o:o.match(/3D\/_rels\/.*\.model\.rels$/)?n=o:o.match(/^3D\/.*\.model$/)?s.push(o):o.match(/^3D\/Textures?\/.*/)&&u.push(o);var h=a[t],d=r(Rc.decodeText(h));if(n){var p=a[n];i=r(Rc.decodeText(p))}for(var v=0;v<s.length;v++){var m=s[v],g=a[m],y=Rc.decodeText(g),x=(new DOMParser).parseFromString(y,"application/xml");"model"!==x.documentElement.nodeName.toLowerCase()&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",m);for(var _=x.querySelector("model"),b={},T=0;T<_.attributes.length;T++){var M=_.attributes[T];M.name.match(/^xmlns:(.+)$/)&&(b[M.value]=RegExp.$1)}var w=f(_);w.xml=_,0<Object.keys(b).length&&(w.extensions=b),l[m]=w}for(var S=0;S<u.length;S++){var E=u[S];c[E]=a[E].buffer}return{rels:d,modelRels:i,model:l,printTicket:{},texture:c}}(e),S=function(e){var t=e.model,n=e.modelRels,r={},i=Object.keys(t),a={};if(n)for(var o=0,s=n.length;o<s;o++){var u=n[o],l=u.target.substring(1);e.texture[l]&&(a[u.target]=e.texture[l])}for(var c=0;c<i.length;c++)for(var h=t[i[c]],f=Object.keys(h.resources.object),d=0;d<f.length;d++){M(f[d],r,h,a)}return r}(w);return function(e,t){for(var n=new Ws,r=function(e){for(var t=0;t<e.length;t++){var n=e[t];if("model"===n.target.split(".").pop().toLowerCase())return n}}(t.rels),i=t.model[r.target.substring(1)].build,a=0;a<i.length;a++){var o=i[a],s=e[o.objectId].clone(),u=o.transform;u&&s.applyMatrix4(u),n.add(s)}return n}(S,w)}},{key:"addExtension",value:function(e){this.availableExtensions.push(e)}}]),r}(uc),Lg=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CreateLoader",value:function(e){return null}},{key:"GetMainObject",value:function(e){return e}},{key:"IsMeshVisible",value:function(e){return!0}},{key:"ClearContent",value:function(){this.loader=null,this.materialIdToIndex=null,this.objectUrlToFileName=null}},{key:"ResetContent",value:function(){this.loader=null,this.materialIdToIndex=new Map,this.objectUrlToFileName=new Map}},{key:"ImportContent",value:function(e,t){this.LoadModel(e,t)}},{key:"LoadModel",value:function(e,t){var n=this,r=!1,i=new oc((function(){r=!0})),a=B(e);i.setURLModifier((function(e){if(e===a)return e;var t=T(e);if(M(e).length>0){var r=n.callbacks.getFileBuffer(e);if(null!==r){var i=B(r);return n.objectUrlToFileName.set(i,t),i}}return e}));var o=this.CreateLoader(i);null!==o?o.load(a,(function(e){h((function(){return!r||(n.OnThreeObjectsLoaded(e,t),!1)}))}),(function(){}),(function(e){n.SetError(e),t()})):t()}},{key:"OnThreeObjectsLoaded",value:function(e,t){function n(e){var t=(new Jh).CreateIdentity();return e.updateMatrix(),void 0!==e.matrix&&null!==e.matrix&&t.Set(e.matrix.elements),new $h(t)}function r(e,t,i,a){var o=new vf;void 0!==i.name&&o.SetName(i.name),o.SetTransformation(n(i)),a.AddChildNode(o);var s,u=d()(i.children);try{for(u.s();!(s=u.n()).done;){r(e,t,s.value,o)}}catch(e){u.e(e)}finally{u.f()}if(i.isMesh&&e.IsMeshVisible(i)){0===i.children.length&&o.SetType(pf.MeshNode);var l=e.ConvertThreeMesh(i),c=t.AddMesh(l);o.AddMeshIndex(c)}}var i=this.GetMainObject(e),a=this.model.GetRootNode();a.SetTransformation(n(i));var o,s=d()(i.children);try{for(s.s();!(o=s.n()).done;){var u=o.value;r(this,this.model,u,a)}}catch(e){s.e(e)}finally{s.f()}t()}},{key:"ConvertThreeMesh",value:function(e){var t=null;if(Array.isArray(e.material)){if(t=Jc(e.geometry,null),void 0===e.geometry.attributes.color||null===e.geometry.attributes.color){for(var n=[],r=0;r<e.material.length;r++){var i=e.material[r],a=this.FindOrCreateMaterial(i);n.push(a)}for(var o=0;o<e.geometry.groups.length;o++){var s=e.geometry.groups[o],u=null;u=s.count===1/0?t.TriangleCount():s.start/3+s.count/3;for(var l=s.start/3;l<u;l++){t.GetTriangle(l).SetMaterial(n[s.materialIndex])}}}}else{var c=this.FindOrCreateMaterial(e.material);t=Jc(e.geometry,c)}return void 0!==e.name&&null!==e.name&&t.SetName(e.name),t}},{key:"FindOrCreateMaterial",value:function(e){if(this.materialIdToIndex.has(e.id))return this.materialIdToIndex.get(e.id);var t=this.ConvertThreeMaterial(e),n=this.model.AddMaterial(t);return this.materialIdToIndex.set(e.id,n),n}},{key:"ConvertThreeMaterial",value:function(e){function t(e,t){if(null==e)return null;if(void 0===e.image||null===e.image)return null;try{var n=function(e){if(void 0!==e.data&&null!==e.data){for(var t=new ImageData(e.width,e.height),n=e.width*e.height*4,r=0;r<n;r++)t.data[r]=e.data[r];return Kn.getDataURL(t)}return Kn.getDataURL(e)}(e.image),r=z(n),i=new Ve,a=null;return a=t.has(e.image.src)?t.get(e.image.src):void 0!==e.name&&null!==e.name?e.name+"."+V(r.mimeType):"Embedded_"+e.id.toString()+"."+V(r.mimeType),i.name=a,i.mimeType=r.mimeType,i.buffer=r.buffer,i.rotation=e.rotation,i.offset.x=e.offset.x,i.offset.y=e.offset.y,i.scale.x=e.repeat.x,i.scale.y=e.repeat.y,i}catch(e){return null}}var n=new qe;return n.name=e.name,n.color=Kc(e.color),n.opacity=e.opacity,n.transparent=e.transparent,n.alphaTest=e.alphaTest,"MeshPhongMaterial"===e.type&&(n.specular=Kc(e.specular),n.shininess=e.shininess/100),n.diffuseMap=t(e.map,this.objectUrlToFileName),n.normalMap=t(e.normalMap,this.objectUrlToFileName),n.bumpMap=t(e.bumpMap,this.objectUrlToFileName),n}}]),n}(Of),Pg=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"fbx"===e}},{key:"GetUpDirection",value:function(){return ie.Y}},{key:"CreateLoader",value:function(e){return e.addHandler(/\.tga$/i,new kp(e)),new ag(e)}},{key:"GetMainObject",value:function(e){return e}}]),n}(Lg),Ng=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"dae"===e}},{key:"GetUpDirection",value:function(){return ie.Y}},{key:"CreateLoader",value:function(e){return e.addHandler(/\.tga$/i,new kp(e)),new wg(e)}},{key:"GetMainObject",value:function(e){return e.scene}}]),n}(Lg),Og=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"wrl"===e}},{key:"GetUpDirection",value:function(){return ie.Y}},{key:"CreateLoader",value:function(e){return new Eg(e)}},{key:"GetMainObject",value:function(e){return e}},{key:"IsMeshVisible",value:function(e){var t=!0;if(Array.isArray(e.material)){for(var n=0;n<e.material.length;n++)if(1===e.material[n].side){t=!1;break}}else t=1!==e.material.side;return t}}]),n}(Lg),Dg=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"3mf"===e}},{key:"GetUpDirection",value:function(){return ie.Z}},{key:"CreateLoader",value:function(e){return new Rg(e)}},{key:"GetMainObject",value:function(e){return e}}]),n}(Lg),Fg=Uint8Array,Ug=Uint16Array,Gg=Uint32Array,zg=new Fg([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vg=new Fg([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Bg=new Fg([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wg=function(e,t){for(var n=new Ug(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new Gg(n[30]);for(r=1;r<30;++r)for(var a=n[r];a<n[r+1];++a)i[a]=a-n[r]<<5|r;return[n,i]},Hg=Wg(zg,2),jg=Hg[0],qg=Hg[1];jg[28]=258,qg[258]=28;for(var Xg=Wg(Vg,0),Yg=Xg[0],Kg=(Xg[1],new Ug(32768)),Zg=0;Zg<32768;++Zg){var Jg=(43690&Zg)>>>1|(21845&Zg)<<1;Jg=(61680&(Jg=(52428&Jg)>>>2|(13107&Jg)<<2))>>>4|(3855&Jg)<<4,Kg[Zg]=((65280&Jg)>>>8|(255&Jg)<<8)>>>1}var Qg=function(e,t,n){for(var r=e.length,i=0,a=new Ug(t);i<r;++i)e[i]&&++a[e[i]-1];var o,s=new Ug(t);for(i=0;i<t;++i)s[i]=s[i-1]+a[i-1]<<1;if(n){o=new Ug(1<<t);var u=15-t;for(i=0;i<r;++i)if(e[i])for(var l=i<<4|e[i],c=t-e[i],h=s[e[i]-1]++<<c,f=h|(1<<c)-1;h<=f;++h)o[Kg[h]>>>u]=l}else for(o=new Ug(r),i=0;i<r;++i)e[i]&&(o[i]=Kg[s[e[i]-1]++]>>>15-e[i]);return o},$g=new Fg(288);for(Zg=0;Zg<144;++Zg)$g[Zg]=8;for(Zg=144;Zg<256;++Zg)$g[Zg]=9;for(Zg=256;Zg<280;++Zg)$g[Zg]=7;for(Zg=280;Zg<288;++Zg)$g[Zg]=8;var ey=new Fg(32);for(Zg=0;Zg<32;++Zg)ey[Zg]=5;var ty=Qg($g,9,1),ny=Qg(ey,5,1),ry=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},iy=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},ay=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},oy=function(e){return(e+7)/8|0},sy=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new(2==e.BYTES_PER_ELEMENT?Ug:4==e.BYTES_PER_ELEMENT?Gg:Fg)(n-t);return r.set(e.subarray(t,n)),r},uy=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ly=function e(t,n,r){var i=new Error(n||uy[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,e),!r)throw i;return i},cy=function(e,t,n){var r=e.length;if(!r||n&&n.f&&!n.l)return t||new Fg(0);var i=!t||n,a=!n||n.i;n||(n={}),t||(t=new Fg(3*r));var o=function(e){var n=t.length;if(e>n){var r=new Fg(Math.max(2*n,e));r.set(t),t=r}},s=n.f||0,u=n.p||0,l=n.b||0,c=n.l,h=n.d,f=n.m,d=n.n,p=8*r;do{if(!c){s=iy(e,u,1);var v=iy(e,u+1,3);if(u+=3,!v){var m=e[(k=oy(u)+4)-4]|e[k-3]<<8,g=k+m;if(g>r){a&&ly(0);break}i&&o(l+m),t.set(e.subarray(k,g),l),n.b=l+=m,n.p=u=8*g,n.f=s;continue}if(1==v)c=ty,h=ny,f=9,d=5;else if(2==v){var y=iy(e,u,31)+257,x=iy(e,u+10,15)+4,_=y+iy(e,u+5,31)+1;u+=14;for(var b=new Fg(_),T=new Fg(19),M=0;M<x;++M)T[Bg[M]]=iy(e,u+3*M,7);u+=3*x;var w=ry(T),S=(1<<w)-1,E=Qg(T,w,1);for(M=0;M<_;){var k,A=E[iy(e,u,S)];if(u+=15&A,(k=A>>>4)<16)b[M++]=k;else{var C=0,I=0;for(16==k?(I=3+iy(e,u,3),u+=2,C=b[M-1]):17==k?(I=3+iy(e,u,7),u+=3):18==k&&(I=11+iy(e,u,127),u+=7);I--;)b[M++]=C}}var R=b.subarray(0,y),L=b.subarray(y);f=ry(R),d=ry(L),c=Qg(R,f,1),h=Qg(L,d,1)}else ly(1);if(u>p){a&&ly(0);break}}i&&o(l+131072);for(var P=(1<<f)-1,N=(1<<d)-1,O=u;;O=u){var D=(C=c[ay(e,u)&P])>>>4;if((u+=15&C)>p){a&&ly(0);break}if(C||ly(2),D<256)t[l++]=D;else{if(256==D){O=u,c=null;break}var F=D-254;if(D>264){var U=zg[M=D-257];F=iy(e,u,(1<<U)-1)+jg[M],u+=U}var G=h[ay(e,u)&N],z=G>>>4;G||ly(3),u+=15&G;L=Yg[z];if(z>3){U=Vg[z];L+=ay(e,u)&(1<<U)-1,u+=U}if(u>p){a&&ly(0);break}i&&o(l+131072);for(var V=l+F;l<V;l+=4)t[l]=t[l-L],t[l+1]=t[l+1-L],t[l+2]=t[l+2-L],t[l+3]=t[l+3-L];l=V}}n.l=c,n.p=O,n.b=l,n.f=s,c&&(s=1,n.m=f,n.d=h,n.n=d)}while(!s);return l==t.length?t:sy(t,0,l)},hy=new Fg(0),fy=function(e,t){return e[t]|e[t+1]<<8},dy=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},py=function(e,t){return dy(e,t)+4294967296*dy(e,t+4)};function vy(e,t){return cy(e,t)}var my="undefined"!=typeof TextDecoder&&new TextDecoder;try{my.decode(hy,{stream:!0}),1}catch(e){}var gy=function(e){for(var t="",n=0;;){var r=e[n++],i=(r>127)+(r>223)+(r>239);if(n+i>e.length)return[t,sy(e,n-1)];i?3==i?(r=((15&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t+=String.fromCharCode(55296|r>>10,56320|1023&r)):t+=1&i?String.fromCharCode((31&r)<<6|63&e[n++]):String.fromCharCode((15&r)<<12|(63&e[n++])<<6|63&e[n++]):t+=String.fromCharCode(r)}};function yy(e,t){if(t){for(var n="",r=0;r<e.length;r+=16384)n+=String.fromCharCode.apply(null,e.subarray(r,r+16384));return n}if(my)return my.decode(e);var i=gy(e),a=i[0];return i[1].length&&ly(8),a}var xy=function(e,t){return t+30+fy(e,t+26)+fy(e,t+28)},_y=function(e,t,n){var r=fy(e,t+28),i=yy(e.subarray(t+46,t+46+r),!(2048&fy(e,t+8))),a=t+46+r,o=dy(e,t+20),s=n&&4294967295==o?by(e,a):[o,dy(e,t+24),dy(e,t+42)],u=s[0],l=s[1],c=s[2];return[fy(e,t+10),u,l,i,a+fy(e,t+30)+fy(e,t+32),c]},by=function(e,t){for(;1!=fy(e,t);t+=4+fy(e,t+2));return[py(e,t+12),py(e,t+4),py(e,t+20)]};"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;function Ty(e,t){for(var n={},r=e.length-22;101010256!=dy(e,r);--r)(!r||e.length-r>65558)&&ly(13);var i=fy(e,r+8);if(!i)return{};var a=dy(e,r+16),o=4294967295==a||65535==i;if(o){var s=dy(e,r-12);(o=101075792==dy(e,s))&&(i=dy(e,s+32),a=dy(e,s+48))}for(var u=t&&t.filter,l=0;l<i;++l){var c=_y(e,a,o),h=c[0],f=c[1],d=c[2],p=c[3],v=c[4],m=c[5],g=xy(e,m);a=v,u&&!u({name:p,size:f,originalSize:d,compression:h})||(h?8==h?n[p]=vy(e.subarray(g,g+f),new Fg(d)):ly(14,"unknown compression type "+h):n[p]=sy(e,g,g+f))}return n}var My=0,wy=1,Sy=function(){function e(t,n){i()(this,e),this.name=t,this.type=n,this.shapeName=null,this.isVisible=!1,this.color=null,this.fileName=null,this.fileContent=null,this.inLinkCount=0,this.properties=null}return o()(e,[{key:"IsConvertible",value:function(){return null!==this.fileName&&null!==this.fileContent&&(!!this.isVisible&&!(this.inLinkCount>0))}}]),e}(),Ey=function(){function e(){i()(this,e),this.files=null,this.properties=null,this.objectNames=[],this.objectData=new Map}return o()(e,[{key:"Init",value:function(e){var t=new Uint8Array(e);return this.files=Ty(t),this.LoadDocumentXml()?(this.LoadGuiDocumentXml(),My):wy}},{key:"GetObjectListToConvert",value:function(){var e,t=[],n=d()(this.objectNames);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.objectData.get(r);i.IsConvertible()&&t.push(i)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"IsSupportedType",value:function(e){return!(!e.startsWith("Part::")&&!e.startsWith("PartDesign::"))&&-1===e.indexOf("Part2D")}},{key:"HasFile",value:function(e){return e in this.files}},{key:"LoadDocumentXml",value:function(){var e=this.GetXMLContent("Document.xml");if(null===e)return!1;this.properties=new If("Properties");var t,n=e.getElementsByTagName("Document"),r=d()(n);try{for(r.s();!(t=r.n()).done;){var i,a=t.value,o=d()(a.childNodes);try{for(o.s();!(i=o.n()).done;){var s=i.value;"Properties"===s.tagName&&this.GetPropertiesFromElement(s,this.properties)}}catch(e){o.e(e)}finally{o.f()}}}catch(e){r.e(e)}finally{r.f()}var u,l=e.getElementsByTagName("Objects"),c=d()(l);try{for(c.s();!(u=c.n()).done;){var h,f=u.value.getElementsByTagName("Object"),p=d()(f);try{for(p.s();!(h=p.n()).done;){var v=h.value,m=v.getAttribute("name"),g=v.getAttribute("type");if(this.IsSupportedType(g)){var y=new Sy(m,g);this.objectNames.push(m),this.objectData.set(m,y)}}}catch(e){p.e(e)}finally{p.f()}}}catch(e){c.e(e)}finally{c.f()}var x,_=e.getElementsByTagName("ObjectData"),b=d()(_);try{for(b.s();!(x=b.n()).done;){var T,w=x.value.getElementsByTagName("Object"),S=d()(w);try{for(S.s();!(T=S.n()).done;){var E=T.value,k=E.getAttribute("name");if(this.objectData.has(k)){var A=this.objectData.get(k);A.properties=new If("Properties");var C,I=d()(E.childNodes);try{for(I.s();!(C=I.n()).done;){var R=C.value;"Properties"===R.tagName&&this.GetPropertiesFromElement(R,A.properties)}}catch(e){I.e(e)}finally{I.f()}var L,P=E.getElementsByTagName("Property"),N=d()(P);try{for(N.s();!(L=N.n()).done;){var O=L.value,D=O.getAttribute("name");if("Label"===D)A.shapeName=this.GetFirstChildValue(O,"String","value");else if("Visibility"===D){var F=this.GetFirstChildValue(O,"Bool","value");A.isVisible="true"===F}else if("Visible"===D){var U=this.GetFirstChildValue(O,"Bool","value");A.isVisible="true"===U}else if("Shape"===D){var G=this.GetFirstChildValue(O,"Part","file");if(!this.HasFile(G))continue;var z=M(G);if("brp"!==z&&"brep"!==z)continue;A.fileName=G,A.fileContent=this.files[G]}}}catch(e){N.e(e)}finally{N.f()}var V,B=E.getElementsByTagName("Link"),W=d()(B);try{for(W.s();!(V=W.n()).done;){var H=V.value.getAttribute("value");if(this.objectData.has(H))this.objectData.get(H).inLinkCount+=1}}catch(e){W.e(e)}finally{W.f()}}}}catch(e){S.e(e)}finally{S.f()}}}catch(e){b.e(e)}finally{b.f()}return!0}},{key:"LoadGuiDocumentXml",value:function(){var e=this.GetXMLContent("GuiDocument.xml");if(null===e)return!1;var t,n=e.getElementsByTagName("ViewProvider"),r=d()(n);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=i.getAttribute("name");if(this.objectData.has(a)){var o,s=this.objectData.get(a),u=i.getElementsByTagName("Property"),l=d()(u);try{for(l.s();!(o=l.n()).done;){var c=o.value,h=c.getAttribute("name");if("Visibility"===h){var f=this.GetFirstChildValue(c,"Bool","value");s.isVisible="true"===f}else if("ShapeColor"===h){var p=this.GetFirstChildValue(c,"PropertyColor","value"),v=parseInt(p,10);s.color=new me(v>>24&255,v>>16&255,v>>8&255,255)}}}catch(e){l.e(e)}finally{l.f()}}}}catch(e){r.e(e)}finally{r.f()}return!0}},{key:"GetPropertiesFromElement",value:function(e,t){var n,r=e.getElementsByTagName("Property"),i=d()(r);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.getAttribute("name"),s=a.getAttribute("type"),u=null;if("App::PropertyBool"===s){var l=this.GetFirstChildValue(a,"String","bool");null!==l&&l.length>0&&(u=new Cf(Af.Boolean,o,"true"===l))}else if("App::PropertyInteger"===s){var c=this.GetFirstChildValue(a,"Integer","value");null!==c&&c.length>0&&(u=new Cf(Af.Integer,o,parseInt(c)))}else if("App::PropertyString"===s){var h=this.GetFirstChildValue(a,"String","value");null!==h&&h.length>0&&(u=new Cf(Af.Text,o,h))}else if("App::PropertyUUID"===s){var f=this.GetFirstChildValue(a,"Uuid","value");null!==f&&f.length>0&&(u=new Cf(Af.Text,o,f))}else if("App::PropertyFloat"===s||"App::PropertyLength"===s||"App::PropertyDistance"===s||"App::PropertyArea"===s||"App::PropertyVolume"===s){var p=this.GetFirstChildValue(a,"Float","value");null!==p&&p.length>0&&(u=new Cf(Af.Number,o,parseFloat(p)))}null!==u&&t.AddProperty(u)}}catch(e){i.e(e)}finally{i.f()}}},{key:"GetXMLContent",value:function(e){if(!this.HasFile(e))return null;var t=new DOMParser,n=D(this.files[e]);return t.parseFromString(n,"text/xml")}},{key:"GetFirstChildValue",value:function(e,t,n){var r=e.getElementsByTagName(t);return 0===r.length?null:r[0].getAttribute(n)}}]),e}(),ky=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this)).worker=null,e.document=null,e}return o()(n,[{key:"CanImportExtension",value:function(e){return"fcstd"===e}},{key:"GetUpDirection",value:function(){return ie.Z}},{key:"ClearContent",value:function(){null!==this.worker&&(this.worker.terminate(),this.worker=null),this.document=null}},{key:"ResetContent",value:function(){this.worker=null,this.document=new Ey}},{key:"ImportContent",value:function(e,t){if(this.document.Init(e)===wy)return this.SetError("No Document.xml found."),void t();null!==this.document.properties&&this.document.properties.PropertyCount()>0&&this.model.AddPropertyGroup(this.document.properties);var n=this.document.GetObjectListToConvert();if(0===n.length)return this.SetError("No importable object found."),void t();this.ConvertObjects(n,t)}},{key:"ConvertObjects",value:function(e,t){var n=this,r=N("loaders/occt-import-js-worker.js");this.worker=new Worker(r);var i=0,a=new Bf(this.model),o=function(r){if(null!==r){var o=e[i];n.OnFileConverted(o,r,a)}if((i+=1)===e.length)t();else{var s=e[i];n.worker.postMessage({format:"brep",buffer:s.fileContent})}};this.worker.addEventListener("message",(function(e){o(e.data)})),this.worker.addEventListener("error",(function(e){o(null)}));var s=e[i];this.worker.postMessage({format:"brep",buffer:s.fileContent})}},{key:"OnFileConverted",value:function(e,t,n){if(t.success&&0!==t.meshes.length){var r=new vf;r.SetType(pf.GroupNode),null!==e.shapeName&&r.SetName(e.shapeName);var i,a=1,o=d()(t.meshes);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=null;null!==e.color&&(u=n.GetMaterialIndex(e.color.r,e.color.g,e.color.b,e.color.a));var l=Jc(s,u);if(null!==e.shapeName){var c=a.toString().padStart(3,"0");l.SetName(e.shapeName+" "+c)}null!==e.properties&&e.properties.PropertyCount()>0&&l.AddPropertyGroup(e.properties);var h=this.model.AddMesh(l);r.AddMeshIndex(h),a+=1}}catch(e){o.e(e)}finally{o.f()}this.model.GetRootNode().AddChildNode(r)}}}]),n}(Of),Ay=o()((function e(){i()(this,e),this.defaultColor=new ve(200,200,200)})),Cy={NoImportableFile:1,FailedToLoadFile:2,ImportFailed:3,UnknownError:4},Iy=o()((function e(t){i()(this,e),this.code=t,this.mainFile=null,this.message=null})),Ry=o()((function e(){i()(this,e),this.model=null,this.mainFile=null,this.upVector=null,this.usedFiles=null,this.missingFiles=null})),Ly=function(){function e(t){i()(this,e),this.getBufferCallback=t,this.fileBuffers=new Map}return o()(e,[{key:"GetFileBuffer",value:function(e){var t=T(e);if(this.fileBuffers.has(t))return this.fileBuffers.get(t);var n=this.getBufferCallback(t);return this.fileBuffers.set(t,n),n}}]),e}(),Py=function(){function e(){i()(this,e),this.importers=[new vp,new Sp,new mp,new Mp,new Ld,new tp,new fp,new Ep,new Wf,new np,new wp,new ky,new Pg,new Ng,new Og,new Dg],this.fileList=new Hh,this.model=null,this.usedFiles=[],this.missingFiles=[]}return o()(e,[{key:"AddImporter",value:function(e){this.importers.push(e)}},{key:"ImportFiles",value:function(e,t,n){var r=this;n.onLoadStart(),this.LoadFiles(e,{onReady:function(){n.onImportStart(),u((function(){r.DecompressArchives(r.fileList,(function(){r.ImportLoadedFiles(t,n)}))}))},onFileListProgress:n.onFileListProgress,onFileLoadProgress:n.onFileLoadProgress})}},{key:"LoadFiles",value:function(e,t){var n=new Hh;n.FillFromInputFiles(e);var r=!1;if(this.HasImportableFile(n))r=!0;else{for(var i=!1,a=0;a<this.missingFiles.length;a++){var o=this.missingFiles[a];n.ContainsFileByPath(o)&&(i=!0)}i?(this.fileList.ExtendFromFileList(n),r=!1):r=!0}r&&(this.fileList=n),this.fileList.GetContent({onReady:t.onReady,onFileListProgress:t.onFileListProgress,onFileLoadProgress:t.onFileLoadProgress})}},{key:"ImportLoadedFiles",value:function(e,t){var n=this,r=this.GetImportableFiles(this.fileList);if(0!==r.length)if(1!==r.length&&t.onSelectMainFile){var i=r.map((function(e){return e.file.name}));t.onSelectMainFile(i,(function(i){null!==i?u((function(){var a=r[i];n.ImportLoadedMainFile(a,e,t)})):t.onImportError(new Iy(Cy.NoImportableFile))}))}else{var a=r[0];this.ImportLoadedMainFile(a,e,t)}else t.onImportError(new Iy(Cy.NoImportableFile))}},{key:"ImportLoadedMainFile",value:function(e,t,n){var r=this;if(null===e||null===e.file||null===e.file.content){var i=new Iy(Cy.FailedToLoadFile);return null!==e&&null!==e.file&&(i.mainFile=e.file.name),void n.onImportError(i)}this.model=null,this.usedFiles=[],this.missingFiles=[],this.usedFiles.push(e.file.name);var a=e.importer,o=new Ly((function(e){var t=null,n=r.fileList.FindFileByPath(e);return null===n||null===n.content?(r.missingFiles.push(e),t=null):(r.usedFiles.push(e),t=n.content),t}));a.Import(e.file.name,e.file.extension,e.file.content,{getDefaultMaterialColor:function(){return t.defaultColor},getFileBuffer:function(e){return o.GetFileBuffer(e)},onSuccess:function(){r.model=a.GetModel();var t=new Ry;t.mainFile=e.file.name,t.model=r.model,t.usedFiles=r.usedFiles,t.missingFiles=r.missingFiles,t.upVector=a.GetUpDirection(),n.onImportSuccess(t)},onError:function(){var t=new Iy(Cy.ImportFailed);t.mainFile=e.file.name,t.message=a.GetErrorMessage(),n.onImportError(t)},onComplete:function(){a.Clear()}})}},{key:"DecompressArchives",value:function(e,t){var n,r=e.GetFiles(),i=[],a=d()(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;"zip"===o.extension&&i.push(o)}}catch(e){a.e(e)}finally{a.f()}if(0!==i.length){for(var s=0;s<i.length;s++){var u=i[s],l=Ty(new Uint8Array(u.content));for(var c in l)if(Object.prototype.hasOwnProperty.call(l,c)){var h=new Wh(c,_.Decompressed,null);h.SetContent(l[c].buffer),e.AddFile(h)}}t()}else t()}},{key:"GetFileList",value:function(){return this.fileList}},{key:"HasImportableFile",value:function(e){return this.GetImportableFiles(e).length>0}},{key:"GetImportableFiles",value:function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(r.CanImportExtension(e.extension))return r}return null}for(var n=[],r=e.GetFiles(),i=0;i<r.length;i++){var a=r[i],o=t(a,this.importers);null!==o&&n.push({file:a,importer:o})}return n}}]),e}(),Ny={IntegerToString:function(e){return e.toString()},StringToInteger:function(e){return parseInt(e,10)},NumberToString:function(e){return e.toFixed(5)},StringToNumber:function(e){return parseFloat(e)},ModelUrlsToString:function(e){return null===e?null:e.join(",")},StringToModelUrls:function(e){return null===e||0===e.length?null:e.split(",")},CameraToString:function(e){return null===e?null:[this.NumberToString(e.eye.x),this.NumberToString(e.eye.y),this.NumberToString(e.eye.z),this.NumberToString(e.center.x),this.NumberToString(e.center.y),this.NumberToString(e.center.z),this.NumberToString(e.up.x),this.NumberToString(e.up.y),this.NumberToString(e.up.z),this.NumberToString(e.fov)].join(",")},CameraModeToString:function(e){return e===Lh.Perspective?"perspective":e===Lh.Orthographic?"orthographic":null},StringToCamera:function(e){if(null===e||0===e.length)return null;var t=e.split(",");if(9!==t.length&&10!==t.length)return null;var n=45;return t.length>=10&&(n=this.StringToNumber(t[9])),new Qc(new ae(this.StringToNumber(t[0]),this.StringToNumber(t[1]),this.StringToNumber(t[2])),new ae(this.StringToNumber(t[3]),this.StringToNumber(t[4]),this.StringToNumber(t[5])),new ae(this.StringToNumber(t[6]),this.StringToNumber(t[7]),this.StringToNumber(t[8])),n)},StringToCameraMode:function(e){return"perspective"===e?Lh.Perspective:"orthographic"===e?Lh.Orthographic:null},RGBColorToString:function(e){return null===e?null:[this.IntegerToString(e.r),this.IntegerToString(e.g),this.IntegerToString(e.b)].join(",")},RGBAColorToString:function(e){return null===e?null:[this.IntegerToString(e.r),this.IntegerToString(e.g),this.IntegerToString(e.b),this.IntegerToString(e.a)].join(",")},StringToRGBColor:function(e){if(null===e||0===e.length)return null;var t=e.split(",");return 3!==t.length?null:new ve(this.StringToInteger(t[0]),this.StringToInteger(t[1]),this.StringToInteger(t[2]))},StringToRGBAColor:function(e){if(null===e||0===e.length)return null;var t=e.split(",");if(3!==t.length&&4!==t.length)return null;var n=new me(this.StringToInteger(t[0]),this.StringToInteger(t[1]),this.StringToInteger(t[2]),255);return 4===t.length&&(n.a=this.StringToInteger(t[3])),n},EnvironmentSettingsToString:function(e){return null===e?null:[e.environmentMapName,e.backgroundIsEnvMap?"on":"off"].join(",")},StringToEnvironmentSettings:function(e){if(null===e||0===e.length)return null;var t=e.split(",");return 2!==t.length?null:{environmentMapName:t[0],backgroundIsEnvMap:"on"===t[1]}},EdgeSettingsToString:function(e){return null===e?null:[e.showEdges?"on":"off",this.RGBColorToString(e.edgeColor),this.IntegerToString(e.edgeThreshold)].join(",")},StringToEdgeSettings:function(e){if(null===e||0===e.length)return null;var t=e.split(",");return 5!==t.length?null:{showEdges:"on"===t[0],edgeColor:new ve(this.StringToInteger(t[1]),this.StringToInteger(t[2]),this.StringToInteger(t[3])),edgeThreshold:this.StringToInteger(t[4])}}},Oy=function(){function e(t){i()(this,e),this.separator=t,this.paramList=""}return o()(e,[{key:"AddModelUrls",value:function(e){return this.AddUrlPart("model",Ny.ModelUrlsToString(e)),this}},{key:"AddCamera",value:function(e){return this.AddUrlPart("camera",Ny.CameraToString(e)),this}},{key:"AddCameraMode",value:function(e){return this.AddUrlPart("cameramode",Ny.CameraModeToString(e)),this}},{key:"AddEnvironmentSettings",value:function(e){return this.AddUrlPart("envsettings",Ny.EnvironmentSettingsToString(e)),this}},{key:"AddBackgroundColor",value:function(e){return this.AddUrlPart("backgroundcolor",Ny.RGBAColorToString(e)),this}},{key:"AddDefaultColor",value:function(e){return this.AddUrlPart("defaultcolor",Ny.RGBColorToString(e)),this}},{key:"AddEdgeSettings",value:function(e){return this.AddUrlPart("edgesettings",Ny.EdgeSettingsToString(e)),this}},{key:"AddUrlPart",value:function(e,t){null!==e&&null!==t&&(this.paramList.length>0&&(this.paramList+=this.separator),this.paramList+=e+"="+t)}},{key:"GetParameterList",value:function(){return this.paramList}}]),e}(),Dy=function(){function e(t,n){i()(this,e),this.separator=n,this.paramList=t}return o()(e,[{key:"GetModelUrls",value:function(){if(-1===this.paramList.indexOf("="))return this.paramList.split(",");var e=this.GetKeywordParams("model");return Ny.StringToModelUrls(e)}},{key:"GetCamera",value:function(){var e=this.GetKeywordParams("camera");return Ny.StringToCamera(e)}},{key:"GetCameraMode",value:function(){var e=this.GetKeywordParams("cameramode");return Ny.StringToCameraMode(e)}},{key:"GetEnvironmentSettings",value:function(){var e=this.GetKeywordParams("envsettings");return Ny.StringToEnvironmentSettings(e)}},{key:"GetBackgroundColor",value:function(){var e=this.GetKeywordParams("backgroundcolor");return Ny.StringToRGBAColor(e)}},{key:"GetDefaultColor",value:function(){var e=this.GetKeywordParams("defaultcolor");return Ny.StringToRGBColor(e)}},{key:"GetEdgeSettings",value:function(){var e=this.GetKeywordParams("edgesettings");return Ny.StringToEdgeSettings(e)}},{key:"GetKeywordParams",value:function(e){if(null===this.paramList||0===this.paramList.length)return null;for(var t=e+"=",n=this.paramList.split(this.separator),r=0;r<n.length;r++){var i=n[r];if(i.startsWith(t))return i.substring(t.length)}return null}}]),e}();function Fy(){return new Oy("$")}function Uy(e){return new Dy(e,"$")}function Gy(e){var t=Fy();return t.AddModelUrls(e),t.GetParameterList()}var zy=o()((function e(){i()(this,e),this.forceMediumpForMaterials=!1})),Vy=o()((function e(){i()(this,e),this.defaultMaterial=null,this.objectUrls=[]})),By=function(){function e(t){i()(this,e),this.callbacks=t,this.texturesNeeded=0,this.texturesLoaded=0,this.threeObject=null}return o()(e,[{key:"OnTextureNeeded",value:function(){this.texturesNeeded+=1}},{key:"OnTextureLoaded",value:function(){this.texturesLoaded+=1,this.callbacks.onTextureLoaded(),this.Finish()}},{key:"OnModelLoaded",value:function(e){this.threeObject=e,this.Finish()}},{key:"Finish",value:function(){null!==this.threeObject&&this.texturesNeeded===this.texturesLoaded&&this.callbacks.onModelLoaded(this.threeObject)}}]),e}(),Wy=function(){function e(t,n){i()(this,e),this.meshInstances=[],this.AddNode(t,n)}return o()(e,[{key:"AddNode",value:function(e,t){var n=e.GetTransformation().GetMatrix(),r=(new Dr).fromArray(n.Get());t.applyMatrix4(r);var i,a=d()(e.GetChildNodes());try{for(a.s();!(i=a.n()).done;){var o=i.value,s=new si;t.add(s),this.AddNode(o,s)}}catch(e){a.e(e)}finally{a.f()}var u,l=d()(e.GetMeshIndices());try{for(l.s();!(u=l.n()).done;){var c=u.value;this.meshInstances.push({node:e,threeNode:t,meshIndex:c})}}catch(e){l.e(e)}finally{l.f()}}},{key:"GetMeshInstances",value:function(){return this.meshInstances}}]),e}();function Hy(e,t,n,r){function i(e,t,n,r,i,a){function o(e,t,n,r,i){if(null!==n&&n.IsValid()){var a=new vc;e.OnTextureNeeded();var o=null;o=null!==n.mimeType?W(n.buffer,n.mimeType):B(n.buffer),r.objectUrls.push(o),a.load(o,(function(r){!function(e,t){t.wrapS=pt,t.wrapT=pt,t.rotation=e.rotation,t.offset.x=e.offset.x,t.offset.y=e.offset.y,t.repeat.x=e.scale.x,t.repeat.y=e.scale.y}(n,r),t.needsUpdate=!0,i(r),e.OnTextureLoaded()}),null,(function(t){e.OnTextureLoaded()}))}}var s=t.GetMaterial(n),u=Zc(s.color);s.vertexColors&&u.setRGB(1,1,1);var l={color:u,vertexColors:s.vertexColors,opacity:s.opacity,transparent:s.transparent,alphaTest:s.alphaTest,side:2};i.forceMediumpForMaterials&&(l.precision="mediump");var c=null;if(r===Xc.Phong){if(c=new Fl(l),s.type===We.Phong){var h=Zc(s.specular);ee(s.shininess,0)&&h.setRGB(0,0,0),c.specular=h,c.shininess=100*s.shininess,o(e,c,s.specularMap,a,(function(e){c.specularMap=e}))}}else r===Xc.Physical&&(c=new Dl(l),s.type===We.Physical&&(c.metalness=s.metalness,c.roughness=s.roughness,o(e,c,s.metalnessMap,a,(function(e){c.metalness=1,c.roughness=1,c.metalnessMap=e,c.roughnessMap=e}))));var f=Zc(s.emissive);return c.emissive=f,o(e,c,s.diffuseMap,a,(function(e){s.multiplyDiffuseMap||c.color.setRGB(1,1,1),c.map=e})),o(e,c,s.bumpMap,a,(function(e){c.bumpMap=e})),o(e,c,s.normalMap,a,(function(e){c.normalMap=e})),o(e,c,s.emissiveMap,a,(function(e){c.emissiveMap=e})),s.isDefault&&(a.defaultMaterial=c),c}function a(e,t,n,r){if(nf(t.GetMesh(n.meshIndex))===tf.TriangleMesh){var i=function(e,t,n){for(var r=e.GetMesh(t.meshIndex),i=r.TriangleCount(),a=[],o=0;o<i;o++)a.push(o);a.sort((function(e,t){var n=r.GetTriangle(e),i=r.GetTriangle(t);return n.mat-i.mat}));var s=new Oi,u=[],l=[],c=new Map,h=[],f=[],d=[],p=[],v=[];v.push({start:0,end:-1});for(var m=r.VertexColorCount()>0,g=r.TextureUVCount()>0,y=0;y<a.length;y++){var x=a[y],_=r.GetTriangle(x),b=r.GetVertex(_.v0),T=r.GetVertex(_.v1),M=r.GetVertex(_.v2);if(h.push(b.x,b.y,b.z,T.x,T.y,T.z,M.x,M.y,M.z),_.HasVertexColors()){var w=Zc(r.GetVertexColor(_.c0)),S=Zc(r.GetVertexColor(_.c1)),E=Zc(r.GetVertexColor(_.c2));f.push(w.r,w.g,w.b,S.r,S.g,S.b,E.r,E.g,E.b)}else m&&f.push(0,0,0,0,0,0,0,0,0);var k=r.GetNormal(_.n0),A=r.GetNormal(_.n1),C=r.GetNormal(_.n2);if(d.push(k.x,k.y,k.z,A.x,A.y,A.z,C.x,C.y,C.z),_.HasTextureUVs()){var I=r.GetTextureUV(_.u0),R=r.GetTextureUV(_.u1),L=r.GetTextureUV(_.u2);p.push(I.x,I.y,R.x,R.y,L.x,L.y)}else g&&p.push(0,0,0,0,0,0);var P=_.mat;c.has(P)||(c.set(P,u.length),u.push(n[P]),l.push(P),y>0&&(v[v.length-1].end=y-1,v.push({start:v[v.length-1].end+1,end:-1})))}v[v.length-1].end=i-1,s.setAttribute("position",new ki(h,3)),0!==f.length&&s.setAttribute("color",new ki(f,3)),s.setAttribute("normal",new ki(d,3)),0!==p.length&&s.setAttribute("uv",new ki(p,2));for(var N=0;N<v.length;N++){var O=v[N];s.addGroup(3*O.start,3*(O.end-O.start+1),N)}var D=new $i(s,u);return D.name=r.GetName(),D.userData={originalMeshId:t,originalMaterials:l,threeMaterials:null},D}(t,n,r);e.add(i)}}for(var o=new By(r),s=Yc(e),u=[],l=0;l<e.MaterialCount();l++){var h=i(o,e,l,s,t,n);u.push(h)}!function(e,t,n,r){var i=t.GetRootNode(),o=new Wy(i,e).GetMeshInstances();c(o.length,100,{runTask:function(e,r,i){for(var s=e;s<=r;s++){var u=o[s],l=u.node,c=u.threeNode,h=new hf(l.GetId(),u.meshIndex);a(c,t,h,n)}i()},onReady:function(){r.OnModelLoaded(e)}})}(new si,e,u,o)}var jy=function(){function e(){i()(this,e),this.importer=new Py,this.inProgress=!1,this.defaultMaterial=null,this.objectUrls=null,this.hasHighpDriverIssue=qc()}return o()(e,[{key:"InProgress",value:function(){return this.inProgress}},{key:"LoadModel",value:function(e,t,n){var r=this;this.inProgress||(this.inProgress=!0,this.RevokeObjectUrls(),this.importer.ImportFiles(e,t,{onLoadStart:function(){n.onLoadStart()},onFileListProgress:function(e,t){n.onFileListProgress(e,t)},onFileLoadProgress:function(e,t){n.onFileLoadProgress(e,t)},onImportStart:function(){n.onImportStart()},onSelectMainFile:function(e,t){n.onSelectMainFile?n.onSelectMainFile(e,t):t(0)},onImportSuccess:function(e){n.onVisualizationStart();var t=new zy;t.forceMediumpForMaterials=r.hasHighpDriverIssue;var i=new Vy;Hy(e.model,t,i,{onTextureLoaded:function(){n.onTextureLoaded()},onModelLoaded:function(t){if(r.defaultMaterial=i.defaultMaterial,r.objectUrls=i.objectUrls,e.upVector===ie.X){var a=(new ir).setFromAxisAngle(new ar(0,0,1),Math.PI/2);t.quaternion.multiply(a)}else if(e.upVector===ie.Z){var o=(new ir).setFromAxisAngle(new ar(1,0,0),-Math.PI/2);t.quaternion.multiply(o)}n.onModelFinished(e,t),r.inProgress=!1}})},onImportError:function(e){n.onLoadError(e),r.inProgress=!1}}))}},{key:"GetImporter",value:function(){return this.importer}},{key:"GetDefaultMaterial",value:function(){return this.defaultMaterial}},{key:"ReplaceDefaultMaterialColor",value:function(e){null===this.defaultMaterial||this.defaultMaterial.vertexColors||(this.defaultMaterial.color=Zc(e))}},{key:"RevokeObjectUrls",value:function(){if(null!==this.objectUrls){var e,t=d()(this.objectUrls);try{for(t.s();!(e=t.n()).done;){H(e.value)}}catch(e){t.e(e)}finally{t.f()}this.objectUrls=null}}}]),e}(),qy=function(){function e(t,n){var r=this;i()(this,e),this.parentElement=t,this.parameters={},v(n)&&(this.parameters=n),this.canvas=document.createElement("canvas"),this.parentElement.appendChild(this.canvas),this.viewer=new Gh,this.viewer.Init(this.canvas);var a=this.parentElement.clientWidth,o=this.parentElement.clientHeight;if(this.viewer.Resize(a,o),this.parameters.cameraMode&&this.viewer.SetCameraMode(this.parameters.cameraMode),this.parameters.backgroundColor&&this.viewer.SetBackgroundColor(this.parameters.backgroundColor),this.parameters.edgeSettings&&this.viewer.SetEdgeSettings(this.parameters.edgeSettings.showEdges,this.parameters.edgeSettings.edgeColor,this.parameters.edgeSettings.edgeThreshold),this.parameters.environmentSettings){var s=this.parameters.environmentSettings.environmentMap,u=this.parameters.environmentSettings.backgroundIsEnvMap;this.viewer.SetEnvironmentMapSettings(s,u)}this.model=null,window.addEventListener("resize",(function(){r.Resize()}))}return o()(e,[{key:"LoadModelFromUrlList",value:function(e){E(e);var t=Vh(e);this.LoadModelFromInputFiles(t)}},{key:"LoadModelFromFileList",value:function(e){var t=Bh(e);this.LoadModelFromInputFiles(t)}},{key:"LoadModelFromInputFiles",value:function(e){var t=this;if(null===e||0===e.length)return null;this.viewer.Clear();var n=new Ay;this.parameters.defaultColor&&(n.defaultColor=this.parameters.defaultColor),this.model=null;var r=null;(new jy).LoadModel(e,n,{onLoadStart:function(){t.canvas.style.display="none",(r=document.createElement("div")).innerHTML="Loading model...",t.parentElement.appendChild(r)},onFileListProgress:function(e,t){},onFileLoadProgress:function(e,t){},onImportStart:function(){r.innerHTML="Importing model..."},onVisualizationStart:function(){r.innerHTML="Visualizing model..."},onModelFinished:function(e,n){t.parentElement.removeChild(r),t.canvas.style.display="inherit",t.viewer.SetMainObject(n);var i=t.viewer.GetBoundingSphere((function(e){return!0}));t.viewer.AdjustClippingPlanesToSphere(i),t.parameters.camera?t.viewer.SetCamera(t.parameters.camera):(t.viewer.SetUpVector(ie.Y,!1),t.viewer.FitSphereToWindow(i,!1)),t.model=e.model,t.parameters.onModelLoaded&&t.parameters.onModelLoaded()},onTextureLoaded:function(){t.viewer.Render()},onLoadError:function(e){var t="Unknown error.";e.code===Cy.NoImportableFile?t="No importable file found.":e.code===Cy.FailedToLoadFile?t="Failed to load file for import.":e.code===Cy.ImportFailed&&(t="Failed to import model."),null!==e.message&&(t+=" ("+e.message+")"),r.innerHTML=t}})}},{key:"GetViewer",value:function(){return this.viewer}},{key:"GetModel",value:function(){return this.model}},{key:"Resize",value:function(){var e=this.parentElement.clientWidth,t=this.parentElement.clientHeight;this.viewer.Resize(e,t)}}]),e}();function Xy(e,t,n){var r=new qy(e,n);return r.LoadModelFromUrlList(t),r}function Yy(e){function t(e){var t=null,n=e.getAttribute("camera");n&&(t=Ny.StringToCamera(n));var r=null,i=e.getAttribute("cameramode");i&&(r=Ny.StringToCameraMode(i));var a=null,o=e.getAttribute("backgroundcolor");o&&(a=Ny.StringToRGBAColor(o));var s=null,u=e.getAttribute("defaultcolor");u&&(s=Ny.StringToRGBColor(u));var l=null,c=e.getAttribute("edgesettings");c&&(l=Ny.StringToEdgeSettings(c));var h=null,f=e.getAttribute("environmentmap");if(f){var d=f.split(",");if(6===d.length){var p=!1,v=e.getAttribute("environmentmapbg");v&&"true"===v&&(p=!0),h={environmentMap:d,backgroundIsEnvMap:p}}}var m=null,g=e.getAttribute("model");return g&&(m=Ny.StringToModelUrls(g)),Xy(e,m,{camera:t,cameraMode:r,backgroundColor:a,defaultColor:s,edgeSettings:l,environmentSettings:h})}var n=[];window.addEventListener("load",(function(){for(var r=document.getElementsByClassName("online_3d_viewer"),i=0;i<r.length;i++){var a=t(r[i]);n.push(a)}null!=e&&e(n)}))}function Ky(e,t,n){var r=le(e,t),i=le(t,n),a=le(e,n),o=(r+i+a)/2,s=o*(o-r)*(o-i)*(o-a);return s<0?0:Math.sqrt(s)}function Zy(e,t,n){return ce(e,fe(t,n))/6}function Jy(e){if(e instanceof mf){var t=0;return e.EnumerateMeshInstances((function(e){t+=Jy(e)})),t}var n=0;return e.EnumerateTriangleVertices((function(e,t,r){n+=Zy(e,t,r)})),n}function Qy(e){var t=0;return e.EnumerateTriangleVertices((function(e,n,r){t+=Ky(e,n,r)})),t}var $y=function(){function e(){i()(this,e),this.indices=[],this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.material=null}return o()(e,[{key:"GetBounds",value:function(){for(var e=[1/0,1/0,1/0],t=[-1/0,-1/0,-1/0],n=0;n<this.vertices.length/3;n++)for(var r=0;r<3;r++)e[r]=Math.min(e[r],this.vertices[3*n+r]),t[r]=Math.max(t[r],this.vertices[3*n+r]);return{min:e,max:t}}},{key:"GetByteLength",value:function(e,t){return this.indices.length*e+(this.vertices.length+this.colors.length+this.normals.length+this.uvs.length)*t}}]),e}(),ex=function(){function e(){i()(this,e),this.primitives=[]}return o()(e,[{key:"PrimitiveCount",value:function(){return this.primitives.length}},{key:"GetPrimitive",value:function(e){return this.primitives[e]}},{key:"GetByteLength",value:function(e,t){for(var n=0,r=0;r<this.primitives.length;r++){n+=this.primitives[r].GetByteLength(e,t)}return n}}]),e}();function tx(e){function t(e,t,n,r){function i(e,t,n){return null!==t?e.GetVertexColor(t):n?new ve(0,0,0):null}function a(e,t,n){return null!==t?e.GetTextureUV(t):n?new Ae(0,0):null}function o(e,t,n){var r=e.VertexColorCount()>0,o=e.TextureUVCount()>0,s=e.GetVertex(t.vertex),u=e.GetNormal(t.normal),l=n.vertices.length/3;n.indices.push(l),n.vertices.push(s.x,s.y,s.z);var c=i(e,t.color,r);null!==c&&n.colors.push(c.r/255,c.g/255,c.b/255),n.normals.push(u.x,u.y,u.z);var h=a(e,t.uv,o);return null!==h&&n.uvs.push(h.x,h.y),{index:l,color:c,normal:u,uv:h}}if(r.has(t.vertex)){var s=r.get(t.vertex),u=function(e,t,n){function r(e,t,n){return null===n&&null===t||ke(n,i(e,t,!0))}function o(e,t,n){return oe(n,e.GetNormal(t))}function s(e,t,n){return null===n&&null===t||Ce(n,a(e,t,!0))}for(var u=0;u<t.length;u++){var l=t[u],c=r(e,n.color,l.color),h=o(e,n.normal,l.normal),f=s(e,n.uv,l.uv);if(c&&h&&f)return l}return null}(e,s,t);if(null!==u)n.indices.push(u.index);else{var l=o(e,t,n);s.push(l)}}else{var c=o(e,t,n);r.set(t.vertex,[c])}}var n=new ex,r=e.TriangleCount();if(0===r)return null;for(var i=[],a=0;a<r;a++)i.push(a);i.sort((function(t,n){var r=e.GetTriangle(t),i=e.GetTriangle(n);return r.mat-i.mat}));for(var o=null,s=null,u=0;u<i.length;u++){var l=i[u],c=e.GetTriangle(l);null!==o&&o.material===c.mat||((o=new $y).material=c.mat,s=new Map,n.primitives.push(o));var h={vertex:c.v0,color:c.c0,normal:c.n0,uv:c.u0},f={vertex:c.v1,color:c.c1,normal:c.n1,uv:c.u1},d={vertex:c.v2,color:c.c2,normal:c.n2,uv:c.u2};t(e,h,o,s),t(e,f,o,s),t(e,d,o,s)}return n}var nx=function(){function e(t){i()(this,e),this.name=t,this.content=null}return o()(e,[{key:"GetName",value:function(){return this.name}},{key:"SetName",value:function(e){this.name=e}},{key:"GetTextContent",value:function(){return D(this.content)}},{key:"GetBufferContent",value:function(){return this.content}},{key:"SetTextContent",value:function(e){var t=G(e);this.content=t}},{key:"SetBufferContent",value:function(e){this.content=e}}]),e}(),rx=function(){function e(){i()(this,e)}return o()(e,[{key:"CanExport",value:function(e,t){return!1}},{key:"Export",value:function(e,t,n){var r=[];this.ExportContent(e,t,r,(function(){n(r)}))}},{key:"ExportContent",value:function(e,t,n,r){}},{key:"GetExportedMaterialName",value:function(e){return this.GetExportedName(e,"Material")}},{key:"GetExportedMeshName",value:function(e){return this.GetExportedName(e,"Mesh")}},{key:"GetExportedName",value:function(e,t){return 0===e.length?t:e}}]),e}();var ix=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanExport",value:function(e,t){return e===b.Text&&"bim"===t}},{key:"ExportContent",value:function(e,t,n,r){var i=this,a={schema_version:"1.0.0",meshes:[],elements:[],info:{}};this.ExportProperties(e.GetModel(),a.info);var o=0;e.EnumerateTransformedMeshes((function(t){var n={mesh_id:o,coordinates:[],indices:[]};t.EnumerateVertices((function(e){n.coordinates.push(e.x,e.y,e.z)})),t.EnumerateTriangleVertexIndices((function(e,t,r){n.indices.push(e,t,r)}));for(var r={mesh_id:o,type:"Other",color:{r:200,g:200,b:200,a:255},vector:{x:0,y:0,z:0},rotation:{qx:0,qy:0,qz:0,qw:1},guid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),info:{}},s=null,u=!0,l=[],c=0;c<t.TriangleCount();c++){var h=t.GetTriangle(c),f=e.GetMaterial(h.mat),d={r:f.color.r,g:f.color.g,b:f.color.b,a:ge(f.opacity)};l.push(d.r,d.g,d.b,d.a),u&&(null===s?s=d:s.r===d.r&&s.g===d.g&&s.b===d.b&&s.a===d.a||(u=!1,s=null))}u?r.color=s:r.face_colors=l,r.info.Name=t.GetName(),i.ExportProperties(t,r.info),a.meshes.push(n),a.elements.push(r),o+=1}));var s=new nx("model.bim");s.SetTextContent(JSON.stringify(a,null,4)),n.push(s),r()}},{key:"ExportProperties",value:function(e,t){for(var n=0;n<e.PropertyGroupCount();n++)for(var r=e.GetPropertyGroup(n),i=0;i<r.PropertyCount();i++){var a=r.GetProperty(i);t[a.name]=Rf(a)}}}]),n}(rx),ax=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this)).rhino=null,e}return o()(n,[{key:"CanExport",value:function(e,t){return e===b.Binary&&"3dm"===t}},{key:"ExportContent",value:function(e,t,n,r){var i=this;null===this.rhino?O("loaders/rhino3dm.min.js").then((function(){rhino3dm().then((function(t){i.rhino=t,i.ExportRhinoContent(e,n,r)}))})).catch((function(){r()})):this.ExportRhinoContent(e,n,r)}},{key:"ExportRhinoContent",value:function(e,t,n){var r=this;function i(e){return{r:e.r,g:e.g,b:e.b,a:255}}var a=new nx("model.3dm");t.push(a);var o=new this.rhino.File3dm;e.EnumerateTransformedMeshes((function(t){for(var n=tx(t),a=0;a<n.PrimitiveCount();a++){var s=n.GetPrimitive(a),u={data:{attributes:{position:{itemSize:3,type:"Float32Array",array:s.vertices},normal:{itemSize:3,type:"Float32Array",array:s.normals}},index:{type:"Uint16Array",array:s.indices}}},l=e.GetMaterial(s.material),c=new r.rhino.Material;c.name=r.GetExportedMaterialName(l.name),l.type===We.Phong&&(c.ambientColor=i(l.ambient),c.specularColor=i(l.specular)),c.diffuseColor=i(l.color),c.transparency=1-l.opacity;var h=o.materials().count();o.materials().add(c);var f=new r.rhino.Mesh.createFromThreejsJSON(u),d=new r.rhino.ObjectAttributes;d.name=r.GetExportedMeshName(t.GetName()),d.materialSource=r.rhino.ObjectMaterialSource.MaterialFromObject,d.materialIndex=h,o.objects().add(f,d)}}));var s=new this.rhino.File3dmWriteOptions;s.version=6;var u=o.toByteArray(s);a.SetBufferContent(u),n()}}]),n}(rx),ox=function(e){Ue()(n,e);var t=ze()(n);function n(){var e;return i()(this,n),(e=t.call(this)).components={index:{type:5125,size:4},number:{type:5126,size:4}},e}return o()(n,[{key:"CanExport",value:function(e,t){return e===b.Text&&"gltf"===t||e===b.Binary&&"glb"===t}},{key:"ExportContent",value:function(e,t,n,r){t===b.Text?this.ExportAsciiContent(e,n):t===b.Binary&&this.ExportBinaryContent(e,n),r()}},{key:"ExportAsciiContent",value:function(e,t){var n=new nx("model.gltf"),r=new nx("model.bin");t.push(n),t.push(r);var i=this.GetMeshData(e),a=this.GetMainBuffer(i),o=this.GetMainJson(i);o.buffers.push({uri:r.GetName(),byteLength:a.byteLength});var s=new Map;this.ExportMaterials(e,o,(function(e){var n=T(e.name);if(s.has(n))return s.get(n);var r=new nx(n);r.SetBufferContent(e.buffer),t.push(r);var i=o.textures.length;return s.set(n,i),o.images.push({uri:n}),o.textures.push({source:i}),i})),n.SetTextContent(JSON.stringify(o,null,4)),r.SetBufferContent(a)}},{key:"ExportBinaryContent",value:function(e,t){function n(e){var t=e%4;return 0===t?e:e+(4-t)}function r(e,t,n){for(var r=0;r<n;r++)e.WriteUnsignedCharacter8(t)}var i=new nx("model.glb");t.push(i);var a=this.GetMeshData(e),o=this.GetMainBuffer(a),s=this.GetMainJson(a),u=[],l=o.byteLength,c=new Map;this.ExportMaterials(e,s,(function(e){var t=T(e.name),n=M(e.name);if(c.has(t))return c.get(t);var r=s.bufferViews.length,i=s.textures.length;c.set(t,i);var a=e.buffer;return u.push(a),s.bufferViews.push({buffer:0,byteOffset:l,byteLength:a.byteLength}),l+=a.byteLength,s.images.push({bufferView:r,mimeType:"image/"+n}),s.textures.push({source:i}),i}));for(var h=o.byteLength,f=0;f<u.length;f++){h+=u[f].byteLength}var d=n(h);s.buffers.push({byteLength:d});var p=G(JSON.stringify(s)),v=p.byteLength,m=n(v),g=20+m+8+d,y=new I(g,!0);y.WriteUnsignedInteger32(1179937895),y.WriteUnsignedInteger32(2),y.WriteUnsignedInteger32(g),y.WriteUnsignedInteger32(m),y.WriteUnsignedInteger32(1313821514),y.WriteArrayBuffer(p),r(y,32,m-v),y.WriteUnsignedInteger32(d),y.WriteUnsignedInteger32(5130562),y.WriteArrayBuffer(o);for(var x=0;x<u.length;x++){var _=u[x];y.WriteArrayBuffer(_)}r(y,0,d-h),i.SetBufferContent(y.GetBuffer())}},{key:"GetMeshData",value:function(e){var t=[];return e.EnumerateTransformedMeshes((function(e){var n=tx(e);t.push({name:e.GetName(),buffer:n,offsets:[],sizes:[]})})),t}},{key:"GetMainBuffer",value:function(e){for(var t=0,n=0;n<e.length;n++){t+=e[n].buffer.GetByteLength(this.components.index.size,this.components.number.size)}for(var r=new I(t,!0),i=0;i<e.length;i++)for(var a=e[i],o=0;o<a.buffer.PrimitiveCount();o++){for(var s=a.buffer.GetPrimitive(o),u=r.GetPosition(),l=0;l<s.indices.length;l++)r.WriteUnsignedInteger32(s.indices[l]);for(var c=0;c<s.vertices.length;c++)r.WriteFloat32(s.vertices[c]);for(var h=0;h<s.colors.length;h++)r.WriteFloat32(_e(s.colors[h]));for(var f=0;f<s.normals.length;f++)r.WriteFloat32(s.normals[f]);for(var d=0;d<s.uvs.length;d++){var p=s.uvs[d];d%2==1&&(p*=-1),r.WriteFloat32(p)}a.offsets.push(u),a.sizes.push(r.GetPosition()-u)}return r.GetBuffer()}},{key:"GetMainJson",value:function(e){for(var t=function(){function e(t,n){i()(this,e),this.mainJson=t,this.byteOffset=n}return o()(e,[{key:"AddBufferView",value:function(e){return this.mainJson.bufferViews.push({buffer:0,byteOffset:this.byteOffset,byteLength:e}),this.byteOffset+=e,this.mainJson.bufferViews.length-1}}]),e}(),n={asset:{generator:"https://3dviewer.net",version:"2.0"},scene:0,scenes:[{nodes:[]}],nodes:[],materials:[],meshes:[],buffers:[],bufferViews:[],accessors:[]},r=0;r<e.length;r++){var a=e[r];n.scenes[0].nodes.push(r),n.nodes.push({mesh:r});for(var s={name:this.GetExportedMeshName(a.name),primitives:[]},u=a.buffer.primitives,l=0;l<u.length;l++){var c=u[l],h=new t(n,a.offsets[l]),f=h.AddBufferView(c.indices.length*this.components.index.size),d=h.AddBufferView(c.vertices.length*this.components.number.size),p=null;c.colors.length>0&&(p=h.AddBufferView(c.colors.length*this.components.number.size));var v=h.AddBufferView(c.normals.length*this.components.number.size),m=null;c.uvs.length>0&&(m=h.AddBufferView(c.uvs.length*this.components.number.size));var g={attributes:{},mode:4,material:c.material},y=c.GetBounds();n.accessors.push({bufferView:f,byteOffset:0,componentType:this.components.index.type,count:c.indices.length,type:"SCALAR"}),g.indices=n.accessors.length-1,n.accessors.push({bufferView:d,byteOffset:0,componentType:this.components.number.type,count:c.vertices.length/3,min:y.min,max:y.max,type:"VEC3"}),g.attributes.POSITION=n.accessors.length-1,null!==p&&(n.accessors.push({bufferView:p,byteOffset:0,componentType:this.components.number.type,count:c.colors.length/3,type:"VEC3"}),g.attributes.COLOR_0=n.accessors.length-1),n.accessors.push({bufferView:v,byteOffset:0,componentType:this.components.number.type,count:c.normals.length/3,type:"VEC3"}),g.attributes.NORMAL=n.accessors.length-1,null!==m&&(n.accessors.push({bufferView:m,byteOffset:0,componentType:this.components.number.type,count:c.uvs.length/2,type:"VEC2"}),g.attributes.TEXCOORD_0=n.accessors.length-1),s.primitives.push(g)}n.meshes.push(s)}return n}},{key:"ExportMaterials",value:function(e,t,n){function r(e,t,n,r){function i(e,t){return[_e(e.r/255),_e(e.g/255),_e(e.b/255),t]}function a(e,t,n){if(null===t||!t.IsValid())return null;void 0===e.images&&(e.images=[]),void 0===e.textures&&(e.textures=[]);var r={index:n(t)};if(t.HasTransformation()){var i="KHR_texture_transform";void 0===e.extensionsUsed&&(e.extensionsUsed=[]),-1===e.extensionsUsed.indexOf(i)&&e.extensionsUsed.push(i),r.extensions={KHR_texture_transform:{offset:[t.offset.x,-t.offset.y],scale:[t.scale.x,t.scale.y],rotation:-t.rotation}}}return r}var o,s={name:e.GetExportedMaterialName(n.name),pbrMetallicRoughness:{baseColorFactor:i(n.color,n.opacity)},emissiveFactor:(o=n.emissive,[_e(o.r/255),_e(o.g/255),_e(o.b/255)]),doubleSided:!0,alphaMode:"OPAQUE"};n.transparent&&(s.alphaMode="BLEND");var u=a(t,n.diffuseMap,r);if(null!==u&&(n.multiplyDiffuseMap||(s.pbrMetallicRoughness.baseColorFactor=i(new ve(255,255,255),n.opacity)),s.pbrMetallicRoughness.baseColorTexture=u),n.type===We.Physical){var l=a(t,n.metalnessMap,r);null!==l?s.pbrMetallicRoughness.metallicRoughnessTexture=l:(s.pbrMetallicRoughness.metallicFactor=n.metalness,s.pbrMetallicRoughness.roughnessFactor=n.roughness)}var c=a(t,n.normalMap,r);null!==c&&(s.normalTexture=c);var h=a(t,n.emissiveMap,r);null!==h&&(s.emissiveTexture=h),t.materials.push(s)}for(var i=0;i<e.MaterialCount();i++){r(this,t,e.GetMaterial(i),n)}}}]),n}(rx),sx=o()((function e(t){i()(this,e),this.transformation=new $h,this.isMeshVisible=function(e){return!0},g(t,this)})),ux=function(){function e(t,n){i()(this,e),this.model=t,this.settings=n||new sx}return o()(e,[{key:"GetModel",value:function(){return this.model}},{key:"MaterialCount",value:function(){return this.model.MaterialCount()}},{key:"GetMaterial",value:function(e){return this.model.GetMaterial(e)}},{key:"VertexCount",value:function(){var e=0;return this.EnumerateMeshInstances((function(t){e+=t.VertexCount()})),e}},{key:"TriangleCount",value:function(){var e=0;return this.EnumerateMeshInstances((function(t){e+=t.TriangleCount()})),e}},{key:"MeshInstanceCount",value:function(){var e=0;return this.EnumerateMeshInstances((function(t){e+=1})),e}},{key:"EnumerateMeshInstances",value:function(e){var t=this;this.model.EnumerateMeshInstances((function(n){t.settings.isMeshVisible(n.GetId())&&e(n)}))}},{key:"EnumerateTransformedMeshes",value:function(e){var t=this;this.EnumerateMeshInstances((function(n){var r=n.GetTransformation();t.settings.transformation.IsIdentity()||r.Append(t.settings.transformation);var i=n.GetMesh().Clone();r.IsIdentity()||af(i,r),e(i)}))}},{key:"EnumerateVerticesAndTriangles",value:function(e){var t=[];this.EnumerateTransformedMeshes((function(e){t.push(e)}));for(var n=0,r=t;n<r.length;n++){r[n].EnumerateVertices((function(t){e.onVertex(t.x,t.y,t.z)}))}for(var i=0,a=0,o=t;a<o.length;a++){var s=o[a];s.EnumerateTriangleVertexIndices((function(t,n,r){e.onTriangle(t+i,n+i,r+i)})),i+=s.VertexCount()}}},{key:"EnumerateTrianglesWithNormals",value:function(e){this.EnumerateTransformedMeshes((function(t){t.EnumerateTriangleVertices((function(t,n,r){var i=rf(t,n,r);e(t,n,r,i)}))}))}}]),e}(),lx=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanExport",value:function(e,t){return e===b.Text&&"obj"===t}},{key:"ExportContent",value:function(e,t,n,r){var i=this;function a(e,t,n,r){if(null!==n&&n.IsValid()){var i=T(n.name);if(e.WriteArrayLine([t,i]),-1===r.findIndex((function(e){return e.GetName()===i}))){var a=new nx(i);a.SetBufferContent(n.buffer),r.push(a)}}}var o=new nx("model.mtl"),s=new nx("model.obj");n.push(o),n.push(s);var u=new A;u.WriteLine(this.GetHeaderText());for(var l=0;l<e.MaterialCount();l++){var c=e.GetMaterial(l);u.WriteArrayLine(["newmtl",this.GetExportedMaterialName(c.name)]),u.WriteArrayLine(["Kd",c.color.r/255,c.color.g/255,c.color.b/255]),u.WriteArrayLine(["d",c.opacity]),c.type===We.Phong&&(u.WriteArrayLine(["Ka",c.ambient.r/255,c.ambient.g/255,c.ambient.b/255]),u.WriteArrayLine(["Ks",c.specular.r/255,c.specular.g/255,c.specular.b/255]),u.WriteArrayLine(["Ns",1e3*c.shininess])),a(u,"map_Kd",c.diffuseMap,n),c.type===We.Phong&&a(u,"map_Ks",c.specularMap,n),a(u,"bump",c.bumpMap,n)}o.SetTextContent(u.GetText());var h=new A;h.WriteLine(this.GetHeaderText()),h.WriteArrayLine(["mtllib",o.GetName()]);var f=0,d=0,p=0,v=null;e.EnumerateTransformedMeshes((function(t){h.WriteArrayLine(["g",i.GetExportedMeshName(t.GetName())]);for(var n=0;n<t.VertexCount();n++){var r=t.GetVertex(n);h.WriteArrayLine(["v",r.x,r.y,r.z])}for(var a=0;a<t.NormalCount();a++){var o=t.GetNormal(a);h.WriteArrayLine(["vn",o.x,o.y,o.z])}for(var s=0;s<t.TextureUVCount();s++){var u=t.GetTextureUV(s);h.WriteArrayLine(["vt",u.x,u.y])}for(var l=0;l<t.TriangleCount();l++){var c=t.GetTriangle(l),m=c.v0+f+1,g=c.v1+f+1,y=c.v2+f+1,x=c.n0+d+1,_=c.n1+d+1,b=c.n2+d+1;if(null!==c.mat){var T=e.GetMaterial(c.mat),M=i.GetExportedMaterialName(T.name);M!==v&&(h.WriteArrayLine(["usemtl",M]),v=M)}var w="",S="",E="";c.HasTextureUVs()&&(w=c.u0+p+1,S=c.u1+p+1,E=c.u2+p+1),h.WriteArrayLine(["f",[m,w,x].join("/"),[g,S,_].join("/"),[y,E,b].join("/")])}f+=t.VertexCount(),d+=t.NormalCount(),p+=t.TextureUVCount()})),s.SetTextContent(h.GetText()),r()}},{key:"GetHeaderText",value:function(){return"# exported by https://3dviewer.net"}}]),n}(rx),cx=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanExport",value:function(e,t){return e===b.Text&&"off"===t}},{key:"ExportContent",value:function(e,t,n,r){var i=new nx("model.off");n.push(i);var a=new A;a.WriteLine("OFF"),a.WriteArrayLine([e.VertexCount(),e.TriangleCount(),0]),e.EnumerateVerticesAndTriangles({onVertex:function(e,t,n){a.WriteArrayLine([e,t,n])},onTriangle:function(e,t,n){a.WriteArrayLine([3,e,t,n])}}),i.SetTextContent(a.GetText()),r()}}]),n}(rx),hx=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanExport",value:function(e,t){return(e===b.Text||e===b.Binary)&&"ply"===t}},{key:"ExportContent",value:function(e,t,n,r){t===b.Text?this.ExportText(e,n):this.ExportBinary(e,n),r()}},{key:"ExportText",value:function(e,t){var n=new nx("model.ply");t.push(n);var r=new A,i=e.VertexCount(),a=e.TriangleCount(),o=this.GetHeaderText("ascii",i,a);r.Write(o),e.EnumerateVerticesAndTriangles({onVertex:function(e,t,n){r.WriteArrayLine([e,t,n])},onTriangle:function(e,t,n){r.WriteArrayLine([3,e,t,n])}}),n.SetTextContent(r.GetText())}},{key:"ExportBinary",value:function(e,t){var n=new nx("model.ply");t.push(n);for(var r=e.VertexCount(),i=e.TriangleCount(),a=this.GetHeaderText("binary_little_endian",r,i),o=a.length+3*r*4+13*i,s=new I(o,!0),u=0;u<a.length;u++)s.WriteUnsignedCharacter8(a.charCodeAt(u));e.EnumerateVerticesAndTriangles({onVertex:function(e,t,n){s.WriteFloat32(e),s.WriteFloat32(t),s.WriteFloat32(n)},onTriangle:function(e,t,n){s.WriteUnsignedCharacter8(3),s.WriteInteger32(e),s.WriteInteger32(t),s.WriteInteger32(n)}}),n.SetBufferContent(s.GetBuffer())}},{key:"GetHeaderText",value:function(e,t,n){var r=new A;return r.WriteLine("ply"),r.WriteLine("format "+e+" 1.0"),r.WriteLine("element vertex "+t),r.WriteLine("property float x"),r.WriteLine("property float y"),r.WriteLine("property float z"),r.WriteLine("element face "+n),r.WriteLine("property list uchar int vertex_index"),r.WriteLine("end_header"),r.GetText()}}]),n}(rx),fx=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanExport",value:function(e,t){return(e===b.Text||e===b.Binary)&&"stl"===t}},{key:"ExportContent",value:function(e,t,n,r){t===b.Text?this.ExportText(e,n):this.ExportBinary(e,n),r()}},{key:"ExportText",value:function(e,t){var n=new nx("model.stl");t.push(n);var r=new A;r.WriteLine("solid Model"),e.EnumerateTrianglesWithNormals((function(e,t,n,i){r.WriteArrayLine(["facet","normal",i.x,i.y,i.z]),r.Indent(1),r.WriteLine("outer loop"),r.Indent(1),r.WriteArrayLine(["vertex",e.x,e.y,e.z]),r.WriteArrayLine(["vertex",t.x,t.y,t.z]),r.WriteArrayLine(["vertex",n.x,n.y,n.z]),r.Indent(-1),r.WriteLine("endloop"),r.Indent(-1),r.WriteLine("endfacet")})),r.WriteLine("endsolid Model"),n.SetTextContent(r.GetText())}},{key:"ExportBinary",value:function(e,t){var n=new nx("model.stl");t.push(n);for(var r=e.TriangleCount(),i=new I(84+50*r,!0),a=0;a<80;a++)i.WriteUnsignedCharacter8(0);i.WriteUnsignedInteger32(r),e.EnumerateTrianglesWithNormals((function(e,t,n,r){i.WriteFloat32(r.x),i.WriteFloat32(r.y),i.WriteFloat32(r.z),i.WriteFloat32(e.x),i.WriteFloat32(e.y),i.WriteFloat32(e.z),i.WriteFloat32(t.x),i.WriteFloat32(t.y),i.WriteFloat32(t.z),i.WriteFloat32(n.x),i.WriteFloat32(n.y),i.WriteFloat32(n.z),i.WriteUnsignedInteger16(0)})),n.SetBufferContent(i.GetBuffer())}}]),n}(rx),dx=function(){function e(){i()(this,e),this.exporters=[new lx,new fx,new hx,new cx,new ox,new ax,new ix]}return o()(e,[{key:"AddExporter",value:function(e){this.exporters.push(e)}},{key:"Export",value:function(e,t,n,r,i){for(var a=null,o=0;o<this.exporters.length;o++){var s=this.exporters[o];if(s.CanExport(n,r)){a=s;break}}if(null!==a){var u=new ux(e,t);a.Export(u,n,(function(e){0===e.length?i.onError():i.onSuccess(e)}))}else i.onError()}}]),e}(),px=function(e){Fe(r,e);var n=Ge(r);function r(e){var i;return t(this,r),(i=n.call(this,e)).defaultDPI=90,i.defaultUnit="px",i}return a(r,[{key:"load",value:function(e,t,n,r){var i=this,a=new hc(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(n))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){var t=this;function n(e,t,n,i,a,o,s,u){if(0!=t&&0!=n){i=i*Math.PI/180,t=Math.abs(t),n=Math.abs(n);var l=(s.x-u.x)/2,c=(s.y-u.y)/2,h=Math.cos(i)*l+Math.sin(i)*c,f=-Math.sin(i)*l+Math.cos(i)*c,d=t*t,p=n*n,v=h*h,m=f*f,g=v/d+m/p;if(g>1){var y=Math.sqrt(g);d=(t*=y)*t,p=(n*=y)*n}var x=d*m+p*v,_=(d*p-x)/x,b=Math.sqrt(Math.max(0,_));a===o&&(b=-b);var T=b*t*f/n,M=-b*n*h/t,w=Math.cos(i)*T-Math.sin(i)*M+(s.x+u.x)/2,S=Math.sin(i)*T+Math.cos(i)*M+(s.y+u.y)/2,E=r(1,0,(h-T)/t,(f-M)/n),k=r((h-T)/t,(f-M)/n,(-h-T)/t,(-f-M)/n)%(2*Math.PI);e.currentPath.absellipse(w,S,t,n,E,E+k,0===o,i)}else e.lineTo(u.x,u.y)}function r(e,t,n,r){var i=e*n+t*r,a=Math.sqrt(e*e+t*t)*Math.sqrt(n*n+r*r),o=Math.acos(Math.max(-1,Math.min(1,i/a)));return e*r-t*n<0&&(o=-o),o}function i(e,t){t=Object.assign({},t);var n={};if(e.hasAttribute("class"))for(var r=e.getAttribute("class").split(/\s/).filter(Boolean).map((function(e){return e.trim()})),i=0;i<r.length;i++)n=Object.assign(n,d["."+r[i]]);function a(r,i,a){void 0===a&&(a=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(r)&&(t[i]=a(e.getAttribute(r))),n[r]&&(t[i]=a(n[r])),e.style&&""!==e.style[r]&&(t[i]=a(e.style[r]))}function o(e){return Math.max(0,Math.min(1,l(e)))}function s(e){return Math.max(0,l(e))}return e.hasAttribute("id")&&(n=Object.assign(n,d["#"+e.getAttribute("id")])),a("fill","fill"),a("fill-opacity","fillOpacity",o),a("fill-rule","fillRule"),a("opacity","opacity",o),a("stroke","stroke"),a("stroke-opacity","strokeOpacity",o),a("stroke-width","strokeWidth",s),a("stroke-linejoin","strokeLineJoin"),a("stroke-linecap","strokeLineCap"),a("stroke-miterlimit","strokeMiterLimit",s),a("visibility","visibility"),t}function a(e,t){return e-(t-e)}function o(e,t,n){if("string"!=typeof e)throw new TypeError("Invalid input: "+Ap(e));var r,i={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},a=0,o=!0,s="",u="",l=[];function c(e,t,n){var r=new SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw r.partial=n,r}function h(){""!==s&&(""===u?l.push(Number(s)):l.push(Number(s)*Math.pow(10,Number(u)))),s="",u=""}for(var f=e.length,d=0;d<f;d++)if(r=e[d],Array.isArray(t)&&t.includes(l.length%n)&&i.FLAGS.test(r))a=1,s=r,h();else{if(0===a){if(i.WHITESPACE.test(r))continue;if(i.DIGIT.test(r)||i.SIGN.test(r)){a=1,s=r;continue}if(i.POINT.test(r)){a=2,s=r;continue}i.COMMA.test(r)&&(o&&c(r,d,l),o=!0)}if(1===a){if(i.DIGIT.test(r)){s+=r;continue}if(i.POINT.test(r)){s+=r,a=2;continue}if(i.EXP.test(r)){a=3;continue}i.SIGN.test(r)&&1===s.length&&i.SIGN.test(s[0])&&c(r,d,l)}if(2===a){if(i.DIGIT.test(r)){s+=r;continue}if(i.EXP.test(r)){a=3;continue}i.POINT.test(r)&&"."===s[s.length-1]&&c(r,d,l)}if(3===a){if(i.DIGIT.test(r)){u+=r;continue}if(i.SIGN.test(r)){if(""===u){u+=r;continue}1===u.length&&i.SIGN.test(u)&&c(r,d,l)}}i.WHITESPACE.test(r)?(h(),a=0,o=!1):i.COMMA.test(r)?(h(),a=0,o=!0):i.SIGN.test(r)?(h(),a=1,s=r):i.POINT.test(r)?(h(),a=2,s=r):c(r,d,l)}return h(),l}var s=["mm","cm","in","pt","pc","px"],u={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function l(e){var n="px";if("string"==typeof e||e instanceof String)for(var r=0,i=s.length;r<i;r++){var a=s[r];if(e.endsWith(a)){n=a,e=e.substring(0,e.length-a.length);break}}var o=void 0;return"px"===n&&"px"!==t.defaultUnit?o=u.in[t.defaultUnit]/t.defaultDPI:(o=u[n][t.defaultUnit])<0&&(o=u[n].in*t.defaultDPI),o*parseFloat(e)}function c(e){var t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function h(e){var t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}var f=[],d={},p=[],v=new Nn,m=new Nn,g=new Nn,y=new Nn,x=new Pn,_=new ar,b=new Nn,T=(new DOMParser).parseFromString(e,"image/svg+xml");return function e(t,r){if(1===t.nodeType){var s=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;var t=function(e){var t=new Nn,n=v;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){var r=l(e.getAttribute("x")),i=l(e.getAttribute("y"));t.translate(r,i)}if(e.hasAttribute("transform"))for(var a=e.getAttribute("transform").split(")"),s=a.length-1;s>=0;s--){var u=a[s].trim();if(""!==u){var c=u.indexOf("("),h=u.length;if(c>0&&c<h){var f=u.slice(0,c),d=o(u.slice(c+1));switch(n.identity(),f){case"translate":if(d.length>=1){var p=d[0],x=0;d.length>=2&&(x=d[1]),n.translate(p,x)}break;case"rotate":if(d.length>=1){var _=0,b=0,T=0;_=-d[0]*Math.PI/180,d.length>=3&&(b=d[1],T=d[2]),m.identity().translate(-b,-T),g.identity().rotate(_),y.multiplyMatrices(g,m),m.identity().translate(b,T),n.multiplyMatrices(m,y)}break;case"scale":if(d.length>=1){var M=d[0],w=M;d.length>=2&&(w=d[1]),n.scale(M,w)}break;case"skewX":1===d.length&&n.set(1,Math.tan(d[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===d.length&&n.set(1,0,0,Math.tan(d[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===d.length&&n.set(d[0],d[2],d[4],d[1],d[3],d[5],0,0,1)}}t.premultiply(n)}}return t}(e);p.length>0&&t.premultiply(p[p.length-1]);return b.copy(t),p.push(t),t}(t),u=!1,T=null;switch(t.nodeName){case"svg":case"g":r=i(t,r);break;case"style":!function(e){if(!e.sheet||!e.sheet.cssRules||!e.sheet.cssRules.length)return;for(var t=0;t<e.sheet.cssRules.length;t++){var n=e.sheet.cssRules[t];if(1===n.type)for(var r=n.selectorText.split(/,/gm).filter(Boolean).map((function(e){return e.trim()})),i=0;i<r.length;i++){var a=Object.fromEntries(Object.entries(n.style).filter((function(e){return""!==nt(e,2)[1]})));d[r[i]]=Object.assign(d[r[i]]||{},a)}}}(t);break;case"path":r=i(t,r),t.hasAttribute("d")&&(T=function(e){for(var t=new jc,r=new Pn,i=new Pn,s=new Pn,u=!0,l=!1,c=e.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),h=0,f=c.length;h<f;h++){var d=c[h],p=d.charAt(0),v=d.slice(1).trim();!0===u&&(l=!0,u=!1);var m=void 0;switch(p){case"M":for(var g=0,y=(m=o(v)).length;g<y;g+=2)r.x=m[g+0],r.y=m[g+1],i.x=r.x,i.y=r.y,0===g?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===g&&s.copy(r);break;case"H":for(var x=0,_=(m=o(v)).length;x<_;x++)r.x=m[x],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===x&&!0===l&&s.copy(r);break;case"V":for(var b=0,T=(m=o(v)).length;b<T;b++)r.y=m[b],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===b&&!0===l&&s.copy(r);break;case"L":for(var M=0,w=(m=o(v)).length;M<w;M+=2)r.x=m[M+0],r.y=m[M+1],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===M&&!0===l&&s.copy(r);break;case"C":for(var S=0,E=(m=o(v)).length;S<E;S+=6)t.bezierCurveTo(m[S+0],m[S+1],m[S+2],m[S+3],m[S+4],m[S+5]),i.x=m[S+2],i.y=m[S+3],r.x=m[S+4],r.y=m[S+5],0===S&&!0===l&&s.copy(r);break;case"S":for(var k=0,A=(m=o(v)).length;k<A;k+=4)t.bezierCurveTo(a(r.x,i.x),a(r.y,i.y),m[k+0],m[k+1],m[k+2],m[k+3]),i.x=m[k+0],i.y=m[k+1],r.x=m[k+2],r.y=m[k+3],0===k&&!0===l&&s.copy(r);break;case"Q":for(var C=0,I=(m=o(v)).length;C<I;C+=4)t.quadraticCurveTo(m[C+0],m[C+1],m[C+2],m[C+3]),i.x=m[C+0],i.y=m[C+1],r.x=m[C+2],r.y=m[C+3],0===C&&!0===l&&s.copy(r);break;case"T":for(var R=0,L=(m=o(v)).length;R<L;R+=2){var P=a(r.x,i.x),N=a(r.y,i.y);t.quadraticCurveTo(P,N,m[R+0],m[R+1]),i.x=P,i.y=N,r.x=m[R+0],r.y=m[R+1],0===R&&!0===l&&s.copy(r)}break;case"A":for(var O=0,D=(m=o(v,[3,4],7)).length;O<D;O+=7)if(m[O+5]!=r.x||m[O+6]!=r.y){var F=r.clone();r.x=m[O+5],r.y=m[O+6],i.x=r.x,i.y=r.y,n(t,m[O],m[O+1],m[O+2],m[O+3],m[O+4],F,r),0===O&&!0===l&&s.copy(r)}break;case"m":for(var U=0,G=(m=o(v)).length;U<G;U+=2)r.x+=m[U+0],r.y+=m[U+1],i.x=r.x,i.y=r.y,0===U?t.moveTo(r.x,r.y):t.lineTo(r.x,r.y),0===U&&s.copy(r);break;case"h":for(var z=0,V=(m=o(v)).length;z<V;z++)r.x+=m[z],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===z&&!0===l&&s.copy(r);break;case"v":for(var B=0,W=(m=o(v)).length;B<W;B++)r.y+=m[B],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===B&&!0===l&&s.copy(r);break;case"l":for(var H=0,j=(m=o(v)).length;H<j;H+=2)r.x+=m[H+0],r.y+=m[H+1],i.x=r.x,i.y=r.y,t.lineTo(r.x,r.y),0===H&&!0===l&&s.copy(r);break;case"c":for(var q=0,X=(m=o(v)).length;q<X;q+=6)t.bezierCurveTo(r.x+m[q+0],r.y+m[q+1],r.x+m[q+2],r.y+m[q+3],r.x+m[q+4],r.y+m[q+5]),i.x=r.x+m[q+2],i.y=r.y+m[q+3],r.x+=m[q+4],r.y+=m[q+5],0===q&&!0===l&&s.copy(r);break;case"s":for(var Y=0,K=(m=o(v)).length;Y<K;Y+=4)t.bezierCurveTo(a(r.x,i.x),a(r.y,i.y),r.x+m[Y+0],r.y+m[Y+1],r.x+m[Y+2],r.y+m[Y+3]),i.x=r.x+m[Y+0],i.y=r.y+m[Y+1],r.x+=m[Y+2],r.y+=m[Y+3],0===Y&&!0===l&&s.copy(r);break;case"q":for(var Z=0,J=(m=o(v)).length;Z<J;Z+=4)t.quadraticCurveTo(r.x+m[Z+0],r.y+m[Z+1],r.x+m[Z+2],r.y+m[Z+3]),i.x=r.x+m[Z+0],i.y=r.y+m[Z+1],r.x+=m[Z+2],r.y+=m[Z+3],0===Z&&!0===l&&s.copy(r);break;case"t":for(var Q=0,$=(m=o(v)).length;Q<$;Q+=2){var ee=a(r.x,i.x),te=a(r.y,i.y);t.quadraticCurveTo(ee,te,r.x+m[Q+0],r.y+m[Q+1]),i.x=ee,i.y=te,r.x=r.x+m[Q+0],r.y=r.y+m[Q+1],0===Q&&!0===l&&s.copy(r)}break;case"a":for(var ne=0,re=(m=o(v,[3,4],7)).length;ne<re;ne+=7)if(0!=m[ne+5]||0!=m[ne+6]){var ie=r.clone();r.x+=m[ne+5],r.y+=m[ne+6],i.x=r.x,i.y=r.y,n(t,m[ne],m[ne+1],m[ne+2],m[ne+3],m[ne+4],ie,r),0===ne&&!0===l&&s.copy(r)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(r.copy(s),t.currentPath.currentPoint.copy(r),u=!0);break;default:console.warn(d)}l=!1}return t}(t));break;case"rect":r=i(t,r),T=function(e){var t=l(e.getAttribute("x")||0),n=l(e.getAttribute("y")||0),r=l(e.getAttribute("rx")||e.getAttribute("ry")||0),i=l(e.getAttribute("ry")||e.getAttribute("rx")||0),a=l(e.getAttribute("width")),o=l(e.getAttribute("height")),s=.448084975506,u=new jc;u.moveTo(t+r,n),u.lineTo(t+a-r,n),(0!==r||0!==i)&&u.bezierCurveTo(t+a-r*s,n,t+a,n+i*s,t+a,n+i);u.lineTo(t+a,n+o-i),(0!==r||0!==i)&&u.bezierCurveTo(t+a,n+o-i*s,t+a-r*s,n+o,t+a-r,n+o);u.lineTo(t+r,n+o),(0!==r||0!==i)&&u.bezierCurveTo(t+r*s,n+o,t,n+o-i*s,t,n+o-i);u.lineTo(t,n+i),(0!==r||0!==i)&&u.bezierCurveTo(t,n+i*s,t+r*s,n,t+r,n);return u}(t);break;case"polygon":r=i(t,r),T=function(e){function t(e,t,n){var a=l(t),o=l(n);0===i?r.moveTo(a,o):r.lineTo(a,o),i++}var n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new jc,i=0;return e.getAttribute("points").replace(n,t),r.currentPath.autoClose=!0,r}(t);break;case"polyline":r=i(t,r),T=function(e){function t(e,t,n){var a=l(t),o=l(n);0===i?r.moveTo(a,o):r.lineTo(a,o),i++}var n=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,r=new jc,i=0;return e.getAttribute("points").replace(n,t),r.currentPath.autoClose=!1,r}(t);break;case"circle":r=i(t,r),T=function(e){var t=l(e.getAttribute("cx")||0),n=l(e.getAttribute("cy")||0),r=l(e.getAttribute("r")||0),i=new Ku;i.absarc(t,n,r,0,2*Math.PI);var a=new jc;return a.subPaths.push(i),a}(t);break;case"ellipse":r=i(t,r),T=function(e){var t=l(e.getAttribute("cx")||0),n=l(e.getAttribute("cy")||0),r=l(e.getAttribute("rx")||0),i=l(e.getAttribute("ry")||0),a=new Ku;a.absellipse(t,n,r,i,0,2*Math.PI);var o=new jc;return o.subPaths.push(a),o}(t);break;case"line":r=i(t,r),T=function(e){var t=l(e.getAttribute("x1")||0),n=l(e.getAttribute("y1")||0),r=l(e.getAttribute("x2")||0),i=l(e.getAttribute("y2")||0),a=new jc;return a.moveTo(t,n),a.lineTo(r,i),a.currentPath.autoClose=!1,a}(t);break;case"defs":u=!0;break;case"use":r=i(t,r);var M=(t.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),w=t.viewportElement.getElementById(M);w?e(w,r):console.warn("SVGLoader: 'use node' references non-existent node id: "+M)}T&&(void 0!==r.fill&&"none"!==r.fill&&T.color.setStyle(r.fill),function(e,t){function n(e){_.set(e.x,e.y,1).applyMatrix3(t),e.set(_.x,_.y)}for(var r=function(e){return 0!==e.elements[1]||0!==e.elements[3]}(t),i=e.subPaths,a=0,o=i.length;a<o;a++)for(var s=i[a].curves,u=0;u<s.length;u++){var l=s[u];l.isLineCurve?(n(l.v1),n(l.v2)):l.isCubicBezierCurve?(n(l.v0),n(l.v1),n(l.v2),n(l.v3)):l.isQuadraticBezierCurve?(n(l.v0),n(l.v1),n(l.v2)):l.isEllipseCurve&&(r&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),x.set(l.aX,l.aY),n(x),l.aX=x.x,l.aY=x.y,l.xRadius*=c(t),l.yRadius*=h(t))}}(T,b),f.push(T),T.userData={node:t,style:r});for(var S=t.childNodes,E=0;E<S.length;E++){var k=S[E];u&&"style"!==k.nodeName&&"defs"!==k.nodeName||e(k,r)}s&&(p.pop(),p.length>0?b.copy(p[p.length-1]):b.identity())}}(T.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:f,xml:T.documentElement}}}],[{key:"createShapes",value:function(e){var t=999999999,n=0,r=1,i=2,a=3,o=4,s=5,u=6,l={loc:n,t:0};function c(e,t,r,a){var o=e.x,s=t.x,u=r.x,c=a.x,f=e.y,d=t.y,p=r.y,v=a.y,m=(c-u)*(f-p)-(v-p)*(o-u),g=(v-p)*(s-o)-(c-u)*(d-f),y=m/g,x=((s-o)*(f-p)-(d-f)*(o-u))/g;if(0===g&&0!==m||y<=0||y>=1||x<0||x>1)return null;if(0===m&&0===g){for(var _=0;_<2;_++){if(h(0===_?r:a,e,t),l.loc==n){var b=0===_?r:a;return{x:b.x,y:b.y,t:l.t}}if(l.loc==i)return{x:+(o+l.t*(s-o)).toPrecision(10),y:+(f+l.t*(d-f)).toPrecision(10),t:l.t}}return null}for(var T=0;T<2;T++)if(h(0===T?r:a,e,t),l.loc==n){var M=0===T?r:a;return{x:M.x,y:M.y,t:l.t}}return{x:+(o+y*(s-o)).toPrecision(10),y:+(f+y*(d-f)).toPrecision(10),t:y}}function h(e,t,c){var h,f=c.x-t.x,d=c.y-t.y,p=e.x-t.x,v=e.y-t.y,m=f*v-p*d;if(e.x===t.x&&e.y===t.y)return l.loc=n,void(l.t=0);if(e.x===c.x&&e.y===c.y)return l.loc=r,void(l.t=1);m<-Number.EPSILON?l.loc=a:m>Number.EPSILON?l.loc=o:f*p<0||d*v<0?l.loc=s:Math.sqrt(f*f+d*d)<Math.sqrt(p*p+v*v)?l.loc=u:(h=0!==f?p/f:v/d,l.loc=i,l.t=h)}function f(e,t,n){var r=new Pn;t.getCenter(r);var i=[];return n.forEach((function(t){if(t.boundingBox.containsPoint(r)){var n=function(e,t){for(var n=[],r=[],i=1;i<e.length;i++)for(var a=e[i-1],o=e[i],s=function(e){var i=t[e-1],s=t[e],u=c(a,o,i,s);null!==u&&void 0===n.find((function(e){return e.t<=u.t+Number.EPSILON&&e.t>=u.t-Number.EPSILON}))&&(n.push(u),r.push(new Pn(u.x,u.y)))},u=1;u<t.length;u++)s(u);return r}(e,t.points);n.forEach((function(e){i.push({identifier:t.identifier,isCW:t.isCW,point:e})}))}})),i.sort((function(e,t){return e.point.x-t.point.x})),i}var d=0,p=t,v=-999999999,m=e.subPaths.map((function(e){for(var n=e.getPoints(),r=-999999999,i=t,a=-999999999,o=t,s=0;s<n.length;s++){var u=n[s];u.y>r&&(r=u.y),u.y<i&&(i=u.y),u.x>a&&(a=u.x),u.x<o&&(o=u.x)}return v<=a&&(v=a+1),p>=o&&(p=o-1),{curves:e.curves,points:n,isCW:Il.isClockWise(n),identifier:d++,boundingBox:new Hc(new Pn(o,i),new Pn(a,r))}})),g=(m=m.filter((function(e){return e.points.length>1}))).map((function(t){var n;return function(e,t,n,r,i){null!=i&&""!==i||(i="nonzero");var a=new Pn;e.boundingBox.getCenter(a);var o=f([new Pn(n,a.y),new Pn(r,a.y)],e.boundingBox,t);o.sort((function(e,t){return e.point.x-t.point.x}));var s=[],u=[];o.forEach((function(t){t.identifier===e.identifier?s.push(t):u.push(t)}));for(var l=s[0].point.x,c=[],h=0;h<u.length&&u[h].point.x<l;)c.length>0&&c[c.length-1]===u[h].identifier?c.pop():c.push(u[h].identifier),h++;if(c.push(e.identifier),"evenodd"===i){var d=c.length%2==0,p=c[c.length-2];return{identifier:e.identifier,isHole:d,for:p}}if("nonzero"===i){for(var v=!0,m=null,g=null,y=0;y<c.length;y++){var x=c[y];v?(g=t[x].isCW,v=!1,m=x):g!==t[x].isCW&&(g=t[x].isCW,v=!0)}return{identifier:e.identifier,isHole:v,for:m}}console.warn('fill-rule: "'+i+'" is currently not implemented.')}(t,m,p,v,null===(n=e.userData)||void 0===n?void 0:n.style.fillRule)})),y=[];return m.forEach((function(e){if(!g[e.identifier].isHole){var t=new rl;t.curves=e.curves,g.filter((function(t){return t.isHole&&t.for===e.identifier})).forEach((function(e){var n=m[e.identifier],r=new Ku;r.curves=n.curves,t.holes.push(r)})),y.push(t)}})),y}},{key:"getStrokeStyle",value:function(e,t,n,r,i){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:n=void 0!==n?n:"miter",strokeLineCap:r=void 0!==r?r:"butt",strokeMiterLimit:i=void 0!==i?i:4}}},{key:"pointsToStroke",value:function(e,t,n,i){var a=[],o=[],s=[];if(0===r.pointsToStrokeWithBuffers(e,t,n,i,a,o,s))return null;var u=new Oi;return u.setAttribute("position",new ki(a,3)),u.setAttribute("normal",new ki(o,3)),u.setAttribute("uv",new ki(s,2)),u}},{key:"pointsToStrokeWithBuffers",value:function(e,t,n,r,i,a,o,s){var u=new Pn,l=new Pn,c=new Pn,h=new Pn,f=new Pn,d=new Pn,p=new Pn,v=new Pn,m=new Pn,g=new Pn,y=new Pn,x=new Pn,_=new Pn,b=new Pn,T=new Pn,M=new Pn,w=new Pn;n=void 0!==n?n:12,r=void 0!==r?r:.001,s=void 0!==s?s:0,e=function(e){for(var t=!1,n=1,i=e.length-1;n<i;n++)if(e[n].distanceTo(e[n+1])<r){t=!0;break}if(!t)return e;var a=[];a.push(e[0]);for(var o=1,s=e.length-1;o<s;o++)e[o].distanceTo(e[o+1])>=r&&a.push(e[o]);return a.push(e[e.length-1]),a}(e);var S=e.length;if(S<2)return 0;var E,k,A,C,I,R,L=e[0].equals(e[S-1]),P=e[0],N=t.strokeWidth/2,O=1/(S-1),D=0,F=!1,U=0,G=3*s,z=2*s;J(e[0],e[1],u).multiplyScalar(N),v.copy(e[0]).sub(u),m.copy(e[0]).add(u),g.copy(v),y.copy(m);for(var V=1;V<S;V++){E=e[V],k=V===S-1?L?e[1]:void 0:e[V+1];var B=u;if(J(P,E,B),c.copy(B).multiplyScalar(N),x.copy(E).sub(c),_.copy(E).add(c),A=D+O,C=!1,void 0!==k){J(E,k,l),c.copy(l).multiplyScalar(N),b.copy(E).sub(c),T.copy(E).add(c),I=!0,c.subVectors(k,P),B.dot(c)<0&&(I=!1),1===V&&(F=I),c.subVectors(k,E),c.normalize();var W=Math.abs(B.dot(c));if(W>Number.EPSILON){var H=N/W;c.multiplyScalar(-H),h.subVectors(E,P),f.copy(h).setLength(H).add(c),M.copy(f).negate();var j=f.length(),q=h.length();h.divideScalar(q),d.subVectors(k,E);var X=d.length();switch(d.divideScalar(X),h.dot(M)<q&&d.dot(M)<X&&(C=!0),w.copy(f).add(E),M.add(E),R=!1,C?I?(T.copy(M),_.copy(M)):(b.copy(M),x.copy(M)):ee(),t.strokeLineJoin){case"bevel":te(I,C,A);break;case"round":ne(I,C),I?$(E,x,b,A,0):$(E,T,_,A,1);break;default:var Y=N*t.strokeMiterLimit/j;if(Y<1){if("miter-clip"!==t.strokeLineJoin){te(I,C,A);break}ne(I,C),I?(d.subVectors(w,x).multiplyScalar(Y).add(x),p.subVectors(w,b).multiplyScalar(Y).add(b),Q(x,A,0),Q(d,A,0),Q(E,A,.5),Q(E,A,.5),Q(d,A,0),Q(p,A,0),Q(E,A,.5),Q(p,A,0),Q(b,A,0)):(d.subVectors(w,_).multiplyScalar(Y).add(_),p.subVectors(w,T).multiplyScalar(Y).add(T),Q(_,A,1),Q(d,A,1),Q(E,A,.5),Q(E,A,.5),Q(d,A,1),Q(p,A,1),Q(E,A,.5),Q(p,A,1),Q(T,A,1))}else C?(I?(Q(m,D,1),Q(v,D,0),Q(w,A,0),Q(m,D,1),Q(w,A,0),Q(M,A,1)):(Q(m,D,1),Q(v,D,0),Q(w,A,1),Q(v,D,0),Q(M,A,0),Q(w,A,1)),I?b.copy(w):T.copy(w)):I?(Q(x,A,0),Q(w,A,0),Q(E,A,.5),Q(E,A,.5),Q(w,A,0),Q(b,A,0)):(Q(_,A,1),Q(w,A,1),Q(E,A,.5),Q(E,A,.5),Q(w,A,1),Q(T,A,1)),R=!0}}else ee()}else ee();L||V!==S-1||re(e[0],g,y,I,!0,D),D=A,P=E,v.copy(b),m.copy(T)}if(L){if(C&&i){var K=w,Z=M;F!==I&&(K=M,Z=w),I?(R||F)&&(Z.toArray(i,0),Z.toArray(i,9),R&&K.toArray(i,3)):!R&&F||(Z.toArray(i,3),Z.toArray(i,9),R&&K.toArray(i,0))}}else re(E,x,_,I,!1,A);return U;function J(e,t,n){return n.subVectors(t,e),n.set(-n.y,n.x).normalize()}function Q(e,t,n){i&&(i[G]=e.x,i[G+1]=e.y,i[G+2]=0,a&&(a[G]=0,a[G+1]=0,a[G+2]=1),G+=3,o&&(o[z]=t,o[z+1]=n,z+=2)),U+=3}function $(e,t,r,i,a){u.copy(t).sub(e).normalize(),l.copy(r).sub(e).normalize();var o=Math.PI,s=u.dot(l);Math.abs(s)<1&&(o=Math.abs(Math.acos(s))),o/=n,c.copy(t);for(var f=0,d=n-1;f<d;f++)h.copy(c).rotateAround(e,o),Q(c,i,a),Q(h,i,a),Q(e,i,.5),c.copy(h);Q(h,i,a),Q(r,i,a),Q(e,i,.5)}function ee(){Q(m,D,1),Q(v,D,0),Q(x,A,0),Q(m,D,1),Q(x,A,1),Q(_,A,0)}function te(e,t,n){t?e?(Q(m,D,1),Q(v,D,0),Q(x,A,0),Q(m,D,1),Q(x,A,0),Q(M,A,1),Q(x,n,0),Q(b,n,0),Q(M,n,.5)):(Q(m,D,1),Q(v,D,0),Q(_,A,1),Q(v,D,0),Q(M,A,0),Q(_,A,1),Q(_,n,1),Q(T,n,0),Q(M,n,.5)):e?(Q(x,n,0),Q(b,n,0),Q(E,n,.5)):(Q(_,n,1),Q(T,n,0),Q(E,n,.5))}function ne(e,t){t&&(e?(Q(m,D,1),Q(v,D,0),Q(x,A,0),Q(m,D,1),Q(x,A,0),Q(M,A,1),Q(x,D,0),Q(E,A,.5),Q(M,A,1),Q(E,A,.5),Q(b,D,0),Q(M,A,1)):(Q(m,D,1),Q(v,D,0),Q(_,A,1),Q(v,D,0),Q(M,A,0),Q(_,A,1),Q(_,D,1),Q(M,A,0),Q(E,A,.5),Q(E,A,.5),Q(M,A,0),Q(T,D,1)))}function re(e,n,r,a,o,s){switch(t.strokeLineCap){case"round":o?$(e,r,n,s,.5):$(e,n,r,s,.5);break;case"square":if(o)u.subVectors(n,e),l.set(u.y,-u.x),c.addVectors(u,l).add(e),h.subVectors(l,u).add(e),a?(c.toArray(i,3),h.toArray(i,0),h.toArray(i,9)):(c.toArray(i,3),c.toArray(i,9),h.toArray(i,0));else{u.subVectors(r,e),l.set(u.y,-u.x),c.addVectors(u,l).add(e),h.subVectors(l,u).add(e);var f=i.length;a?(c.toArray(i,f-3),h.toArray(i,f-6),h.toArray(i,f-12)):(c.toArray(i,f-6),h.toArray(i,f-3),h.toArray(i,f-12))}}}}}]),r}(uc),vx=function(e){Ue()(n,e);var t=ze()(n);function n(){return i()(this,n),t.call(this)}return o()(n,[{key:"CanImportExtension",value:function(e){return"svg"===e}},{key:"GetUpDirection",value:function(){return ie.Z}},{key:"CreateLoader",value:function(e){return new px(e)}},{key:"GetMainObject",value:function(e){function t(e){var t=e.userData.style;return void 0!==t.fill&&"none"!==t.fill}function n(e,t,n){var r,i=null,a=d()(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(o.style===t&&o.opacity===n){i=o.material;break}}}catch(e){a.e(e)}finally{a.f()}return null===i&&(i=new Fl({color:(new Yn).setStyle(t),opacity:n,transparent:n<1}),e.push({style:t,opacity:n,material:i})),i}var r=[],i=new si;i.rotation.x=Math.PI;var a,o=d()(e.paths);try{for(o.s();!(a=o.n()).done;){var s=a.value,u=px.createShapes(s);if(t(s)){var l,c=s.userData.style,h=n(r,c.fill,c.opacity),f=d()(u);try{for(f.s();!(l=f.n()).done;){var p=l.value,v=new Pl(p,{depth:10,bevelEnabled:!1}),m=new $i(v,h);m.name=s.userData.node.id,i.add(m)}}catch(e){f.e(e)}finally{f.f()}}}}catch(e){o.e(e)}finally{o.f()}return i}}]),n}(Lg)}(),r}()}));